<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Takawala - Ultimate Final</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- Firebase SDK (Full inline) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap');
        
        body { 
            font-family: 'Hind Siliguri', sans-serif; 
            background: #f8fafc;
            color: #1e293b;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* ADVERTISEMENT STYLES */
        .ad-container {
            margin: 15px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .ad-banner {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }
        
        .interstitial-ad {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10001;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }

        /* PREMIUM GRADIENT */
        .bg-premium { background: linear-gradient(135deg, #059669 0%, #047857 50%, #d97706 100%); }
        
        /* GLASS EFFECTS */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* SELECTION HIGHLIGHT */
        .select-active { border: 2px solid #059669; background: #ecfdf5; transform: scale(1.05); }

        /* SCROLL HIDE */
        ::-webkit-scrollbar { width: 0px; }
        
        /* RECEIPT FONT */
        .receipt-font { font-family: 'Courier New', monospace; }

        /* ‚úÖ FIXED NOTIFICATION - 2-3 SECONDS ONLY */
        #notificationMessage {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100000;
            min-width: 300px;
            max-width: 90%;
            width: auto;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            animation: slideDown 0.3s ease, fadeOut 0.3s ease 2.5s;
            animation-fill-mode: forwards;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
        }
        
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; visibility: visible; }
            to { opacity: 0; visibility: hidden; }
        }
        
        .notification-success {
            background: #10b981;
            color: white;
            border-left: 5px solid #047857;
        }
        
        .notification-error {
            background: #ef4444;
            color: white;
            border-left: 5px solid #dc2626;
        }
        
        .notification-info {
            background: #3b82f6;
            color: white;
            border-left: 5px solid #1d4ed8;
        }
        
        .notification-close {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-left: 10px;
            line-height: 1;
            flex-shrink: 0;
        }

        /* LOADING ANIMATION */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loading-logo {
            width: 100px;
            animation: zoomInOut 2s ease-in-out infinite;
        }
        
        @keyframes zoomInOut {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* DISABLED STATE */
        .disabled-option {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }
        
        .disabled-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        /* ‚úÖ FIXED TEXT CONTAINERS */
        .text-container {
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            overflow-wrap: break-word;
            max-width: 100%;
        }
        
        .address-box {
            background: #f8fafc;
            border: 1px dashed #cbd5e1;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            word-break: break-all;
            overflow-wrap: break-word;
            white-space: normal;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .address-line {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .address-line:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        /* HISTORY STATUS */
        .status-pending { color: #f59e0b; }
        .status-success { color: #10b981; }
        .status-rejected { color: #ef4444; }
        
        /* ‚úÖ COMPACT RECEIPT MODAL */
        .receipt-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .receipt-content {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 15px;
            max-width: 380px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .receipt-header {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .receipt-header h2 {
            font-size: 18px;
            margin-bottom: 4px;
        }
        
        .receipt-body {
            padding: 15px;
        }
        
        .receipt-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed #e2e8f0;
            font-size: 13px;
        }
        
        .receipt-row:last-child {
            border-bottom: none;
        }
        
        .receipt-label {
            color: #64748b;
            font-weight: 500;
            flex: 1;
        }
        
        .receipt-value {
            color: #1e293b;
            font-weight: 600;
            text-align: right;
            flex: 1;
            word-break: break-word;
            padding-left: 10px;
        }
        
        .receipt-amount {
            font-size: 24px;
            font-weight: 700;
            color: #059669;
            text-align: center;
            margin: 10px 0;
            padding: 8px;
            background: #f0fdf4;
            border-radius: 10px;
            border: 1px solid #dcfce7;
        }
        
        .receipt-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 12px;
        }
        
        .status-success-badge {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .status-pending-badge {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .status-rejected-badge {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        /* COPY BUTTON */
        .copy-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 10px;
            cursor: pointer;
            margin-left: 6px;
            flex-shrink: 0;
            white-space: nowrap;
        }
        
        .copy-btn:hover {
            background: #047857;
        }
        
        /* QUIZ TIMER */
        .quiz-timer {
            display: inline-block;
            background: #ef4444;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        /* SUBSCRIPTION STAR */
        .star-count {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            background: #fbbf24;
            color: #78350f;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* ‚úÖ REFERRAL LINK FIX */
        .referral-box {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            word-break: break-all;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid #cbd5e1;
            text-align: center;
        }
        
        /* PROOF SUBMISSION MODAL */
        .proof-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .proof-content {
            background: white;
            border-radius: 20px;
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }
        
        .task-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3b82f6;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* ‚úÖ HISTORY ITEM STYLES */
        .history-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        /* ‚úÖ MONITAG AD STYLES */
        .monitag-ad {
            width: 100%;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .ad-placeholder {
            padding: 20px;
            text-align: center;
            color: #64748b;
            font-size: 14px;
        }
        
        /* ‚úÖ SIMPLE HISTORY LOADING */
        .history-loading {
            text-align: center;
            padding: 40px 20px;
        }
        
        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }

        /* ‚úÖ GLOBAL CHAT ICON */
        #globalChatIcon {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 9999;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            cursor: pointer;
            border: 3px solid white;
            transition: all 0.3s ease;
        }
        
        #globalChatIcon:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.6);
        }
        
        #globalChatIcon i {
            font-size: 28px;
            color: white;
        }
        
        /* MAINTENANCE MODE */
        .maintenance-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            z-index: 999999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }
        
        .maintenance-content {
            text-align: center;
            max-width: 500px;
        }
        
        .maintenance-content img {
            width: 150px;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* ‚úÖ TWAI CHATBOT STYLES */
        #twaiChatbotIcon {
            position: fixed;
            bottom: 170px;
            right: 20px;
            z-index: 9998;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            cursor: pointer;
            border: 3px solid white;
            transition: all 0.3s ease;
        }
        
        #twaiChatbotIcon:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(139, 92, 246, 0.6);
        }
        
        #twaiChatbotIcon i {
            font-size: 28px;
            color: white;
        }
        
        .chatbot-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10010;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .chatbot-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            padding: 15px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chatbot-header h3 {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chatbot-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            max-height: 400px;
        }
        
        .chat-message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .user-message {
            align-items: flex-end;
        }
        
        .bot-message {
            align-items: flex-start;
        }
        
        .message-bubble {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .user-bubble {
            background: #3b82f6;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .bot-bubble {
            background: #f1f5f9;
            color: #1e293b;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 4px;
        }
        
        .quick-questions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .quick-question {
            background: #e2e8f0;
            border: none;
            padding: 8px 10px;
            border-radius: 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .quick-question:hover {
            background: #cbd5e1;
        }
        
        .chatbot-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            background: white;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #cbd5e1;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
        }
        
        .chatbot-input button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* ‚úÖ DRIVE OFFER SCREEN */
        #driveOfferScreen {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: white;
        }
        
        .drive-header {
            padding: 40px 20px;
            text-align: center;
        }
        
        .drive-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.8;
        }
        
        /* ‚úÖ HISTORY FILTER STYLES */
        .history-filter {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }
        
        .filter-btn {
            white-space: nowrap;
            padding: 8px 15px;
            border-radius: 20px;
            background: #f1f5f9;
            border: none;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #059669;
            color: white;
        }
    </style>
</head>
<body class="bg-slate-50">

    <!-- MAINTENANCE SCREEN (HIDDEN BY DEFAULT) -->
    <div id="maintenanceScreen" class="maintenance-screen hidden">
        <div class="maintenance-content">
            <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" alt="Logo">
            <h1 class="text-4xl font-bold mb-4">üîß ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá</h1>
            <p class="text-xl mb-6">‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶æ‡¶á‡¶ü‡¶ü‡¶ø‡¶ï‡ßá ‡¶Ü‡¶∞‡ßã ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡¶ø</p>
            <p class="text-lg text-slate-300 mb-8">‡¶Ö‡¶≤‡ßç‡¶™ ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßã‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ß‡ßà‡¶∞‡ßç‡¶Ø‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§</p>
            <div class="bg-white/10 p-6 rounded-2xl">
                <p class="text-sm">üìû ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó: support@takawala.com</p>
                <p class="text-sm mt-2">üì± ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ: @TAKAR_WALA_ADMIN</p>
            </div>
        </div>
    </div>

    <!-- ‚úÖ GLOBAL CHAT ICON -->
    <div id="globalChatIcon" onclick="window.openSupport()">
        <i class="ri-customer-service-2-fill"></i>
    </div>
    
    <!-- ‚úÖ TWAI CHATBOT ICON -->
    <div id="twaiChatbotIcon" onclick="window.openTWAI()">
        <i class="ri-robot-2-fill"></i>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="loading-logo">
    </div>

    <!-- ‚úÖ NOTIFICATION MESSAGE - AUTO HIDE AFTER 2.5 SECONDS -->
    <div id="notificationMessage" class="hidden">
        <span id="notificationText" class="text-container"></span>
        <button id="notificationClose" class="notification-close">√ó</button>
    </div>

    <!-- MONITAG INTERSTITIAL AD (HIDDEN INITIALLY) -->
    <div id="monitagInterstitial" class="interstitial-ad hidden">
        <div id="interstitialContent" class="text-center">
            <h3 class="font-bold text-lg mb-3">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h3>
            <div class="monitag-ad">
                <div class="ad-placeholder">
                    <p class="mb-4">‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    <button onclick="window.openAdLink()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold text-lg">
                        üîó ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                    </button>
                </div>
            </div>
            <div id="adTimer" class="mt-4 text-red-600 font-bold">‡ßß‡ß´</div>
            <button onclick="closeInterstitialAd()" class="mt-4 bg-slate-200 text-slate-800 px-6 py-2 rounded-lg font-bold">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- ‚úÖ TWAI CHATBOT MODAL -->
    <div id="twaiModal" class="chatbot-modal hidden">
        <div class="chatbot-content">
            <div class="chatbot-header">
                <h3><i class="ri-robot-2-fill"></i> TWAI ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶ø‡¶ï‡¶æ ü§ñ</h3>
                <button onclick="window.closeTWAI()" class="bg-white/20 text-white p-2 rounded-full">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            
            <div class="chatbot-body" id="chatbotMessages">
                <div class="chat-message bot-message">
                    <div class="message-bubble bot-bubble">
                        ‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ! ‡¶Ü‡¶Æ‡¶ø TWAI (Takawala AI)‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®:
                    </div>
                    <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
                </div>
            </div>
            
            <div class="quick-questions p-4 border-t">
                <button onclick="window.askTWAI('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')" class="quick-question">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
                <button onclick="window.askTWAI('‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞')" class="quick-question">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</button>
                <button onclick="window.askTWAI('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü')" class="quick-question">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                <button onclick="window.askTWAI('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')" class="quick-question">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</button>
                <button onclick="window.askTWAI('‡¶ï‡ßÅ‡¶á‡¶ú')" class="quick-question">‡¶ï‡ßÅ‡¶á‡¶ú</button>
                <button onclick="window.askTWAI('‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú')" class="quick-question">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</button>
                <button onclick="window.askTWAI('‡¶¨‡ßç‡¶Ø‡¶æ‡¶®')" class="quick-question">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®</button>
                <button onclick="window.askTWAI('‡¶¶‡ßá‡¶∞‡¶ø')" class="quick-question">‡¶¶‡ßá‡¶∞‡¶ø</button>
            </div>
            
            <div class="chatbot-input">
                <input type="text" id="chatbotInput" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                <button onclick="window.sendTWAI()"><i class="ri-send-plane-fill"></i></button>
            </div>
        </div>
    </div>

    <div id="authScreen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        <!-- ADD BANNER AT TOP (REMOVED AS PER REQUEST) -->
        
        <div class="glass-card w-full max-w-md p-8 rounded-[35px] text-center animate__animated animate__fadeInUp">
            <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="w-32 mx-auto mb-2 drop-shadow-xl animate__animated animate__pulse animate__infinite">
            <h1 class="text-3xl font-extrabold text-slate-800 mb-1">‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ</h1>
            <p class="text-slate-500 text-sm font-medium mb-8">‡¶™‡ßç‡¶∞‡¶´‡ßá‡¶∂‡¶®‡¶æ‡¶≤ ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ</p>

            <div class="flex bg-slate-100 p-1.5 rounded-full mb-6 border border-slate-200">
                <button onclick="window.toggleAuthTab('login')" id="btnTabLogin" class="flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg transition-all">‡¶≤‡¶ó‡¶á‡¶®</button>
                <button onclick="window.toggleAuthTab('register')" id="btnTabRegister" class="flex-1 py-3 rounded-full text-sm font-bold text-slate-500 transition-all">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
            </div>

            <div id="loginForm" class="space-y-4 text-left">
                <input type="email" id="loginEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="password" id="loginPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <button id="btnLoginAction" class="w-full bg-premium text-white font-bold py-4 rounded-2xl shadow-xl active:scale-95 transition mt-2">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <div id="registerForm" class="hidden space-y-3 text-left">
                <input type="text" id="regName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="text" id="regPhone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="email" id="regEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="password" id="regPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (‡ß¨+ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="text" id="regReferralCode" placeholder="‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <button id="btnRegAction" class="w-full bg-premium text-white font-bold py-4 rounded-2xl shadow-xl active:scale-95 transition">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</button>
            </div>
            
            <!-- ADD BANNER AT BOTTOM (REMOVED AS PER REQUEST) -->
        </div>
    </div>

    <div id="mainApp" class="hidden pb-24 max-w-md mx-auto min-h-screen relative bg-white">
        
        <!-- MONITAG AD AT TOP OF MAIN APP (REMOVED AS PER REQUEST) -->
        
        <div id="homeScreen" class="animate__animated animate__fadeIn">
            <div class="bg-premium p-6 pt-8 rounded-b-[40px] text-white shadow-2xl relative overflow-hidden">
                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                <div class="relative flex justify-between items-center mb-6">
                    <div class="flex items-center gap-3" onclick="window.showPage('profileScreen')">
                        <img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-12 h-12 rounded-full border-2 border-white/50">
                        <div>
                            <h3 class="font-bold text-xl leading-tight" id="userNameDisplay">Guest</h3>
                            <div class="flex items-center gap-1">
                                <img src="https://i.postimg.cc/TwfTZM7Z/award.png" class="w-4">
                                <span class="text-xs font-bold text-yellow-200" id="userPlanDisplay">Free Member</span>
                            </div>
                        </div>
                    </div>
                    <div id="notificationIcon" class="bg-white/20 p-2 rounded-full backdrop-blur-md border border-white/30 relative cursor-pointer draggable">
                        <img src="https://i.postimg.cc/c1nSnFz4/notofication.png" class="w-6 h-6">
                        <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
                    </div>
                </div>

                <div class="bg-white/10 backdrop-blur-md rounded-[25px] p-5 text-white shadow-lg border border-white/10 relative">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-xs text-green-100 font-bold uppercase tracking-widest mb-1">‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                            <h1 class="text-4xl font-extrabold tracking-tight">‡ß≥ <span id="mainBalanceDisplay">0.00</span></h1>
                        </div>
                        <button onclick="window.showPage('walletScreen')" class="bg-white text-green-700 px-4 py-2 rounded-xl font-bold text-xs shadow-lg flex items-center gap-1 active:scale-95 transition">
                            <img src="https://i.postimg.cc/7ZGpHH5q/save-money.png" class="w-5"> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø
                        </button>
                    </div>
                </div>
            </div>

            <div class="mx-5 -mt-5 bg-white p-3 rounded-2xl shadow-lg border border-slate-100 flex items-center gap-3 relative z-20">
                <img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-6 h-6 animate-pulse">
                <marquee class="text-sm font-bold text-slate-600" id="noticeText">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá!</marquee>
            </div>

            <!-- ADD BANNER IN HOME SCREEN (REMOVED AS PER REQUEST) -->

            <div class="p-5 grid grid-cols-4 gap-4 text-center mt-2">
                <div onclick="window.showPage('taskScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/d1sXyCb6/clipboard.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span></div>
                <div onclick="window.showPage('rechargeScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/jjdpNH5b/payment-method.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</span></div>
                <div onclick="window.showPage('vipScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition relative"><img src="https://i.postimg.cc/TwfTZM7Z/award.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</span></div>
                <div onclick="window.loadHistory()" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/VNTvSLRX/transaction-history.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</span></div>
                <div onclick="window.showDailyBonus()" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/qqLQKVHV/bonus.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span></div>
                <div onclick="window.showPage('walletScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/wMdF5zV5/withdraw.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</span></div>
                <div onclick="window.showDriveOffer()" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/qByrJYrn/sim-card.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠</span></div>
                <div onclick="window.showPage('moreScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/76SnZckK/more.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶Ü‡¶∞‡ßã</span></div>
            </div>
            
            <!-- ADD BANNER AT BOTTOM OF HOME (REMOVED AS PER REQUEST) -->
        </div>

        <!-- TASK SCREEN -->
        <div id="taskScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')" class="w-8 cursor-pointer">
            </div>
            
            <!-- ADD BANNER IN TASK SCREEN (REMOVED AS PER REQUEST) -->
            
            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.switchTaskTab('free')" id="tabFreeTask" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶´‡ßç‡¶∞‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
                <button onclick="window.switchTaskTab('vip')" id="tabVipTask" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
            </div>

            <div id="taskListContainer" class="space-y-3">
                <!-- TASKS WILL BE LOADED FROM FIREBASE WITH NEW LOGOS -->
                <div class="glass-card p-3 rounded-2xl flex justify-between items-center animate__animated animate__fadeInUp">
                    <div class="flex items-center gap-3"><img src="https://i.postimg.cc/TYLvN32V/telegram.png" class="w-10"><div><h4 class="font-bold text-slate-700">Telegram Channel</h4><p class="text-[10px] text-slate-400">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®</p></div></div>
                    <button onclick="window.completeTask('telegram_task', 5)" class="bg-blue-100 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold">+‡ß≥5</button>
                </div>
            </div>
            
            <!-- ADD BANNER AT BOTTOM OF TASKS (REMOVED AS PER REQUEST) -->
        </div>

        <!-- WALLET SCREEN -->
        <div id="walletScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®')" class="w-8 cursor-pointer">
            </div>

            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-premium p-4 rounded-2xl text-white text-center shadow-lg"><p class="text-[10px] font-bold opacity-80">‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-xl font-extrabold mt-1">‡ß≥ <span id="walletMainDisplay">0.00</span></h2></div>
                <div class="bg-blue-600 p-4 rounded-2xl text-white text-center shadow-lg"><p class="text-[10px] font-bold opacity-80">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-xl font-extrabold mt-1">‡ß≥ <span id="walletRechargeDisplay">0.00</span></h2></div>
            </div>

            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.toggleWalletTab('deposit')" id="tabDeposit" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                <button onclick="window.toggleWalletTab('withdraw')" id="tabWithdraw" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                <button onclick="window.toggleWalletTab('transfer')" id="tabTransfer" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞</button>
            </div>

            <div id="depositSection">
                <div class="grid grid-cols-4 gap-3 mb-6">
                    <div onclick="window.selectPayment(this, 'bKash')" id="payment_bKash" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/C5vDR4nz/1656235223bkash-logo.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'Nagad')" id="payment_Nagad" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/k4phWWbK/1679248787Nagad-Logo.png" class="h-8 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'Rocket')" id="payment_Rocket" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'USDT')" id="payment_USDT" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain"></div>
                </div>
                <div class="glass-card p-5 rounded-[25px] space-y-4 text-center">
                    <!-- ‚úÖ DYNAMIC ADDRESS BOX - WILL UPDATE BASED ON SELECTED METHOD -->
                    <div id="depositAddressContainer" class="address-box">
                        <p class="text-slate-500">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                    
                    <input type="text" id="depositTrxId" placeholder="TrxID" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <input type="number" id="depositAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <div class="text-xs text-red-500 font-bold" id="vatCalculation">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ßß‡ß¶%): ‡ß≥0.00 | ‡¶Æ‡ßã‡¶ü: ‡ß≥0.00</div>
                    <input type="hidden" id="selectedDepositMethod" value="">
                    <button onclick="window.submitDeposit()" class="w-full bg-green-600 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="withdrawSection" class="hidden">
                 <div class="grid grid-cols-4 gap-3 mb-6">
                    <div onclick="window.selectWithdrawMethod(this, 'bKash')" id="withdraw_bKash" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/C5vDR4nz/1656235223bkash-logo.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'Nagad')" id="withdraw_Nagad" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/k4phWWbK/1679248787Nagad-Logo.png" class="h-8 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'Rocket')" id="withdraw_Rocket" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'USDT')" id="withdraw_USDT" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain"></div>
                </div>
                 <div class="glass-card p-5 rounded-[25px] space-y-4">
                    <input type="number" id="withdrawNumber" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <input type="number" id="withdrawAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <div class="text-xs text-red-500 font-bold" id="withdrawVat">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ßß‡ß¶%): ‡ß≥0.00 | ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§: ‡ß≥0.00</div>
                    <input type="hidden" id="selectedWithdrawMethod" value="">
                    <button onclick="window.submitWithdraw()" class="w-full bg-red-500 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="transferSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-4">
                    <div class="flex items-center justify-center gap-3 text-sm font-bold text-slate-600">
                        <span>‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span> <i class="ri-arrow-right-line"></i> <span>‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span>
                    </div>
                    <input type="number" id="transferAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none text-center text-xl">
                    <button onclick="window.transferBalance()" class="w-full bg-slate-800 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <p class="text-xs text-red-500">* ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
                </div>
            </div>
            
            <!-- ADD BANNER IN WALLET SCREEN (REMOVED AS PER REQUEST) -->
        </div>

        <!-- RECHARGE SCREEN -->
        <div id="rechargeScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')" class="w-8 cursor-pointer">
            </div>
            
            <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 flex justify-between items-center mb-6">
                <div><p class="text-xs font-bold text-slate-500">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-2xl font-extrabold text-blue-600">‡ß≥ <span id="rechargePageBalance">0.00</span></h2></div>
                <img src="https://i.postimg.cc/jjdpNH5b/payment-method.png" class="w-10">
            </div>

            <div class="grid grid-cols-5 gap-3 mb-6">
                <div onclick="window.selectOperator(this, 'GP')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/65w1n62J/FB-IMG-1769495932877.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'BL')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/gJ8NL1Gx/FB-IMG-1769495999103.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Robi')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/RFHbQNLZ/FB-IMG-1769495977203.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Airtel')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/Wz0CjhdX/FB-IMG-1769496019329.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Teletalk')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/TYCQbVvT/FB-IMG-1769496047333.jpg" class="h-full object-contain rounded-lg"></div>
            </div>

            <div class="glass-card p-6 rounded-[25px] space-y-4">
                 <input type="number" id="rechPhone" placeholder="‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full bg-slate-50 p-3 rounded-xl border font-bold outline-none">
                 <input type="number" id="rechAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full bg-slate-50 p-3 rounded-xl border font-bold outline-none">
                 <div class="text-xs text-red-500 font-bold" id="rechargeFee">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: ‡ß≥5 | ‡¶Æ‡ßã‡¶ü: ‡ß≥5</div>
                 <input type="hidden" id="selectedOperator" value="GP">
                 <button onclick="window.submitRecharge()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            
            <!-- ADD BANNER IN RECHARGE SCREEN (REMOVED AS PER REQUEST) -->
        </div>
        
        <!-- ‚úÖ DRIVE OFFER SCREEN -->
        <div id="driveOfferScreen" class="hidden min-h-screen text-white animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 p-5 pt-8">
                <button onclick="window.showPage('homeScreen')" class="bg-white/20 p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞</h2>
            </div>
            
            <div class="drive-header">
                <div class="drive-icon">‚öôÔ∏è</div>
                <h1 class="text-3xl font-bold mb-4">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞</h1>
                <p class="text-xl text-slate-300 mb-6">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶§‡ßá‡¶õ‡ßá</p>
            </div>
            
            <div class="p-8 text-center">
                <div class="bg-white/10 p-8 rounded-3xl backdrop-blur-sm border border-white/20">
                    <p class="text-lg mb-6">‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶ï‡¶∞‡¶õ‡¶ø‡•§ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶è‡¶ü‡¶ø ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
                    
                    <div class="mt-10 pt-6 border-t border-white/20">
                        <p class="text-sm text-slate-300">‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶Ü‡¶∏‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º:</p>
                        <p class="text-xl font-bold mt-2">‡ßß‡¶≤‡¶æ ‡¶Æ‡ßá ‡ß®‡ß¶‡ß®‡ß¨</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MORE SCREEN -->
        <div id="moreScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
             <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</h2></div>
             
             <!-- ADD BANNER IN MORE SCREEN (REMOVED AS PER REQUEST) -->
             
            <div class="grid grid-cols-3 gap-4 text-center">
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('profileScreen')"><img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('referralScreen')"><img src="https://i.postimg.cc/c4xbp54V/add-friend.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('marketingScreen')"><img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('quizScreen')"><img src="https://i.postimg.cc/mkNFY0L0/solution.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶ï‡ßÅ‡¶á‡¶ú</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('summaryScreen')"><img src="https://img.icons8.com/fluency/96/statistics.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('settingsScreen')"><img src="https://img.icons8.com/fluency/96/settings.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('spinScreen')"><img src="https://i.postimg.cc/02p5C1GN/fortune-wheel.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡ßç‡¶™‡¶ø‡¶®</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('subscriptionScreen')"><img src="https://i.postimg.cc/Z5JxMx1z/subscription-active.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.openSupport()"><img src="https://i.postimg.cc/GhmX78Xw/comment.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</p></div>
            </div>
            
            <!-- ADD BANNER AT BOTTOM OF MORE SCREEN (REMOVED AS PER REQUEST) -->
             
             <button onclick="window.logout()" class="w-full mt-10 bg-red-100 text-red-600 py-3 rounded-xl font-bold">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
        </div>

        <!-- PROFILE SCREEN -->
        <div id="profileScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <div class="text-center mb-6">
                    <div class="relative inline-block">
                        <img id="currentAvatar" src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-24 h-24 mx-auto rounded-full border-4 border-slate-100">
                        <div class="absolute bottom-0 right-0 bg-green-500 text-white p-1 rounded-full cursor-pointer" onclick="window.showAvatarSelector()">
                            <i class="ri-edit-line text-sm"></i>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold mt-2" id="profNameDisplay">Guest</h3>
                </div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶®‡¶æ‡¶Æ</label><input type="text" id="profNameInput" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="profAddressInput" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶´‡ßã‡¶® (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)</label><input type="text" id="profPhoneInput" disabled class="w-full p-3 bg-slate-100 border rounded-xl font-bold text-slate-500"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="profEmailInput" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <button onclick="window.updateProfile()" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button onclick="window.showChangePassword()" class="w-full bg-slate-100 text-slate-800 py-3 rounded-xl font-bold shadow-lg">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
            </div>
        </div>

        <!-- AVATAR SELECTOR MODAL -->
        <div id="avatarModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-10000 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                <h3 class="text-xl font-bold mb-4 text-center">‡¶è‡¶≠‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="grid grid-cols-4 gap-3">
                    <div onclick="window.selectAvatar('https://img.icons8.com/fluency/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/color/96/user-male-circle--v1.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/color/96/user-male-circle--v1.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/office/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/office/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/plasticine/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/plasticine/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/dusk/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/dusk/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/fluency/96/user-female-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/fluency/96/user-female-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/color/96/user-female-circle--v1.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/color/96/user-female-circle--v1.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/office/96/user-female-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/office/96/user-female-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                </div>
                <button onclick="window.closeAvatarModal()" class="w-full mt-4 bg-slate-100 text-slate-800 py-3 rounded-xl font-bold">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- REFERRAL SCREEN -->
        <div id="referralScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</h2></div>
            <div class="glass-card p-6 rounded-[25px] text-center">
                <img src="https://i.postimg.cc/c4xbp54V/add-friend.png" class="w-20 mx-auto mb-4">
                <h3 class="text-lg font-bold mb-2">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®!</h3>
                <p class="text-sm text-slate-600 mb-4 text-container">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡ß≥5 ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                
                <!-- ‚úÖ FIXED REFERRAL LINK BOX -->
                <div class="referral-box text-container" id="referralLink">
                    ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                </div>
                
                <div class="mb-4">
                    <p class="text-sm font-bold text-slate-700 text-container">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ: <span id="referralCount">0</span></p>
                    <p class="text-sm font-bold text-green-600 text-container">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º: ‡ß≥<span id="referralEarnings">0</span></p>
                </div>
                <button onclick="window.copyReferralLink()" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg">‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- MARKETING SCREEN -->
        <div id="marketingScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç</h2></div>
            <div class="glass-card p-6 rounded-[25px] text-center">
                <img src="https://img.icons8.com/fluency/96/settings.png" class="w-20 mx-auto mb-4">
                <h3 class="text-xl font-bold text-slate-800 mb-2">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶§‡ßá‡¶õ‡ßá</h3>
                <p class="text-lg text-slate-600 mb-6">‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶è‡¶ü‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá</p>
                <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                    <p class="text-sm text-slate-700">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá‡•§ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞, ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡¶®‡¶æ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
                </div>
            </div>
        </div>

        <!-- QUIZ SCREEN -->
        <div id="quizScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶ï‡ßÅ‡¶á‡¶ú</h2></div>
            
            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.switchQuizTab('types')" id="tabQuizTypes" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ü‡¶æ‡¶á‡¶™</button>
                <button onclick="window.switchQuizTab('questions')" id="tabQuizQuestions" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</button>
            </div>

            <div id="quizTypesSection">
                <div class="glass-card p-6 rounded-[25px] space-y-4">
                    <h3 class="text-lg font-bold text-center mb-4">‡¶ï‡ßÅ‡¶á‡¶ú‡ßá‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div onclick="window.showQuizQuestions('general')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/mkNFY0L0/solution.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('math')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/Pqpp3Lfc/mathematics.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶• ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('science')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/V6XSw3CN/scince.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('islamic')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/QCbH91SW/rub-el-hizb.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="quizQuestionsSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <button onclick="window.switchQuizTab('types')" class="bg-slate-100 text-slate-800 px-3 py-1 rounded-lg font-bold text-sm">
                            <i class="ri-arrow-left-line"></i> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
                        </button>
                        <h3 id="quizTypeTitle" class="text-lg font-bold">‡¶ï‡ßÅ‡¶á‡¶ú</h3>
                        <div class="quiz-timer" id="quizTimer">‡ß©‡ß¶</div>
                    </div>
                    
                    <div id="quizQuestionsContainer">
                        <!-- Questions will be loaded here -->
                    </div>
                    
                    <button onclick="window.submitQuiz()" id="submitQuizBtn" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg hidden">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

        <!-- SUMMARY SCREEN -->
        <div id="summaryScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <h3 class="text-lg font-bold text-center mb-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-green-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-green-700">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</p>
                        <h3 class="text-xl font-bold text-green-800">‡ß≥ <span id="totalEarnings">0.00</span></h3>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-blue-700">‡¶Æ‡ßã‡¶ü ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</p>
                        <h3 class="text-xl font-bold text-blue-800">‡ß≥ <span id="totalDeposit">0.00</span></h3>
                    </div>
                    <div class="bg-red-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-red-700">‡¶Æ‡ßã‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</p>
                        <h3 class="text-xl font-bold text-red-800">‡ß≥ <span id="totalWithdraw">0.00</span></h3>
                    </div>
                    <div class="bg-purple-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-purple-700">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</p>
                        <h3 class="text-xl font-bold text-purple-800">‡ß≥ <span id="todayEarnings">0.00</span></h3>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-yellow-700">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p>
                        <h3 class="text-xl font-bold text-yellow-800"><span id="totalTasks">0</span></h3>
                    </div>
                    <div class="bg-pink-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-pink-700">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</p>
                        <h3 class="text-xl font-bold text-pink-800"><span id="totalReferrals">0</span></h3>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶§‡¶•‡ßç‡¶Ø:</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span>‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</span><span id="joinDate">-</span></div>
                        <div class="flex justify-between"><span>‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú:</span><span id="summaryPlan">Free</span></div>
                        <div class="flex justify-between"><span>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï:</span><span id="activeTasks">0</span></div>
                        <div class="flex justify-between"><span>‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏:</span><span id="dailyBonusStatus">‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS SCREEN -->
        <div id="settingsScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <h3 class="text-lg font-bold mb-4">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span>‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</span>
                        <input type="checkbox" class="toggle" checked>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°</span>
                        <input type="checkbox" class="toggle">
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°</span>
                        <input type="checkbox" class="toggle" checked>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®</span>
                        <input type="checkbox" class="toggle" checked>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
                    <button onclick="window.showPage('profileScreen')" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button onclick="window.showChangePassword()" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h4>
                    <button onclick="window.openSupport()" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                    <button onclick="window.open('mailto:support@takawala.com')" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm">‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                </div>
            </div>
        </div>

        <!-- ‚úÖ ENHANCED HISTORY SCREEN WITH FILTER -->
        <div id="historyScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-slate-800">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h2>
            </div>
            
            <!-- ‚úÖ HISTORY FILTER -->
            <div class="history-filter mb-6">
                <button onclick="window.filterHistory('all')" id="filterAll" class="filter-btn active">‡¶∏‡¶¨</button>
                <button onclick="window.filterHistory('deposit')" id="filterDeposit" class="filter-btn">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                <button onclick="window.filterHistory('withdraw')" id="filterWithdraw" class="filter-btn">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                <button onclick="window.filterHistory('recharge')" id="filterRecharge" class="filter-btn">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</button>
                <button onclick="window.filterHistory('task')" id="filterTask" class="filter-btn">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
                <button onclick="window.filterHistory('bonus')" id="filterBonus" class="filter-btn">‡¶¨‡ßã‡¶®‡¶æ‡¶∏</button>
                <button onclick="window.filterHistory('quiz')" id="filterQuiz" class="filter-btn">‡¶ï‡ßÅ‡¶á‡¶ú</button>
            </div>
            
            <div id="historyListContainer" class="space-y-3">
                <!-- History will be loaded here -->
            </div>
            
            <!-- ADD BANNER AT BOTTOM (REMOVED AS PER REQUEST) -->
        </div>
        
        <!-- VIP SCREEN -->
        <div id="vipScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
             <div class="flex justify-between items-center mb-6"><div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h2></div></div>
             <div id="packageListContainer" class="space-y-4">
                 <!-- VIP PLANS WILL BE LOADED FROM FIREBASE -->
                 <div class="glass-card p-4 rounded-2xl border-2 border-yellow-500">
                     <div class="flex justify-between items-center">
                         <div>
                             <h3 class="font-bold text-lg text-yellow-700">‡¶∏‡¶ø‡¶≤‡¶≠‡¶æ‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h3>
                             <p class="text-sm text-slate-600">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ßß‡ß¶‡¶ü‡¶ø ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p>
                         </div>
                         <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full font-bold">‡ß≥500</span>
                     </div>
                     <button onclick="window.buyPackage('silver')" class="w-full mt-3 bg-yellow-500 text-white py-2 rounded-lg font-bold">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                 </div>
                 <div class="glass-card p-4 rounded-2xl border-2 border-purple-500">
                     <div class="flex justify-between items-center">
                         <div>
                             <h3 class="font-bold text-lg text-purple-700">‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h3>
                             <p class="text-sm text-slate-600">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ß®‡ß´‡¶ü‡¶ø ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï + ‡ß®‡ß¶% ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</p>
                         </div>
                         <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full font-bold">‡ß≥1000</span>
                     </div>
                     <button onclick="window.buyPackage('gold')" class="w-full mt-3 bg-purple-500 text-white py-2 rounded-lg font-bold">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                 </div>
                 <div class="glass-card p-4 rounded-2xl border-2 border-green-500">
                     <div class="flex justify-between items-center">
                         <div>
                             <h3 class="font-bold text-lg text-green-700">‡¶™‡ßç‡¶≤‡¶æ‡¶ü‡¶ø‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h3>
                             <p class="text-sm text-slate-600">‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ + ‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</p>
                         </div>
                         <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full font-bold">‡ß≥2000</span>
                     </div>
                     <button onclick="window.buyPackage('platinum')" class="w-full mt-3 bg-green-500 text-white py-2 rounded-lg font-bold">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                 </div>
             </div>
        </div>
        
        <!-- SPIN SCREEN -->
        <div id="spinScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡ßç‡¶™‡¶ø‡¶®</h2></div>
            <div class="glass-card p-6 rounded-[25px] text-center">
                <img src="https://i.postimg.cc/02p5C1GN/fortune-wheel.png" class="w-32 mx-auto mb-4">
                <h3 class="text-lg font-bold mb-2">‡¶≤‡¶æ‡¶ï‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶®</h3>
                <p class="text-sm text-slate-600 mb-4">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶è‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ó‡ßç‡¶∞‡¶á ‡¶è‡¶ü‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®</p>
                <div class="bg-yellow-50 p-4 rounded-xl mb-4">
                    <p class="text-sm font-bold text-yellow-700">‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá...</p>
                    <p class="text-xs text-slate-600 mt-1">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá</p>
                </div>
                <button onclick="window.showPage('homeScreen')" class="w-full bg-slate-100 text-slate-800 py-3 rounded-xl font-bold shadow">‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
            </div>
        </div>

        <!-- SUBSCRIPTION SCREEN -->
        <div id="subscriptionScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-slate-800">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</h2>
            </div>
            
            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.switchSubscriptionTab('stars')" id="tabStars" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                <button onclick="window.switchSubscriptionTab('telegram')" id="tabTelegram" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ</button>
            </div>
            
            <!-- STARS SECTION -->
            <div id="starsSection">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-6">
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <img src="https://i.postimg.cc/Z5JxMx1z/subscription-active.png" class="w-8">
                        <h3 class="text-xl font-bold text-yellow-700">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</h3>
                    </div>
                    
                    <p class="text-sm text-slate-600 mb-2">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡ß≥<span id="starPrice">2.90</span></p>
                    
                    <div class="grid grid-cols-3 gap-3">
                        <div onclick="window.selectStarPackage(100)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500">
                            <div class="star-count mx-auto mb-2">100 ‚≠ê</div>
                            <p class="text-lg font-bold text-slate-800">‡ß≥<span id="price100">290</span></p>
                            <p class="text-[10px] text-slate-500">‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶æ‡¶°‡¶º ‡¶®‡ßá‡¶á</p>
                        </div>
                        <div onclick="window.selectStarPackage(250)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500 relative">
                            <div class="absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">‡ßß‡ß¶% ‡¶õ‡¶æ‡¶°‡¶º</div>
                            <div class="star-count mx-auto mb-2">250 ‚≠ê</div>
                            <p class="text-lg font-bold text-slate-800 line-through text-slate-400">‡ß≥725</p>
                            <p class="text-lg font-bold text-green-600">‡ß≥<span id="price250">652.5</span></p>
                        </div>
                        <div onclick="window.selectStarPackage(500)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500 relative">
                            <div class="absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">‡ßß‡ß¶% ‡¶õ‡¶æ‡¶°‡¶º</div>
                            <div class="star-count mx-auto mb-2">500 ‚≠ê</div>
                            <p class="text-lg font-bold text-slate-800 line-through text-slate-400">‡ß≥1450</p>
                            <p class="text-lg font-bold text-green-600">‡ß≥<span id="price500">1305</span></p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-slate-700">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞:</span>
                            <span class="font-bold text-yellow-700"><span id="selectedStars">0</span> ‚≠ê</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-slate-700">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</span>
                            <span class="text-xl font-bold text-green-600">‡ß≥<span id="totalStarPrice">0</span></span>
                        </div>
                    </div>
                    
                    <button onclick="window.buyStars()" class="w-full bg-yellow-500 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-yellow-600">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                </div>
            </div>
            
            <!-- TELEGRAM PREMIUM SECTION -->
            <div id="telegramSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-6">
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <img src="https://i.postimg.cc/TYLvN32V/telegram.png" class="w-8">
                        <h3 class="text-xl font-bold text-blue-700">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div onclick="window.selectTelegramPlan('1month')" class="bg-white p-4 rounded-2xl border cursor-pointer text-left hover:border-blue-500">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-slate-800">‡ßß ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h4>
                                    <p class="text-sm text-slate-600">‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ</p>
                                </div>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold">‡ß≥600</span>
                            </div>
                        </div>
                        
                        <div onclick="window.selectTelegramPlan('3month')" class="bg-white p-4 rounded-2xl border cursor-pointer text-left hover:border-blue-500 relative">
                            <div class="absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full">‡¶∏‡¶æ‡¶∂‡ßç‡¶∞‡¶Ø‡¶º‡ßÄ</div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-slate-800">‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h4>
                                    <p class="text-sm text-slate-600">‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶°‡¶ø‡¶∏‡ßç‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</p>
                                </div>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold">‡ß≥1550</span>
                            </div>
                        </div>
                        
                        <div onclick="window.selectTelegramPlan('1year')" class="bg-white p-4 rounded-2xl border cursor-pointer text-left hover:border-blue-500 relative">
                            <div class="absolute -top-2 -right-2 bg-purple-500 text-white text-xs px-2 py-1 rounded-full">‡¶∏‡ßá‡¶∞‡¶æ ‡¶Ö‡¶´‡¶æ‡¶∞</div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-slate-800">‡ßß ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h4>
                                    <p class="text-sm text-slate-600">‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶∂‡ßç‡¶∞‡¶Ø‡¶º‡ßÄ</p>
                                </div>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold">‡ß≥3900</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-slate-700">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®:</span>
                            <span class="font-bold text-blue-700" id="selectedPlanText">‡¶ï‡ßã‡¶®‡ßã‡¶ü‡¶ø‡¶á ‡¶®‡¶æ</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-slate-700">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</span>
                            <span class="text-xl font-bold text-green-600">‡ß≥<span id="selectedPlanPrice">0</span></span>
                        </div>
                    </div>
                    
                    <button onclick="window.buyTelegramPremium()" class="w-full bg-blue-500 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-blue-600">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

    </div>

    <!-- BOTTOM NAV -->
    <div id="bottomNav" class="hidden fixed bottom-4 left-4 right-4 bottom-nav bg-white/90 backdrop-blur-md shadow-2xl rounded-2xl flex justify-around py-2.5 z-50 border border-white/50">
        <div onclick="window.showPage('homeScreen')" class="text-center cursor-pointer text-green-600"><i class="ri-home-5-fill text-xl"></i><p class="text-[9px] font-bold">‡¶π‡ßã‡¶Æ</p></div>
        <div onclick="window.showPage('walletScreen')" class="text-center cursor-pointer text-slate-400"><i class="ri-wallet-3-line text-xl"></i><p class="text-[9px] font-bold">‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü</p></div>
        <div onclick="window.showPage('taskScreen')" class="text-center cursor-pointer -mt-8 relative"><div class="bg-premium p-3.5 rounded-full shadow-lg shadow-green-500/40 border-4 border-slate-50"><img src="https://i.postimg.cc/d1sXyCb6/clipboard.png" class="w-6 invert brightness-0"></div><p class="text-[9px] font-bold mt-1 text-slate-600">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p></div>
        <div onclick="window.loadHistory()" class="text-center cursor-pointer text-slate-400"><i class="ri-history-line text-xl"></i><p class="text-[9px] font-bold">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</p></div>
        <div onclick="window.showPage('moreScreen')" class="text-center cursor-pointer text-slate-400"><i class="ri-menu-4-line text-xl"></i><p class="text-[9px] font-bold">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p></div>
    </div>

    <!-- PROOF SUBMISSION MODAL -->
    <div id="proofModal" class="proof-modal hidden">
        <div class="proof-content">
            <div class="bg-premium p-6 text-white text-center">
                <h2 class="text-xl font-bold">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</h2>
                <p class="text-sm opacity-90">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®</p>
            </div>
            <div class="p-6">
                <div id="proofFormContainer">
                    <!-- Proof form will be loaded here dynamically -->
                </div>
                <div class="mt-4">
                    <button onclick="window.submitProof()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button onclick="window.closeProofModal()" class="w-full mt-2 bg-slate-200 text-slate-800 py-3 rounded-xl font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCXo_oRLBE9Gr7JZ_Fp4rl2OAjCz_AJEBo",
            authDomain: "takawala-e8522.firebaseapp.com",
            projectId: "takawala-e8522",
            storageBucket: "takawala-e8522.firebasestorage.app",
            messagingSenderId: "900133484973",
            appId: "1:900133484973:web:00f8d9de7c970f505f8924",
            measurementId: "G-ZNZ1D35QLB"
        };

        // ‚úÖ TELEGRAM BOT CONFIGURATION
        const TG_BOT_TOKEN = "8583588570:AAEKfRe3y_egMXA6n8WxiZA-z-sU4FEgE1M";
        const TG_ADMIN_CHAT_ID = "6454695072";

        async function sendTelegramNotification(message) {
            try {
                const url = `https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage`;
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: TG_ADMIN_CHAT_ID,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
            } catch (error) { console.error("TG Error:", error); }
        }

        // ‚úÖ GLOBAL DEMO QUESTIONS FOR QUIZ
        const demoQuestions = {
            general: [
                {
                    question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∞‡¶æ‡¶ú‡¶ß‡¶æ‡¶®‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?",
                    options: ["‡¶ï‡¶≤‡¶ï‡¶æ‡¶§‡¶æ", "‡¶¢‡¶æ‡¶ï‡¶æ", "‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ", "‡¶ñ‡ßÅ‡¶≤‡¶®‡¶æ"],
                    answer: 1
                },
                {
                    question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶´‡ßÅ‡¶≤ ‡¶ï‡¶ø?",
                    options: ["‡¶ó‡ßã‡¶≤‡¶æ‡¶™", "‡¶∂‡¶æ‡¶™‡¶≤‡¶æ", "‡¶ï‡¶Æ‡¶≤", "‡¶ú‡¶¨‡¶æ"],
                    answer: 1
                },
                {
                    question: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶Æ‡ßÅ‡¶¶‡ßç‡¶∞‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡¶ø?",
                    options: ["‡¶∞‡ßÅ‡¶™‡¶ø", "‡¶ü‡¶æ‡¶ï‡¶æ", "‡¶°‡¶≤‡¶æ‡¶∞", "‡¶á‡¶Ø‡¶º‡ßá‡¶®"],
                    answer: 1
                }
            ],
            math: [
                {
                    question: "‡ß® + ‡ß® = ‡¶ï‡¶§?",
                    options: ["‡ß©", "‡ß™", "‡ß´", "‡ß¨"],
                    answer: 1
                },
                {
                    question: "‡ßß‡ß¶ √ó ‡ß´ = ‡¶ï‡¶§?",
                    options: ["‡ß´‡ß¶", "‡ßß‡ß´", "‡ß®‡ß¶", "‡ßß‡ß¶‡ß¶"],
                    answer: 0
                },
                {
                    question: "‡ßß‡ß¶‡ß¶ √∑ ‡ßß‡ß¶ = ‡¶ï‡¶§?",
                    options: ["‡ßß", "‡ß´", "‡ßß‡ß¶", "‡ß®‡ß¶"],
                    answer: 2
                }
            ],
            science: [
                {
                    question: "‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶∏‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡¶ï ‡¶∏‡¶Ç‡¶ï‡ßá‡¶§ ‡¶ï‡¶ø?",
                    options: ["H2O", "CO2", "O2", "NaCl"],
                    answer: 0
                },
                {
                    question: "‡¶™‡ßÉ‡¶•‡¶ø‡¶¨‡ßÄ ‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ö‡¶æ‡¶∞‡¶¶‡¶ø‡¶ï‡ßá ‡¶ò‡ßÅ‡¶∞‡¶§‡ßá ‡¶ï‡¶§ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶®‡ßá‡¶Ø‡¶º?",
                    options: ["‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ", "‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®", "‡ß©‡ß¨‡ß´ ‡¶¶‡¶ø‡¶®", "‡ß≠ ‡¶¶‡¶ø‡¶®"],
                    answer: 2
                },
                {
                    question: "‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑‡ßá‡¶∞ ‡¶¶‡ßá‡¶π‡ßá ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶π‡¶æ‡¶°‡¶º ‡¶Ü‡¶õ‡ßá?",
                    options: ["‡ßß‡ß¶‡ß¨", "‡ß®‡ß¶‡ß¨", "‡ß©‡ß¶‡ß¨", "‡ß™‡ß¶‡ß¨"],
                    answer: 1
                }
            ],
            islamic: [
                {
                    question: "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∏‡ßç‡¶§‡¶Æ‡ßç‡¶≠ ‡¶ï‡¶ø?",
                    options: ["‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú", "‡¶∞‡ßã‡¶ú‡¶æ", "‡¶∂‡¶æ‡¶π‡¶æ‡¶¶‡¶æ‡¶π", "‡¶π‡¶ú‡ßç‡¶ú"],
                    answer: 2
                },
                {
                    question: "‡¶Æ‡ßÅ‡¶∏‡¶≤‡¶Æ‡¶æ‡¶®‡¶¶‡ßá‡¶∞ ‡¶ï‡¶ø‡¶¨‡¶≤‡¶æ ‡¶ï‡ßã‡¶•‡¶æ‡¶Ø‡¶º?",
                    options: ["‡¶Æ‡¶¶‡¶ø‡¶®‡¶æ", "‡¶Æ‡¶ï‡ßç‡¶ï‡¶æ", "‡¶ú‡ßá‡¶∞‡ßÅ‡¶ú‡¶æ‡¶≤‡ßá‡¶Æ", "‡¶ï‡¶æ‡¶Ø‡¶º‡¶∞‡ßã"],
                    answer: 1
                },
                {
                    question: "‡¶™‡¶¨‡¶ø‡¶§‡ßç‡¶∞ ‡¶ï‡ßã‡¶∞‡¶Ü‡¶®‡ßá ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá?",
                    options: ["‡ßß‡ßß‡ß™", "‡ßß‡ß®‡ß™", "‡ßß‡ß©‡ß™", "‡ßß‡ß™‡ß™"],
                    answer: 0
                }
            ]
        };

        // ‚úÖ TWAI CHATBOT RESPONSES
        const twaiResponses = {
            '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï': '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶≠‡¶ø‡¶â ‡¶¨‡¶æ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®‡•§',
            '‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞': '‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü > ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡¶Ø‡¶æ‡¶®‡•§ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶π‡¶≤‡ßá ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§',
            '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü': '‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü > ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü‡ßá ‡¶Ø‡¶æ‡¶®‡•§ ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá TrxID ‡¶¶‡¶ø‡¶®‡•§',
            '‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú': '‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶®‡•§',
            '‡¶ï‡ßÅ‡¶á‡¶ú': '‡¶ï‡ßÅ‡¶á‡¶ú ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶¶‡¶ø‡¶®‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ñ‡ßá‡¶≤‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§',
            '‡¶¨‡ßç‡¶Ø‡¶æ‡¶®': '‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¨‡¶æ ‡¶´‡ßá‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶∏‡¶§‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
            '‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú': '‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶Ö‡¶™‡¶∂‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶¨‡¶æ‡ßú‡¶¨‡ßá‡•§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶ï‡ßá‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§',
            '‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®': '‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶® ‡¶Ö‡¶™‡¶∂‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§',
            '‡¶¶‡ßá‡¶∞‡¶ø': '‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶Æ‡¶æ‡¶ù‡ßá ‡¶Æ‡¶æ‡¶ù‡ßá ‡¶¶‡ßá‡¶∞‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶ß‡ßà‡¶∞‡ßç‡¶Ø ‡¶ß‡¶∞‡ßÅ‡¶®‡•§'
        };

        // ‚úÖ INITIALIZE FIREBASE
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ‚úÖ GLOBAL VARIABLES
        let currentUserData = null;
        let currentUserId = null;
        let currentTaskType = 'free';
        let selectedMethod = 'bKash';
        let selectedOperator = 'GP';
        let selectedStarPackage = 0;
        let selectedTelegramPlan = null;
        let currentQuizType = null;
        let quizTimer = null;
        let taskTimer = null;
        let currentTaskInfo = null;
        let paymentNumbers = {};
        let systemSettings = {};
        let currentHistoryFilter = 'all';
        let todayEarnings = 0;
        let selectedAvatar = 'https://img.icons8.com/fluency/96/user-male-circle.png';
        let selectedAnswers = {};
        let maintenanceMode = false;
        let userWithdrawCount = 0;
        let userRechargeCount = 0;

        // ‚úÖ FIXED NOTIFICATION FUNCTION
        function showNotification(message, type = 'info') {
            // Message Handling (Object fix)
            let displayMessage = '';
            if (typeof message === 'object' && message !== null) {
                displayMessage = message.message || JSON.stringify(message);
            } else {
                displayMessage = String(message);
            }
            
            const notification = document.getElementById('notificationMessage');
            const notificationText = document.getElementById('notificationText');
            const notificationClose = document.getElementById('notificationClose');
            
            // Clear existing timeout
            if(window.notificationTimeout) clearTimeout(window.notificationTimeout);
            
            // Reset Animation (Trick to restart CSS animation)
            notification.style.animation = 'none';
            notification.offsetHeight; /* trigger reflow */
            notification.style.animation = 'slideDown 0.3s ease, fadeOut 0.3s ease 2.5s forwards';

            // Set Style
            notification.className = ''; // Clear previous
            notification.classList.add(`notification-${type}`);
            notification.classList.remove('hidden');
            
            // Set Icon & Text
            let icon = type === 'success' ? '‚úÖ ' : (type === 'error' ? '‚ùå ' : '‚ÑπÔ∏è ');
            notificationText.innerHTML = icon + displayMessage;
            
            // Close Logic
            notificationClose.onclick = () => notification.classList.add('hidden');
            
            // Auto Hide
            window.notificationTimeout = setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // ‚úÖ LOADING ANIMATION
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // ‚úÖ MONITAG AD FUNCTIONS (UPDATED WITH ROTATION)
        function showInterstitialAd() {
            const interstitial = document.getElementById('monitagInterstitial');
            interstitial.classList.remove('hidden');
            
            let timeLeft = 15;
            const timerElement = document.getElementById('adTimer');
            const adTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if(timeLeft <= 0) {
                    clearInterval(adTimer);
                    closeInterstitialAd();
                }
            }, 1000);
            
            window.adTimer = adTimer;
        }
        
        function closeInterstitialAd() {
            const interstitial = document.getElementById('monitagInterstitial');
            interstitial.classList.add('hidden');
            
            if(window.adTimer) {
                clearInterval(window.adTimer);
            }
        }
        
        window.openAdLink = () => {
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ßÆ: ‡ß©‡¶ü‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ‡¶≤‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞
            const adLinks = [
                'https://otieu.com/4/10532824',
                'https://otieu.com/4/10556225', 
                'https://otieu.com/4/10532823'
            ];
            
            const randomLink = adLinks[Math.floor(Math.random() * adLinks.length)];
            window.open(randomLink, '_blank');
            closeInterstitialAd();
        };

        // ‚úÖ COPY TO CLIPBOARD
        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            }).catch(() => {
                showNotification('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
            });
        };

        // ‚úÖ LOAD SYSTEM SETTINGS
        async function loadSystemSettings() {
            try {
                // Check maintenance mode first
                const maintenanceDoc = await db.collection("settings").doc("maintenance").get();
                if(maintenanceDoc.exists) {
                    const maintenanceData = maintenanceDoc.data();
                    if(maintenanceData.maintenanceMode === true) {
                        maintenanceMode = true;
                        showMaintenanceScreen();
                        return;
                    }
                }
                
                const paymentDoc = await db.collection("settings").doc("payment_numbers").get();
                if(paymentDoc.exists) {
                    paymentNumbers = paymentDoc.data();
                    
                    // Update payment method status
                    updatePaymentMethodStatus();
                } else {
                    paymentNumbers = {
                        bKash: "01340975230",
                        Nagad: "01836319726",
                        Rocket: "01600000000",
                        USDT_Polygon: "0x3399E2a9408c675489f84Ae830Ad5ED6FC12c14b",
                        USDT_BEP20: "0xa202c31208D7d7b0cA8f2F48F0821e86824605C4"
                    };
                }

                const settingsDoc = await db.collection("settings").doc("system").get();
                if(settingsDoc.exists) {
                    systemSettings = settingsDoc.data();
                } else {
                    systemSettings = {
                        noticeText: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá!",
                        referralBonus: 5,
                        taskWaitTime: 15, // ‚úÖ CHANGED FROM 60 TO 15 SECONDS
                        minWithdraw: 100,
                        maxWithdraw: 5000,
                        vatPercentage: 10,
                        rechargeFee: 5,
                        minDeposit: 50,
                        minRecharge: 20
                    };
                }

                document.getElementById('noticeText').innerText = systemSettings.noticeText || "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá!";
                
                // Load user today counts
                await loadUserTodayCounts();
                
            } catch (error) {
                console.error("Error loading system settings:", error);
            }
        }
        
        // ‚úÖ LOAD USER TODAY'S COUNTS
        async function loadUserTodayCounts() {
            if(!currentUserId) return;
            
            try {
                const today = new Date();
                const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                
                // Withdraw count
                const withdrawQuery = await db.collection("history")
                    .where("userId", "==", currentUserId)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .where("type", "in", ["‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®", "Withdraw"])
                    .get();
                
                userWithdrawCount = withdrawQuery.size || 0;
                
                // Recharge count
                const rechargeQuery = await db.collection("history")
                    .where("userId", "==", currentUserId)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .where("type", "in", ["‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú", "Recharge"])
                    .get();
                
                userRechargeCount = rechargeQuery.size || 0;
                
            } catch (error) {
                console.error("Error loading user counts:", error);
            }
        }
        
        // ‚úÖ UPDATE PAYMENT METHOD STATUS
        function updatePaymentMethodStatus() {
            const methods = ['bKash', 'Nagad', 'Rocket', 'USDT'];
            methods.forEach(method => {
                const element = document.getElementById(`payment_${method}`);
                const withdrawElement = document.getElementById(`withdraw_${method}`);
                
                if(element) {
                    // ‚úÖ FIX 4: USDT should always be enabled in deposit
                    if(method === 'USDT') {
                        element.classList.remove('disabled-option');
                        element.onclick = () => window.selectPayment(element, method);
                        element.innerHTML = `<img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain">`;
                    } else if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                        element.classList.add('disabled-option');
                        element.onclick = null;
                        element.innerHTML = `
                            <img src="${element.querySelector('img').src}" class="h-10 object-contain opacity-50">
                            <div class="disabled-text">‡¶¨‡¶®‡ßç‡¶ß</div>
                        `;
                    } else {
                        element.classList.remove('disabled-option');
                        element.onclick = () => window.selectPayment(element, method);
                        element.innerHTML = `<img src="https://i.postimg.cc/${method === 'bKash' ? 'C5vDR4nz/1656235223bkash-logo.png' : method === 'Nagad' ? 'k4phWWbK/1679248787Nagad-Logo.png' : method === 'Rocket' ? 'xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png' : '0QRCvZDV/usdt.png'}" class="h-10 object-contain">`;
                    }
                }
                
                if(withdrawElement) {
                    if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                        withdrawElement.classList.add('disabled-option');
                        withdrawElement.onclick = null;
                        withdrawElement.innerHTML = `
                            <img src="${withdrawElement.querySelector('img').src}" class="h-10 object-contain opacity-50">
                            <div class="disabled-text">‡¶¨‡¶®‡ßç‡¶ß</div>
                        `;
                    } else {
                        withdrawElement.classList.remove('disabled-option');
                        withdrawElement.onclick = () => window.selectWithdrawMethod(withdrawElement, method);
                        withdrawElement.innerHTML = `<img src="https://i.postimg.cc/${method === 'bKash' ? 'C5vDR4nz/1656235223bkash-logo.png' : method === 'Nagad' ? 'k4phWWbK/1679248787Nagad-Logo.png' : method === 'Rocket' ? 'xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png' : '0QRCvZDV/usdt.png'}" class="h-10 object-contain">`;
                    }
                }
            });
        }
        
        // ‚úÖ SHOW MAINTENANCE SCREEN
        function showMaintenanceScreen() {
            document.getElementById('maintenanceScreen').classList.remove('hidden');
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('bottomNav').classList.add('hidden');
            document.getElementById('globalChatIcon').style.display = 'none';
            document.getElementById('twaiChatbotIcon').style.display = 'none';
        }

        // ‚úÖ UPDATE DEPOSIT ADDRESS
        window.selectPayment = (el, method) => { 
            // ‚úÖ FIX 4: USDT should always be enabled
            if(method === 'USDT') {
                // USDT is always enabled in deposit
            } else if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                showNotification(`${method} ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶¨‡¶®‡ßç‡¶ß`, 'error');
                return;
            }
            
            document.querySelectorAll('#depositSection .grid .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedMethod = method;
            document.getElementById('selectedDepositMethod').value = method;
            
            updateDepositAddress(method);
        };
        
        function updateDepositAddress(method) {
            const container = document.getElementById('depositAddressContainer');
            
            if(method === 'bKash') {
                container.innerHTML = `
                    <div class="address-line">
                        <span class="font-bold">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂:</span>
                        <div class="flex items-center">
                            <span class="text-slate-700 mr-2 text-container">${paymentNumbers.bKash || "01340975230"}</span>
                            <button onclick="window.copyToClipboard('${paymentNumbers.bKash || "01340975230"}')" class="copy-btn">‡¶ï‡¶™‡¶ø</button>
                        </div>
                    </div>`;
            } 
            else if(method === 'Nagad') {
                container.innerHTML = `
                    <div class="address-line">
                        <span class="font-bold">‡¶®‡¶ó‡¶¶:</span>
                        <div class="flex items-center">
                            <span class="text-slate-700 mr-2 text-container">${paymentNumbers.Nagad || "01836319726"}</span>
                            <button onclick="window.copyToClipboard('${paymentNumbers.Nagad || "01836319726"}')" class="copy-btn">‡¶ï‡¶™‡¶ø</button>
                        </div>
                    </div>`;
            } 
            else if(method === 'USDT') {
                container.innerHTML = `
                    <div class="address-line">
                        <span class="font-bold">‡¶™‡¶≤‡¶ø‡¶ó‡¶® (USDT):</span>
                        <div class="flex items-center">
                            <span class="text-slate-700 mr-2 text-container">${paymentNumbers.USDT_Polygon || "0x3399E2a9408c675489f84Ae830Ad5ED6FC12c14b"}</span>
                            <button onclick="window.copyToClipboard('${paymentNumbers.USDT_Polygon || "0x3399E2a9408c675489f84Ae830Ad5ED6FC12c14b"}')" class="copy-btn">‡¶ï‡¶™‡¶ø</button>
                        </div>
                    </div>
                    <div class="address-line">
                        <span class="font-bold">BEP20 (USDT):</span>
                        <div class="flex items-center">
                            <span class="text-slate-700 mr-2 text-container">${paymentNumbers.USDT_BEP20 || "0xa202c31208D7d7b0cA8f2F48F0821e86824605C4"}</span>
                            <button onclick="window.copyToClipboard('${paymentNumbers.USDT_BEP20 || "0xa202c31208D7d7b0cA8f2F48F0821e86824605C4"}')" class="copy-btn">‡¶ï‡¶™‡¶ø</button>
                        </div>
                    </div>`;
            }
        }

        // ‚úÖ AUTH FUNCTIONS
        document.getElementById('btnRegAction').addEventListener('click', async () => {
            const name = document.getElementById('regName').value, 
                  phone = document.getElementById('regPhone').value, 
                  email = document.getElementById('regEmail').value, 
                  pass = document.getElementById('regPass').value,
                  referralCode = document.getElementById('regReferralCode').value.trim();
            
            if(!name || !phone || !email || !pass) return showNotification('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
            if(pass.length < 6) return showNotification('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
            
            try {
                showLoading();
                showNotification('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                const uc = await auth.createUserWithEmailAndPassword(email, pass);
                
                const userReferralCode = 'REF' + Math.floor(100000 + Math.random() * 900000);
                
                const userData = { 
                    name, 
                    phone, 
                    email, 
                    mainBalance: 0, 
                    rechargeBalance: 0, 
                    plan: "Free Member", 
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(), 
                    totalEarnings: 0, 
                    totalDeposit: 0, 
                    totalWithdraw: 0, 
                    totalTasks: 0, 
                    totalReferrals: 0,
                    referralEarnings: 0,
                    stars: 0,
                    lastDailyBonus: null,
                    referralCode: userReferralCode,
                    referredBy: referralCode || null,
                    avatar: selectedAvatar,
                    address: '',
                    todayEarnings: 0,
                    lastQuizDate_general: null,
                    lastQuizDate_math: null,
                    lastQuizDate_science: null,
                    lastQuizDate_islamic: null
                };
                
                await db.collection("users").doc(uc.user.uid).set(userData);
                
                if(referralCode) {
                    try {
                        const referralQuery = await db.collection("users").where("referralCode", "==", referralCode).get();
                        
                        if(!referralQuery.empty) {
                            const referrerDoc = referralQuery.docs[0];
                            const referrerId = referrerDoc.id;
                            
                            const bonusAmount = systemSettings.referralBonus || 5;
                            await db.collection("users").doc(referrerId).update({
                                mainBalance: firebase.firestore.FieldValue.increment(bonusAmount),
                                totalEarnings: firebase.firestore.FieldValue.increment(bonusAmount),
                                totalReferrals: firebase.firestore.FieldValue.increment(1),
                                referralEarnings: firebase.firestore.FieldValue.increment(bonusAmount)
                            });
                            
                            await db.collection("history").add({
                                userId: referrerId,
                                type: "‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏",
                                amount: bonusAmount,
                                status: "Success",
                                details: `${name} ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`,
                                date: new Date().toLocaleDateString('bn-BD'),
                                time: new Date().toLocaleTimeString('bn-BD'),
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            
                            await db.collection("users").doc(uc.user.uid).update({
                                referredBy: referralCode
                            });
                        }
                    } catch (referralError) {
                        console.error("Referral processing error:", referralError);
                    }
                }
                
                showNotification('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶∏‡¶´‡¶≤! ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®', 'success');
                hideLoading();
            } catch (e) { 
                showNotification(e.message, 'error');
                hideLoading();
            }
        });

        document.getElementById('btnLoginAction').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            
            if(!email || !pass) return showNotification('‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®', 'error');
            
            try { 
                showLoading();
                showNotification('‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info'); 
                await auth.signInWithEmailAndPassword(email, pass); 
                showNotification('‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!', 'success'); 
                hideLoading();
            } catch (e) { 
                showNotification('‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°', 'error'); 
                hideLoading();
            }
        });

        // ‚úÖ AUTH STATE LISTENER
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUserId = user.uid;
                showLoading();
                setTimeout(async () => {
                    await loadSystemSettings();
                    
                    if(maintenanceMode) {
                        hideLoading();
                        return;
                    }
                    
                    document.getElementById('authScreen').classList.add('hidden'); 
                    document.getElementById('mainApp').classList.remove('hidden'); 
                    document.getElementById('bottomNav').classList.remove('hidden');
                    
                    syncUserData(user.uid); 
                    renderTasks();
                    loadSummary(user.uid);
                    checkDailyBonus(user.uid);
                    initDraggableChat();
                    loadTodayEarnings(user.uid);
                    
                    // Show icons
                    document.getElementById('globalChatIcon').style.display = 'flex';
                    document.getElementById('twaiChatbotIcon').style.display = 'flex';
                    
                    hideLoading();
                }, 2000);
            } else {
                document.getElementById('authScreen').classList.remove('hidden'); 
                document.getElementById('mainApp').classList.add('hidden'); 
                document.getElementById('bottomNav').classList.add('hidden');
                document.getElementById('globalChatIcon').style.display = 'none';
                document.getElementById('twaiChatbotIcon').style.display = 'none';
            }
        });

        // ‚úÖ SYNC USER DATA
        function syncUserData(uid) {
            db.collection("users").doc(uid).onSnapshot((d) => {
                const safe = (id, txt) => { if(document.getElementById(id)) document.getElementById(id).innerText = txt; }
                if(d.exists) {
                    currentUserData = d.data();
                    safe('userNameDisplay', currentUserData.name); 
                    safe('profNameDisplay', currentUserData.name);
                    safe('mainBalanceDisplay', currentUserData.mainBalance.toFixed(2)); 
                    safe('walletMainDisplay', currentUserData.mainBalance.toFixed(2));
                    safe('rechargePageBalance', (currentUserData.rechargeBalance||0).toFixed(2)); 
                    safe('walletRechargeDisplay', (currentUserData.rechargeBalance||0).toFixed(2));
                    safe('userPlanDisplay', currentUserData.plan || "Free Member");
                    safe('referralCount', currentUserData.totalReferrals || 0);
                    safe('referralEarnings', currentUserData.referralEarnings || 0);
                    
                    // Update profile inputs
                    if(document.getElementById('profNameInput')) document.getElementById('profNameInput').value = currentUserData.name;
                    if(document.getElementById('profPhoneInput')) document.getElementById('profPhoneInput').value = currentUserData.phone;
                    if(document.getElementById('profEmailInput')) document.getElementById('profEmailInput').value = currentUserData.email;
                    if(document.getElementById('profAddressInput')) document.getElementById('profAddressInput').value = currentUserData.address || '';
                    
                    // Update avatar
                    if(currentUserData.avatar) {
                        selectedAvatar = currentUserData.avatar;
                        document.getElementById('currentAvatar').src = selectedAvatar;
                    }
                    
                    // ‚úÖ FIXED REFERRAL LINK
                    if(document.getElementById('referralLink')) {
                        document.getElementById('referralLink').innerText = `https://t.me/TAKA_WALA_TG_BOT?start=ref_${uid}`;
                    }
                    
                    if(d.data().createdAt) {
                        const date = d.data().createdAt.toDate();
                        document.getElementById('joinDate').innerText = date.toLocaleDateString('bn-BD');
                    }
                } else {
                    safe('userNameDisplay', "Guest"); 
                    safe('mainBalanceDisplay', "0.00");
                }
            }, (err) => { 
                console.error("Error syncing user data:", err);
            });
            
            db.collection("settings").doc("system").onSnapshot((d) => { 
                if(d.exists) {
                    systemSettings = d.data();
                    document.getElementById('noticeText').innerText = d.data().noticeText || "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!";
                }
            });
            
            db.collection("settings").doc("payment_numbers").onSnapshot((d) => {
                if(d.exists) {
                    paymentNumbers = d.data();
                    updatePaymentMethodStatus();
                }
            });
            
            // Listen for maintenance mode changes
            db.collection("settings").doc("maintenance").onSnapshot((d) => {
                if(d.exists) {
                    const maintenanceData = d.data();
                    if(maintenanceData.maintenanceMode === true) {
                        maintenanceMode = true;
                        showMaintenanceScreen();
                    } else {
                        maintenanceMode = false;
                        document.getElementById('maintenanceScreen').classList.add('hidden');
                    }
                }
            });
        }

        // ‚úÖ LOAD TODAY'S EARNINGS
        async function loadTodayEarnings(uid) {
            try {
                const today = new Date();
                const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                
                const querySnapshot = await db.collection("history")
                    .where("userId", "==", uid)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .where("amount", ">", 0)
                    .get();
                
                let todayTotal = 0;
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    todayTotal += parseFloat(data.amount) || 0;
                });
                
                todayEarnings = todayTotal;
                document.getElementById('todayEarnings').textContent = todayTotal.toFixed(2);
                
                // Update today's earnings in user document
                await db.collection("users").doc(uid).update({
                    todayEarnings: todayTotal
                });
                
            } catch (error) {
                console.error("Error loading today's earnings:", error);
            }
        }

        // ‚úÖ TASK FUNCTIONS
        function renderTasks() {
            db.collection("tasks").onSnapshot((snap) => {
                const list = document.getElementById('taskListContainer'); 
                if(!list) return; 
                
                showLoading();
                list.innerHTML = '';
                
                if(snap.empty) { 
                    list.innerHTML = `
                    <div class="glass-card p-3 rounded-2xl flex justify-between items-center animate__animated animate__fadeInUp">
                        <div class="flex items-center gap-3"><img src="https://i.postimg.cc/TYLvN32V/telegram.png" class="w-10"><div><h4 class="font-bold text-slate-700">Telegram Channel</h4><p class="text-[10px] text-slate-400">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®</p></div></div>
                        <button onclick="window.completeTask('telegram_task', 5, 'telegram', 'Telegram Channel', '‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®', 'https://t.me/takawala_channel')" class="bg-blue-100 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold">+‡ß≥5</button>
                    </div>
                    <div class="glass-card p-3 rounded-2xl flex justify-between items-center animate__animated animate__fadeInUp">
                        <div class="flex items-center gap-3"><img src="https://i.postimg.cc/C1j6TxLF/youtube.png" class="w-10"><div><h4 class="font-bold text-slate-700">YouTube Subscribe</h4><p class="text-[10px] text-slate-400">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®</p></div></div>
                        <button onclick="window.completeTask('youtube_task', 8, 'youtube', 'YouTube Subscribe', '‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®', 'https://youtube.com/takawala')" class="bg-blue-100 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold">+‡ß≥8</button>
                    </div>
                    <div class="glass-card p-3 rounded-2xl flex justify-between items-center animate__animated animate__fadeInUp">
                        <div class="flex items-center gap-3"><img src="https://i.postimg.cc/pdtvFMHW/facebook.png" class="w-10"><div><h4 class="font-bold text-slate-700">Facebook Page Like</h4><p class="text-[10px] text-slate-400">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ Facebook ‡¶™‡ßá‡¶ú ‡¶≤‡¶æ‡¶á‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p></div></div>
                        <button onclick="window.completeTask('facebook_task', 4, 'facebook', 'Facebook Page Like', '‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶™‡ßá‡¶ú ‡¶≤‡¶æ‡¶á‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®', 'https://facebook.com/takawala')" class="bg-blue-100 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold">+‡ß≥4</button>
                    </div>`;
                    hideLoading();
                    return; 
                }
                
                snap.forEach(doc => {
                    const t = doc.data();
                    if(t.type === currentTaskType || (!t.type && currentTaskType === 'free')) {
                         list.innerHTML += `
                        <div class="glass-card p-3 rounded-2xl flex justify-between items-center animate__animated animate__fadeInUp">
                            <div class="flex items-center gap-3"><img src="${t.icon || 'https://i.postimg.cc/d1sXyCb6/clipboard.png'}" class="w-10"><div><h4 class="font-bold text-slate-700">${t.title}</h4><p class="text-[10px] text-slate-400">${t.desc}</p></div></div>
                            <button onclick="window.completeTask('${doc.id}', ${t.reward}, '${t.taskType || 'general'}', '${t.title}', '${t.desc}', '${t.link || '#'}')" class="bg-blue-100 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold">+‡ß≥${t.reward}</button>
                        </div>`;
                    }
                });
                
                hideLoading();
            });
        }

        // ‚úÖ ENHANCED HISTORY SYSTEM WITH FILTER
        window.loadHistory = () => {
            window.showPage('historyScreen');
            document.getElementById('historyListContainer').innerHTML = `
                <div class="history-loading">
                    <div class="animate-pulse">
                        <div class="h-4 bg-slate-200 rounded w-3/4 mx-auto mb-4"></div>
                        <div class="h-20 bg-slate-100 rounded-lg mb-3"></div>
                        <div class="h-20 bg-slate-100 rounded-lg mb-3"></div>
                        <div class="h-20 bg-slate-100 rounded-lg"></div>
                    </div>
                </div>
            `;
            
            loadSimpleHistory('all');
        };
        
        // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ßß: ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏
        window.filterHistory = (filterType) => {
            currentHistoryFilter = filterType;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}`).classList.add('active');
            
            loadSimpleHistory(filterType);
        };
        
        async function loadSimpleHistory(filterType = 'all') {
            showLoading();
            
            try {
                let query = db.collection("history")
                    .where("userId", "==", currentUserId)
                    .orderBy("timestamp", "desc")
                    .limit(50);
                
                // Apply filter based on type
                if(filterType !== 'all') {
                    let typeArray = [];
                    
                    switch(filterType) {
                        case 'deposit':
                            typeArray = ['‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü', 'Deposit'];
                            break;
                        case 'withdraw':
                            typeArray = ['‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®', 'Withdraw'];
                            break;
                        case 'recharge':
                            typeArray = ['‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú', 'Recharge'];
                            break;
                        case 'task':
                            typeArray = ['‡¶ü‡¶æ‡¶∏‡ßç‡¶ï', 'Task'];
                            break;
                        case 'bonus':
                            typeArray = ['‡¶¨‡ßã‡¶®‡¶æ‡¶∏', 'Bonus', '‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏', '‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏'];
                            break;
                        case 'quiz':
                            typeArray = ['‡¶ï‡ßÅ‡¶á‡¶ú', 'Quiz'];
                            break;
                        default:
                            // All types
                    }
                    
                    if(typeArray.length > 0) {
                        query = query.where("type", "in", typeArray);
                    }
                }
                
                const querySnapshot = await query.get();
                
                const list = document.getElementById('historyListContainer'); 
                if(!list) return; 
                
                list.innerHTML = '';
                
                if(querySnapshot.empty) { 
                    list.innerHTML = `
                    <div class="history-empty">
                        <img src="https://i.postimg.cc/VNTvSLRX/transaction-history.png" class="w-20 mx-auto mb-4 opacity-30">
                        <p class="text-slate-400">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶á</p>
                        <p class="text-sm text-slate-500 mt-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>`; 
                    hideLoading();
                    return; 
                }
                
                querySnapshot.forEach(doc => {
                    const h = doc.data(); 
                    const date = h.date || new Date().toLocaleDateString('bn-BD');
                    const time = h.time || new Date().toLocaleTimeString('bn-BD');
                    
                    let icon = '';
                    let bgColor = '';
                    
                    if(h.type.includes('Recharge') || h.type.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')) {
                        icon = 'https://i.postimg.cc/jjdpNH5b/payment-method.png';
                        bgColor = 'bg-blue-100';
                    } else if(h.type.includes('Withdraw') || h.type.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®')) {
                        icon = 'https://i.postimg.cc/wMdF5zV5/withdraw.png';
                        bgColor = 'bg-red-100';
                    } else if(h.type.includes('Deposit') || h.type.includes('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü')) {
                        icon = 'https://i.postimg.cc/7ZGpHH5q/save-money.png';
                        bgColor = 'bg-green-100';
                    } else if(h.type.includes('Task') || h.type.includes('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')) {
                        icon = 'https://i.postimg.cc/d1sXyCb6/clipboard.png';
                        bgColor = 'bg-purple-100';
                    } else if(h.type.includes('Bonus') || h.type.includes('‡¶¨‡ßã‡¶®‡¶æ‡¶∏')) {
                        icon = 'https://i.postimg.cc/qqLQKVHV/bonus.png';
                        bgColor = 'bg-yellow-100';
                    } else if(h.type.includes('Transfer') || h.type.includes('‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞')) {
                        icon = 'https://i.postimg.cc/VNTvSLRX/transaction-history.png';
                        bgColor = 'bg-indigo-100';
                    } else if(h.type.includes('‡¶ï‡ßÅ‡¶á‡¶ú') || h.type.includes('Quiz')) {
                        icon = 'https://i.postimg.cc/mkNFY0L0/solution.png';
                        bgColor = 'bg-pink-100';
                    } else {
                        icon = 'https://i.postimg.cc/VNTvSLRX/transaction-history.png';
                        bgColor = 'bg-slate-100';
                    }
                    
                    let statusIcon = '';
                    let statusColor = '';
                    if(h.status === 'Pending') {
                        statusIcon = 'üïô';
                        statusColor = 'text-yellow-600';
                    } else if(h.status === 'Success') {
                        statusIcon = '‚úÖ';
                        statusColor = 'text-green-600';
                    } else if(h.status === 'Rejected') {
                        statusIcon = '‚ùå';
                        statusColor = 'text-red-600';
                    }
                    
                    const amount = parseFloat(h.amount) || 0;
                    const amountColor = amount > 0 ? 'text-green-600' : 'text-red-600';
                    const amountSign = amount > 0 ? '+' : '';
                    
                    list.innerHTML += `
                    <div class="history-item glass-card p-4 rounded-2xl flex items-center gap-3">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 ${bgColor} rounded-xl flex items-center justify-center">
                                <img src="${icon}" class="w-7 h-7">
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <h4 class="font-bold text-slate-700 truncate">${h.type}</h4>
                                <span class="font-bold ${amountColor} whitespace-nowrap">${amountSign}‡ß≥${Math.abs(amount).toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between items-center mt-1">
                                <p class="text-[11px] text-slate-500 truncate">${date} ‚Ä¢ ${time}</p>
                                <span class="text-sm ${statusColor}">${statusIcon}</span>
                            </div>
                            ${h.method ? `<p class="text-[10px] text-slate-600 mt-1 truncate">${h.method}</p>` : ''}
                            ${h.details ? `<p class="text-[10px] text-slate-500 mt-1 truncate">${h.details}</p>` : ''}
                        </div>
                        <button onclick="window.showReceipt(${JSON.stringify({...h, id: doc.id}).replace(/"/g, '&quot;')})" class="text-[10px] bg-premium text-white px-3 py-1.5 rounded-lg font-bold whitespace-nowrap">
                            ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü
                        </button>
                    </div>`;
                });
                hideLoading();
            } catch (error) {
                console.error("Error loading history:", error);
                document.getElementById('historyListContainer').innerHTML = `
                <div class="history-empty">
                    <p class="text-red-400">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
                    <button onclick="window.loadHistory()" class="mt-2 text-sm text-blue-600 font-bold">‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>`;
                hideLoading();
            }
        }

        // ‚úÖ COMPACT RECEIPT MODAL (‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß™)
        window.showReceipt = (transaction) => {
            const existingModal = document.getElementById('receiptModal');
            if(existingModal) {
                existingModal.remove();
            }
            
            const receiptModal = document.createElement('div');
            receiptModal.className = 'receipt-modal';
            receiptModal.id = 'receiptModal';
            
            let statusBadge = '';
            let statusText = '';
            if(transaction.status === 'Success') {
                statusBadge = '<span class="receipt-status status-success-badge">‚úÖ ‡¶∏‡¶´‡¶≤</span>';
                statusText = '‡¶∏‡¶´‡¶≤';
            } else if(transaction.status === 'Pending') {
                statusBadge = '<span class="receipt-status status-pending-badge">üïô ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</span>';
                statusText = '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç';
            } else if(transaction.status === 'Rejected') {
                statusBadge = '<span class="receipt-status status-rejected-badge">‚ùå ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü</span>';
                statusText = '‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü';
            }
            
            let icon = '';
            let typeText = transaction.type || '‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®';
            
            if(typeText.includes('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü') || typeText.includes('Deposit')) {
                icon = 'https://i.postimg.cc/7ZGpHH5q/save-money.png';
            } else if(typeText.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®') || typeText.includes('Withdraw')) {
                icon = 'https://i.postimg.cc/wMdF5zV5/withdraw.png';
            } else if(typeText.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú') || typeText.includes('Recharge')) {
                icon = 'https://i.postimg.cc/jjdpNH5b/payment-method.png';
            } else if(typeText.includes('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï') || typeText.includes('Task')) {
                icon = 'https://i.postimg.cc/d1sXyCb6/clipboard.png';
            } else if(typeText.includes('‡¶¨‡ßã‡¶®‡¶æ‡¶∏') || typeText.includes('Bonus')) {
                icon = 'https://i.postimg.cc/qqLQKVHV/bonus.png';
            } else if(typeText.includes('‡¶ï‡ßÅ‡¶á‡¶ú') || typeText.includes('Quiz')) {
                icon = 'https://i.postimg.cc/mkNFY0L0/solution.png';
            } else if(typeText.includes('‡¶∞‡ßá‡¶´‡¶æ‡¶∞') || typeText.includes('Referral')) {
                icon = 'https://i.postimg.cc/c4xbp54V/add-friend.png';
            } else {
                icon = 'https://i.postimg.cc/VNTvSLRX/transaction-history.png';
            }
            
            const amount = parseFloat(transaction.amount) || 0;
            const amountColor = amount > 0 ? 'text-green-600' : 'text-red-600';
            const amountSign = amount > 0 ? '+' : '';
            
            let receiptRows = '';
            
            receiptRows += `
                <div class="receipt-row">
                    <span class="receipt-label">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ü‡¶á‡¶°‡¶ø</span>
                    <span class="receipt-value">${transaction.trxId || transaction.id?.substring(0, 8) || 'N/A'}</span>
                </div>
                <div class="receipt-row">
                    <span class="receipt-label">‡¶ß‡¶∞‡¶£</span>
                    <span class="receipt-value">${typeText}</span>
                </div>
                <div class="receipt-row">
                    <span class="receipt-label">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</span>
                    <span class="receipt-value">${transaction.date || new Date().toLocaleDateString('bn-BD')}</span>
                </div>
                <div class="receipt-row">
                    <span class="receipt-label">‡¶∏‡¶Æ‡¶Ø‡¶º</span>
                    <span class="receipt-value">${transaction.time || new Date().toLocaleTimeString('bn-BD')}</span>
                </div>
                <div class="receipt-row">
                    <span class="receipt-label">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</span>
                    <span class="receipt-value">${statusBadge}</span>
                </div>
            `;
            
            if(transaction.method) {
                receiptRows += `
                    <div class="receipt-row">
                        <span class="receipt-label">‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</span>
                        <span class="receipt-value">${transaction.method}</span>
                    </div>
                `;
            }
            
            if(transaction.accountNumber || transaction.phone) {
                receiptRows += `
                    <div class="receipt-row">
                        <span class="receipt-label">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü/‡¶´‡ßã‡¶®</span>
                        <span class="receipt-value">${transaction.accountNumber || transaction.phone || 'N/A'}</span>
                    </div>
                `;
            }
            
            if(transaction.vat) {
                receiptRows += `
                    <div class="receipt-row">
                        <span class="receipt-label">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü</span>
                        <span class="receipt-value">‡ß≥${parseFloat(transaction.vat).toFixed(2)}</span>
                    </div>
                `;
            }
            
            if(transaction.receivedAmount) {
                receiptRows += `
                    <div class="receipt-row">
                        <span class="receipt-label">‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</span>
                        <span class="receipt-value text-green-600">‡ß≥${parseFloat(transaction.receivedAmount).toFixed(2)}</span>
                    </div>
                `;
            }
            
            if(transaction.fee) {
                receiptRows += `
                    <div class="receipt-row">
                        <span class="receipt-label">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶´‡¶ø</span>
                        <span class="receipt-value">‡ß≥${parseFloat(transaction.fee).toFixed(2)}</span>
                    </div>
                `;
            }
            
            if(transaction.details && transaction.details.length > 0) {
                receiptRows += `
                    <div class="receipt-row">
                        <span class="receipt-label">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</span>
                        <span class="receipt-value" style="text-align: left; font-size: 12px;">${transaction.details.substring(0, 50)}${transaction.details.length > 50 ? '...' : ''}</span>
                    </div>
                `;
            }
            
            receiptModal.innerHTML = `
                <div class="receipt-content">
                    <div class="receipt-header">
                        <h2 class="text-lg font-bold text-white mb-1">‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü</h2>
                        <p class="text-xs text-white/80">‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü</p>
                    </div>
                    
                    <div class="receipt-body">
                        <div class="text-center mb-4">
                            <img src="${icon}" class="w-16 h-16 mx-auto mb-2">
                            <div class="receipt-amount ${amountColor}">
                                ${amountSign}‡ß≥${Math.abs(amount).toFixed(2)}
                            </div>
                            <p class="text-sm text-slate-600 mt-1">${typeText}</p>
                        </div>
                        
                        <div class="space-y-1">
                            ${receiptRows}
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-slate-200">
                            <button onclick="document.getElementById('receiptModal').remove()" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg hover:opacity-90 transition text-sm">
                                ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                            <p class="text-center text-xs text-slate-500 mt-2">
                                ‡¶è‡¶á ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶Ü‡¶á‡¶®‡¶ó‡¶§ ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(receiptModal);
            
            receiptModal.addEventListener('click', (e) => {
                if(e.target === receiptModal) {
                    receiptModal.remove();
                }
            });
        };

        // ‚úÖ QUIZ FUNCTIONS WITH DAILY LIMIT (‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß®)
        window.switchQuizTab = (tab) => {
            document.getElementById('tabQuizTypes').className = tab === 'types' ? 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow' : 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            document.getElementById('tabQuizQuestions').className = tab === 'questions' ? 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow' : 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            
            document.getElementById('quizTypesSection').classList.toggle('hidden', tab !== 'types');
            document.getElementById('quizQuestionsSection').classList.toggle('hidden', tab !== 'questions');
        };

        window.showQuizQuestions = async (type) => {
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß®: ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ö‡ßá‡¶ï
            if(currentUserData) {
                const today = new Date().toDateString();
                const lastQuizDateField = `lastQuizDate_${type}`;
                const lastQuizDate = currentUserData[lastQuizDateField] ? 
                    new Date(currentUserData[lastQuizDateField].toDate()).toDateString() : null;
                
                if(lastQuizDate === today) {
                    showNotification(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ${type} ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ñ‡ßá‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            currentQuizType = type;
            selectedAnswers = {};
            
            // Quiz titles
            const quizTitles = {
                general: '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡ßÅ‡¶á‡¶ú',
                math: '‡¶Æ‡ßç‡¶Ø‡¶æ‡¶• ‡¶ï‡ßÅ‡¶á‡¶ú',
                science: '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú',
                islamic: '‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßÅ‡¶á‡¶ú'
            };
            
            document.getElementById('quizTypeTitle').textContent = quizTitles[type] || '‡¶ï‡ßÅ‡¶á‡¶ú';
            
            const questions = demoQuestions[type] || demoQuestions.general;
            let questionsHtml = '';
            
            questions.forEach((q, qIndex) => {
                let optionsHtml = '';
                q.options.forEach((option, oIndex) => {
                    optionsHtml += `
                        <div class="flex items-center p-3 bg-white rounded-xl border cursor-pointer hover:bg-slate-50 mb-2" onclick="window.selectQuizAnswer(${qIndex}, ${oIndex})">
                            <input type="radio" name="quizQuestion${qIndex}" id="q${qIndex}o${oIndex}" class="mr-3">
                            <label for="q${qIndex}o${oIndex}" class="flex-1 cursor-pointer">${option}</label>
                        </div>
                    `;
                });
                
                questionsHtml += `
                    <div class="mb-6 p-4 bg-slate-50 rounded-xl">
                        <h4 class="font-bold text-slate-700 mb-3">${qIndex + 1}. ${q.question}</h4>
                        <div class="space-y-2">
                            ${optionsHtml}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('quizQuestionsContainer').innerHTML = questionsHtml;
            document.getElementById('submitQuizBtn').classList.remove('hidden');
            
            window.switchQuizTab('questions');
            startQuizTimer();
        };
        
        window.selectQuizAnswer = (questionIndex, answerIndex) => {
            selectedAnswers[questionIndex] = answerIndex;
            
            // Update radio button visually
            const radio = document.getElementById(`q${questionIndex}o${answerIndex}`);
            if(radio) {
                radio.checked = true;
            }
        };
        
        function startQuizTimer() {
            if(quizTimer) clearInterval(quizTimer);
            
            let timeLeft = 180; // 3 minutes
            const timerElement = document.getElementById('quizTimer');
            
            quizTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if(timeLeft <= 0) {
                    clearInterval(quizTimer);
                    showNotification('‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                    window.switchQuizTab('types');
                }
            }, 1000);
        }
        
        window.submitQuiz = async () => {
            const questionsCount = Object.keys(selectedAnswers).length;
            if(questionsCount === 0) {
                showNotification('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            // ‚úÖ FIX 2: REAL QUIZ LOGIC - Calculate actual score
            const questions = demoQuestions[currentQuizType] || demoQuestions.general;
            let correctAnswers = 0;
            const totalQuestions = questions.length;
            
            // Check each answer
            for(let i = 0; i < totalQuestions; i++) {
                if(selectedAnswers[i] !== undefined && selectedAnswers[i] === questions[i].answer) {
                    correctAnswers++;
                }
            }
            
            // Calculate reward: 0.25 per correct answer
            const reward = correctAnswers * 0.25;
            
            if(reward === 0) {
                showNotification('‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶®‡¶®‡¶ø', 'error');
                return;
            }
            
            showLoading();
            showNotification('‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const userRef = db.collection("users").doc(currentUserId);
                
                // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß®: Update last quiz date
                const updateData = {
                    mainBalance: firebase.firestore.FieldValue.increment(reward),
                    totalEarnings: firebase.firestore.FieldValue.increment(reward),
                    totalTasks: firebase.firestore.FieldValue.increment(1),
                    todayEarnings: firebase.firestore.FieldValue.increment(reward),
                    [`lastQuizDate_${currentQuizType}`]: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await userRef.update(updateData);
                
                await db.collection("history").add({
                    userId: currentUserId,
                    type: `${currentQuizType} ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞`,
                    amount: reward,
                    status: "Success",
                    details: `${correctAnswers}/${totalQuestions} ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶†‡¶ø‡¶ï`,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update today's earnings display
                todayEarnings += reward;
                document.getElementById('todayEarnings').textContent = todayEarnings.toFixed(2);
                
                showNotification(`‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶´‡¶≤! ‡ß≥${reward.toFixed(2)} ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®`, 'success');
                hideLoading();
                
                if(quizTimer) clearInterval(quizTimer);
                
                document.getElementById('quizQuestionsContainer').innerHTML = `
                    <div class="text-center p-6">
                        <div class="text-green-500 text-6xl mb-4">‚úÖ</div>
                        <h4 class="text-xl font-bold text-green-700 mb-2">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶´‡¶≤!</h4>
                        <p class="text-slate-600 mb-2">‡¶Ü‡¶™‡¶®‡¶ø ${correctAnswers}/${totalQuestions} ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®</p>
                        <p class="text-slate-700 font-bold mb-4">‡¶Ü‡¶™‡¶®‡¶ø ‡ß≥${reward.toFixed(2)} ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®</p>
                        <button onclick="window.switchQuizTab('types')" class="mt-4 bg-premium text-white px-6 py-2 rounded-xl font-bold">
                            ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                    </div>
                `;
                
                document.getElementById('submitQuizBtn').classList.add('hidden');
                
            } catch (error) {
                console.error("Quiz submission error:", error);
                showNotification('‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };

        // ‚úÖ PROFILE FUNCTIONS
        window.showAvatarSelector = () => {
            document.getElementById('avatarModal').classList.remove('hidden');
        };
        
        window.closeAvatarModal = () => {
            document.getElementById('avatarModal').classList.add('hidden');
        };
        
        window.selectAvatar = (avatarUrl) => {
            selectedAvatar = avatarUrl;
            document.getElementById('currentAvatar').src = avatarUrl;
            window.closeAvatarModal();
            showNotification('‡¶è‡¶≠‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
        };
        
        window.updateProfile = async () => { 
            try {
                showLoading();
                await db.collection("users").doc(currentUserId).update({ 
                    name: document.getElementById('profNameInput').value, 
                    email: document.getElementById('profEmailInput').value,
                    address: document.getElementById('profAddressInput').value,
                    avatar: selectedAvatar
                }); 
                
                // ‚úÖ FIX 5: Update avatar immediately
                document.getElementById('currentAvatar').src = selectedAvatar;
                
                showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success'); 
                hideLoading();
            } catch (e) {
                showNotification('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        window.showChangePassword = async () => {
            const { value: newPassword } = await Swal.fire({
                title: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®',
                input: 'password',
                inputLabel: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (‡ß¨+ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)',
                inputPlaceholder: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®',
                showCancelButton: true,
                confirmButtonText: '‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                inputValidator: (value) => {
                    if (!value || value.length < 6) {
                        return '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá';
                    }
                }
            });
            
            if (newPassword) {
                try {
                    showLoading();
                    const user = auth.currentUser;
                    await user.updatePassword(newPassword);
                    showNotification('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶´‡¶≤', 'success');
                    hideLoading();
                } catch (error) {
                    showNotification('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                    hideLoading();
                }
            }
        };

        // ‚úÖ TASK COMPLETION
        window.completeTask = async (taskId, reward, taskType, title, description, link) => {
            if(!currentUserData) return;
            
            currentTaskInfo = {
                taskId,
                reward,
                taskType,
                title,
                description,
                link
            };
            
            showInterstitialAd();
            
            setTimeout(() => {
                window.open(link, '_blank');
            }, 500);
            
            startTaskTimer();
            
            showNotification('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'info');
        };
        
        function startTaskTimer() {
            if(taskTimer) clearInterval(taskTimer);
            
            // ‚úÖ FIX 3: Changed from 60 to 15 seconds
            let timeLeft = 15; // 15 seconds instead of 60
            const startTime = Date.now();
            
            taskTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const remaining = timeLeft - elapsed;
                
                if(remaining <= 0) {
                    clearInterval(taskTimer);
                    showProofSubmissionForm();
                }
            }, 1000);
            
            setTimeout(() => {
                if(taskTimer) {
                    clearInterval(taskTimer);
                }
                showProofSubmissionForm();
            }, timeLeft * 1000);
        }
        
        function showProofSubmissionForm() {
            if(!currentTaskInfo) return;
            
            let proofFields = '';
            
            if(currentTaskInfo.taskType === 'telegram') {
                proofFields = `
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                        <input type="text" id="proofTelegramUsername" placeholder="@username" class="w-full p-3 border rounded-lg">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï</label>
                        <input type="url" id="proofScreenshot" placeholder="https://example.com/screenshot.png" class="w-full p-3 border rounded-lg">
                    </div>
                `;
            } else if(currentTaskInfo.taskType === 'youtube') {
                proofFields = `
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï</label>
                        <input type="url" id="proofYoutubeLink" placeholder="https://youtube.com/@channel" class="w-full p-3 border rounded-lg">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï</label>
                        <input type="url" id="proofScreenshot" placeholder="https://example.com/screenshot.png" class="w-full p-3 border rounded-lg">
                    </div>
                `;
            } else {
                proofFields = `
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏</label>
                        <textarea id="proofDetails" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡ßÅ‡¶£ ‡¶¶‡¶ø‡¶®..." class="w-full p-3 border rounded-lg" rows="3"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                        <input type="url" id="proofLink" placeholder="https://example.com/proof" class="w-full p-3 border rounded-lg">
                    </div>
                `;
            }
            
            document.getElementById('proofFormContainer').innerHTML = `
                <h3 class="text-lg font-bold mb-4">${currentTaskInfo.title}</h3>
                <p class="text-slate-600 mb-4">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: ‡ß≥${currentTaskInfo.reward}</p>
                ${proofFields}
            `;
            
            document.getElementById('proofModal').classList.remove('hidden');
        }
        
        window.closeProofModal = () => {
            document.getElementById('proofModal').classList.add('hidden');
            currentTaskInfo = null;
            if(taskTimer) clearInterval(taskTimer);
        };
        
        window.submitProof = async () => {
            if(!currentTaskInfo) return;
            
            showLoading();
            showNotification('‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const proofData = {
                    telegramUsername: document.getElementById('proofTelegramUsername')?.value || '',
                    screenshot: document.getElementById('proofScreenshot')?.value || '',
                    youtubeLink: document.getElementById('proofYoutubeLink')?.value || '',
                    details: document.getElementById('proofDetails')?.value || '',
                    link: document.getElementById('proofLink')?.value || ''
                };
                
                await db.collection("pending_requests").add({ 
                    userId: currentUserId, 
                    type: "‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®", 
                    taskId: currentTaskInfo.taskId,
                    taskType: currentTaskInfo.taskType,
                    taskTitle: currentTaskInfo.title,
                    amount: currentTaskInfo.reward, 
                    userName: currentUserData.name,
                    userPhone: currentUserData.phone,
                    proof: proofData,
                    status: "Pending",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Send Telegram notification
                const telegramMessage = `üîî *‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüéØ *‡¶ü‡¶æ‡¶∏‡ßç‡¶ï:* ${currentTaskInfo.title}\nüí∞ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${currentTaskInfo.reward}\nüìä *‡¶ü‡¶æ‡¶á‡¶™:* ${currentTaskInfo.taskType}\nüìù *‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏:* ${JSON.stringify(proofData)}`;
                await sendTelegramNotification(telegramMessage);
                
                showNotification('‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®', 'success');
                hideLoading();
                window.closeProofModal();
                
            } catch (e) {
                showNotification('‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };

        // ‚úÖ WALLET FUNCTIONS WITH LIMITS (‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß´)
        window.calculateDepositVAT = () => {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            const vatPercentage = systemSettings.vatPercentage || 10;
            const vat = amount * (vatPercentage / 100);
            const total = amount + vat;
            document.getElementById('vatCalculation').innerHTML = `‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (${vatPercentage}%): ‡ß≥${vat.toFixed(2)} | ‡¶Æ‡ßã‡¶ü: ‡ß≥${total.toFixed(2)}`;
        };
        
        window.calculateWithdrawVAT = () => {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            const vatPercentage = systemSettings.vatPercentage || 10;
            const vat = amount * (vatPercentage / 100);
            const received = amount - vat;
            document.getElementById('withdrawVat').innerHTML = `‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (${vatPercentage}%): ‡ß≥${vat.toFixed(2)} | ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§: ‡ß≥${received.toFixed(2)}`;
        };
        
        window.calculateRechargeFee = () => {
            const amount = parseFloat(document.getElementById('rechAmount').value) || 0;
            const fee = systemSettings.rechargeFee || 5;
            const total = amount + fee;
            document.getElementById('rechargeFee').innerHTML = `‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: ‡ß≥${fee.toFixed(2)} | ‡¶Æ‡ßã‡¶ü: ‡ß≥${total.toFixed(2)}`;
        };

        window.submitDeposit = async () => {
            const trxId = document.getElementById('depositTrxId').value.trim();
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const method = document.getElementById('selectedDepositMethod').value;
            
            if(!trxId || !amount || amount <= 0) {
                showNotification('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            if(!method) {
                showNotification('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß´: ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶ö‡ßá‡¶ï
            const minDeposit = systemSettings.minDeposit || 50;
            if(amount < minDeposit) {
                showNotification(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minDeposit}`, 'error');
                return;
            }
            
            showLoading();
            showNotification('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const vatPercentage = systemSettings.vatPercentage || 10;
                const vat = amount * (vatPercentage / 100);
                const totalAmount = amount + vat;
                
                await db.collection("pending_requests").add({ 
                    userId: currentUserId, 
                    type: "‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü", 
                    amount: amount, 
                    vat: vat,
                    totalAmount: totalAmount,
                    trxId: trxId,
                    method: method,
                    userName: currentUserData.name,
                    userPhone: currentUserData.phone,
                    status: "Pending",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Send Telegram notification
                const telegramMessage = `üí∞ *‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüí≥ *‡¶Æ‡ßá‡¶•‡¶°:* ${method}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüßæ *TrxID:* ${trxId}\nüìä *‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü:* ‡ß≥${vat.toFixed(2)}\nüí∞ *‡¶Æ‡ßã‡¶ü:* ‡ß≥${totalAmount.toFixed(2)}`;
                await sendTelegramNotification(telegramMessage);
                
                showNotification('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®', 'success');
                hideLoading();
                
                document.getElementById('depositTrxId').value = '';
                document.getElementById('depositAmount').value = '';
                window.calculateDepositVAT();
                
            } catch (e) {
                showNotification('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        window.submitWithdraw = async () => {
            const number = document.getElementById('withdrawNumber').value.trim();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const method = document.getElementById('selectedWithdrawMethod').value;
            
            if(!number || !amount || amount <= 0) {
                showNotification('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            if(!method) {
                showNotification('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const minWithdraw = systemSettings.minWithdraw || 50;
            const maxWithdraw = systemSettings.maxWithdraw || 5000;
            
            if(amount < minWithdraw) {
                showNotification(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minWithdraw}`, 'error');
                return;
            }
            
            if(amount > maxWithdraw) {
                showNotification(`‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${maxWithdraw}`, 'error');
                return;
            }
            
            // ‚úÖ FIXED: Check if user has enough balance
            if(!currentUserData) {
                showNotification('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.mainBalance < amount) {
                showNotification('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + currentUserData.mainBalance.toFixed(2), 'error');
                return;
            }
            
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß´: ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶ö‡ßá‡¶ï ‡¶´‡¶∞ ‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞
            const isFreeUser = currentUserData.plan === "Free Member" || currentUserData.plan.includes("Free");
            if(isFreeUser) {
                const referralCount = currentUserData.totalReferrals || 0;
                if(referralCount < 3) {
                    showNotification(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ${referralCount}‡•§ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß©‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß´: ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü
            let dailyLimit = 1; // Default for free users
            if(!isFreeUser) {
                dailyLimit = 2; // VIP/Paid users get 2 withdrawals per day
            }
            
            if(userWithdrawCount >= dailyLimit) {
                showNotification(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ${userWithdrawCount} ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ${dailyLimit} ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`, 'error');
                return;
            }
            
            const vatPercentage = systemSettings.vatPercentage || 10;
            const vat = amount * (vatPercentage / 100);
            const received = amount - vat;
            
            showLoading();
            showNotification('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const userRef = db.collection("users").doc(currentUserId);
                await userRef.update({
                    mainBalance: firebase.firestore.FieldValue.increment(-amount),
                    totalWithdraw: firebase.firestore.FieldValue.increment(amount)
                });
                
                await db.collection("pending_requests").add({ 
                    userId: currentUserId, 
                    type: "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®", 
                    amount: amount, 
                    vat: vat,
                    receivedAmount: received,
                    accountNumber: number,
                    method: method,
                    userName: currentUserData.name,
                    userPhone: currentUserData.phone,
                    status: "Pending",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®",
                    amount: -amount,
                    status: "Pending",
                    details: `${method} - ${number}`,
                    vat: vat,
                    receivedAmount: received,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update withdrawal count
                userWithdrawCount++;
                
                // Send Telegram notification
                const telegramMessage = `üí∏ *‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüí≥ *‡¶Æ‡ßá‡¶•‡¶°:* ${method}\nüìû *‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü:* ${number}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüìä *‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü:* ‡ß≥${vat.toFixed(2)}\nüí∞ *‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§:* ‡ß≥${received.toFixed(2)}`;
                await sendTelegramNotification(telegramMessage);
                
                showNotification('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®', 'success');
                hideLoading();
                
                document.getElementById('withdrawNumber').value = '';
                document.getElementById('withdrawAmount').value = '';
                window.calculateWithdrawVAT();
                
            } catch (e) {
                showNotification('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        window.submitRecharge = async () => { 
            const phone = document.getElementById('rechPhone').value.trim();
            const amount = parseFloat(document.getElementById('rechAmount').value);
            const operator = document.getElementById('selectedOperator').value;
            
            if(!phone || !amount || amount <= 0) {
                showNotification('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß´: ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶ö‡ßá‡¶ï
            const minRecharge = systemSettings.minRecharge || 20;
            if(amount < minRecharge) {
                showNotification(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minRecharge}`, 'error');
                return;
            }
            
            const fee = systemSettings.rechargeFee || 5;
            const totalAmount = amount + fee;
            
            // ‚úÖ FIXED: Check if user has enough recharge balance
            if(!currentUserData) {
                showNotification('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.rechargeBalance < totalAmount) {
                showNotification('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + (currentUserData.rechargeBalance || 0).toFixed(2), 'error');
                return;
            }
            
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß´: ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶ö‡ßá‡¶ï ‡¶´‡¶∞ ‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞
            const isFreeUser = currentUserData.plan === "Free Member" || currentUserData.plan.includes("Free");
            if(isFreeUser) {
                const referralCount = currentUserData.totalReferrals || 0;
                if(referralCount < 3) {
                    showNotification(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ${referralCount}‡•§ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß©‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß´: ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü
            let dailyLimit = 2; // Default for free users
            if(!isFreeUser) {
                dailyLimit = 3; // VIP/Paid users get 3 recharges per day
            }
            
            if(userRechargeCount >= dailyLimit) {
                showNotification(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ${userRechargeCount} ‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ${dailyLimit} ‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`, 'error');
                return;
            }
            
            showLoading();
            showNotification('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const userRef = db.collection("users").doc(currentUserId);
                await userRef.update({
                    rechargeBalance: firebase.firestore.FieldValue.increment(-totalAmount)
                });
                
                await db.collection("recharge_requests").add({ 
                    userId: currentUserId, 
                    phone: phone, 
                    amount: amount, 
                    fee: fee,
                    totalAmount: totalAmount,
                    operator: operator,
                    status: 'Pending', 
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }); 
                
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú",
                    amount: -totalAmount,
                    status: "Pending",
                    details: `${operator} - ${phone}`,
                    fee: fee,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update recharge count
                userRechargeCount++;
                
                // Send Telegram notification
                const telegramMessage = `üì± *‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüìû *‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞:* ${phone}\nüè¢ *‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞:* ${operator}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüìä *‡¶´‡¶ø:* ‡ß≥${fee}\nüí∞ *‡¶Æ‡ßã‡¶ü:* ‡ß≥${totalAmount}`;
                await sendTelegramNotification(telegramMessage);
                
                showNotification('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success'); 
                hideLoading();
                
                document.getElementById('rechPhone').value = '';
                document.getElementById('rechAmount').value = '';
                window.calculateRechargeFee();
                
            } catch (e) {
                showNotification('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        window.transferBalance = async () => {
            const am = parseFloat(document.getElementById('transferAmount').value);
            if(!am || am <= 0) {
                showNotification('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', 'error');
                return;
            }
            
            // ‚úÖ FIXED: Check if user has enough balance
            if(!currentUserData) {
                showNotification('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.mainBalance < am) {
                showNotification('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + currentUserData.mainBalance.toFixed(2), 'error');
                return;
            }
            
            showLoading();
            showNotification('‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const userRef = db.collection("users").doc(currentUserId);
                
                await userRef.update({
                    mainBalance: firebase.firestore.FieldValue.increment(-am),
                    rechargeBalance: firebase.firestore.FieldValue.increment(am)
                });
                
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞",
                    amount: am,
                    status: "Success",
                    details: "‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification(`‡ß≥${am} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'success');
                hideLoading();
                
                document.getElementById('transferAmount').value = '';
                
            } catch (e) {
                showNotification('‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };

        // ‚úÖ SUMMARY FUNCTIONS
        async function loadSummary(uid) {
            try {
                showLoading();
                const userDoc = await db.collection("users").doc(uid).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    document.getElementById('totalEarnings').innerText = (data.totalEarnings || 0).toFixed(2);
                    document.getElementById('totalDeposit').innerText = (data.totalDeposit || 0).toFixed(2);
                    document.getElementById('totalWithdraw').innerText = (data.totalWithdraw || 0).toFixed(2);
                    document.getElementById('totalTasks').innerText = data.totalTasks || '0';
                    document.getElementById('summaryPlan').innerText = data.plan || 'Free';
                    document.getElementById('totalReferrals').innerText = data.totalReferrals || '0';
                    document.getElementById('referralCount').innerText = data.totalReferrals || '0';
                    document.getElementById('referralEarnings').innerText = data.referralEarnings || 0;
                    document.getElementById('todayEarnings').innerText = (data.todayEarnings || 0).toFixed(2);
                    todayEarnings = data.todayEarnings || 0;
                    
                    const tasksSnap = await db.collection("tasks").get();
                    document.getElementById('activeTasks').innerText = tasksSnap.size || '0';
                    
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    document.getElementById('dailyBonusStatus').innerText = lastBonus === today ? '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
                }
                hideLoading();
            } catch (e) {
                console.error("Error loading summary:", e);
                hideLoading();
            }
        }

        async function checkDailyBonus(uid) {
            try {
                const userDoc = await db.collection("users").doc(uid).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    
                    if(lastBonus === today) {
                        document.getElementById('dailyBonusStatus').innerText = '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                    } else {
                        document.getElementById('dailyBonusStatus').innerText = '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
                    }
                }
            } catch (e) {
                console.error("Error checking daily bonus:", e);
            }
        }

        window.showDailyBonus = async () => {
            if(!currentUserId) return;
            
            try {
                const userDoc = await db.collection("users").doc(currentUserId).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    
                    if(lastBonus === today) {
                        showNotification('‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú‡¶ï‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®', 'info');
                        return;
                    }
                    
                    const bonusAmount = Math.floor(2 + Math.random() * 2);
                    
                    const result = await Swal.fire({
                        title: '‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏',
                        html: `‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <b>‡ß≥${bonusAmount}</b><br><br>‡¶è‡¶á ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`,
                        showCancelButton: true,
                        confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶®‡¶ø‡¶®',
                        cancelButtonText: '‡¶®‡¶æ',
                        confirmButtonColor: '#059669',
                        icon: 'info'
                    });
                    
                    if (result.isConfirmed) {
                        showLoading();
                        
                        const userRef = db.collection("users").doc(currentUserId);
                        
                        await userRef.update({
                            mainBalance: firebase.firestore.FieldValue.increment(bonusAmount),
                            totalEarnings: firebase.firestore.FieldValue.increment(bonusAmount),
                            lastDailyBonus: firebase.firestore.FieldValue.serverTimestamp(),
                            todayEarnings: firebase.firestore.FieldValue.increment(bonusAmount)
                        });
                        
                        // Update today's earnings display
                        todayEarnings += bonusAmount;
                        document.getElementById('todayEarnings').textContent = todayEarnings.toFixed(2);
                        
                        await db.collection("history").add({
                            userId: currentUserId,
                            type: "‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏",
                            amount: bonusAmount,
                            status: "Success",
                            details: "‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶ø‡¶§ ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏",
                            date: new Date().toLocaleDateString('bn-BD'),
                            time: new Date().toLocaleTimeString('bn-BD'),
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        showNotification(`‡ß≥${bonusAmount} ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
                        checkDailyBonus(currentUserId);
                        hideLoading();
                    }
                }
            } catch (e) {
                console.error("Error showing daily bonus:", e);
                showNotification('‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };

        // ‚úÖ OTHER FUNCTIONS
        window.copyReferralLink = () => {
            const link = document.getElementById('referralLink').innerText;
            navigator.clipboard.writeText(link);
            showNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
        };
        
        window.openSupport = () => {
            window.open('https://t.me/TAKAR_WALA_ADMIN', '_blank');
        };
        
        // ‚úÖ FIX 1: AUTOMATIC PACKAGE PURCHASE
        window.buyPackage = async (packageType) => {
            if(!currentUserData) {
                showNotification('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            const packagePrices = {
                silver: 500,
                gold: 1000,
                platinum: 2000
            };
            
            const packageNames = {
                silver: "‡¶∏‡¶ø‡¶≤‡¶≠‡¶æ‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú",
                gold: "‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú", 
                platinum: "‡¶™‡ßç‡¶≤‡¶æ‡¶ü‡¶ø‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú"
            };
            
            const price = packagePrices[packageType];
            const name = packageNames[packageType];
            
            // Check balance
            if(currentUserData.mainBalance < price) {
                showNotification(`‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${currentUserData.mainBalance.toFixed(2)}, ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®: ‡ß≥${price}`, 'error');
                return;
            }
            
            const result = await Swal.fire({
                title: `${name} ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`,
                html: `‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: <b>‡ß≥${price}</b><br><br>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${currentUserData.mainBalance.toFixed(2)}<br>‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${(currentUserData.mainBalance - price).toFixed(2)}`,
                showCancelButton: true,
                confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                confirmButtonColor: '#059669',
                icon: 'question'
            });
            
            if (result.isConfirmed) {
                showLoading();
                try {
                    const userRef = db.collection("users").doc(currentUserId);
                    
                    // Deduct balance and update plan
                    await userRef.update({
                        mainBalance: firebase.firestore.FieldValue.increment(-price),
                        plan: name,
                        totalDeposit: firebase.firestore.FieldValue.increment(price)
                    });
                    
                    // Add to history
                    await db.collection("history").add({
                        userId: currentUserId,
                        type: `${name} ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º`,
                        amount: -price,
                        status: "Success",
                        details: `${name} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`,
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Send Telegram notification
                    const telegramMessage = `üõí *‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∏‡¶´‡¶≤*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüì¶ *‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú:* ${name}\nüí∞ *‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:* ‡ß≥${price}\n‚úÖ *‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:* Success`;
                    await sendTelegramNotification(telegramMessage);
                    
                    showNotification(`${name} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
                    hideLoading();
                    
                } catch (e) {
                    console.error("Package purchase error:", e);
                    showNotification('‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                    hideLoading();
                }
            }
        };
        
        // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß¨: ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶™‡ßá‡¶ú
        window.showDriveOffer = () => {
            window.showPage('driveOfferScreen');
        };
        
        window.logout = () => {
            auth.signOut();
            showNotification('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤', 'success');
            document.getElementById('globalChatIcon').style.display = 'none';
            document.getElementById('twaiChatbotIcon').style.display = 'none';
        };
        
        window.showRules = (t) => {
            Swal.fire({
                title: `${t} ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ`,
                html: `
                    <div class="text-left">
                        <p><b>‡ßß.</b> ‡¶∏‡¶ï‡¶≤ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®</p>
                        <p><b>‡ß®.</b> ‡¶≠‡ßÅ‡¶Ø‡¶º‡¶æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</p>
                        <p><b>‡ß©.</b> ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡ß≥5 ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</p>
                        <p><b>‡ß™.</b> ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡ßß‡ß¶% ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶æ‡¶ü‡¶æ ‡¶π‡¶¨‡ßá</p>
                        <p><b>‡ß´.</b> ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ßß‡¶ü‡¶ø ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá</p>
                        <p><b>‡ß¨.</b> ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ: ‡ß≥50</p>
                        <p><b>‡ß≠.</b> ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ: ‡ß≥50</p>
                        <p><b>‡ßÆ.</b> ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ: ‡ß≥20</p>
                        <p><b>‡ßØ.</b> ‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞/‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß©‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá</p>
                    </div>
                `,
                confirmButtonText: '‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø'
            });
        };
        
        // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß≠: TWAI ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø
        window.openTWAI = () => {
            document.getElementById('twaiModal').classList.remove('hidden');
        };
        
        window.closeTWAI = () => {
            document.getElementById('twaiModal').classList.add('hidden');
        };
        
        window.askTWAI = (question) => {
            const response = twaiResponses[question] || '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶æ‡¶®‡¶ø ‡¶®‡¶æ‡•§ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
            
            const chatContainer = document.getElementById('chatbotMessages');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user-message';
            userMessage.innerHTML = `
                <div class="message-bubble user-bubble">${question}</div>
                <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
            `;
            chatContainer.appendChild(userMessage);
            
            // Add bot response after delay
            setTimeout(() => {
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot-message';
                botMessage.innerHTML = `
                    <div class="message-bubble bot-bubble">${response}</div>
                    <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
                `;
                chatContainer.appendChild(botMessage);
                
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 500);
            
            // Clear input
            document.getElementById('chatbotInput').value = '';
        };
        
        window.sendTWAI = () => {
            const input = document.getElementById('chatbotInput');
            const question = input.value.trim();
            
            if(!question) return;
            
            window.askTWAI(question);
        };
        
        // Auto answer based on keywords
        window.askTWAI = (question) => {
            let response = '';
            const q = question.toLowerCase();
            
            // Keyword matching
            if(q.includes('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï') || q.includes('task')) {
                response = twaiResponses['‡¶ü‡¶æ‡¶∏‡ßç‡¶ï'];
            } else if(q.includes('‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞') || q.includes('withdraw') || q.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®')) {
                response = twaiResponses['‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞'];
            } else if(q.includes('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü') || q.includes('deposit')) {
                response = twaiResponses['‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü'];
            } else if(q.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú') || q.includes('recharge')) {
                response = twaiResponses['‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú'];
            } else if(q.includes('‡¶ï‡ßÅ‡¶á‡¶ú') || q.includes('quiz')) {
                response = twaiResponses['‡¶ï‡ßÅ‡¶á‡¶ú'];
            } else if(q.includes('‡¶¨‡ßç‡¶Ø‡¶æ‡¶®') || q.includes('ban')) {
                response = twaiResponses['‡¶¨‡ßç‡¶Ø‡¶æ‡¶®'];
            } else if(q.includes('‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú') || q.includes('package') || q.includes('‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø') || q.includes('vip')) {
                response = twaiResponses['‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú'];
            } else if(q.includes('‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®') || q.includes('subscription') || q.includes('‡¶∏‡ßç‡¶ü‡¶æ‡¶∞')) {
                response = twaiResponses['‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®'];
            } else if(q.includes('‡¶¶‡ßá‡¶∞‡¶ø') || q.includes('late') || q.includes('‡¶ï‡¶§‡¶ï‡ßç‡¶∑‡¶£')) {
                response = twaiResponses['‡¶¶‡ßá‡¶∞‡¶ø'];
            } else {
                response = '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶æ‡¶®‡¶ø ‡¶®‡¶æ‡•§ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
            }
            
            const chatContainer = document.getElementById('chatbotMessages');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user-message';
            userMessage.innerHTML = `
                <div class="message-bubble user-bubble">${question}</div>
                <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
            `;
            chatContainer.appendChild(userMessage);
            
            // Add bot response after delay
            setTimeout(() => {
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot-message';
                botMessage.innerHTML = `
                    <div class="message-bubble bot-bubble">${response}</div>
                    <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
                `;
                chatContainer.appendChild(botMessage);
                
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 500);
            
            // Clear input
            document.getElementById('chatbotInput').value = '';
        };

        // ‚úÖ GLOBAL WINDOW FUNCTIONS
        window.toggleAuthTab = (t) => {
            document.getElementById('loginForm').classList.toggle('hidden', t!=='login');
            document.getElementById('registerForm').classList.toggle('hidden', t!=='register');
            document.getElementById('btnTabLogin').className = t==='login'?'flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg':'flex-1 py-3 rounded-full text-sm font-bold text-slate-500';
            document.getElementById('btnTabRegister').className = t==='register'?'flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg':'flex-1 py-3 rounded-full text-sm font-bold text-slate-500';
        };
        
        window.showPage = (id) => { 
            showLoading();
            setTimeout(() => {
                document.querySelectorAll('#mainApp > div').forEach(d => { 
                    if(d.id !== 'bottomNav') d.classList.add('hidden'); 
                }); 
                document.getElementById(id).classList.remove('hidden'); 
                
                if(id === 'summaryScreen' && currentUserId) {
                    loadSummary(currentUserId);
                }
                if(id === 'subscriptionScreen') {
                    window.switchSubscriptionTab('stars');
                }
                if(id === 'walletScreen') {
                    updateDepositAddress(selectedMethod || 'bKash');
                }
                if(id === 'quizScreen') {
                    window.switchQuizTab('types');
                }
                
                hideLoading();
            }, 500);
        };
        
        window.toggleWalletTab = (t) => {
            ['deposit','withdraw','transfer'].forEach(id => document.getElementById(id+'Section').classList.add('hidden'));
            document.getElementById(t+'Section').classList.remove('hidden');
            ['tabDeposit','tabWithdraw','tabTransfer'].forEach(id => document.getElementById(id).className = 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500');
            document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1)).className = 'flex-1 py-3 font-bold text-sm rounded-xl bg-slate-800 text-white shadow';
            
            if(t === 'deposit') {
                document.getElementById('depositAmount').addEventListener('input', window.calculateDepositVAT);
                window.calculateDepositVAT();
            } else if(t === 'withdraw') {
                document.getElementById('withdrawAmount').addEventListener('input', window.calculateWithdrawVAT);
                window.calculateWithdrawVAT();
            }
        };
        
        window.switchTaskTab = (type) => {
            currentTaskType = type;
            document.getElementById('tabFreeTask').className = type==='free'?'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow':'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            document.getElementById('tabVipTask').className = type==='vip'?'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow':'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            renderTasks();
        };
        
        window.selectOperator = (el, operator) => { 
            document.querySelectorAll('#rechargeScreen .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedOperator = operator;
            document.getElementById('selectedOperator').value = operator;
        };
        
        window.selectWithdrawMethod = (el, method) => { 
            // Check if method is disabled
            if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                showNotification(`${method} ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶¨‡¶®‡ßç‡¶ß`, 'error');
                return;
            }
            
            document.querySelectorAll('#withdrawSection .grid .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedMethod = method;
            document.getElementById('selectedWithdrawMethod').value = method;
        };

        // ‚úÖ SUBSCRIPTION FUNCTIONS WITH TELEGRAM REDIRECT (‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß©)
        window.switchSubscriptionTab = (tab) => {
            document.getElementById('tabStars').className = tab === 'stars' ? 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow' : 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            document.getElementById('tabTelegram').className = tab === 'telegram' ? 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow' : 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            
            document.getElementById('starsSection').classList.toggle('hidden', tab !== 'stars');
            document.getElementById('telegramSection').classList.toggle('hidden', tab !== 'telegram');
        };
        
        window.selectStarPackage = (stars) => {
            selectedStarPackage = stars;
            document.getElementById('selectedStars').textContent = stars;
            
            let price = 0;
            if(stars === 100) price = 290;
            else if(stars === 250) price = 652.5;
            else if(stars === 500) price = 1305;
            
            document.getElementById('totalStarPrice').textContent = price;
        };
        
        window.selectTelegramPlan = (plan) => {
            selectedTelegramPlan = plan;
            let planText = '';
            let price = 0;
            
            if(plan === '1month') {
                planText = '‡ßß ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú';
                price = 600;
            } else if(plan === '3month') {
                planText = '‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú';
                price = 1550;
            } else if(plan === '1year') {
                planText = '‡ßß ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú';
                price = 3900;
            }
            
            document.getElementById('selectedPlanText').textContent = planText;
            document.getElementById('selectedPlanPrice').textContent = price;
        };
        
        // ‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡ß©: ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶® ‡¶ì ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü
        window.buyStars = () => {
            if(selectedStarPackage === 0) {
                showNotification('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const message = encodeURIComponent(`‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶Ü‡¶Æ‡¶ø ${currentUserData.name} (${currentUserData.phone})‡•§ ‡¶Ü‡¶Æ‡¶ø ${selectedStarPackage} ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ - ‡ß≥${document.getElementById('totalStarPrice').textContent} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§`);
            
            // Redirect to Telegram
            window.open(`https://t.me/TAKAR_WALA_ADMIN?text=${message}`, '_blank');
            
            showNotification('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
        };
        
        window.buyTelegramPremium = () => {
            if(!selectedTelegramPlan) {
                showNotification('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const planText = document.getElementById('selectedPlanText').textContent;
            const price = document.getElementById('selectedPlanPrice').textContent;
            
            const message = encodeURIComponent(`‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶Ü‡¶Æ‡¶ø ${currentUserData.name} (${currentUserData.phone})‡•§ ‡¶Ü‡¶Æ‡¶ø ${planText} - ‡ß≥${price} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§`);
            
            // Redirect to Telegram
            window.open(`https://t.me/TAKAR_WALA_ADMIN?text=${message}`, '_blank');
            
            showNotification('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
        };

        // ‚úÖ INITIALIZE EVENT LISTENERS
        document.addEventListener('DOMContentLoaded', function() {
            // Load system settings on page load
            loadSystemSettings();
            
            const depositAmount = document.getElementById('depositAmount');
            if(depositAmount) {
                depositAmount.addEventListener('input', window.calculateDepositVAT);
            }
            
            const withdrawAmount = document.getElementById('withdrawAmount');
            if(withdrawAmount) {
                withdrawAmount.addEventListener('input', window.calculateWithdrawVAT);
            }
            
            const rechAmount = document.getElementById('rechAmount');
            if(rechAmount) {
                rechAmount.addEventListener('input', window.calculateRechargeFee);
            }
            
            window.calculateDepositVAT();
            window.calculateWithdrawVAT();
            window.calculateRechargeFee();
            
            // Initialize star prices
            if(document.getElementById('price100')) {
                document.getElementById('price100').textContent = (100 * 2.90).toFixed(2);
                document.getElementById('price250').textContent = (250 * 2.90 * 0.90).toFixed(2);
                document.getElementById('price500').textContent = (500 * 2.90 * 0.90).toFixed(2);
            }
            
            // TWAI Chatbot input enter key support
            const chatbotInput = document.getElementById('chatbotInput');
            if(chatbotInput) {
                chatbotInput.addEventListener('keypress', function(e) {
                    if(e.key === 'Enter') {
                        window.sendTWAI();
                    }
                });
            }
        });

        // ‚úÖ DRAGGABLE CHAT FUNCTIONALITY
        function initDraggableChat() {
            setTimeout(() => {
                const notifIcon = document.getElementById('notificationIcon');
                if(notifIcon) {
                    makeDraggable(notifIcon);
                }
            }, 3000);
        }

        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            element.onmousedown = dragMouseDown;
            element.ontouchstart = touchStart;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function touchStart(e) {
                if(e.touches.length == 1) {
                    e.preventDefault();
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                    document.ontouchend = closeDragElementTouch;
                    document.ontouchmove = elementDragTouch;
                }
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }
            
            function elementDragTouch(e) {
                if(e.touches.length == 1) {
                    e.preventDefault();
                    pos1 = pos3 - e.touches[0].clientX;
                    pos2 = pos4 - e.touches[0].clientY;
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                    element.style.top = (element.offsetTop - pos2) + "px";
                    element.style.left = (element.offsetLeft - pos1) + "px";
                }
            }
            
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
            
            function closeDragElementTouch() {
                document.ontouchend = null;
                document.ontouchmove = null;
            }
        }
    </script>

</body>
</html>
