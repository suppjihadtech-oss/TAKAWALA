<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Takawala - Ultimate Final</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        
                /* ‚úÖ EMERGENCY FIX: FORCE HIDE */
        .hidden { 
            display: none !important; 
            visibility: hidden !important;
            pointer-events: none !important;
        }

        
                /* ‚úÖ iOS STYLE POPUP DESIGN */
        .ios-modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ï‡¶æ‡¶≤‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° */
            backdrop-filter: blur(5px); /* ‡¶¨‡ßç‡¶≤‡¶æ‡¶∞ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
            z-index: 9999999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ios-modal {
            background: rgba(255, 255, 255, 0.95);
            width: 85%;
            max-width: 320px;
            border-radius: 15px;
            text-align: center;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .ios-modal-content {
            padding: 20px 20px 15px;
        }

        .ios-icon-box {
            width: 50px; height: 50px;
            background: #eef2ff;
            color: #6366f1;
            font-size: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
        }
        
        .ios-title {
            font-size: 18px;
            font-weight: 700;
            color: #1c1c1e;
            margin-bottom: 5px;
        }
        
        .ios-message {
            font-size: 14px;
            color: #3a3a3c;
            line-height: 1.5;
        }
        
        /* ‡¶∞‡¶ô‡¶ø‡¶® ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ */
        .ios-message span { font-weight: bold; }
        .red-text { color: #ef4444; }
        .green-text { color: #10b981; }
        .blue-text { color: #3b82f6; }
        .gold-text { color: #d97706; }

        .ios-modal-actions {
            border-top: 1px solid #e5e5ea;
            display: flex;
        }
        
        .ios-btn {
            background: transparent;
            color: #007aff; /* ‡¶Ü‡¶á‡¶´‡ßã‡¶® ‡¶¨‡ßç‡¶≤‡ßÅ */
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            padding: 12px;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .ios-btn:active {
            background: #f2f2f7;
        }
        
        .hidden { display: none !important; }

        
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap');
        
        body { 
            font-family: 'Hind Siliguri', sans-serif; 
            background: #f8fafc;
            color: #1e293b;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* PREMIUM GRADIENT */
        .bg-premium { background: linear-gradient(135deg, #059669 0%, #047857 50%, #d97706 100%); }
        
        /* GLASS EFFECTS */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* SCROLL HIDE */
        ::-webkit-scrollbar { width: 0px; }
        
        /* ‚úÖ FIXED NOTIFICATION */
        #notificationMessage {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100000;
            min-width: 300px;
            max-width: 90%;
            width: auto;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            animation: slideDown 0.3s ease, fadeOut 0.3s ease 2.5s;
            animation-fill-mode: forwards;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
        }
        
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; visibility: visible; }
            to { opacity: 0; visibility: hidden; }
        }
        
        /* ‚úÖ iPHONE STYLE NOTIFICATION */
        .smart-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999999;
            min-width: 310px;
            max-width: 90%;
            padding: 10px 14px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDownFade 0.4s ease, fadeOutUp 0.4s ease 4.5s forwards;
        }
        
        .toast-icon {
            font-size: 22px;
            display: flex;
            align-items: center;
        }
        
        .toast-content p {
            color: #1e293b;
            font-family: 'Hind Siliguri', sans-serif;
            font-weight: 600;
            font-size: 13px;
            line-height: 1.3;
            margin: 0;
        }

        .toast-close {
            background: #f1f5f9;
            border: none;
            color: #94a3b8;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: auto;
        }
        
        .toast-close:active {
            background: #e2e8f0;
            color: #ef4444;
            transform: scale(0.9);
        }

        @keyframes slideDownFade {
            from { top: -100px; opacity: 0; transform: translateX(-50%) scale(0.9); }
            to { top: 20px; opacity: 1; transform: translateX(-50%) scale(1); }
        }
        
        @keyframes fadeOutUp {
            from { top: 20px; opacity: 1; transform: translateX(-50%) scale(1); }
            to { top: -100px; opacity: 0; transform: translateX(-50%) scale(0.9); visibility: hidden; }
        }

        /* LOADING ANIMATION */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loading-logo {
            width: 100px;
            animation: zoomInOut 2s ease-in-out infinite;
        }
        
        @keyframes zoomInOut {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* DISABLED STATE */
        .disabled-option {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }
        
        .disabled-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        /* ‚úÖ FIXED TEXT CONTAINERS */
        .text-container {
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            overflow-wrap: break-word;
            max-width: 100%;
        }
        
        .address-box {
            background: #f8fafc;
            border: 1px dashed #cbd5e1;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            word-break: break-all;
            overflow-wrap: break-word;
            white-space: normal;
            font-size: 13px;
            line-height: 1.4;
        }

        /* ‚úÖ HISTORY ITEM STYLES - FIXED LAYOUT */
        .history-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

                       /* ‚úÖ FIXED: WIDE & COMPACT RECEIPT STYLE */
        .receipt-box {
            background: #ffffff;
            width: 100% !important;   /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡ßØ‡ß´% ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶®‡¶ø‡¶¨‡ßá */
            max-width: 500px;        /* ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶ö‡¶ì‡ßú‡¶æ */
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            position: relative;
            margin: auto;            /* ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
        }

        .receipt-header {
            background: linear-gradient(135deg, #059669, #047857);
            padding: 15px;           /* ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶ø‡¶Ç ‡¶ï‡¶Æ‡¶ø‡ßü‡ßá‡¶õ‡¶ø ‡¶Ø‡¶æ‡¶§‡ßá ‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ ‡¶ï‡¶Æ ‡¶π‡ßü */
            text-align: center;
            color: white;
            position: relative;
        }
        
        /* ‡¶≤‡ßã‡¶ó‡ßã ‡¶∏‡¶æ‡¶á‡¶ú ‡¶†‡¶ø‡¶ï‡¶†‡¶æ‡¶ï ‡¶∞‡¶æ‡¶ñ‡¶æ */
        .receipt-header img {
            width: 28px;
            height: 28px;
        }
        
        .receipt-header h2 { font-size: 18px; margin-bottom: 2px; }
        .receipt-header p { font-size: 11px; opacity: 0.9; }

        /* ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶õ‡ßã‡¶ü ‡¶ï‡¶∞‡¶æ */
        .amount-box {
            margin-top: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 8px;
            backdrop-filter: blur(5px);
        }
        
        .amount-box h1 { font-size: 24px; margin: 0; }

        .receipt-body {
            padding: 15px;          /* ‡¶¨‡¶°‡¶ø‡¶∞ ‡¶∏‡ßç‡¶™‡ßá‡¶∏ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã */
            background-color: #fff;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;         /* ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá‡¶∞ ‡¶´‡¶æ‡¶Å‡¶ï‡¶æ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã */
            border-bottom: 1px dashed #e2e8f0;
            font-size: 13px;
        }

        .receipt-value {
            font-weight: 700;
            color: #1e293b;
            text-align: right;
            max-width: 65%;        /* ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã */
            word-break: break-all;
        }

        .receipt-footer {
            background: #f8fafc;
            padding: 10px;
            text-align: center;
            border-top: 2px dashed #cbd5e1;
        }
        
        .receipt-footer h3 { font-size: 10px; letter-spacing: 2px; }

        
        /* ‚úÖ FIXED REFERRAL LINK */
        .referral-box {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            word-break: break-all;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid #cbd5e1;
            text-align: center;
        }

        /* ‚úÖ PROOF SUBMISSION MODAL */
        .proof-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .proof-content {
            background: white;
            border-radius: 20px;
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }
        
        .task-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3b82f6;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        /* ‚úÖ GLOBAL CHAT ICON */
        #globalChatIcon {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 9999;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            cursor: pointer;
            border: 3px solid white;
            transition: all 0.3s ease;
        }
        
        #globalChatIcon:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.6);
        }
        
        #globalChatIcon i {
            font-size: 28px;
            color: white;
        }
        
        /* MAINTENANCE MODE */
        .maintenance-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            z-index: 999999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }
        
        /* ‚úÖ UPDATED TWAI CHATBOT STYLES */
        #twaiChatbotIcon {
            position: fixed;
            bottom: 170px;
            right: 20px;
            z-index: 9998;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            cursor: pointer;
            border: 3px solid white;
            transition: all 0.3s ease;
        }
        
        #twaiChatbotIcon:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(139, 92, 246, 0.6);
        }
        
        #twaiChatbotIcon i {
            font-size: 28px;
            color: white;
        }
        
        .chatbot-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10010;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .chatbot-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 420px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            padding: 15px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chatbot-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            max-height: 400px;
        }
        
        /* ‚úÖ UPDATED QUICK QUESTIONS GRID - 20 QUESTIONS */
        .quick-questions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            padding: 15px;
            max-height: 250px;
            overflow-y: auto;
            border-top: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        
        .quick-question {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            color: #1e293b;
            font-weight: 500;
        }
        
        .quick-question:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }
        
        .chatbot-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            background: white;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #cbd5e1;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
            background: #f8fafc;
        }
        
        .chatbot-input button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        /* ‚úÖ HISTORY FILTER STYLES */
        .history-filter {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }
        
        .filter-btn {
            white-space: nowrap;
            padding: 8px 15px;
            border-radius: 20px;
            background: #f1f5f9;
            border: none;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #059669;
            color: white;
        }
        
        /* ‚úÖ SETTINGS TOGGLE STYLES */
        .toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #059669;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* ‚úÖ NEW LOGIN NOTICE MODAL STYLES */
        .login-notice-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 100000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .login-notice-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            backdrop-filter: blur(20px);
            border-radius: 25px;
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            transform: translateY(20px);
            animation: slideUpNotice 0.6s ease forwards;
        }
        
        @keyframes slideUpNotice {
            to { transform: translateY(0); opacity: 1; }
        }

        /* ‚úÖ INTERSTITIAL AD STYLES */
        .interstitial-ad {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        /* ‚úÖ EMERGENCY FIX: FORCE HIDE */
        .hidden { display: none !important; }

        /* üçé ULTRA PREMIUM iPHONE STYLE POPUP */
        div:where(.swal2-container) div:where(.swal2-popup) {
            border-radius: 30px !important;
            background: rgba(255, 255, 255, 0.85) !important;
            backdrop-filter: blur(25px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(25px) saturate(180%) !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2) !important;
            padding: 15px !important;
            width: 320px!important;
            border: 1px solid rgba(255, 255, 255, 0.5) !important;
        }

        div:where(.swal2-title) {
            font-family: 'Hind Siliguri', sans-serif !important;
            font-weight: 700 !important;
            color: #1e293b !important;
            font-size: 1.3rem !important;
            padding: 0 !important;
            margin-bottom: 2px !important;
        }

        div:where(.swal2-html-container) {
            font-family: 'Hind Siliguri', sans-serif !important;
            font-size: 0.95rem !important;
            color: #64748b !important;
            margin: 0 !important;
            line-height: 1.5 !important;
            font-weight: 500 !important;
        }

        div:where(.swal2-icon) {
            width: 60px !important;
            height: 60px !important;
            margin: 0 auto 5px auto !important;
            border-width: 3px !important;
        }
        
        .swal2-icon-content {
            font-size: 30px !important;
        }

        div:where(.swal2-actions) {
            margin-top: 10px !important;
            gap: 12px !important;
            width: 100% !important;
            display: flex !important;
            flex-direction: column !important;
        }

        div:where(.swal2-confirm), div:where(.swal2-cancel) {
            border-radius: 18px !important;
            font-weight: 700 !important;
            padding: 14px 0 !important;
            box-shadow: none !important;
            width: 100% !important;
            font-size: 15px !important;
            margin: 0 !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            transition: transform 0.2s ease !important;
        }

        div:where(.swal2-confirm) {
            background: #007AFF !important;
            color: white !important;
            background-image: linear-gradient(135deg, #007AFF, #005ecb) !important;
        }
        
        div:where(.swal2-cancel) {
            background: #F2F2F7 !important;
            color: #8E8E93 !important;
        }

        div:where(.swal2-confirm):active, div:where(.swal2-cancel):active {
            transform: scale(0.96) !important;
        }

        /* ‚úÖ MODERN iPHONE DOCK BOTTOM NAV */
        #bottomNav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-slate-50">

    <!-- MAINTENANCE SCREEN (HIDDEN BY DEFAULT) -->
    <div id="maintenanceScreen" class="maintenance-screen hidden">
        <div class="maintenance-content">
            <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" alt="Logo">
            <h1 class="text-4xl font-bold mb-4">üîß ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá</h1>
            <p class="text-xl mb-6">‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶æ‡¶á‡¶ü‡¶ü‡¶ø‡¶ï‡ßá ‡¶Ü‡¶∞‡ßã ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡¶ø</p>
            <p class="text-lg text-slate-300 mb-8">‡¶Ö‡¶≤‡ßç‡¶™ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßã‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ß‡ßà‡¶∞‡ßç‡¶Ø‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§</p>
            <div class="bg-white/10 p-6 rounded-2xl">
                <p class="text-sm">üìû ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó: support@takawala.com</p>
                <p class="text-sm mt-2">üì± ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ: @TAKAR_WALA_ADMIN</p>
            </div>
        </div>
    </div>

    <!-- ‚úÖ GLOBAL CHAT ICON -->
    <div id="globalChatIcon" onclick="window.openSupport()">
        <i class="ri-customer-service-2-fill"></i>
    </div>
    
    <!-- ‚úÖ UPDATED TWAI CHATBOT ICON -->
    <div id="twaiChatbotIcon" onclick="window.openTWAI()">
        <i class="ri-robot-2-fill"></i>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="loading-logo">
    </div>

    <!-- ‚úÖ NEW SMART NOTIFICATION (TOAST) -->
    <div id="smartToast" class="smart-toast hidden">
        <div class="toast-icon"></div>
        <div class="toast-content">
            <p id="toastMessage"></p>
        </div>
        <button onclick="document.getElementById('smartToast').classList.add('hidden')" class="toast-close">
            <i class="ri-close-line"></i>
        </button>
    </div>

    <!-- ‚úÖ NEW LOGIN NOTICE MODAL -->
    <div id="loginNoticeModal" class="ios-modal-overlay hidden">
        <div class="ios-modal animate__animated animate__zoomIn">
            <div class="ios-modal-content">
                <div class="ios-icon-box" style="background: transparent; box-shadow: none; margin-bottom: 0;">
                    <img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-14 h-14 animate__animated animate__tada animate__infinite" style="filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2));">
                </div>
                
                <h3 id="noticeTitle" class="ios-title mt-2">‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h3>
                
                <div id="noticeMessage" class="ios-message mt-2">
                    ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                </div>
            </div>
            
            <div class="ios-modal-actions">
                <button onclick="closeLoginNoticeWithConfetti()" class="ios-btn text-blue-600 font-bold" style="font-size: 17px;">
                    ‡¶ì‡¶ï‡ßá, ‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø
                </button>
            </div>
        </div>
    </div>

    <!-- INTERSTITIAL AD (HIDDEN INITIALLY) -->
    <div id="monitagInterstitial" class="interstitial-ad hidden">
        <div id="interstitialContent" class="text-center bg-white p-5 md:p-8 rounded-2xl w-[95%] max-w-md relative overflow-hidden max-h-[85vh] overflow-y-auto mx-auto my-auto shadow-2xl border-4 border-white/50">
            <h3 class="font-bold text-xl mb-2 text-red-600">‚ö†Ô∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</h3>
            
            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 mb-6">
                <p class="text-sm font-bold text-slate-700 mb-2">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶π‡¶≤‡ßá:</p>
                <ul class="text-xs text-left text-slate-600 list-disc pl-4 space-y-1">
                    <li>‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ü‡¶ø ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡ßá ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</li>
                    <li>‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶∏‡ßá "‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®</li>
                </ul>
            </div>

            <button onclick="window.openAdLink()" class="w-full bg-blue-600 text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg hover:scale-105 transition animate-pulse">
                üëâ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
            </button>
            
            <div id="adTimer" class="mt-4 text-slate-400 font-bold text-sm">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®: ‡ßß‡ß¶</div>
            
            <button onclick="closeInterstitialAd()" class="mt-4 w-full bg-slate-200 text-slate-800 px-6 py-3 rounded-xl font-bold hidden">
                ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>

    <!-- ‚úÖ UPDATED TWAI CHATBOT MODAL -->
    <div id="twaiModal" class="chatbot-modal hidden">
        <div class="chatbot-content">
            <div class="chatbot-header">
                <h3><i class="ri-robot-2-fill"></i> TWAI ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶ø‡¶ï‡¶æ ü§ñ</h3>
                <button onclick="window.closeTWAI()" class="bg-white/20 text-white p-2 rounded-full">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            
            <div class="chatbot-body" id="chatbotMessages">
                <div class="chat-message bot-message">
                    <div class="message-bubble bot-bubble">
                        ‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ! ‡¶Ü‡¶Æ‡¶ø TWAI (Takawala AI)‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®:
                    </div>
                    <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
                </div>
            </div>
            
            <!-- ‚úÖ UPDATED: 20 QUESTIONS GRID -->
            <div class="quick-questions" id="quickQuestionsGrid">
                <button onclick="window.askTWAI('‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨?')" class="quick-question">‡ßß. ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨?</button>
                <button onclick="window.askTWAI('‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?')" class="quick-question">‡ß®. ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?</button>
                <button onclick="window.askTWAI('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡¶§?')" class="quick-question">‡ß©. ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡¶§?</button>
                <button onclick="window.askTWAI('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶§‡ßá ‡¶ï‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶≤‡¶æ‡¶ó‡ßá?')" class="quick-question">‡ß™. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶§‡ßá ‡¶ï‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶≤‡¶æ‡¶ó‡ßá?</button>
                <button onclick="window.askTWAI('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡¶ø, ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?')" class="quick-question">‡ß´. ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡¶ø, ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?</button>
                <button onclick="window.askTWAI('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡¶≤‡ßá ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?')" class="quick-question">‡ß¨. ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡¶≤‡ßá ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?</button>
                <button onclick="window.askTWAI('‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶§?')" class="quick-question">‡ß≠. ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶§?</button>
                <button onclick="window.askTWAI('‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶§ ‡¶ï‡¶æ‡¶ü‡ßá?')" class="quick-question">‡ßÆ. ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶§ ‡¶ï‡¶æ‡¶ü‡ßá?</button>
                <button onclick="window.askTWAI('‡¶è‡¶ï ‡¶´‡ßã‡¶®‡ßá ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá?')" class="quick-question">‡ßØ. ‡¶è‡¶ï ‡¶´‡ßã‡¶®‡ßá ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá?</button>
                <button onclick="window.askTWAI('‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶ï‡¶ø?')" class="quick-question">‡ßß‡ß¶. ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶ï‡¶ø?</button>
                <button onclick="window.askTWAI('‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® (VPN) ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨ ‡¶ï‡¶ø‡¶®‡¶æ?')" class="quick-question">‡ßß‡ßß. ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨ ‡¶ï‡¶ø‡¶®‡¶æ?</button>
                <button onclick="window.askTWAI('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶ñ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü?')" class="quick-question">‡ßß‡ß®. ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶ñ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü?</button>
                <button onclick="window.askTWAI('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶è‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ ‡¶ï‡ßá‡¶®?')" class="quick-question">‡ßß‡ß©. ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶è‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ ‡¶ï‡ßá‡¶®?</button>
                <button onclick="window.askTWAI('‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßá ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?')" class="quick-question">‡ßß‡ß™. ‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßá ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?</button>
                <button onclick="window.askTWAI('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤?')" class="quick-question">‡ßß‡ß´. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤?</button>
                <button onclick="window.askTWAI('‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶ø?')" class="quick-question">‡ßß‡ß¨. ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶ø?</button>
                <button onclick="window.askTWAI('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?')" class="quick-question">‡ßß‡ß≠. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?</button>
                <button onclick="window.askTWAI('‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡ßü?')" class="quick-question">‡ßß‡ßÆ. ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡ßü?</button>
                <button onclick="window.askTWAI('‡¶®‡¶ó‡¶¶‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡ßü?')" class="quick-question">‡ßß‡ßØ. ‡¶®‡¶ó‡¶¶‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡ßü?</button>
                <button onclick="window.askTWAI('‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶ñ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡ßá?')" class="quick-question">‡ß®‡ß¶. ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶ñ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡ßá?</button>
            </div>
            
            <div class="chatbot-input">
                <input type="text" id="chatbotInput" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                <button onclick="window.sendTWAI()"><i class="ri-send-plane-fill"></i></button>
            </div>
        </div>
    </div>

    <!-- AUTH SCREEN -->
    <div id="authScreen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        <div class="glass-card w-full max-w-md p-8 rounded-[35px] text-center animate__animated animate__fadeInUp">
            <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="w-32 mx-auto mb-2 drop-shadow-xl animate__animated animate__pulse animate__infinite">
            <h1 class="text-3xl font-extrabold text-slate-800 mb-1">‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ</h1>
            <p class="text-slate-500 text-sm font-medium mb-8">‡¶™‡ßç‡¶∞‡¶´‡ßá‡¶∂‡¶®‡¶æ‡¶≤ ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ</p>

            <div class="flex bg-slate-100 p-1.5 rounded-full mb-6 border border-slate-200">
                <button onclick="window.toggleAuthTab('login')" id="btnTabLogin" class="flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg transition-all">‡¶≤‡¶ó‡¶á‡¶®</button>
                <button onclick="window.toggleAuthTab('register')" id="btnTabRegister" class="flex-1 py-3 rounded-full text-sm font-bold text-slate-500 transition-all">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
            </div>

            <div id="loginForm" class="space-y-4 text-left">
                <input type="email" id="loginEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="password" id="loginPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <button id="btnLoginAction" class="w-full bg-premium text-white font-bold py-4 rounded-2xl shadow-xl active:scale-95 transition mt-2">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <div id="registerForm" class="hidden space-y-3 text-left">
                <input type="text" id="regName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="text" id="regPhone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="email" id="regEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="password" id="regPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (‡ß¨+ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="text" id="regReferralCode" placeholder="‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <button id="btnRegAction" class="w-full bg-premium text-white font-bold py-4 rounded-2xl shadow-xl active:scale-95 transition">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="hidden pb-24 max-w-md mx-auto min-h-screen relative bg-white">
        
        <!-- HOME SCREEN -->
        <div id="homeScreen" class="animate__animated animate__fadeIn relative">
            
            <div class="bg-premium pb-8 pt-8 px-5 rounded-b-[40px] text-white shadow-xl relative z-10">
                
                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                
                <div class="relative flex justify-between items-center mb-6">
                    <div class="flex items-center gap-3" onclick="window.showPage('profileScreen')">
                        <div class="relative">
                            <img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-12 h-12 rounded-full border-2 border-white/30 bg-white/10 backdrop-blur-sm">
                            <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 border-2 border-white rounded-full"></span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg leading-tight text-white drop-shadow-sm" id="userNameDisplay">Guest</h3>
                            <div class="flex items-center gap-1 opacity-90">
                                <img src="https://i.postimg.cc/TwfTZM7Z/award.png" class="w-3">
                                <span class="text-[11px] font-bold text-yellow-300 tracking-wide" id="userPlanDisplay">Free Member</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="notificationIcon" class="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 relative cursor-pointer hover:bg-white/30 transition shadow-sm">
                        <img src="https://i.postimg.cc/c1nSnFz4/notofication.png" class="w-5 h-5 invert opacity-90">
                        <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
                        <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border border-white"></span>
                    </div>
                </div>

                <div class="bg-white/10 backdrop-blur-md rounded-full p-1.5 border border-white/20 shadow-lg relative mx-1 mb-2">
                    <div class="flex items-center justify-between">
                        
                        <div class="relative z-10 pl-1 cursor-pointer" onclick="toggleBalance()">
                            <div id="balancePill" class="balance-pill bg-white/95 rounded-full pl-1 pr-5 py-1 flex items-center gap-2 shadow-sm transition-all active:scale-95 h-10">
                                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center text-white shadow-md">
                                    <i class="ri-wallet-3-fill text-sm"></i>
                                </div>
                                <div class="flex flex-col justify-center min-w-[80px]">
                                    <span id="balanceText" class="text-[11px] font-bold text-slate-600 leading-none">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</span>
                                    <span id="balanceAmount" class="text-[13px] font-black text-rose-600 leading-none hidden">‡ß≥0.00</span>
                                </div>
                            </div>
                        </div>

                        <button onclick="window.showPage('walletScreen')" class="bg-white text-emerald-700 px-5 py-2 rounded-full text-[11px] font-bold shadow-md flex items-center gap-2 active:scale-95 transition-transform z-10 mr-1 hover:bg-emerald-50 h-9">
                            <img src="https://i.postimg.cc/7ZGpHH5q/save-money.png" class="w-4 h-4">
                            ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø
                        </button>
                    </div>
                </div>
            </div>

            <div class="mx-5 -mt-6 bg-white p-3 rounded-2xl shadow-lg border border-slate-100 flex items-center gap-3 relative z-20">
                <div class="w-8 h-8 bg-orange-50 rounded-full flex items-center justify-center shrink-0">
                    <img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-5 h-5 animate-pulse">
                </div>
                <div class="overflow-hidden w-full">
                     <marquee class="text-sm font-bold text-slate-600 leading-none pt-1" id="noticeText">‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</marquee>
                </div>
            </div>

            <div class="p-5 grid grid-cols-4 gap-4 text-center mt-2">
                <div onclick="window.showPage('taskScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/d1sXyCb6/clipboard.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span></div>
                <div onclick="window.showPage('rechargeScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/jjdpNH5b/payment-method.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</span></div>
                <div onclick="window.showPage('vipScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition relative"><img src="https://i.postimg.cc/TwfTZM7Z/award.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</span></div>
                <div onclick="window.loadHistory()" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/VNTvSLRX/transaction-history.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</span></div>
                <div onclick="window.showDailyBonus()" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/qqLQKVHV/bonus.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span></div>
                <div onclick="window.showPage('walletScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/wMdF5zV5/withdraw.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</span></div>
                <div onclick="window.showDriveOffer()" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/qByrJYrn/sim-card.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠</span></div>
                <div onclick="window.showPage('moreScreen')" class="glass-card p-3 rounded-2xl flex flex-col items-center justify-center cursor-pointer h-24 active:scale-95 transition"><img src="https://i.postimg.cc/76SnZckK/more.png" class="w-10 mb-2 drop-shadow-md"><span class="text-[11px] font-bold text-slate-700">‡¶Ü‡¶∞‡ßã</span></div>
            </div>
        </div>

        <!-- TASK SCREEN -->
        <div id="taskScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')" class="w-8 cursor-pointer">
            </div>
            
            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.switchTaskTab('free')" id="tabFreeTask" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶´‡ßç‡¶∞‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
                <button onclick="window.switchTaskTab('vip')" id="tabVipTask" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
            </div>

            <div id="taskListContainer" class="space-y-3">
                <div class="glass-card p-3 rounded-2xl flex justify-between items-center animate__animated animate__fadeInUp">
                    <div class="flex items-center gap-3"><img src="https://i.postimg.cc/TYLvN32V/telegram.png" class="w-10"><div><h4 class="font-bold text-slate-700">Telegram Channel</h4><p class="text-[10px] text-slate-400">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®</p></div></div>
                    <button onclick="window.completeTask('telegram_task', 5)" class="bg-blue-100 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold">+‡ß≥5</button>
                </div>
            </div>
        </div>

        <!-- WALLET SCREEN -->
        <div id="walletScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®')" class="w-8 cursor-pointer">
            </div>

            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-premium p-4 rounded-2xl text-white text-center shadow-lg"><p class="text-[10px] font-bold opacity-80">‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-xl font-extrabold mt-1">‡ß≥ <span id="walletMainDisplay">0.00</span></h2></div>
                <div class="bg-blue-600 p-4 rounded-2xl text-white text-center shadow-lg"><p class="text-[10px] font-bold opacity-80">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-xl font-extrabold mt-1">‡ß≥ <span id="walletRechargeDisplay">0.00</span></h2></div>
            </div>

            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.toggleWalletTab('deposit')" id="tabDeposit" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                <button onclick="window.toggleWalletTab('withdraw')" id="tabWithdraw" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                <button onclick="window.toggleWalletTab('transfer')" id="tabTransfer" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞</button>
            </div>

            <div id="depositSection">
                <div class="grid grid-cols-4 gap-3 mb-6">
                    <div onclick="window.selectPayment(this, 'bKash')" id="payment_bKash" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/C5vDR4nz/1656235223bkash-logo.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'Nagad')" id="payment_Nagad" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/k4phWWbK/1679248787Nagad-Logo.png" class="h-8 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'Rocket')" id="payment_Rocket" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'USDT')" id="payment_USDT" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain"></div>
                </div>
                <div class="glass-card p-5 rounded-[25px] space-y-4 text-center">
                    <div id="depositAddressContainer" class="address-box">
                        <p class="text-slate-500">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                    
                    <input type="text" id="depositTrxId" placeholder="TrxID" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <input type="number" id="depositAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <div class="text-xs text-red-500 font-bold" id="vatCalculation">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ßß‡ß¶%): ‡ß≥0.00 | ‡¶Æ‡ßã‡¶ü: ‡ß≥0.00</div>
                    <input type="hidden" id="selectedDepositMethod" value="">
                    <button onclick="window.submitDeposit()" class="w-full bg-green-600 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="withdrawSection" class="hidden">
                 <div class="grid grid-cols-4 gap-3 mb-6">
                    <div onclick="window.selectWithdrawMethod(this, 'bKash')" id="withdraw_bKash" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/C5vDR4nz/1656235223bkash-logo.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'Nagad')" id="withdraw_Nagad" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/k4phWWbK/1679248787Nagad-Logo.png" class="h-8 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'Rocket')" id="withdraw_Rocket" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'USDT')" id="withdraw_USDT" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain"></div>
                </div>
                 <div class="glass-card p-5 rounded-[25px] space-y-4">
                    <input type="number" id="withdrawNumber" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <input type="number" id="withdrawAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <div class="text-xs text-red-500 font-bold" id="withdrawVat">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ßß‡ß¶%): ‡ß≥0.00 | ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§: ‡ß≥0.00</div>
                    <input type="hidden" id="selectedWithdrawMethod" value="">
                    <button onclick="window.submitWithdraw()" class="w-full bg-red-500 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="transferSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-4">
                    <div class="flex items-center justify-center gap-3 text-sm font-bold text-slate-600">
                        <span>‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span> <i class="ri-arrow-right-line"></i> <span>‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span>
                    </div>
                    <input type="number" id="transferAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none text-center text-xl">
                    <button onclick="window.transferBalance()" class="w-full bg-slate-800 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <p class="text-xs text-red-500">* ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
                </div>
            </div>
        </div>

        <!-- RECHARGE SCREEN -->
        <div id="rechargeScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')" class="w-8 cursor-pointer">
            </div>
            
            <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 flex justify-between items-center mb-6">
                <div><p class="text-xs font-bold text-slate-500">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-2xl font-extrabold text-blue-600">‡ß≥ <span id="rechargePageBalance">0.00</span></h2></div>
                <img src="https://i.postimg.cc/jjdpNH5b/payment-method.png" class="w-10">
            </div>

            <div class="grid grid-cols-5 gap-3 mb-6">
                <div onclick="window.selectOperator(this, 'GP')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/65w1n62J/FB-IMG-1769495932877.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'BL')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/gJ8NL1Gx/FB-IMG-1769495999103.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Robi')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/RFHbQNLZ/FB-IMG-1769495977203.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Airtel')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/Wz0CjhdX/FB-IMG-1769496019329.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Teletalk')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/TYCQbVvT/FB-IMG-1769496047333.jpg" class="h-full object-contain rounded-lg"></div>
            </div>

            <div class="glass-card p-6 rounded-[25px] space-y-4">
                 <input type="number" id="rechPhone" placeholder="‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full bg-slate-50 p-3 rounded-xl border font-bold outline-none">
                 <input type="number" id="rechAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full bg-slate-50 p-3 rounded-xl border font-bold outline-none">
                 <div class="text-xs text-red-500 font-bold" id="rechargeFee">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: ‡ß≥5 | ‡¶Æ‡ßã‡¶ü: ‡ß≥5</div>
                 <input type="hidden" id="selectedOperator" value="GP">
                 <button onclick="window.submitRecharge()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
        
        <!-- ‚úÖ DRIVE OFFER SCREEN -->
        <div id="driveOfferScreen" class="hidden min-h-screen text-white animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 p-5 pt-8">
                <button onclick="window.showPage('homeScreen')" class="bg-white/20 p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞</h2>
            </div>
            
            <div class="drive-header">
                <div class="drive-icon">‚öôÔ∏è</div>
                <h1 class="text-3xl font-bold mb-4">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞</h1>
                <p class="text-xl text-slate-300 mb-6">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶§‡ßá‡¶õ‡ßá</p>
            </div>
            
            <div class="p-8 text-center">
                <div class="bg-white/10 p-8 rounded-3xl backdrop-blur-sm border border-white/20">
                    <p class="text-lg mb-6">‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶ï‡¶∞‡¶õ‡¶ø‡•§ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶è‡¶ü‡¶ø ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
                    
                    <div class="mt-10 pt-6 border-t border-white/20">
                        <p class="text-sm text-slate-300">‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶Ü‡¶∏‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º:</p>
                        <p class="text-xl font-bold mt-2">‡ßß‡¶≤‡¶æ ‡¶Æ‡ßá ‡ß®‡ß¶‡ß®‡ß¨</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MORE SCREEN -->
        <div id="moreScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
             <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</h2></div>
             
            <div class="grid grid-cols-3 gap-4 text-center">
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('profileScreen')"><img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('referralScreen')"><img src="https://i.postimg.cc/c4xbp54V/add-friend.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('marketingScreen')"><img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('quizScreen')"><img src="https://i.postimg.cc/mkNFY0L0/solution.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶ï‡ßÅ‡¶á‡¶ú</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('summaryScreen')"><img src="https://img.icons8.com/fluency/96/statistics.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('settingsScreen')"><img src="https://img.icons8.com/fluency/96/settings.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('spinScreen')"><img src="https://i.postimg.cc/02p5C1GN/fortune-wheel.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡ßç‡¶™‡¶ø‡¶®</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('subscriptionScreen')"><img src="https://i.postimg.cc/Z5JxMx1z/subscription-active.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</p></div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.openSupport()"><img src="https://i.postimg.cc/GhmX78Xw/comment.png" class="w-12 mx-auto mb-2"><p class="text-xs font-bold">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</p></div>
            </div>
             
             <button onclick="window.logout()" class="w-full mt-10 bg-red-100 text-red-600 py-3 rounded-xl font-bold">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
        </div>

        <!-- PROFILE SCREEN -->
        <div id="profileScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <div class="text-center mb-6">
                    <div class="relative inline-block">
                        <img id="currentAvatar" src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-24 h-24 mx-auto rounded-full border-4 border-slate-100">
                        <div class="absolute bottom-0 right-0 bg-green-500 text-white p-1 rounded-full cursor-pointer" onclick="window.showAvatarSelector()">
                            <i class="ri-edit-line text-sm"></i>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold mt-2" id="profNameDisplay">Guest</h3>
                </div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶®‡¶æ‡¶Æ</label><input type="text" id="profNameInput" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="profAddressInput" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶´‡ßã‡¶® (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)</label><input type="text" id="profPhoneInput" disabled class="w-full p-3 bg-slate-100 border rounded-xl font-bold text-slate-500"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="profEmailInput" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <button onclick="window.updateProfile()" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button onclick="window.showChangePassword()" class="w-full bg-slate-100 text-slate-800 py-3 rounded-xl font-bold shadow-lg">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
            </div>
        </div>

        <!-- AVATAR SELECTOR MODAL -->
        <div id="avatarModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-10000 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                <h3 class="text-xl font-bold mb-4 text-center">‡¶è‡¶≠‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="grid grid-cols-4 gap-3">
                    <div onclick="window.selectAvatar('https://img.icons8.com/fluency/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/color/96/user-male-circle--v1.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/color/96/user-male-circle--v1.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/office/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/office/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/plasticine/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/plasticine/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/dusk/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/dusk/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/fluency/96/user-female-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/fluency/96/user-female-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/color/96/user-female-circle--v1.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/color/96/user-female-circle--v1.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/office/96/user-female-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/office/96/user-female-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                </div>
                <button onclick="window.closeAvatarModal()" class="w-full mt-4 bg-slate-100 text-slate-800 py-3 rounded-xl font-bold">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- REFERRAL SCREEN -->
        <div id="referralScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</h2></div>
            <div class="glass-card p-6 rounded-[25px] text-center">
                <img src="https://i.postimg.cc/c4xbp54V/add-friend.png" class="w-20 mx-auto mb-4">
                <h3 class="text-lg font-bold mb-2">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®!</h3>
                <p class="text-sm text-slate-600 mb-4 text-container">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡ß≥5 ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                
                <div class="referral-box text-container" id="referralLink">
                    ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                </div>
                
                <div class="mb-4">
                    <p class="text-sm font-bold text-slate-700 text-container">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ: <span id="referralCount">0</span></p>
                    <p class="text-sm font-bold text-green-600 text-container">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º: ‡ß≥<span id="referralEarnings">0</span></p>
                </div>
                <button onclick="window.copyReferralLink()" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg">‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- MARKETING SCREEN -->
        <div id="marketingScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç</h2></div>
            <div class="glass-card p-6 rounded-[25px] text-center">
                <img src="https://img.icons8.com/fluency/96/settings.png" class="w-20 mx-auto mb-4">
                <h3 class="text-xl font-bold text-slate-800 mb-2">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶§‡ßá‡¶õ‡ßá</h3>
                <p class="text-lg text-slate-600 mb-6">‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶è‡¶ü‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá</p>
                <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                    <p class="text-sm text-slate-700">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá‡•§ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞, ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡¶®‡¶æ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
                </div>
            </div>
        </div>

        <!-- QUIZ SCREEN -->
        <div id="quizScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶ï‡ßÅ‡¶á‡¶ú</h2></div>
            
            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.switchQuizTab('types')" id="tabQuizTypes" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ü‡¶æ‡¶á‡¶™</button>
                <button onclick="window.switchQuizTab('questions')" id="tabQuizQuestions" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</button>
            </div>

            <div id="quizTypesSection">
                <div class="glass-card p-6 rounded-[25px] space-y-4">
                    <h3 class="text-lg font-bold text-center mb-4">‡¶ï‡ßÅ‡¶á‡¶ú‡ßá‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div onclick="window.showQuizQuestions('general')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/mkNFY0L0/solution.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('math')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/Pqpp3Lfc/mathematics.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶• ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('science')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/V6XSw3CN/scince.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('islamic')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/QCbH91SW/rub-el-hizb.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="quizQuestionsSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <button onclick="window.switchQuizTab('types')" class="bg-slate-100 text-slate-800 px-3 py-1 rounded-lg font-bold text-sm">
                            <i class="ri-arrow-left-line"></i> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
                        </button>
                        <h3 id="quizTypeTitle" class="text-lg font-bold">‡¶ï‡ßÅ‡¶á‡¶ú</h3>
                        <div class="quiz-timer" id="quizTimer">‡ß©‡ß¶</div>
                    </div>
                    
                    <div id="quizQuestionsContainer">
                        <!-- Questions will be loaded here -->
                    </div>
                    
                    <button onclick="window.submitQuiz()" id="submitQuizBtn" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg hidden">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

        <!-- SUMMARY SCREEN -->
        <div id="summaryScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <h3 class="text-lg font-bold text-center mb-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-green-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-green-700">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</p>
                        <h3 class="text-xl font-bold text-green-800">‡ß≥ <span id="totalEarnings">0.00</span></h3>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-blue-700">‡¶Æ‡ßã‡¶ü ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</p>
                        <h3 class="text-xl font-bold text-blue-800">‡ß≥ <span id="totalDeposit">0.00</span></h3>
                    </div>
                    <div class="bg-red-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-red-700">‡¶Æ‡ßã‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</p>
                        <h3 class="text-xl font-bold text-red-800">‡ß≥ <span id="totalWithdraw">0.00</span></h3>
                    </div>
                    <div class="bg-purple-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-purple-700">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</p>
                        <h3 class="text-xl font-bold text-purple-800">‡ß≥ <span id="todayEarnings">0.00</span></h3>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-yellow-700">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p>
                        <h3 class="text-xl font-bold text-yellow-800"><span id="totalTasks">0</span></h3>
                    </div>
                    <div class="bg-pink-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-pink-700">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</p>
                        <h3 class="text-xl font-bold text-pink-800"><span id="totalReferrals">0</span></h3>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶§‡¶•‡ßç‡¶Ø:</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span>‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</span><span id="joinDate">-</span></div>
                        <div class="flex justify-between"><span>‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú:</span><span id="summaryPlan">Free</span></div>
                        <div class="flex justify-between"><span>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï:</span><span id="activeTasks">0</span></div>
                        <div class="flex justify-between"><span>‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏:</span><span id="dailyBonusStatus">‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚úÖ UPDATED SETTINGS SCREEN -->
        <div id="settingsScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <h3 class="text-lg font-bold mb-4">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span>‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</span>
                        <label class="toggle">
                            <input type="checkbox" id="notificationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°</span>
                        <label class="toggle">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°</span>
                        <label class="toggle">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®</span>
                        <label class="toggle">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
                    <button onclick="window.showPage('profileScreen')" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button onclick="window.showChangePassword()" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h4>
                    <button onclick="window.openSupport()" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                    <button onclick="window.open('mailto:support@takawala.com')" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm">‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                </div>
            </div>
        </div>

        <!-- ‚úÖ ENHANCED HISTORY SCREEN WITH FILTER -->
        <div id="historyScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-slate-800">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h2>
            </div>
            
            <!-- ‚úÖ HISTORY FILTER -->
            <div class="history-filter mb-6">
                <button onclick="window.filterHistory('all')" id="filterAll" class="filter-btn active">‡¶∏‡¶¨</button>
                <button onclick="window.filterHistory('deposit')" id="filterDeposit" class="filter-btn">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                <button onclick="window.filterHistory('withdraw')" id="filterWithdraw" class="filter-btn">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                <button onclick="window.filterHistory('recharge')" id="filterRecharge" class="filter-btn">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</button>
                <button onclick="window.filterHistory('task')" id="filterTask" class="filter-btn">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
                <button onclick="window.filterHistory('bonus')" id="filterBonus" class="filter-btn">‡¶¨‡ßã‡¶®‡¶æ‡¶∏</button>
                <button onclick="window.filterHistory('quiz')" id="filterQuiz" class="filter-btn">‡¶ï‡ßÅ‡¶á‡¶ú</button>
            </div>
            
            <div id="historyListContainer" class="space-y-3">
                <!-- History will be loaded here -->
            </div>
        </div>
        
        <!-- VIP SCREEN -->
        <div id="vipScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
             <div class="flex justify-between items-center mb-6"><div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h2></div></div>
             
             <!-- ‚úÖ DYNAMIC VIP PACKAGE CONTAINER -->
             <div id="packageListContainer" class="space-y-4">
                 <div class="history-loading">
                    <div class="animate-pulse">
                        <div class="h-24 bg-slate-100 rounded-2xl mb-3"></div>
                        <div class="h-24 bg-slate-100 rounded-2xl mb-3"></div>
                        <div class="h-24 bg-slate-100 rounded-2xl"></div>
                    </div>
                 </div>
             </div>
        </div>
        
        <!-- SPIN SCREEN -->
        <div id="spinScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡ßç‡¶™‡¶ø‡¶®</h2></div>
            <div class="glass-card p-6 rounded-[25px] text-center">
                <img src="https://i.postimg.cc/02p5C1GN/fortune-wheel.png" class="w-32 mx-auto mb-4">
                <h3 class="text-lg font-bold mb-2">‡¶≤‡¶æ‡¶ï‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶®</h3>
                <p class="text-sm text-slate-600 mb-4">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶è‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ó‡ßç‡¶∞‡¶á ‡¶è‡¶ü‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®</p>
                <div class="bg-yellow-50 p-4 rounded-xl mb-4">
                    <p class="text-sm font-bold text-yellow-700">‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá...</p>
                    <p class="text-xs text-slate-600 mt-1">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá</p>
                </div>
                <button onclick="window.showPage('homeScreen')" class="w-full bg-slate-100 text-slate-800 py-3 rounded-xl font-bold shadow">‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
            </div>
        </div>

        <!-- SUBSCRIPTION SCREEN -->
        <div id="subscriptionScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-slate-800">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</h2>
            </div>
            
            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.switchSubscriptionTab('stars')" id="tabStars" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                <button onclick="window.switchSubscriptionTab('telegram')" id="tabTelegram" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ</button>
            </div>
            
            <!-- STARS SECTION -->
            <div id="starsSection">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-6">
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <img src="https://i.postimg.cc/Z5JxMx1z/subscription-active.png" class="w-8">
                        <h3 class="text-xl font-bold text-yellow-700">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</h3>
                    </div>
                    
                    <p class="text-sm text-slate-600 mb-2">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡ß≥<span id="starPrice">2.90</span></p>
                    
                    <div class="grid grid-cols-3 gap-3">
                        <div onclick="window.selectStarPackage(100)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500">
                            <div class="star-count mx-auto mb-2">100 ‚≠ê</div>
                            <p class="text-lg font-bold text-slate-800">‡ß≥<span id="price100">290</span></p>
                            <p class="text-[10px] text-slate-500">‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶æ‡¶°‡¶º ‡¶®‡ßá‡¶á</p>
                        </div>
                        <div onclick="window.selectStarPackage(250)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500 relative">
                            <div class="absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">‡ßß‡ß¶% ‡¶õ‡¶æ‡¶°‡¶º</div>
                            <div class="star-count mx-auto mb-2">250 ‚≠ê</div>
                            <p class="text-lg font-bold text-slate-800 line-through text-slate-400">‡ß≥725</p>
                            <p class="text-lg font-bold text-green-600">‡ß≥<span id="price250">652.5</span></p>
                        </div>
                        <div onclick="window.selectStarPackage(500)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500 relative">
                            <div class="absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">‡ßß‡ß¶% ‡¶õ‡¶æ‡¶°‡¶º</div>
                            <div class="star-count mx-auto mb-2">500 ‚≠ê</div>
                            <p class="text-lg font-bold text-slate-800 line-through text-slate-400">‡ß≥1450</p>
                            <p class="text-lg font-bold text-green-600">‡ß≥<span id="price500">1305</span></p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-slate-700">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞:</span>
                            <span class="font-bold text-yellow-700"><span id="selectedStars">0</span> ‚≠ê</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-slate-700">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</span>
                            <span class="text-xl font-bold text-green-600">‡ß≥<span id="totalStarPrice">0</span></span>
                        </div>
                    </div>
                    
                    <button onclick="window.buyStars()" class="w-full bg-yellow-500 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-yellow-600">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                </div>
            </div>
            
            <!-- TELEGRAM PREMIUM SECTION -->
            <div id="telegramSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-6">
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <img src="https://i.postimg.cc/TYLvN32V/telegram.png" class="w-8">
                        <h3 class="text-xl font-bold text-blue-700">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div onclick="window.selectTelegramPlan('1month')" class="bg-white p-4 rounded-2xl border cursor-pointer text-left hover:border-blue-500">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-slate-800">‡ßß ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h4>
                                    <p class="text-sm text-slate-600">‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ</p>
                                </div>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold">‡ß≥600</span>
                            </div>
                        </div>
                        
                        <div onclick="window.selectTelegramPlan('3month')" class="bg-white p-4 rounded-2xl border cursor-pointer text-left hover:border-blue-500 relative">
                            <div class="absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full">‡¶∏‡¶æ‡¶∂‡ßç‡¶∞‡¶Ø‡¶º‡ßÄ</div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-slate-800">‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h4>
                                    <p class="text-sm text-slate-600">‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶°‡¶ø‡¶∏‡ßç‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</p>
                                </div>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold">‡ß≥1550</span>
                            </div>
                        </div>
                        
                        <div onclick="window.selectTelegramPlan('1year')" class="bg-white p-4 rounded-2xl border cursor-pointer text-left hover:border-blue-500 relative">
                            <div class="absolute -top-2 -right-2 bg-purple-500 text-white text-xs px-2 py-1 rounded-full">‡¶∏‡ßá‡¶∞‡¶æ ‡¶Ö‡¶´‡¶æ‡¶∞</div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-slate-800">‡ßß ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h4>
                                    <p class="text-sm text-slate-600">‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶∂‡ßç‡¶∞‡¶Ø‡¶º‡ßÄ</p>
                                </div>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold">‡ß≥3900</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-slate-700">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®:</span>
                            <span class="font-bold text-blue-700" id="selectedPlanText">‡¶ï‡ßã‡¶®‡ßã‡¶ü‡¶ø‡¶á ‡¶®‡¶æ</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-slate-700">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</span>
                            <span class="text-xl font-bold text-green-600">‡ß≥<span id="selectedPlanPrice">0</span></span>
                        </div>
                    </div>
                    
                    <button onclick="window.buyTelegramPremium()" class="w-full bg-blue-500 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-blue-600">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

    </div>

    <!-- ‚úÖ MODERN iPHONE DOCK BOTTOM NAV -->
    <div id="bottomNav" class="hidden fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl shadow-[0_-5px_30px_rgba(0,0,0,0.1)] rounded-t-[30px] flex justify-around items-end pb-4 pt-2 z-50 border-t border-white/50">
        
        <div onclick="window.showPage('homeScreen')" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <div class="relative">
                <i class="ri-home-5-fill text-xl text-green-600 mb-0.5 block group-hover:-translate-y-1 transition-transform"></i>
                <span class="absolute -bottom-1.5 left-1/2 -translate-x-1/2 w-1 h-1 bg-green-600 rounded-full opacity-100"></span>
            </div>
            <p class="text-[9px] font-bold text-slate-600">‡¶π‡ßã‡¶Æ</p>
        </div>

        <div onclick="window.showPage('walletScreen')" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <i class="ri-wallet-3-line text-xl text-slate-400 mb-0.5 block group-hover:text-green-600 group-hover:-translate-y-1 transition-all"></i>
            <p class="text-[9px] font-bold text-slate-400 group-hover:text-green-600 transition-colors">‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</p>
        </div>

        <div onclick="window.showPage('taskScreen')" class="text-center cursor-pointer -mt-10 relative active:scale-95 transition-transform">
            <div class="bg-gradient-to-br from-green-500 to-emerald-700 p-3.5 rounded-full shadow-[0_8px_20px_rgba(34,197,94,0.4)] border-[5px] border-slate-50 relative z-10 overflow-hidden">
                <div class="absolute inset-0 bg-white/20 backdrop-blur-sm"></div>
                <img src="https://i.postimg.cc/d1sXyCb6/clipboard.png" class="w-6 h-6 invert brightness-0 relative z-20">
            </div>
            <p class="text-[9px] font-bold mt-1.5 text-slate-600">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p>
        </div>

        <div onclick="window.loadHistory()" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <i class="ri-history-line text-xl text-slate-400 mb-0.5 block group-hover:text-green-600 group-hover:-translate-y-1 transition-all"></i>
            <p class="text-[9px] font-bold text-slate-400 group-hover:text-green-600 transition-colors">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</p>
        </div>

        <div onclick="window.showPage('moreScreen')" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <i class="ri-menu-4-line text-xl text-slate-400 mb-0.5 block group-hover:text-green-600 group-hover:-translate-y-1 transition-all"></i>
            <p class="text-[9px] font-bold text-slate-400 group-hover:text-green-600 transition-colors">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p>
        </div>
    </div>

    <!-- ‚úÖ UPDATED PROOF SUBMISSION MODAL -->
    <div id="proofModal" class="proof-modal hidden">
        <div class="proof-content">
            <div class="bg-premium p-6 text-white text-center">
                <h2 class="text-xl font-bold">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</h2>
                <p class="text-sm opacity-90">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®</p>
                <div class="task-timer" id="proofTimer">‡ß´</div>
            </div>
            <div class="p-6">
                <div id="proofFormContainer">
                    <!-- Proof form will be loaded here dynamically -->
                </div>
                <div class="mt-4">
                    <button onclick="window.submitProof()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button onclick="window.closeProofModal()" class="w-full mt-2 bg-slate-200 text-slate-800 py-3 rounded-xl font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCXo_oRLBE9Gr7JZ_Fp4rl2OAjCz_AJEBo",
            authDomain: "takawala-e8522.firebaseapp.com",
            projectId: "takawala-e8522",
            storageBucket: "takawala-e8522.firebasestorage.app",
            messagingSenderId: "900133484973",
            appId: "1:900133484973:web:00f8d9de7c970f505f8924",
            measurementId: "G-ZNZ1D35QLB"
        };

        // ‚úÖ TELEGRAM BOT CONFIGURATION
        const TG_BOT_TOKEN = "8583588570:AAEKfRe3y_egMXA6n8WxiZA-z-sU4FEgE1M";
        const TG_ADMIN_CHAT_ID = "6454695072";

        async function sendTelegramNotification(message) {
            try {
                const url = `https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage`;
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: TG_ADMIN_CHAT_ID,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
            } catch (error) { console.error("TG Error:", error); }
        }

        // ‚úÖ UPDATED TWAI RESPONSES - 20 QUESTIONS
        const twaiResponses = {
            '‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨?': '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶´‡ßç‡¶∞‡¶ø/‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡ßü ‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§',
            '‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?': '‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü > ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡¶Ø‡¶æ‡¶®‡•§ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§ ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶/‡¶∞‡¶ï‡ßá‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®‡•§ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßØ-‡ßß‡ß¶‡¶ü‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶ï‡¶æ‡¶≤ ‡ß©-‡ßØ:‡ß©‡ß¶‡¶ü‡¶æ‡•§',
            '‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡¶§?': '‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡ß≥‡ß´ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ø‡¶ñ‡¶® ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶§‡¶ñ‡¶®‡¶á ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§',
            '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶§‡ßá ‡¶ï‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶≤‡¶æ‡¶ó‡ßá?': '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡ß´-‡ß©‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü‡•§ ‡¶§‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶ï‡¶ø‡¶Ç ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶¨‡¶æ ‡¶â‡¶ö‡ßç‡¶ö ‡¶ö‡¶æ‡¶™‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡ßß-‡ß® ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§',
            '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡¶ø, ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?': '‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶á‡¶ú‡ßá "‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡¶ø" ‡¶Ö‡¶™‡¶∂‡¶® ‡¶®‡ßá‡¶á‡•§ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§',
            '‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡¶≤‡ßá ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?': '‡¶≠‡ßÅ‡¶Ø‡¶º‡¶æ ‡¶§‡¶•‡ßç‡¶Ø, ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü, ‡¶¨‡¶æ ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ ‡¶≠‡¶ô‡ßç‡¶ó ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡¶≤‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
            '‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶§?': '‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥‡ß´‡ß¶‡•§ ‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡ßß ‡¶¨‡¶æ‡¶∞, ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß® ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡•§',
            '‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶§ ‡¶ï‡¶æ‡¶ü‡ßá?': '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡ßß‡ß¶% ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶æ‡¶ü‡¶æ ‡¶π‡ßü‡•§ ‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé ‡ß≥‡ßß‡ß¶‡ß¶ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡ß≥‡ßØ‡ß¶ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶®‡ßá‡¶á‡•§',
            '‡¶è‡¶ï ‡¶´‡ßã‡¶®‡ßá ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá?': '‡¶è‡¶ï ‡¶´‡ßã‡¶®‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ßß‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§',
            '‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶ï‡¶ø?': '‡¶ï‡ßÅ‡¶á‡¶ú ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ï‡ßÅ‡¶á‡¶ú‡ßá ‡ß©‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶•‡¶æ‡¶ï‡ßá‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡ß≥‡ß¶.‡ß®‡ß´ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§',
            '‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® (VPN) ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨ ‡¶ï‡¶ø‡¶®‡¶æ?': '‡¶®‡¶æ, ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§ ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§',
            '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶ñ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü?': '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßØ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßß‡ß¶‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßá‡¶§‡ßá ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶ø‡¶§ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
            '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶è‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ ‡¶ï‡ßá‡¶®?': '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡ßá‡•§ ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡ß´-‡ß©‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶≤‡¶æ‡¶ó‡ßá‡•§ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶≤‡¶æ‡¶ó‡¶≤‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
            '‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßá ‡¶ï‡¶ø ‡¶ï‡¶∞‡¶¨?': '‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶Ø‡¶º ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶¶‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶®‡¶á‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§',
            '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤?': '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, Takawala ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ‡•§ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡ß®‡ß¶‡ß®‡ß´ ‡¶∏‡¶æ‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§',
            '‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶ø?': '‡ßß‡ß¶ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü = ‡ß≥‡ßß‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï, ‡¶ï‡ßÅ‡¶á‡¶ú, ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶Ø‡¶æ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶Ø‡¶º ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡•§',
            '‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?': '@TAKAR_WALA_ADMIN ‡¶è ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡¶ø‡¶®‡•§ ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßØ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßß‡ß¶‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§',
            '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡ßü?': '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡ß≥‡ß´‡ß¶ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß≥‡ß´‡ß¶‡ß¶‡ß¶‡•§',
            '‡¶®‡¶ó‡¶¶‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡ßü?': '‡¶®‡¶ó‡¶¶‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡ß≥‡ß´‡ß¶ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß≥‡ß´‡ß¶‡ß¶‡ß¶‡•§',
            '‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶ñ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡ßá?': '‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßØ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßß‡ß¶‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡ßá‡•§ ‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßÆ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßØ:‡ß©‡ß¶‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§‡•§',
            'default': '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶æ‡¶®‡¶ø ‡¶®‡¶æ‡•§ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'
        };

        // ‚úÖ ADSTERRA ADS LINKS
        const adsterraLinks = [
            'https://www.effectivegatecpm.com/t24spqed1?key=7dead7af0eb6b2081051d790a9f95d1b',
            'https://www.effectivegatecpm.com/dt5xiqg93?key=69751766d294f4706935c6d1f690ea51',
            'https://www.effectivegatecpm.com/c6dvsywif5?key=91b430d7c920d751eaf19bfc7106e45d',
            'https://www.effectivegatecpm.com/q0cc46jma?key=8131e64ae71dd95e34995b8326d2ab81',
            'https://www.effectivegatecpm.com/skjxxk20uj?key=5c7946889852184605cd841244ecaf8d',
            'https://www.effectivegatecpm.com/qy6201wn?key=a1b1d956fe60158f669f837297a01895',
            'https://www.effectivegatecpm.com/f97068jz?key=afdd10b69fab899952ebc24c6c4a2898',
            'https://www.effectivegatecpm.com/cvcrrrps?key=5058530abbd00c92c632cc0ad8b71c58'
        ];

        // ‚úÖ WITHDRAW/RECHARGE SCHEDULE
        const withdrawalSchedule = {
            friday: { start: 8, end: 21.5 }, // 8:00 AM to 9:30 PM
            otherDays: { morning: { start: 9, end: 10 }, evening: { start: 15, end: 21.5 } } // 9-10 AM, 3-9:30 PM
        };

        function isWithinWithdrawalSchedule() {
            const now = new Date();
            const day = now.getDay(); // 0 = Sunday, 5 = Friday
            const hour = now.getHours() + (now.getMinutes() / 60);
            
            if (day === 5) { // Friday
                return hour >= withdrawalSchedule.friday.start && hour <= withdrawalSchedule.friday.end;
            } else {
                return (hour >= withdrawalSchedule.otherDays.morning.start && hour <= withdrawalSchedule.otherDays.morning.end) ||
                       (hour >= withdrawalSchedule.otherDays.evening.start && hour <= withdrawalSchedule.otherDays.evening.end);
            }
        }

        // ‚úÖ INITIALIZE FIREBASE
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ‚úÖ GLOBAL VARIABLES
        let currentUserData = null;
        let onAdCompleted = null; // ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶®: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶ï‡¶ø ‡¶π‡¶¨‡ßá ‡¶§‡¶æ ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        let currentUserId = null;
        let currentTaskType = 'free';
        let selectedMethod = 'bKash';
        let selectedOperator = 'GP';
        let selectedStarPackage = 0;
        let selectedTelegramPlan = null;
        let currentQuizType = null;
        let currentLoadedQuizzes = []; // üî• ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßã
        let quizTimer = null;
        let taskTimer = null;
        let currentTaskInfo = null;
        let paymentNumbers = {};
        let systemSettings = {};
        let currentHistoryFilter = 'all';
        let todayEarnings = 0;
        let selectedAvatar = 'https://img.icons8.com/fluency/96/user-male-circle.png';
        let selectedAnswers = {};
        let maintenanceMode = false;
        let userWithdrawCount = 0;
        let userRechargeCount = 0;
        let proofTimer = null;

        // ‚úÖ SMART TOAST FUNCTION
        function showSmartToast(message, type = 'info') {
            let displayMessage = typeof message === 'object' && message !== null ? (message.message || JSON.stringify(message)) : String(message);
            
            const toast = document.getElementById('smartToast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('.toast-icon');
            
            if(window.toastTimeout) clearTimeout(window.toastTimeout);
            
            // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
            toast.style.animation = 'none';
            toast.offsetHeight; 
            toast.style.animation = 'slideDownFade 0.4s ease, fadeOutUp 0.4s ease 4.5s forwards';

            toast.classList.remove('hidden');
            
            // üî• ‡¶Æ‡¶°‡¶æ‡¶∞‡ßç‡¶® ‡¶Ü‡¶á‡¶ï‡¶® ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (Remix Icon)
            if(type === 'success') {
                toastIcon.innerHTML = '<i class="ri-checkbox-circle-fill text-green-500"></i>';
            } else if(type === 'error') {
                toastIcon.innerHTML = '<i class="ri-close-circle-fill text-red-500"></i>';
            } else {
                toastIcon.innerHTML = '<i class="ri-information-fill text-blue-500"></i>';
            }
            
            toastMessage.innerHTML = displayMessage;
            
            // ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
            window.toastTimeout = setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }

        // ‚úÖ OLD NOTIFICATION FUNCTION (KEPT FOR BACKWARD COMPATIBILITY)
        function showNotification(message, type = 'info') {
            showSmartToast(message, type);
        }

        // ‚úÖ LOADING ANIMATION
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // ‚úÖ UPDATED INTERSTITIAL AD SHOW FUNCTION
        function showInterstitialAd() {
            const interstitial = document.getElementById('monitagInterstitial');
            interstitial.classList.remove('hidden');
            
            let timeLeft = 10; 
            const timerElement = document.getElementById('adTimer');
            
            const closeBtn = document.getElementById('adCloseBtn') || interstitial.querySelector('button.bg-slate-200');
            if(closeBtn) {
                if(!closeBtn.id) closeBtn.id = 'adCloseBtn';
                closeBtn.classList.remove('hidden'); 
                closeBtn.style.display = 'none'; 
                closeBtn.innerHTML = "‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®";
                closeBtn.disabled = false;
                closeBtn.style.opacity = "1";
            }

            const adTimer = setInterval(() => {
                timeLeft--;
                if(timerElement) timerElement.textContent = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(adTimer);
                    if(timerElement) timerElement.textContent = "‡¶è‡¶ñ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ü‡¶ø ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
                }
            }, 1000);
            window.adTimer = adTimer;
        }

        function closeInterstitialAd() {
            const interstitial = document.getElementById('monitagInterstitial');
            interstitial.classList.add('hidden');
            if(window.adTimer) clearInterval(window.adTimer);

            // üî• ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            if (onAdCompleted) {
                onAdCompleted(); 
                onAdCompleted = null; 
            }
        }

        // ‚úÖ ‚úÖ FIXED: UPDATED AD LINK FUNCTION
        window.openAdLink = () => {
            const randomLink = adsterraLinks[Math.floor(Math.random() * adsterraLinks.length)];
            
            // ‡ßß. ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá (‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶®‡ßç‡¶ß ‡¶®‡¶æ ‡¶π‡ßü)
            window.open(randomLink, '_blank');
            
            // ‡ß®. ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
            showSmartToast('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®', 'info');
            
            // ‡ß©. ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ "‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá
            const closeBtn = document.querySelector('#monitagInterstitial button.bg-slate-200');
            if(closeBtn) {
                closeBtn.innerHTML = "‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...";
                closeBtn.disabled = true;
                closeBtn.style.opacity = "0.5";
                closeBtn.style.display = "block"; // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∂‡ßã ‡¶ï‡¶∞‡¶¨‡ßá
                
                setTimeout(() => {
                    closeBtn.innerHTML = "‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®";
                    closeBtn.disabled = false;
                    closeBtn.style.opacity = "1";
                }, 5000); // ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
            }
        };

        // ‚úÖ COPY TO CLIPBOARD
        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text).then(() => {
                showSmartToast('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            }).catch(() => {
                showSmartToast('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
            });
        };

        // ‚úÖ LOAD SYSTEM SETTINGS
        async function loadSystemSettings() {
            try {
                // Check maintenance mode first
                const maintenanceDoc = await db.collection("settings").doc("maintenance").get();
                if(maintenanceDoc.exists) {
                    const maintenanceData = maintenanceDoc.data();
                    if(maintenanceData.maintenanceMode === true) {
                        maintenanceMode = true;
                        showMaintenanceScreen();
                        return;
                    }
                }
                
                const paymentDoc = await db.collection("settings").doc("payment_numbers").get();
                if(paymentDoc.exists) {
                    paymentNumbers = paymentDoc.data();
                    
                    // Update payment method status
                    updatePaymentMethodStatus();
                } else {
                    paymentNumbers = {
                        bKash: "01340975230",
                        Nagad: "01836319726",
                        Rocket: "01600000000",
                        USDT_Polygon: "0x3399E2a9408c675489f84Ae830Ad5ED6FC12c14b",
                        USDT_BEP20: "0xa202c31208D7d7b0cA8f2F48F0821e86824605C4"
                    };
                }

                const settingsDoc = await db.collection("settings").doc("system").get();
                if(settingsDoc.exists) {
                    systemSettings = settingsDoc.data();
                } else {
                    systemSettings = {
                        noticeText: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá!",
                        referralBonus: 5,
                        taskWaitTime: 5, // ‚úÖ CHANGED FROM 15 TO 5 SECONDS
                        minWithdraw: 50,
                        maxWithdraw: 5000,
                        vatPercentage: 10,
                        rechargeFee: 5,
                        minDeposit: 50,
                        minRecharge: 20
                    };
                }

                document.getElementById('noticeText').innerText = systemSettings.noticeText || "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá!";
                
                // Load user today counts
                await loadUserTodayCounts();
                
            } catch (error) {
                console.error("Error loading system settings:", error);
            }
        }
        
        // ‚úÖ LOAD USER TODAY'S COUNTS
        async function loadUserTodayCounts() {
            if(!currentUserId) return;
            
            try {
                const today = new Date();
                const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                
                // Withdraw count
                const withdrawQuery = await db.collection("history")
                    .where("userId", "==", currentUserId)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .where("type", "in", ["‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®", "Withdraw"])
                    .get();
                
                userWithdrawCount = withdrawQuery.size || 0;
                
                // Recharge count
                const rechargeQuery = await db.collection("history")
                    .where("userId", "==", currentUserId)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .where("type", "in", ["‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú", "Recharge"])
                    .get();
                
                userRechargeCount = rechargeQuery.size || 0;
                
            } catch (error) {
                console.error("Error loading user counts:", error);
            }
        }
        
        // ‚úÖ UPDATE PAYMENT METHOD STATUS
        function updatePaymentMethodStatus() {
            const methods = ['bKash', 'Nagad', 'Rocket', 'USDT'];
            methods.forEach(method => {
                const element = document.getElementById(`payment_${method}`);
                const withdrawElement = document.getElementById(`withdraw_${method}`);
                
                if(element) {
                    if(method === 'USDT') {
                        element.classList.remove('disabled-option');
                        element.onclick = () => window.selectPayment(element, method);
                        element.innerHTML = `<img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain">`;
                    } else if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                        element.classList.add('disabled-option');
                        element.onclick = null;
                        element.innerHTML = `
                            <img src="${element.querySelector('img').src}" class="h-10 object-contain opacity-50">
                            <div class="disabled-text">‡¶¨‡¶®‡ßç‡¶ß</div>
                        `;
                    } else {
                        element.classList.remove('disabled-option');
                        element.onclick = () => window.selectPayment(element, method);
                        element.innerHTML = `<img src="https://i.postimg.cc/${method === 'bKash' ? 'C5vDR4nz/1656235223bkash-logo.png' : method === 'Nagad' ? 'k4phWWbK/1679248787Nagad-Logo.png' : method === 'Rocket' ? 'xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png' : '0QRCvZDV/usdt.png'}" class="h-10 object-contain">`;
                    }
                }
                
                if(withdrawElement) {
                    if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                        withdrawElement.classList.add('disabled-option');
                        withdrawElement.onclick = null;
                        withdrawElement.innerHTML = `
                            <img src="${withdrawElement.querySelector('img').src}" class="h-10 object-contain opacity-50">
                            <div class="disabled-text">‡¶¨‡¶®‡ßç‡¶ß</div>
                        `;
                    } else {
                        withdrawElement.classList.remove('disabled-option');
                        withdrawElement.onclick = () => window.selectWithdrawMethod(withdrawElement, method);
                        withdrawElement.innerHTML = `<img src="https://i.postimg.cc/${method === 'bKash' ? 'C5vDR4nz/1656235223bkash-logo.png' : method === 'Nagad' ? 'k4phWWbK/1679248787Nagad-Logo.png' : method === 'Rocket' ? 'xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png' : '0QRCvZDV/usdt.png'}" class="h-10 object-contain">`;
                    }
                }
            });
        }
        
        // ‚úÖ SHOW MAINTENANCE SCREEN
        function showMaintenanceScreen() {
            document.getElementById('maintenanceScreen').classList.remove('hidden');
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('bottomNav').classList.add('hidden');
            document.getElementById('globalChatIcon').style.display = 'none';
            document.getElementById('twaiChatbotIcon').style.display = 'none';
        }

        // ‚úÖ SHOW NOTICE (CLEAN VERSION)
        async function showLoginNotice() {
            try {
                let title = "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ üëã";
                let msg = "‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!";
                
                try {
                    const doc = await db.collection("settings").doc("popup").get();
                    if(doc.exists) {
                        const data = doc.data();
                        if(data.title) title = data.title;
                        if(data.message) msg = data.message;
                    }
                } catch(e) { console.log("DB Error"); }

                document.getElementById('noticeTitle').innerText = title;
                document.getElementById('noticeMessage').innerHTML = msg;
                
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá (‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶¨‡¶æ‡¶ü‡¶®‡ßá)
                document.getElementById('loginNoticeModal').classList.remove('hidden');

            } catch (error) { console.error(error); }
        }

        function closeLoginNoticeWithConfetti() {
            document.getElementById('loginNoticeModal').classList.add('hidden');
            if(typeof confetti === 'function') {
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
            }
        
            // ‡ß®. ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶ó‡¶ú ‡¶´‡ßÅ‡¶ü‡¶æ‡¶®‡ßã (Birthday Style)
            if(typeof confetti === 'function') {
                // ‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { x: 0.1, y: 0.6 },
                    zIndex: 99999999
                });
                // ‡¶°‡¶æ‡¶® ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { x: 0.9, y: 0.6 },
                    zIndex: 99999999
                });
            }
        }

        // ‚úÖ NEW FUNCTION: CLOSE LOGIN NOTICE
        function closeLoginNotice() {
            document.getElementById('loginNoticeModal').classList.add('hidden');
        }

        // ‚úÖ NEW FUNCTION: LOAD DYNAMIC VIP PACKAGES
        async function loadPackages() {
            try {
                const packagesSnapshot = await db.collection("packages").get();
                
                const packageContainer = document.getElementById('packageListContainer');
                if(!packageContainer) return;
                
                packageContainer.innerHTML = '';
                
                if(packagesSnapshot.empty) {
                    packageContainer.innerHTML = `<div class="text-center py-8 text-slate-500">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶®‡ßá‡¶á</div>`;
                    hideLoading();
                    return;
                }
                
                packagesSnapshot.forEach((doc) => {
                    const packageData = doc.data();
                    const packageId = doc.id;
                    
                    let borderColor = 'border-yellow-500';
                    let bgColor = 'bg-yellow-500';
                    let textColor = 'text-yellow-700';
                    
                    if(packageData.name.includes('‡¶ó‡ßã‡¶≤‡ßç‡¶°') || packageData.name.includes('Gold')) {
                        borderColor = 'border-purple-500';
                        bgColor = 'bg-purple-500';
                        textColor = 'text-purple-700';
                    } else if(packageData.name.includes('‡¶™‡ßç‡¶≤‡¶æ‡¶ü‡¶ø‡¶®‡¶æ‡¶Æ') || packageData.name.includes('Platinum')) {
                        borderColor = 'border-green-500';
                        bgColor = 'bg-green-500';
                        textColor = 'text-green-700';
                    }
                    
                    const packageHTML = `
                        <div class="glass-card p-4 rounded-2xl border-2 ${borderColor}">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="font-bold text-lg ${textColor}">${packageData.name}</h3>
                                    <p class="text-sm text-slate-600">${packageData.description || '‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ'}</p>
                                    <p class="text-xs text-slate-500 mt-1">‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶: ${packageData.days || 30} ‡¶¶‡¶ø‡¶®</p>
                                </div>
                                <span class="${bgColor.replace('bg-', 'bg-')}100 ${textColor} px-3 py-1 rounded-full font-bold">‡ß≥${packageData.price}</span>
                            </div>
                            <button onclick="window.buyPackage('${packageId}', ${packageData.price}, '${packageData.name}', ${packageData.days || 30})" class="w-full mt-3 ${bgColor} text-white py-2 rounded-lg font-bold hover:opacity-90 transition">
                                ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®
                            </button>
                        </div>
                    `;
                    
                    packageContainer.innerHTML += packageHTML;
                });
                
            } catch (error) {
                console.error("Error loading packages:", error);
                const packageContainer = document.getElementById('packageListContainer');
                if(packageContainer) {
                    packageContainer.innerHTML = `
                        <div class="glass-card p-6 rounded-2xl text-center">
                            <p class="text-red-500 font-bold">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
                            <button onclick="window.loadPackages()" class="mt-3 bg-premium text-white px-4 py-2 rounded-lg font-bold">
                                ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                    `;
                }
            }
        }

        // ‚úÖ UPDATED BUY PACKAGE FUNCTION (PREVENTS DOUBLE PURCHASE)
        window.buyPackage = async (packageId, price, name, days) => {
            if(!currentUserData) {
                showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }

            // üõë ‡ßß. ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ö‡ßá‡¶ï: ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ?
            if (currentUserData.plan !== "Free Member" && currentUserData.packageExpiresAt) {
                try {
                    const expiryDate = currentUserData.packageExpiresAt.toDate();
                    const now = new Date();
                    
                    // ‡¶Ø‡¶¶‡¶ø ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶è‡¶ñ‡¶®‡ßã ‡¶∂‡ßá‡¶∑ ‡¶®‡¶æ ‡¶π‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá
                    if (expiryDate > now) {
                        Swal.fire({
                            icon: 'warning',
                            title: '‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá!',
                            html: `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡ßá‡¶∞ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ <b>${expiryDate.toLocaleDateString('bn-BD')}</b> ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá‡•§<br><br>‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`,
                            confirmButtonText: '‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø',
                            confirmButtonColor: '#3b82f6',
                            customClass: {
                                popup: 'rounded-[25px]'
                            }
                        });
                        return; // ‚õîÔ∏è ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶° ‡¶•‡¶æ‡¶Æ‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ, ‡¶Ü‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‡¶è‡¶ó‡ßã‡¶¨‡ßá ‡¶®‡¶æ
                    }
                } catch (e) {
                    console.error("Date check error", e);
                }
            }
            
            // ‡ß®. ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ö‡ßá‡¶ï
            if(currentUserData.mainBalance < price) {
                showSmartToast(`‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${currentUserData.mainBalance.toFixed(2)}, ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®: ‡ß≥${price}`, 'error');
                return;
            }
            
            // ‡ß©. ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∂‡¶® ‡¶ì ‡¶ï‡ßá‡¶®‡¶æ
            const result = await Swal.fire({
                title: `${name} ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`,
                html: `‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: <b>‡ß≥${price}</b><br><br>‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶: <b>${days} ‡¶¶‡¶ø‡¶®</b><br>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${currentUserData.mainBalance.toFixed(2)}<br>‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${(currentUserData.mainBalance - price).toFixed(2)}`,
                showCancelButton: true,
                confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                confirmButtonColor: '#059669',
                icon: 'question'
            });
            
            if (result.isConfirmed) {
                showLoading();
                try {
                    const userRef = db.collection("users").doc(currentUserId);
                    
                    // Calculate expiry date
                    const today = new Date();
                    const expiryDate = new Date();
                    expiryDate.setDate(today.getDate() + days);
                    
                    const updateData = {
                        mainBalance: firebase.firestore.FieldValue.increment(-price),
                        plan: name,
                        totalDeposit: firebase.firestore.FieldValue.increment(price),
                        packageExpiresAt: expiryDate,
                        packageId: packageId
                    };
                    
                    await userRef.update(updateData);
                    
                    await db.collection("history").add({
                        userId: currentUserId,
                        type: `${name} ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º`,
                        amount: -price,
                        status: "Success",
                        details: `${name} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶: ${days} ‡¶¶‡¶ø‡¶®, ‡¶∂‡ßá‡¶∑: ${expiryDate.toLocaleDateString('bn-BD')})`,
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    const telegramMessage = `üõí *‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∏‡¶´‡¶≤*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüì¶ *‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú:* ${name}\nüí∞ *‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:* ‡ß≥${price}\nüìÖ *‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶:* ${days} ‡¶¶‡¶ø‡¶®\nüìÖ *‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑:* ${expiryDate.toLocaleDateString('bn-BD')}\n‚úÖ *‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:* Success`;
                    await sendTelegramNotification(telegramMessage);
                    
                    showSmartToast(`${name} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶: ${days} ‡¶¶‡¶ø‡¶®`, 'success');
                    hideLoading();
                    
                } catch (e) {
                    console.error("Package purchase error:", e);
                    showSmartToast('‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                    hideLoading();
                }
            }
        };

        // ‚úÖ UPDATED DEPOSIT ADDRESS FUNCTION
        window.selectPayment = (el, method) => { 
            if(method === 'USDT') {
                // USDT is always enabled in deposit
            } else if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                showSmartToast(`${method} ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶¨‡¶®‡ßç‡¶ß`, 'error');
                return;
            }
            
            document.querySelectorAll('#depositSection .grid .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedMethod = method;
            document.getElementById('selectedDepositMethod').value = method;
            
            updateDepositAddress(method);
        };
        
                                // ‚úÖ FIXED: DATABASE CONNECTED DEPOSIT FUNCTION (USDT + LOCAL)
        function updateDepositAddress(method) {
            const container = document.getElementById('depositAddressContainer');
            if(!container) return;

            // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ
            let address = "01XXXXXXXXX"; 
            let title = "‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞";
            let icon = "ri-smartphone-line";
            let color = "blue"; 
            let badge = "‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡ßü‡¶æ‡¶≤";
            let warning = "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶Æ‡¶ø‡¶≤‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡¶®";

            // 1. USDT LOGIC (DATABASE CONNECTED)
            if (method === 'USDT') {
                // üî• ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶∏‡¶¨‡ßá
                const polygonAddr = paymentNumbers.USDT_Polygon || "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á"; 
                const bscAddr = paymentNumbers.USDT_BEP20 || "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                
                container.innerHTML = `
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-2.5 relative mb-2 overflow-hidden hover:shadow-sm">
                        <div class="absolute top-0 right-0 bg-purple-100 px-2 py-0.5 rounded-bl-lg text-[9px] font-bold text-purple-600">
                            Polygon (Matic)
                        </div>
                        <p class="text-[10px] text-purple-600 font-bold mb-1 flex items-center gap-1">
                            <i class="ri-global-line"></i> Wallet Address:
                        </p>
                        <div class="flex items-center justify-between gap-2">
                            <h2 class="text-[11px] font-mono font-bold text-slate-700 truncate w-48 bg-white px-1 rounded border border-purple-100">
                                ${polygonAddr}
                            </h2>
                            <button onclick="window.copyToClipboard('${polygonAddr}')" 
                                class="bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded-md text-[10px] font-bold active:scale-95 transition h-6 flex items-center gap-1">
                                <i class="ri-file-copy-line"></i> ‡¶ï‡¶™‡¶ø
                            </button>
                        </div>
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-2.5 relative overflow-hidden hover:shadow-sm">
                        <div class="absolute top-0 right-0 bg-yellow-100 px-2 py-0.5 rounded-bl-lg text-[9px] font-bold text-yellow-700">
                            BSC (BEP20)
                        </div>
                        <p class="text-[10px] text-yellow-700 font-bold mb-1 flex items-center gap-1">
                            <i class="ri-bit-coin-line"></i> Wallet Address:
                        </p>
                        <div class="flex items-center justify-between gap-2">
                            <h2 class="text-[11px] font-mono font-bold text-slate-700 truncate w-48 bg-white px-1 rounded border border-yellow-100">
                                ${bscAddr}
                            </h2>
                            <button onclick="window.copyToClipboard('${bscAddr}')" 
                                class="bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded-md text-[10px] font-bold active:scale-95 transition h-6 flex items-center gap-1">
                                <i class="ri-file-copy-line"></i> ‡¶ï‡¶™‡¶ø
                            </button>
                        </div>
                    </div>
                    
                    <p class="text-[9px] text-red-400 mt-2 text-center font-bold">
                        ‚ö†Ô∏è ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ POLYGON ‡¶¨‡¶æ BEP20 ‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá‡¶®‡•§
                    </p>
                `;
                return; 
            }

            // 2. LOCAL METHOD LOGIC (BKASH/NAGAD)
            if (method === 'bKash') {
                address = paymentNumbers.bKash || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "pink";
            } else if (method === 'Nagad') {
                address = paymentNumbers.Nagad || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "orange";
            } else if (method === 'Rocket') {
                address = paymentNumbers.Rocket || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "purple";
            } else if (method === 'Upay') {
                address = paymentNumbers.Upay || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "blue";
            }

            // HTML GENERATION (LOCAL)
            container.innerHTML = `
                <div class="bg-${color}-50 border border-${color}-200 rounded-lg p-2.5 relative overflow-hidden transition-all hover:shadow-sm">
                    <div class="absolute top-0 right-0 bg-${color}-100 px-2 py-0.5 rounded-bl-lg text-[9px] font-bold text-${color}-600">
                        ${badge}
                    </div>
                    <p class="text-[10px] text-${color}-600 font-bold mb-1 flex items-center gap-1">
                        <i class="${icon}"></i> ${title}:
                    </p>
                    <div class="flex items-center justify-between gap-2">
                        <h2 class="text-lg font-black text-slate-700 tracking-wider font-mono leading-none">
                            ${address}
                        </h2>
                        <button onclick="window.copyToClipboard('${address}')" 
                            class="bg-${color}-500 hover:bg-${color}-600 text-white px-2.5 py-1 rounded-md text-[10px] font-bold shadow-sm active:scale-95 transition flex items-center gap-1 h-7">
                            <i class="ri-file-copy-line"></i> ‡¶ï‡¶™‡¶ø
                        </button>
                    </div>
                    <p class="text-[9px] text-slate-400 mt-1.5 flex items-center gap-1 leading-none opacity-80">
                        <i class="ri-shield-check-line text-${color}-400"></i> ${warning}
                    </p>
                </div>
            `;
        }

        // ‚úÖ AUTH FUNCTIONS
        document.getElementById('btnRegAction').addEventListener('click', async () => {
            const name = document.getElementById('regName').value, 
                  phone = document.getElementById('regPhone').value, 
                  email = document.getElementById('regEmail').value, 
                  pass = document.getElementById('regPass').value,
                  referralCode = document.getElementById('regReferralCode').value.trim();
            
            if(!name || !phone || !email || !pass) return showSmartToast('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
            if(pass.length < 6) return showSmartToast('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
            
            try {
                showLoading();
                showSmartToast('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                const uc = await auth.createUserWithEmailAndPassword(email, pass);
                
                const userReferralCode = 'REF' + Math.floor(100000 + Math.random() * 900000);
                
                const userData = { 
                    name, 
                    phone, 
                    email, 
                    mainBalance: 0, 
                    rechargeBalance: 0, 
                    plan: "Free Member", 
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(), 
                    totalEarnings: 0, 
                    totalDeposit: 0, 
                    totalWithdraw: 0, 
                    totalTasks: 0, 
                    totalReferrals: 0,
                    referralEarnings: 0,
                    stars: 0,
                    lastDailyBonus: null,
                    referralCode: userReferralCode,
                    referredBy: referralCode || null,
                    avatar: selectedAvatar,
                    address: '',
                    todayEarnings: 0,
                    lastQuizDate_general: null,
                    lastQuizDate_math: null,
                    lastQuizDate_science: null,
                    lastQuizDate_islamic: null
                };
                
                await db.collection("users").doc(uc.user.uid).set(userData);
                
                if(referralCode) {
                    try {
                        const referralQuery = await db.collection("users").where("referralCode", "==", referralCode).get();
                        
                        if(!referralQuery.empty) {
                            const referrerDoc = referralQuery.docs[0];
                            const referrerId = referrerDoc.id;
                            
                            const bonusAmount = systemSettings.referralBonus || 5;
                            await db.collection("users").doc(referrerId).update({
                                mainBalance: firebase.firestore.FieldValue.increment(bonusAmount),
                                totalEarnings: firebase.firestore.FieldValue.increment(bonusAmount),
                                totalReferrals: firebase.firestore.FieldValue.increment(1),
                                referralEarnings: firebase.firestore.FieldValue.increment(bonusAmount)
                            });
                            
                            await db.collection("history").add({
                                userId: referrerId,
                                type: "‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏",
                                amount: bonusAmount,
                                status: "Success",
                                details: `${name} ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`,
                                date: new Date().toLocaleDateString('bn-BD'),
                                time: new Date().toLocaleTimeString('bn-BD'),
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            
                            await db.collection("users").doc(uc.user.uid).update({
                                referredBy: referralCode
                            });
                        }
                    } catch (referralError) {
                        console.error("Referral processing error:", referralError);
                    }
                }
                
                showSmartToast('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶∏‡¶´‡¶≤! ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®', 'success');
                hideLoading();
            } catch (e) { 
                showSmartToast(e.message, 'error');
                hideLoading();
            }
        });

        document.getElementById('btnLoginAction').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            
            if(!email || !pass) return showSmartToast('‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®', 'error');
            
            try { 
                showLoading();
                showSmartToast('‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info'); 
                await auth.signInWithEmailAndPassword(email, pass); 
                showSmartToast('‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!', 'success'); 
                hideLoading();
            } catch (e) { 
                showSmartToast('‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°', 'error'); 
                hideLoading();
            }
        });

        // ‚úÖ AUTH STATE LISTENER WITH LOGIN NOTICE
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUserId = user.uid;
                showLoading();
                setTimeout(async () => {
                    await loadSystemSettings();
                    
                    if(maintenanceMode) {
                        hideLoading();
                        return;
                    }
                    
                    document.getElementById('authScreen').classList.add('hidden'); 
                    document.getElementById('mainApp').classList.remove('hidden'); 
                    document.getElementById('bottomNav').classList.remove('hidden');
                    
                    syncUserData(user.uid); 
                    renderTasks();
                    loadSummary(user.uid);
                    checkDailyBonus(user.uid);
                    loadTodayEarnings(user.uid);
                    loadSettingsFromLocalStorage(); // Load settings
                    
                    // Show icons
                    document.getElementById('globalChatIcon').style.display = 'flex';
                    document.getElementById('twaiChatbotIcon').style.display = 'flex';
                    
                    // ‚úÖ SHOW LOGIN NOTICE AFTER SUCCESSFUL LOGIN
                    setTimeout(async () => {
                        const noticeShown = await showLoginNotice();
                        if(noticeShown) {
                            console.log("Login notice shown successfully");
                        }
                    }, 1500);
                    
                    hideLoading();
                }, 2000);
            } else {
                document.getElementById('authScreen').classList.remove('hidden'); 
                document.getElementById('mainApp').classList.add('hidden'); 
                document.getElementById('bottomNav').classList.add('hidden');
                document.getElementById('globalChatIcon').style.display = 'none';
                document.getElementById('twaiChatbotIcon').style.display = 'none';
            }
        });

        // ‚úÖ SYNC USER DATA
        function syncUserData(uid) {
            db.collection("users").doc(uid).onSnapshot((d) => {
                const safe = (id, txt) => { if(document.getElementById(id)) document.getElementById(id).innerText = txt; }
                if(d.exists) {
                    currentUserData = d.data();
                    safe('userNameDisplay', currentUserData.name); 
                    safe('profNameDisplay', currentUserData.name);
                    safe('mainBalanceDisplay', currentUserData.mainBalance.toFixed(2)); 
                    safe('walletMainDisplay', currentUserData.mainBalance.toFixed(2));
                    safe('rechargePageBalance', (currentUserData.rechargeBalance||0).toFixed(2)); 
                    safe('walletRechargeDisplay', (currentUserData.rechargeBalance||0).toFixed(2));
                    safe('userPlanDisplay', currentUserData.plan || "Free Member");
                    safe('referralCount', currentUserData.totalReferrals || 0);
                    safe('referralEarnings', currentUserData.referralEarnings || 0);
                    
                    // Update profile inputs
                    if(document.getElementById('profNameInput')) document.getElementById('profNameInput').value = currentUserData.name;
                    if(document.getElementById('profPhoneInput')) document.getElementById('profPhoneInput').value = currentUserData.phone;
                    if(document.getElementById('profEmailInput')) document.getElementById('profEmailInput').value = currentUserData.email;
                    if(document.getElementById('profAddressInput')) document.getElementById('profAddressInput').value = currentUserData.address || '';
                    
                    // Update avatar
                    if(currentUserData.avatar) {
                        selectedAvatar = currentUserData.avatar;
                        document.getElementById('currentAvatar').src = selectedAvatar;
                    }
                    
                    // ‚úÖ VIP PACKAGE EXPIRY CHECK
                    if(currentUserData.packageExpiresAt && typeof currentUserData.packageExpiresAt.toDate === 'function') {
                        const expiryDate = currentUserData.packageExpiresAt.toDate();
                        const now = new Date();
                        
                        if(now > expiryDate) {
                            // Package expired, downgrade to free
                            db.collection("users").doc(uid).update({
                                plan: "Free Member",
                                packageExpiresAt: firebase.firestore.FieldValue.delete(),
                                packageId: firebase.firestore.FieldValue.delete()
                            }).then(() => {
                                showSmartToast("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡ßá‡¶∞ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑, ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶´‡ßç‡¶∞‡¶ø ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡•§", "info");
                            });
                        }
                    }
                    
                    // ‚úÖ FIXED REFERRAL LINK
                    if(document.getElementById('referralLink')) {
                        document.getElementById('referralLink').innerText = `https://t.me/TAKA_WALA_TG_BOT?start=ref_${uid}`;
                    }
                    
                    if(d.data().createdAt) {
                        const date = d.data().createdAt.toDate();
                        document.getElementById('joinDate').innerText = date.toLocaleDateString('bn-BD');
                    }
                } else {
                    safe('userNameDisplay', "Guest"); 
                    safe('mainBalanceDisplay', "0.00");
                }
            }, (err) => { 
                console.error("Error syncing user data:", err);
            });
            
            db.collection("settings").doc("system").onSnapshot((d) => { 
                if(d.exists) {
                    systemSettings = d.data();
                    document.getElementById('noticeText').innerText = d.data().noticeText || "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!";
                }
            });
            
            db.collection("settings").doc("payment_numbers").onSnapshot((d) => {
                if(d.exists) {
                    paymentNumbers = d.data();
                    updatePaymentMethodStatus();
                }
            });
            
            // Listen for maintenance mode changes
            db.collection("settings").doc("maintenance").onSnapshot((d) => {
                if(d.exists) {
                    const maintenanceData = d.data();
                    if(maintenanceData.maintenanceMode === true) {
                        maintenanceMode = true;
                        showMaintenanceScreen();
                    } else {
                        maintenanceMode = false;
                        document.getElementById('maintenanceScreen').classList.add('hidden');
                    }
                }
            });
        }

        // ‚úÖ FIXED: LOAD TODAY'S EARNINGS (SOLVED FIREBASE QUERY ERROR)
        async function loadTodayEarnings(uid) {
            try {
                const today = new Date();
                const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ timestamp ‡¶¶‡¶ø‡ßü‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶õ‡¶ø (amount ‡¶è‡¶∞ inequality ‡¶∏‡¶∞‡¶ø‡ßü‡ßá‡¶õ‡¶ø)
                const querySnapshot = await db.collection("history")
                    .where("userId", "==", uid)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .get();
                
                let todayTotal = 0;
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    // ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá amount ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø
                    const amount = parseFloat(data.amount) || 0;
                    if (amount > 0) {
                        todayTotal += amount;
                    }
                });
                
                todayEarnings = todayTotal;
                document.getElementById('todayEarnings').textContent = todayTotal.toFixed(2);
                
                // Update today's earnings in user document
                await db.collection("users").doc(uid).update({
                    todayEarnings: todayTotal
                });
                
            } catch (error) {
                console.error("Error loading today's earnings:", error);
            }
        }

        // ‚úÖ UPDATED RENDER TASKS (VIP FILTER + ONE TIME LOGIC)
        function renderTasks() {
            if(!currentUserId) return;

            const list = document.getElementById('taskListContainer'); 
            if(!list) return;

            // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
            list.innerHTML = `
                <div class="flex flex-col items-center justify-center py-10 opacity-60">
                    <div class="w-10 h-10 border-4 border-slate-200 border-t-slate-800 rounded-full animate-spin mb-3"></div>
                    <p class="text-xs font-bold text-slate-400">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>`;

            // ‡ßß. ‡¶Ü‡¶ó‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡ßã‡¶® ‡¶ï‡ßã‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡ßá‡¶õ‡ßá
            db.collection("task_submissions")
                .where("userId", "==", currentUserId)
                .get()
                .then((submissionSnap) => {
                    
                    const completedTaskIds = new Set();
                    submissionSnap.forEach(doc => {
                        const data = doc.data();
                        if (data.status === 'pending' || data.status === 'approved') {
                            completedTaskIds.add(data.taskId);
                        }
                    });

                    // ‡ß®. ‡¶è‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶¨ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶ø
                    db.collection("tasks").orderBy("createdAt", "desc").onSnapshot((snap) => {
                        list.innerHTML = ''; 
                        
                        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶ö‡ßá‡¶ï
                        const userPlan = currentUserData ? (currentUserData.plan || "Free Member") : "Free Member";
                        
                        // üõë VIP ‡¶≤‡¶ú‡¶ø‡¶ï: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                        let targetType = 'free';
                        if(currentTaskType === 'vip') {
                            if(userPlan.includes('Silver') || userPlan.includes('‡¶∏‡¶ø‡¶≤‡¶≠‡¶æ‡¶∞')) targetType = 'silver';
                            else if(userPlan.includes('Gold') || userPlan.includes('‡¶ó‡ßã‡¶≤‡ßç‡¶°')) targetType = 'gold';
                            else if(userPlan.includes('Platinum') || userPlan.includes('‡¶™‡ßç‡¶≤‡¶æ‡¶ü‡¶ø‡¶®‡¶æ‡¶Æ')) targetType = 'platinum';
                            else targetType = 'no_access'; // ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶®‡ßá‡¶á
                        }

                        let hasTask = false;

                        if(!snap.empty) {
                            snap.forEach(doc => {
                                const t = doc.data();
                                const taskId = doc.id;
                                
                                // ‡ßß. One-Time ‡¶ö‡ßá‡¶ï: ‡¶Ø‡¶¶‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï 'once' ‡¶π‡ßü ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶¨‡¶æ‡¶¶ ‡¶Ø‡¶æ‡¶¨‡ßá
                                if (t.frequency === 'once' && completedTaskIds.has(taskId)) {
                                    return; 
                                }

                                let showTask = false;
                                
                                // ‡ß®. ‡¶´‡ßç‡¶∞‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶≤‡¶ú‡¶ø‡¶ï
                                if(currentTaskType === 'free' && (t.type === 'free' || !t.type)) {
                                    showTask = true;
                                } 
                                // ‡ß©. ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶Æ‡¶ø‡¶≤‡¶§‡ßá ‡¶π‡¶¨‡ßá)
                                else if(currentTaskType === 'vip' && t.type === targetType) {
                                    showTask = true;
                                }

                                if(showTask) {
                                    hasTask = true;

                                    // ‡¶Ü‡¶á‡¶ï‡¶® ‡¶ì ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®
                                    let iconClass = 'ri-links-line'; 
                                    let iconColor = 'text-gray-500';
                                    let bgColor = 'bg-gray-100';

                                    if (t.category === 'youtube') { iconClass = 'ri-youtube-fill'; iconColor = 'text-red-600'; bgColor = 'bg-red-50'; } 
                                    else if (t.category === 'facebook') { iconClass = 'ri-facebook-circle-fill'; iconColor = 'text-blue-600'; bgColor = 'bg-blue-50'; }
                                    else if (t.category === 'telegram') { iconClass = 'ri-telegram-fill'; iconColor = 'text-blue-500'; bgColor = 'bg-blue-50'; }
                                    else if (t.category === 'website') { iconClass = 'ri-global-line'; iconColor = 'text-green-600'; bgColor = 'bg-green-50'; }
                                    else if (t.category === 'app') { iconClass = 'ri-google-play-fill'; iconColor = 'text-green-600'; bgColor = 'bg-green-100'; }

                                    let frequencyBadge = t.frequency === 'once' 
                                        ? '<span class="text-[9px] bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full ml-1 border border-purple-200">‡ßß ‡¶¨‡¶æ‡¶∞</span>' 
                                        : '';

                                    // HTML ‡¶ï‡¶æ‡¶∞‡ßç‡¶°
                                    list.innerHTML += `
                                    <div class="glass-card p-4 rounded-2xl flex justify-between items-center animate__animated animate__fadeInUp mb-3 border border-slate-100 shadow-sm group active:scale-[0.98] transition-all">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 ${bgColor} rounded-full flex items-center justify-center text-2xl ${iconColor}">
                                                <i class="${iconClass}"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-slate-800 text-sm flex items-center">
                                                    ${t.title} ${frequencyBadge}
                                                </h4>
                                                <div class="flex items-center gap-2 mt-1">
                                                    <span class="text-[10px] font-bold bg-slate-100 text-slate-500 px-2 py-0.5 rounded uppercase tracking-wide">${t.category || 'General'}</span>
                                                    <p class="text-[10px] text-slate-400 truncate max-w-[120px] font-bold">‡ß≥${t.reward}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <button onclick="window.completeTask('${taskId}', ${t.reward}, '${t.category || 'general'}', '${t.title}', '${t.desc}', '${t.link || '#'}')" class="bg-slate-800 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg shadow-slate-200 group-hover:bg-green-600 transition-colors">
                                            ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®
                                        </button>
                                    </div>`;
                                }
                            });
                        }

                        // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
                        if(!hasTask) {
                            if(currentTaskType === 'vip' && targetType === 'no_access') {
                                // ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶´‡ßç‡¶∞‡¶ø ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞
                                list.innerHTML = `
                                    <div class="text-center py-10 animate__animated animate__fadeIn">
                                        <img src="https://i.postimg.cc/TwfTZM7Z/award.png" class="w-20 mx-auto mb-4 opacity-50 grayscale">
                                        <h3 class="text-lg font-bold text-slate-600">‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</h3>
                                        <p class="text-xs text-slate-500 mb-4 px-6">‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßá‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</p>
                                        <button onclick="window.showPage('vipScreen')" class="bg-premium text-white px-6 py-3 rounded-xl font-bold shadow-lg animate-pulse">
                                            ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡ßÅ‡¶® üëë
                                        </button>
                                    </div>`;
                            } else {
                                // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á
                                list.innerHTML = `
                                    <div class="text-center py-12 opacity-60">
                                        <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-3">
                                            <i class="ri-clipboard-line text-3xl text-slate-300"></i>
                                        </div>
                                        <p class="font-bold text-slate-400">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á</p>
                                    </div>`;
                            }
                        }
                    });
                });
        }

        // ‚úÖ ENHANCED HISTORY SYSTEM WITH FILTER - FIXED LAYOUT
        window.loadHistory = () => {
            window.showPage('historyScreen');
            document.getElementById('historyListContainer').innerHTML = `
                <div class="history-loading">
                    <div class="animate-pulse">
                        <div class="h-4 bg-slate-200 rounded w-3/4 mx-auto mb-4"></div>
                        <div class="h-20 bg-slate-100 rounded-lg mb-3"></div>
                        <div class="h-20 bg-slate-100 rounded-lg mb-3"></div>
                        <div class="h-20 bg-slate-100 rounded-lg"></div>
                    </div>
                </div>
            `;
            
            loadSimpleHistory('all');
        };
        
        window.filterHistory = (filterType) => {
            currentHistoryFilter = filterType;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}`).classList.add('active');
            
            loadSimpleHistory(filterType);
        };
        
        // ‚úÖ FINAL FIXED: HISTORY LOAD FUNCTION (CENTERED EMPTY + ANIMATED STATUS)
        async function loadSimpleHistory(filterType = 'all') {
            showLoading();
            
            try {
                let query = db.collection("history")
                    .where("userId", "==", currentUserId)
                    .orderBy("timestamp", "desc")
                    .limit(50);
                
                // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
                if(filterType !== 'all') {
                    let typeArray = [];
                    switch(filterType) {
                        case 'deposit': typeArray = ['‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü', 'Deposit']; break;
                        case 'withdraw': typeArray = ['‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®', 'Withdraw']; break;
                        case 'recharge': typeArray = ['‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú', 'Recharge']; break;
                        case 'task': typeArray = ['‡¶ü‡¶æ‡¶∏‡ßç‡¶ï', 'Task', '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®']; break;
                        case 'bonus': typeArray = ['‡¶¨‡ßã‡¶®‡¶æ‡¶∏', 'Bonus', '‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏', '‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏']; break;
                        case 'quiz': typeArray = ['‡¶ï‡ßÅ‡¶á‡¶ú', 'Quiz']; break;
                    }
                    if(typeArray.length > 0) query = query.where("type", "in", typeArray);
                }
                
                const querySnapshot = await query.get();
                const list = document.getElementById('historyListContainer'); 
                if(!list) return; 
                
                list.innerHTML = '';
                
                // 1Ô∏è‚É£ EMPTY STATE (‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá)
                if(querySnapshot.empty) { 
                    list.innerHTML = `
                    <div class="flex flex-col items-center justify-center w-full py-16 text-center animate__animated animate__fadeIn">
                        <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-4 shadow-sm border border-slate-100">
                            <img src="https://i.postimg.cc/VNTvSLRX/transaction-history.png" class="w-10 h-10 opacity-30 grayscale">
                        </div>
                        <h3 class="text-lg font-bold text-slate-500">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</h3>
                        <p class="text-xs text-slate-400 mt-1 max-w-[200px]">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá</p>
                    </div>`; 
                    hideLoading();
                    return; 
                }
                
                querySnapshot.forEach(doc => {
                    const h = doc.data(); 
                    const date = h.date || '---';
                    const time = h.time || '---';
                    
                    // ‡¶Ü‡¶á‡¶ï‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶®
                    let icon = 'https://i.postimg.cc/VNTvSLRX/transaction-history.png';
                    let bgColor = 'bg-slate-100';
                    
                    if(h.type.includes('Recharge') || h.type.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')) { icon = 'https://i.postimg.cc/jjdpNH5b/payment-method.png'; bgColor = 'bg-blue-50'; } 
                    else if(h.type.includes('Withdraw') || h.type.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®')) { icon = 'https://i.postimg.cc/wMdF5zV5/withdraw.png'; bgColor = 'bg-red-50'; } 
                    else if(h.type.includes('Deposit') || h.type.includes('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü')) { icon = 'https://i.postimg.cc/7ZGpHH5q/save-money.png'; bgColor = 'bg-green-50'; } 
                    else if(h.type.includes('Task') || h.type.includes('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')) { icon = 'https://i.postimg.cc/d1sXyCb6/clipboard.png'; bgColor = 'bg-purple-50'; } 
                    else if(h.type.includes('Bonus') || h.type.includes('‡¶¨‡ßã‡¶®‡¶æ‡¶∏')) { icon = 'https://i.postimg.cc/qqLQKVHV/bonus.png'; bgColor = 'bg-yellow-50'; }
                    else if(h.type.includes('Quiz') || h.type.includes('‡¶ï‡ßÅ‡¶á‡¶ú')) { icon = 'https://i.postimg.cc/mkNFY0L0/solution.png'; bgColor = 'bg-pink-50'; }

                    const amount = parseFloat(h.amount) || 0;
                    const amountColor = amount > 0 ? 'text-green-600' : 'text-red-500';
                    const amountSign = amount > 0 ? '+' : '';

                    // 2Ô∏è‚É£ STATUS BADGE (‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶∏‡¶π)
                    let statusBadge = '';
                    if(h.status === 'Pending') {
                        // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶π‡¶≤‡ßá ‡¶ò‡ßÅ‡¶∞‡¶¨‡ßá (Spinning Icon)
                        statusBadge = `
                        <div class="flex items-center gap-1.5 bg-yellow-50 text-yellow-700 px-2.5 py-1 rounded-full border border-yellow-200">
                            <i class="ri-loader-4-line animate-spin text-sm"></i>
                            <span class="text-[10px] font-bold">‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç</span>
                        </div>`;
                    } else if(h.status === 'Success') {
                        statusBadge = `
                        <div class="flex items-center gap-1.5 bg-green-50 text-green-700 px-2.5 py-1 rounded-full border border-green-200">
                            <i class="ri-checkbox-circle-fill text-sm"></i>
                            <span class="text-[10px] font-bold">‡¶∏‡¶´‡¶≤</span>
                        </div>`;
                    } else if(h.status === 'Rejected') {
                        statusBadge = `
                        <div class="flex items-center gap-1.5 bg-red-50 text-red-700 px-2.5 py-1 rounded-full border border-red-200">
                            <i class="ri-close-circle-fill text-sm"></i>
                            <span class="text-[10px] font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</span>
                        </div>`;
                    }

                    // HTML STRUCTURE
                    list.innerHTML += `
                    <div class="history-item glass-card p-4 rounded-2xl mb-3 border border-slate-50 hover:shadow-md transition-all">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 ${bgColor} rounded-full flex items-center justify-center">
                                    <img src="${icon}" class="w-5 h-5">
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-700 text-sm">${h.type}</h4>
                                    <p class="text-[10px] text-slate-400 font-medium">${date} ‚Ä¢ ${time}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="block text-sm font-black ${amountColor}">${amountSign}‡ß≥${Math.abs(amount).toFixed(2)}</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center pt-2 border-t border-dashed border-slate-100">
                            ${statusBadge}
                            
                            <button onclick="window.openHistoryReceipt('${doc.id}')" 
                                class="flex items-center gap-1 text-slate-500 hover:text-blue-600 transition-colors">
                                <span class="text-[10px] font-bold">‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü</span>
                                <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>`;
                });
                hideLoading();
            } catch (error) {
                console.error("Error loading history:", error);
                document.getElementById('historyListContainer').innerHTML = `
                <div class="flex flex-col items-center justify-center py-10 text-center">
                    <p class="text-red-400 font-bold text-sm">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
                    <button onclick="window.loadHistory()" class="mt-3 bg-slate-100 text-slate-700 px-4 py-2 rounded-lg text-xs font-bold">‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>`;
                hideLoading();
            }
        }

        // ‚úÖ OPEN PROFESSIONAL RECEIPT (WIDE & COPYABLE)
        async function openHistoryReceipt(docId) {
            showLoading();
            try {
                const doc = await db.collection("history").doc(docId).get();
                if (!doc.exists) {
                    showSmartToast("‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø", "error");
                    hideLoading();
                    return;
                }

                const data = doc.data();
                
                // ‡¶Ü‡¶á‡¶ï‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
                let statusColor = "text-yellow-600";
                let statusBg = "bg-yellow-50";
                let statusIcon = '<i class="ri-loader-4-line animate-spin"></i>';
                
                if (data.status === "Success") {
                    statusColor = "text-green-600";
                    statusBg = "bg-green-50";
                    statusIcon = '<i class="ri-checkbox-circle-fill"></i>';
                } else if (data.status === "Rejected") {
                    statusColor = "text-red-600";
                    statusBg = "bg-red-50";
                    statusIcon = '<i class="ri-close-circle-fill"></i>';
                }

                // ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶ì ‡¶∏‡¶Æ‡ßü ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü
                const fullDate = `${data.date} | ${data.time}`;
                const trxID = doc.id.toUpperCase(); // ‡¶°‡¶ï‡ßÅ‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¨‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø
                const method = data.method || data.paymentMethod || "N/A";
                const sender = data.phone || data.accountNumber || "N/A";

                hideLoading();

                // üî• SWEETALERT HTML STRUCTURE
                Swal.fire({
                    html: `
                        <div class="receipt-box mx-auto">
                            <div class="receipt-header">
                                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
                                    <img src="https://i.postimg.cc/VNTvSLRX/transaction-history.png" class="w-8 h-8">
                                </div>
                                <h2 class="text-xl font-bold uppercase tracking-wide">Takawala Official</h2>
                                <p class="text-xs opacity-90 mt-1"> ‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü</p>
                                
                                <div class="mt-4 bg-white/20 rounded-xl p-3 backdrop-blur-sm">
                                    <p class="text-xs text-white/90">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</p>
                                    <h1 class="text-3xl font-black text-white mt-1">‡ß≥${parseFloat(data.amount).toFixed(2)}</h1>
                                    <div class="inline-flex items-center gap-1 mt-2 px-3 py-1 rounded-full bg-white text-xs font-bold ${statusColor.replace('text-', 'text-')}">
                                        ${statusIcon} ${data.status}
                                    </div>
                                </div>
                            </div>

                            <div class="receipt-body text-left">
                                
                                <div class="receipt-row">
                                    <span class="receipt-label">Trx ID</span>
                                    <div class="receipt-value">
                                        <span id="copyTrx">${trxID}</span>
                                        <button class="copy-btn-small" onclick="copyToClipboard('${trxID}')">
                                            <i class="ri-file-copy-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="receipt-row">
                                    <span class="receipt-label">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®</span>
                                    <span class="receipt-value text-blue-600">${data.type}</span>
                                </div>

                                <div class="receipt-row">
                                    <span class="receipt-label">‡¶Æ‡ßá‡¶•‡¶° / ‡¶ó‡ßá‡¶ü‡¶ì‡ßü‡ßá</span>
                                    <span class="receipt-value">${method}</span>
                                </div>

                                <div class="receipt-row">
                                    <span class="receipt-label">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</span>
                                    <div class="receipt-value">
                                        <span>${sender}</span>
                                        <button class="copy-btn-small" onclick="copyToClipboard('${sender}')">
                                            <i class="ri-file-copy-line"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="receipt-row">
                                    <span class="receipt-label">‡¶∏‡¶Æ‡ßü</span>
                                    <span class="receipt-value text-xs">${fullDate}</span>
                                </div>
                                
                                ${data.newBalance ? `
                                <div class="receipt-row">
                                    <span class="receipt-label">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span>
                                    <span class="receipt-value font-black text-slate-600">‡ß≥${parseFloat(data.newBalance).toFixed(2)}</span>
                                </div>` : ''}

                            </div>

                            <div class="receipt-footer">
                                <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="h-6 mx-auto mb-2 opacity-50 grayscale">
                                <p class="text-[10px] text-slate-400 font-medium mb-1">
                                    ‡¶è‡¶á ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£‡¶™‡¶§‡ßç‡¶∞‡•§ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßá TRXID ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
                                </p>
                                <h3 class="text-xs font-bold text-slate-300 tracking-[3px] mt-2">CREATED BY TAKAWALA</h3>
                            </div>
                        </div>
                    `,
                    showConfirmButton: true,
                    confirmButtonText: '<i class="ri-download-2-line mr-1"></i> ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®',
                    confirmButtonColor: '#059669',
                    showCloseButton: true,
                    background: 'transparent', // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ü‡ßç‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡¶™‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡ßü
                    customClass: {
                        popup: 'receipt-popup-container' // ‡¶∏‡¶ø‡¶è‡¶∏‡¶è‡¶∏ ‡¶¶‡¶ø‡ßü‡ßá ‡¶â‡¶á‡¶°‡¶• ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶π‡¶¨‡ßá
                    },
                    didOpen: () => {
                        // ‡¶∏‡ßÅ‡¶á‡¶ü‡¶è‡¶≤‡¶æ‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
                        const popup = Swal.getPopup();
                        popup.style.padding = '0';
                        popup.style.overflow = 'visible';
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶¨‡¶æ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡¶∏
                        showSmartToast('‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'success');
                    }
                });

            } catch (error) {
                console.error(error);
                showSmartToast("‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ", "error");
                hideLoading();
            }
        }

        // ‚úÖ HELPER: COPY FUNCTION
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 1500,
                    timerProgressBar: true
                });
                Toast.fire({
                    icon: 'success',
                    title: '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'
                });
            }).catch(err => {
                console.error('Copy failed', err);
            });
        }

        // ‚úÖ LOAD QUIZ FROM FIREBASE (DYNAMIC)
        window.showQuizQuestions = async (type) => {
            // ‡ßß. ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ö‡ßá‡¶ï
            if(currentUserData) {
                const today = new Date().toDateString();
                const lastQuizDateField = `lastQuizDate_${type}`;
                const lastQuizDate = currentUserData[lastQuizDateField] ? 
                    new Date(currentUserData[lastQuizDateField].toDate()).toDateString() : null;
                
                if(lastQuizDate === today) {
                    showSmartToast(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ${type} ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ñ‡ßá‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            currentQuizType = type;
            selectedAnswers = {};
            currentLoadedQuizzes = []; // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
            
            // ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            const quizTitles = {
                general: '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡ßÅ‡¶á‡¶ú',
                math: '‡¶Æ‡ßç‡¶Ø‡¶æ‡¶• ‡¶ï‡ßÅ‡¶á‡¶ú',
                science: '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú',
                islamic: '‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßÅ‡¶á‡¶ú'
            };
            document.getElementById('quizTypeTitle').textContent = quizTitles[type] || '‡¶ï‡ßÅ‡¶á‡¶ú';
            
            // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            const container = document.getElementById('quizQuestionsContainer');
            container.innerHTML = '<div class="text-center py-10"><div class="w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto"></div><p class="mt-2 text-slate-400 text-xs">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>';
            document.getElementById('submitQuizBtn').classList.add('hidden');
            
            window.switchQuizTab('questions');

            try {
                // ‡ß®. ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶Ü‡¶®‡¶æ
                const snapshot = await db.collection("quizzes").where("category", "==", type).get();

                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="text-center py-10 opacity-60">
                            <i class="ri-file-list-3-line text-4xl text-slate-300"></i>
                            <p class="text-slate-500 mt-2 font-bold">‡¶è‡¶á ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶§‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶®‡ßá‡¶á</p>
                            <button onclick="window.switchQuizTab('types')" class="mt-4 bg-slate-100 text-slate-700 px-4 py-2 rounded-lg font-bold text-xs">‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
                        </div>`;
                    return;
                }

                // ‡ß©. ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ
                snapshot.forEach(doc => {
                    currentLoadedQuizzes.push({ id: doc.id, ...doc.data() });
                });

                // ‡ß™. ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
                let questionsHtml = '';
                currentLoadedQuizzes.forEach((q, qIndex) => {
                    let optionsHtml = '';
                    q.options.forEach((option, oIndex) => {
                        optionsHtml += `
                            <div class="flex items-center p-3 bg-white rounded-xl border border-slate-200 cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition mb-2" onclick="window.selectQuizAnswer(${qIndex}, ${oIndex})">
                                <input type="radio" name="quizQuestion${qIndex}" id="q${qIndex}o${oIndex}" class="mr-3 accent-purple-600 w-4 h-4">
                                <label for="q${qIndex}o${oIndex}" class="flex-1 cursor-pointer font-medium text-slate-700 text-sm">${option}</label>
                            </div>
                        `;
                    });
                    
                    questionsHtml += `
                        <div class="mb-6 p-4 bg-slate-50 rounded-2xl border border-slate-100 shadow-sm">
                            <h4 class="font-bold text-slate-800 mb-3 text-sm flex items-start gap-2">
                                <span class="bg-white text-purple-600 px-2 py-0.5 rounded shadow-sm text-xs border border-purple-100">Q${qIndex + 1}</span> 
                                ${q.question}
                            </h4>
                            <div class="space-y-2">
                                ${optionsHtml}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = questionsHtml;
                document.getElementById('submitQuizBtn').classList.remove('hidden');
                
                startQuizTimer();

            } catch (error) {
                console.error("Quiz Load Error:", error);
                container.innerHTML = '<div class="text-center text-red-500 py-10 font-bold">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>';
            }
        };

        // ‚úÖ DYNAMIC QUIZ SUBMIT
        window.submitQuiz = async () => {
            const totalQuestions = currentLoadedQuizzes.length;
            const answeredCount = Object.keys(selectedAnswers).length;
            
            // ‡¶∏‡¶¨ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶®‡¶æ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶Ü‡¶ü‡¶ï‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã, ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã
            if(answeredCount < totalQuestions) { 
                showSmartToast('‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®', 'error'); 
                return; 
            }
            
            // ‡ßß. ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ó‡¶£‡¶®‡¶æ
            let correctAnswers = 0;
            currentLoadedQuizzes.forEach((q, index) => {
                // Database-‡¶è answer ‡¶π‡¶≤‡ßã index (0, 1, 2, 3)
                if(selectedAnswers[index] === q.answer) {
                    correctAnswers++;
                }
            });
            
            const reward = correctAnswers * 0.25; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá ‡ß¶.‡ß®‡ß´ ‡¶ü‡¶æ‡¶ï‡¶æ
            
            if(reward === 0) { 
                showSmartToast('‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶è‡¶ï‡¶ü‡¶ø ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ì ‡¶∏‡¶†‡¶ø‡¶ï ‡¶π‡ßü‡¶®‡¶ø üòî', 'error'); 
                return; 
            }

            // ‡ß®. ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞)
            onAdCompleted = async () => {
                showLoading();
                try {
                    const userRef = db.collection("users").doc(currentUserId);
                    await userRef.update({
                        mainBalance: firebase.firestore.FieldValue.increment(reward),
                        totalEarnings: firebase.firestore.FieldValue.increment(reward),
                        totalTasks: firebase.firestore.FieldValue.increment(1),
                        todayEarnings: firebase.firestore.FieldValue.increment(reward),
                        [`lastQuizDate_${currentQuizType}`]: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    await db.collection("history").add({
                        userId: currentUserId, 
                        type: "‡¶ï‡ßÅ‡¶á‡¶ú", 
                        amount: reward, 
                        status: "Success",
                        details: `${currentQuizType} ‡¶ï‡ßÅ‡¶á‡¶ú - ${correctAnswers}‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï`, 
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'), 
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    todayEarnings += reward;
                    document.getElementById('todayEarnings').textContent = todayEarnings.toFixed(2);
                    
                    showSmartToast(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ${correctAnswers}‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡ß≥${reward} ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶® üéâ`, 'success');
                    hideLoading();
                    
                    if(quizTimer) clearInterval(quizTimer);
                    
                    // ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶™‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                    document.getElementById('quizQuestionsContainer').innerHTML = `
                        <div class="text-center p-8">
                            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                                <i class="ri-trophy-fill text-4xl text-green-600"></i>
                            </div>
                            <h4 class="text-2xl font-bold text-green-700 mb-2">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶´‡¶≤!</h4>
                            <p class="text-slate-500 font-bold mb-6">‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: ${correctAnswers}/${totalQuestions}</p>
                            <div class="bg-green-50 p-4 rounded-xl border border-green-200 inline-block mb-6">
                                <p class="text-sm text-green-800">‡¶Æ‡ßã‡¶ü ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞</p>
                                <p class="text-3xl font-black text-green-600">‡ß≥${reward}</p>
                            </div>
                            <br>
                            <button onclick="window.switchQuizTab('types')" class="bg-slate-800 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:scale-105 transition">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ñ‡ßá‡¶≤‡ßÅ‡¶®</button>
                        </div>`;
                    document.getElementById('submitQuizBtn').classList.add('hidden');
                    
                } catch (error) { 
                    console.error(error);
                    showSmartToast('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error'); 
                    hideLoading(); 
                }
            };
            
            showInterstitialAd();
        };

        // ‚úÖ MISSING FUNCTION 1: SWITCH QUIZ TAB
        window.switchQuizTab = (tab) => {
            const typesSection = document.getElementById('quizTypesSection');
            const questionsSection = document.getElementById('quizQuestionsSection');
            const btnTypes = document.getElementById('tabQuizTypes');
            const btnQuestions = document.getElementById('tabQuizQuestions');

            if (tab === 'types') {
                typesSection.classList.remove('hidden');
                questionsSection.classList.add('hidden');
                
                // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                btnTypes.className = 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow';
                btnQuestions.className = 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            } else {
                typesSection.classList.add('hidden');
                questionsSection.classList.remove('hidden');
                
                // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                btnQuestions.className = 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow';
                btnTypes.className = 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            }
        };

        // ‚úÖ MISSING FUNCTION 2: START QUIZ TIMER
        window.startQuizTimer = () => {
            if(quizTimer) clearInterval(quizTimer);
            
            let timeLeft = 60; // ‡ß¨‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡¶Æ‡ßü
            const timerElement = document.getElementById('quizTimer');
            timerElement.innerText = timeLeft;
            timerElement.classList.remove('bg-red-500');
            timerElement.classList.add('bg-blue-500');

            quizTimer = setInterval(() => {
                timeLeft--;
                timerElement.innerText = timeLeft;

                // ‡¶∏‡¶Æ‡ßü ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶≤‡ßá ‡¶≤‡¶æ‡¶≤ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá
                if(timeLeft <= 10) {
                    timerElement.classList.remove('bg-blue-500');
                    timerElement.classList.add('bg-red-500');
                }

                if(timeLeft <= 0) {
                    clearInterval(quizTimer);
                    showSmartToast('‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑! ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'warning');
                    window.submitQuiz(); // ‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü
                }
            }, 1000);
        };

        // ‚úÖ MISSING FUNCTION 3: SELECT ANSWER
        window.selectQuizAnswer = (qIndex, oIndex) => {
            // ‡¶∞‡ßá‡¶°‡¶ø‡¶ì ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
            const radio = document.getElementById(`q${qIndex}o${oIndex}`);
            if(radio) radio.checked = true;
            
            // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ ‡¶∞‡¶æ‡¶ñ‡¶æ
            selectedAnswers[qIndex] = oIndex;
        };

        // ‚úÖ PROFILE FUNCTIONS
        window.showAvatarSelector = () => {
            document.getElementById('avatarModal').classList.remove('hidden');
        };
        
        window.closeAvatarModal = () => {
            document.getElementById('avatarModal').classList.add('hidden');
        };
        
        window.selectAvatar = (avatarUrl) => {
            selectedAvatar = avatarUrl;
            document.getElementById('currentAvatar').src = avatarUrl;
            window.closeAvatarModal();
            showSmartToast('‡¶è‡¶≠‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
        };
        
        window.updateProfile = async () => { 
            try {
                showLoading();
                await db.collection("users").doc(currentUserId).update({ 
                    name: document.getElementById('profNameInput').value, 
                    email: document.getElementById('profEmailInput').value,
                    address: document.getElementById('profAddressInput').value,
                    avatar: selectedAvatar
                }); 
                
                document.getElementById('currentAvatar').src = selectedAvatar;
                
                showSmartToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success'); 
                hideLoading();
            } catch (e) {
                showSmartToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        window.showChangePassword = async () => {
            const { value: newPassword } = await Swal.fire({
                title: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®',
                input: 'password',
                inputLabel: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (‡ß¨+ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)',
                inputPlaceholder: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®',
                showCancelButton: true,
                confirmButtonText: '‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                inputValidator: (value) => {
                    if (!value || value.length < 6) {
                        return '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá';
                    }
                }
            });
            
            if (newPassword) {
                try {
                    showLoading();
                    const user = auth.currentUser;
                    await user.updatePassword(newPassword);
                    showSmartToast('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶´‡¶≤', 'success');
                    hideLoading();
                } catch (error) {
                    showSmartToast('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                    hideLoading();
                }
            }
        };

        // ‚úÖ UPDATED TASK COMPLETION - 5 SECONDS TIMER
        window.completeTask = async (taskId, reward, taskType, title, description, link) => {
            if(!currentUserData) return;
            
            currentTaskInfo = {
                taskId,
                reward,
                taskType,
                title,
                description,
                link
            };
            
            showInterstitialAd();
            
            setTimeout(() => {
                window.open(link, '_blank');
            }, 500);
            
            startTaskTimer();
            
            showSmartToast('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'info');
        };
        
        function startTaskTimer() {
            if(taskTimer) clearInterval(taskTimer);
            
            // ‚úÖ CHANGED TO 5 SECONDS
            let timeLeft = 5;
            const startTime = Date.now();
            
            taskTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const remaining = timeLeft - elapsed;
                
                if(remaining <= 0) {
                    clearInterval(taskTimer);
                    showProofSubmissionForm();
                }
            }, 1000);
            
            setTimeout(() => {
                if(taskTimer) {
                    clearInterval(taskTimer);
                }
                showProofSubmissionForm();
            }, timeLeft * 1000);
        }
        
        // ‚úÖ UPDATED SUBMIT PROOF
        window.submitProof = async () => {
            if(!currentTaskInfo) return;
            
            const proof1 = document.getElementById('proof1')?.value.trim();
            const proof2 = document.getElementById('proof2')?.value.trim();
            
            if(!proof1 || !proof2) {
                showSmartToast('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            showLoading();
            showSmartToast('‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                // ‡ßß. ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Æ‡ßá‡¶á‡¶® ‡¶°‡¶æ‡¶ü‡¶æ
                await db.collection("task_submissions").add({ 
                    userId: currentUserId, 
                    taskId: currentTaskInfo.taskId,
                    taskTitle: currentTaskInfo.title,
                    taskType: currentTaskInfo.taskType || 'general',
                    reward: currentTaskInfo.reward,
                    userName: currentUserData.name,
                    userPhone: currentUserData.phone,
                    proofText: proof1,
                    screenshotUrl: proof2,
                    status: "pending",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // ‡ß®. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶§‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®",
                    amount: currentTaskInfo.reward,
                    status: "Pending",
                    details: `${currentTaskInfo.title} - ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ö‡¶≤‡¶õ‡ßá`,
                    taskId: currentTaskInfo.taskId,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // ‡ß©. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
                const telegramMessage = `üîî *‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüéØ *‡¶ü‡¶æ‡¶∏‡ßç‡¶ï:* ${currentTaskInfo.title}\nüí∞ *‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞:* ‡ß≥${currentTaskInfo.reward}\nüìù *‡¶™‡ßç‡¶∞‡ßÅ‡¶´:* ${proof1}\nüñº *‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü:* ${proof2}`;
                await sendTelegramNotification(telegramMessage);
                
                showSmartToast('‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®', 'success');
                hideLoading();
                window.closeProofModal();
                
                // ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ
                renderTasks();
                
            } catch (e) {
                console.error(e);
                showSmartToast('‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };

        // ‚úÖ WALLET FUNCTIONS WITH LIMITS AND SCHEDULE
        window.calculateDepositVAT = () => {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            const vatPercentage = systemSettings.vatPercentage || 10;
            const vat = amount * (vatPercentage / 100);
            const total = amount + vat;
            document.getElementById('vatCalculation').innerHTML = `‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (${vatPercentage}%): ‡ß≥${vat.toFixed(2)} | ‡¶Æ‡ßã‡¶ü: ‡ß≥${total.toFixed(2)}`;
        };
        
        window.calculateWithdrawVAT = () => {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            const vatPercentage = systemSettings.vatPercentage || 10;
            const vat = amount * (vatPercentage / 100);
            const received = amount - vat;
            document.getElementById('withdrawVat').innerHTML = `‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (${vatPercentage}%): ‡ß≥${vat.toFixed(2)} | ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§: ‡ß≥${received.toFixed(2)}`;
        };
        
        window.calculateRechargeFee = () => {
            const amount = parseFloat(document.getElementById('rechAmount').value) || 0;
            const fee = systemSettings.rechargeFee || 5;
            const total = amount + fee;
            document.getElementById('rechargeFee').innerHTML = `‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: ‡ß≥${fee.toFixed(2)} | ‡¶Æ‡ßã‡¶ü: ‡ß≥${total.toFixed(2)}`;
        };

        // ‚úÖ UPDATED DEPOSIT FUNCTION
        window.submitDeposit = async () => {
            const trxId = document.getElementById('depositTrxId').value.trim();
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const method = document.getElementById('selectedDepositMethod').value;
            
            if(!trxId || !amount || amount <= 0) {
                showSmartToast('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            if(!method) {
                showSmartToast('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const minDeposit = systemSettings.minDeposit || 50;
            if(amount < minDeposit) {
                showSmartToast(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minDeposit}`, 'error');
                return;
            }
            
            showLoading();
            showSmartToast('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const vatPercentage = systemSettings.vatPercentage || 10;
                const vat = amount * (vatPercentage / 100);
                const totalAmount = amount + vat;
                
                // Save to pending_requests
                await db.collection("pending_requests").add({ 
                    userId: currentUserId, 
                    type: "‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü", 
                    amount: amount, 
                    vat: vat,
                    totalAmount: totalAmount,
                    trxId: trxId,
                    method: method,
                    userName: currentUserData.name,
                    userPhone: currentUserData.phone,
                    status: "Pending",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // ‚úÖ ADDED: Save to history as well
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü",
                    amount: amount,
                    status: "Pending",
                    details: `${method} - TrxID: ${trxId}`,
                    trxId: trxId,
                    method: method,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Send Telegram notification
                const telegramMessage = `üí∞ *‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüí≥ *‡¶Æ‡ßá‡¶•‡¶°:* ${method}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüßæ *TrxID:* ${trxId}\nüìä *‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü:* ‡ß≥${vat.toFixed(2)}\nüí∞ *‡¶Æ‡ßã‡¶ü:* ‡ß≥${totalAmount.toFixed(2)}`;
                await sendTelegramNotification(telegramMessage);
                
                showSmartToast('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®', 'success');
                hideLoading();
                
                document.getElementById('depositTrxId').value = '';
                document.getElementById('depositAmount').value = '';
                window.calculateDepositVAT();
                
            } catch (e) {
                showSmartToast('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        // ‚úÖ UPDATED WITHDRAW FUNCTION WITH SCHEDULE
        window.submitWithdraw = async () => {
            const number = document.getElementById('withdrawNumber').value.trim();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const method = document.getElementById('selectedWithdrawMethod').value;
            
            if(!number || !amount || amount <= 0) {
                showSmartToast('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            if(!method) {
                showSmartToast('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const minWithdraw = systemSettings.minWithdraw || 50;
            const maxWithdraw = systemSettings.maxWithdraw || 5000;
            
            if(amount < minWithdraw) {
                showSmartToast(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minWithdraw}`, 'error');
                return;
            }
            
            if(amount > maxWithdraw) {
                showSmartToast(`‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${maxWithdraw}`, 'error');
                return;
            }
            
            if(!currentUserData) {
                showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.mainBalance < amount) {
                showSmartToast('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + currentUserData.mainBalance.toFixed(2), 'error');
                return;
            }
            
            const isFreeUser = currentUserData.plan === "Free Member" || currentUserData.plan.includes("Free");
            if(isFreeUser) {
                const referralCount = currentUserData.totalReferrals || 0;
                if(referralCount < 3) {
                    showSmartToast(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ${referralCount}‡•§ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß©‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            let dailyLimit = 1;
            if(!isFreeUser) {
                dailyLimit = 2;
            }
            
            if(userWithdrawCount >= dailyLimit) {
                showSmartToast(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ${userWithdrawCount} ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ${dailyLimit} ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`, 'error');
                return;
            }
            
            const vatPercentage = systemSettings.vatPercentage || 10;
            const vat = amount * (vatPercentage / 100);
            const received = amount - vat;
            
            // ‚úÖ CHECK WITHDRAWAL SCHEDULE
            const withinSchedule = isWithinWithdrawalSchedule();
            
            showLoading();
            showSmartToast('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const userRef = db.collection("users").doc(currentUserId);
                await userRef.update({
                    mainBalance: firebase.firestore.FieldValue.increment(-amount),
                    totalWithdraw: firebase.firestore.FieldValue.increment(amount)
                });
                
                await db.collection("pending_requests").add({ 
                    userId: currentUserId, 
                    type: "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®", 
                    amount: amount, 
                    vat: vat,
                    receivedAmount: received,
                    accountNumber: number,
                    method: method,
                    userName: currentUserData.name,
                    userPhone: currentUserData.phone,
                    status: "Pending",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®",
                    amount: -amount,
                    status: "Pending",
                    details: `${method} - ${number}`,
                    vat: vat,
                    receivedAmount: received,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                userWithdrawCount++;
                
                // Send Telegram notification
                const telegramMessage = `üí∏ *‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüí≥ *‡¶Æ‡ßá‡¶•‡¶°:* ${method}\nüìû *‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü:* ${number}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüìä *‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü:* ‡ß≥${vat.toFixed(2)}\nüí∞ *‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§:* ‡ß≥${received.toFixed(2)}\n‚è∞ *‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÇ‡¶ö‡ßÄ:* ${withinSchedule ? '‡¶≠‡¶ø‡¶§‡¶∞‡ßá' : '‡¶¨‡¶æ‡¶á‡¶∞‡ßá'}`;
                await sendTelegramNotification(telegramMessage);
                
                let successMessage = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®';
                if(!withinSchedule) {
                    successMessage += '\n\n‡¶®‡ßã‡¶ü‡¶ø‡¶∂: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶¶‡¶ø‡¶¨‡¶∏‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§';
                }
                
                showSmartToast(successMessage, 'success');
                hideLoading();
                
                document.getElementById('withdrawNumber').value = '';
                document.getElementById('withdrawAmount').value = '';
                window.calculateWithdrawVAT();
                
            } catch (e) {
                showSmartToast('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        // ‚úÖ UPDATED RECHARGE FUNCTION WITH SCHEDULE
        window.submitRecharge = async () => { 
            const phone = document.getElementById('rechPhone').value.trim();
            const amount = parseFloat(document.getElementById('rechAmount').value);
            const operator = document.getElementById('selectedOperator').value;
            
            if(!phone || !amount || amount <= 0) {
                showSmartToast('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            const minRecharge = systemSettings.minRecharge || 20;
            if(amount < minRecharge) {
                showSmartToast(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minRecharge}`, 'error');
                return;
            }
            
            const fee = systemSettings.rechargeFee || 5;
            const totalAmount = amount + fee;
            
            if(!currentUserData) {
                showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.rechargeBalance < totalAmount) {
                showSmartToast('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + (currentUserData.rechargeBalance || 0).toFixed(2), 'error');
                return;
            }
            
            const isFreeUser = currentUserData.plan === "Free Member" || currentUserData.plan.includes("Free");
            if(isFreeUser) {
                const referralCount = currentUserData.totalReferrals || 0;
                if(referralCount < 3) {
                    showSmartToast(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ${referralCount}‡•§ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß©‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            let dailyLimit = 2;
            if(!isFreeUser) {
                dailyLimit = 3;
            }
            
            if(userRechargeCount >= dailyLimit) {
                showSmartToast(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ${userRechargeCount} ‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ${dailyLimit} ‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`, 'error');
                return;
            }
            
            // ‚úÖ CHECK RECHARGE SCHEDULE
            const withinSchedule = isWithinWithdrawalSchedule();
            
            showLoading();
            showSmartToast('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const userRef = db.collection("users").doc(currentUserId);
                await userRef.update({
                    rechargeBalance: firebase.firestore.FieldValue.increment(-totalAmount)
                });
                
                await db.collection("recharge_requests").add({ 
                    userId: currentUserId, 
                    phone: phone, 
                    amount: amount, 
                    fee: fee,
                    totalAmount: totalAmount,
                    operator: operator,
                    status: 'Pending', 
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }); 
                
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú",
                    amount: -totalAmount,
                    status: "Pending",
                    details: `${operator} - ${phone}`,
                    fee: fee,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                userRechargeCount++;
                
                // Send Telegram notification
                const telegramMessage = `üì± *‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüìû *‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞:* ${phone}\nüè¢ *‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞:* ${operator}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüìä *‡¶´‡¶ø:* ‡ß≥${fee}\nüí∞ *‡¶Æ‡ßã‡¶ü:* ‡ß≥${totalAmount}\n‚è∞ *‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÇ‡¶ö‡ßÄ:* ${withinSchedule ? '‡¶≠‡¶ø‡¶§‡¶∞‡ßá' : '‡¶¨‡¶æ‡¶á‡¶∞‡ßá'}`;
                await sendTelegramNotification(telegramMessage);
                
                let successMessage = '‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                if(!withinSchedule) {
                    successMessage += '\n\n‡¶®‡ßã‡¶ü‡¶ø‡¶∂: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶¶‡¶ø‡¶¨‡¶∏‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§';
                }
                
                showSmartToast(successMessage, 'success'); 
                hideLoading();
                
                document.getElementById('rechPhone').value = '';
                document.getElementById('rechAmount').value = '';
                window.calculateRechargeFee();
                
            } catch (e) {
                showSmartToast('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        window.transferBalance = async () => {
            const am = parseFloat(document.getElementById('transferAmount').value);
            if(!am || am <= 0) {
                showSmartToast('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', 'error');
                return;
            }
            
            if(!currentUserData) {
                showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.mainBalance < am) {
                showSmartToast('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + currentUserData.mainBalance.toFixed(2), 'error');
                return;
            }
            
            showLoading();
            showSmartToast('‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const userRef = db.collection("users").doc(currentUserId);
                
                await userRef.update({
                    mainBalance: firebase.firestore.FieldValue.increment(-am),
                    rechargeBalance: firebase.firestore.FieldValue.increment(am)
                });
                
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞",
                    amount: am,
                    status: "Success",
                    details: "‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showSmartToast(`‡ß≥${am} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'success');
                hideLoading();
                
                document.getElementById('transferAmount').value = '';
                
            } catch (e) {
                showSmartToast('‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };

        // ‚úÖ SUMMARY FUNCTIONS
        async function loadSummary(uid) {
            try {
                showLoading();
                const userDoc = await db.collection("users").doc(uid).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    document.getElementById('totalEarnings').innerText = (data.totalEarnings || 0).toFixed(2);
                    document.getElementById('totalDeposit').innerText = (data.totalDeposit || 0).toFixed(2);
                    document.getElementById('totalWithdraw').innerText = (data.totalWithdraw || 0).toFixed(2);
                    document.getElementById('totalTasks').innerText = data.totalTasks || '0';
                    document.getElementById('summaryPlan').innerText = data.plan || 'Free';
                    document.getElementById('totalReferrals').innerText = data.totalReferrals || '0';
                    document.getElementById('referralCount').innerText = data.totalReferrals || '0';
                    document.getElementById('referralEarnings').innerText = data.referralEarnings || 0;
                    document.getElementById('todayEarnings').innerText = (data.todayEarnings || 0).toFixed(2);
                    todayEarnings = data.todayEarnings || 0;
                    
                    const tasksSnap = await db.collection("tasks").get();
                    document.getElementById('activeTasks').innerText = tasksSnap.size || '0';
                    
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    document.getElementById('dailyBonusStatus').innerText = lastBonus === today ? '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
                }
                hideLoading();
            } catch (e) {
                console.error("Error loading summary:", e);
                hideLoading();
            }
        }

        async function checkDailyBonus(uid) {
            try {
                const userDoc = await db.collection("users").doc(uid).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    
                    if(lastBonus === today) {
                        document.getElementById('dailyBonusStatus').innerText = '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                    } else {
                        document.getElementById('dailyBonusStatus').innerText = '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
                    }
                }
            } catch (e) {
                console.error("Error checking daily bonus:", e);
            }
        }

        // ‚úÖ UPDATED: DAILY BONUS
        window.showDailyBonus = async () => {
            if(!currentUserId) return;
            try {
                const userDoc = await db.collection("users").doc(currentUserId).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    if(lastBonus === today) { 
                        showSmartToast('‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú‡¶ï‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®', 'info'); 
                        return; 
                    }
                    
                    const bonusAmount = Math.floor(2 + Math.random() * 2);
                    const result = await Swal.fire({
                        title: '‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏',
                        html: `‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <b>‡ß≥${bonusAmount}</b><br>‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`,
                        showCancelButton: true, 
                        confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶¨', 
                        confirmButtonColor: '#059669'
                    });
                    
                    if (result.isConfirmed) {
                        onAdCompleted = async () => {
                            showLoading();
                            const userRef = db.collection("users").doc(currentUserId);
                            await userRef.update({
                                mainBalance: firebase.firestore.FieldValue.increment(bonusAmount),
                                totalEarnings: firebase.firestore.FieldValue.increment(bonusAmount),
                                lastDailyBonus: firebase.firestore.FieldValue.serverTimestamp(),
                                todayEarnings: firebase.firestore.FieldValue.increment(bonusAmount)
                            });
                            todayEarnings += bonusAmount;
                            document.getElementById('todayEarnings').textContent = todayEarnings.toFixed(2);
                            await db.collection("history").add({
                                userId: currentUserId, 
                                type: "‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏", 
                                amount: bonusAmount, 
                                status: "Success",
                                details: "‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶ø‡¶§ ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏", 
                                date: new Date().toLocaleDateString('bn-BD'),
                                time: new Date().toLocaleTimeString('bn-BD'), 
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            showSmartToast(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡ß≥${bonusAmount} ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®!`, 'success');
                            checkDailyBonus(currentUserId);
                            hideLoading();
                        };
                        showInterstitialAd();
                    }
                }
            } catch (e) { 
                showSmartToast('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error'); 
            }
        };

        // ‚úÖ OTHER FUNCTIONS
        window.copyReferralLink = () => {
            const link = document.getElementById('referralLink').innerText;
            navigator.clipboard.writeText(link);
            showSmartToast('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
        };
        
        window.openSupport = () => {
            window.open('https://t.me/TAKAR_WALA_ADMIN', '_blank');
        };
        
        window.showDriveOffer = () => {
            window.showPage('driveOfferScreen');
        };
        
        window.logout = () => {
            auth.signOut();
            showSmartToast('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤', 'success');
            document.getElementById('globalChatIcon').style.display = 'none';
            document.getElementById('twaiChatbotIcon').style.display = 'none';
        };
        
        // ‚úÖ DYNAMIC RULES SHOW FUNCTION
        window.showRules = (title) => {
            // ‡ßß. ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            let ruleKey = 'appRules'; // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶®‡¶ø‡ßü‡¶Æ
            let headerTitle = title + ' ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ';

            // ‡ß®. ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßá ‡¶¨‡ßÅ‡¶ù‡¶¨ ‡¶ï‡ßã‡¶® ‡¶®‡¶ø‡ßü‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶π‡¶¨‡ßá
            if (title.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')) {
                ruleKey = 'rulesRecharge';
            } else if (title.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®') || title.includes('‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®')) {
                ruleKey = 'rulesWithdraw';
            } else if (title.includes('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')) {
                ruleKey = 'rulesTask';
            }

            // ‡ß©. ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ø‡ßü‡¶Æ ‡¶Ü‡¶®‡¶æ
            const rulesContent = systemSettings[ruleKey] 
                ? `<div class="text-left text-sm space-y-2">${systemSettings[ruleKey]}</div>` 
                : `<div class="text-center text-slate-400 py-4">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶®‡ßá‡¶á‡•§<br>‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ ‡¶Æ‡ßá‡¶®‡ßá ‡¶ö‡¶≤‡ßÅ‡¶®‡•§</div>`;

            // ‡ß™. ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            Swal.fire({
                title: headerTitle,
                html: rulesContent,
                confirmButtonText: '‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø',
                confirmButtonColor: '#059669',
                customClass: {
                    popup: 'rounded-[25px]',
                    content: 'text-sm text-slate-600'
                }
            });
        };

        // ‚úÖ UPDATED TWAI CHATBOT FUNCTIONS
        window.openTWAI = () => {
            document.getElementById('twaiModal').classList.remove('hidden');
        };
        
        window.closeTWAI = () => {
            document.getElementById('twaiModal').classList.add('hidden');
        };
        
        window.askTWAI = (question) => {
            const response = twaiResponses[question] || twaiResponses['default'];
            
            const chatContainer = document.getElementById('chatbotMessages');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user-message';
            userMessage.innerHTML = `
                <div class="message-bubble user-bubble">${question}</div>
                <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
            `;
            chatContainer.appendChild(userMessage);
            
            // Add bot response after delay
            setTimeout(() => {
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot-message';
                botMessage.innerHTML = `
                    <div class="message-bubble bot-bubble">${response}</div>
                    <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
                `;
                chatContainer.appendChild(botMessage);
                
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 500);
            
            // Clear input
            document.getElementById('chatbotInput').value = '';
        };
        
        window.sendTWAI = () => {
            const input = document.getElementById('chatbotInput');
            const question = input.value.trim();
            
            if(!question) return;
            
            window.askTWAI(question);
        };

        // ‚úÖ SETTINGS FUNCTIONS
        function loadSettingsFromLocalStorage() {
            const notificationToggle = document.getElementById('notificationToggle');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const soundToggle = document.getElementById('soundToggle');
            const vibrationToggle = document.getElementById('vibrationToggle');
            
            if(localStorage.getItem('notificationEnabled') !== null) {
                notificationToggle.checked = localStorage.getItem('notificationEnabled') === 'true';
            }
            
            if(localStorage.getItem('darkModeEnabled') !== null) {
                darkModeToggle.checked = localStorage.getItem('darkModeEnabled') === 'true';
                if(darkModeToggle.checked) {
                    document.body.classList.add('bg-slate-900', 'text-white');
                }
            }
            
            if(localStorage.getItem('soundEnabled') !== null) {
                soundToggle.checked = localStorage.getItem('soundEnabled') === 'true';
            }
            
            if(localStorage.getItem('vibrationEnabled') !== null) {
                vibrationToggle.checked = localStorage.getItem('vibrationEnabled') === 'true';
            }
            
            // Add event listeners
            notificationToggle.addEventListener('change', function() {
                localStorage.setItem('notificationEnabled', this.checked);
                showSmartToast(`‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
            
            darkModeToggle.addEventListener('change', function() {
                localStorage.setItem('darkModeEnabled', this.checked);
                if(this.checked) {
                    document.body.classList.add('bg-slate-900', 'text-white');
                } else {
                    document.body.classList.remove('bg-slate-900', 'text-white');
                }
                showSmartToast(`‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶° ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
            
            soundToggle.addEventListener('change', function() {
                localStorage.setItem('soundEnabled', this.checked);
                showSmartToast(`‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
            
            vibrationToggle.addEventListener('change', function() {
                localStorage.setItem('vibrationEnabled', this.checked);
                showSmartToast(`‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶® ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
        }

        // ‚úÖ TOGGLE BALANCE FUNCTION (MISSING FUNCTION)
        window.toggleBalance = () => {
            const balanceText = document.getElementById('balanceText');
            const balanceAmount = document.getElementById('balanceAmount');
            
            if(balanceAmount.classList.contains('hidden')) {
                balanceText.classList.add('hidden');
                balanceAmount.classList.remove('hidden');
                if(currentUserData) {
                    balanceAmount.textContent = `‡ß≥${currentUserData.mainBalance.toFixed(2)}`;
                }
            } else {
                balanceText.classList.remove('hidden');
                balanceAmount.classList.add('hidden');
            }
        };

        // ‚úÖ GLOBAL WINDOW FUNCTIONS
        window.toggleAuthTab = (t) => {
            document.getElementById('loginForm').classList.toggle('hidden', t!=='login');
            document.getElementById('registerForm').classList.toggle('hidden', t!=='register');
            document.getElementById('btnTabLogin').className = t==='login'?'flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg':'flex-1 py-3 rounded-full text-sm font-bold text-slate-500';
            document.getElementById('btnTabRegister').className = t==='register'?'flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg':'flex-1 py-3 rounded-full text-sm font-bold text-slate-500';
        };
        
        window.showPage = (id) => { 
            showLoading();
            setTimeout(() => {
                document.querySelectorAll('#mainApp > div').forEach(d => { 
                    if(d.id !== 'bottomNav') d.classList.add('hidden'); 
                }); 
                document.getElementById(id).classList.remove('hidden'); 
                
                if(id === 'summaryScreen' && currentUserId) {
                    loadSummary(currentUserId);
                }
                if(id === 'subscriptionScreen') {
                    window.switchSubscriptionTab('stars');
                }
                if(id === 'walletScreen') {
                    updateDepositAddress(selectedMethod || 'bKash');
                }
                if(id === 'quizScreen') {
                    window.switchQuizTab('types');
                }
                if(id === 'settingsScreen') {
                    loadSettingsFromLocalStorage();
                }
                if(id === 'vipScreen') {
                    loadPackages();
                }
                
                hideLoading();
            }, 500);
        };
        
        window.toggleWalletTab = (t) => {
            ['deposit','withdraw','transfer'].forEach(id => document.getElementById(id+'Section').classList.add('hidden'));
            document.getElementById(t+'Section').classList.remove('hidden');
            ['tabDeposit','tabWithdraw','tabTransfer'].forEach(id => document.getElementById(id).className = 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500');
            document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1)).className = 'flex-1 py-3 font-bold text-sm rounded-xl bg-slate-800 text-white shadow';
            
            if(t === 'deposit') {
                document.getElementById('depositAmount').addEventListener('input', window.calculateDepositVAT);
                window.calculateDepositVAT();
            } else if(t === 'withdraw') {
                document.getElementById('withdrawAmount').addEventListener('input', window.calculateWithdrawVAT);
                window.calculateWithdrawVAT();
            }
        };
        
        window.switchTaskTab = (type) => {
            // ‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï
            if (type === 'vip') {
                if (!currentUserData || currentUserData.plan === 'Free Member' || currentUserData.plan.includes('Free')) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶°‡¶ø‡¶®‡¶æ‡¶á‡¶°!',
                        text: '‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§',
                        confirmButtonText: '‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®',
                        confirmButtonColor: '#059669'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.showPage('vipScreen');
                        }
                    });
                    return;
                }
            }

            currentTaskType = type;
            document.getElementById('tabFreeTask').className = type==='free'?'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow':'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            document.getElementById('tabVipTask').className = type==='vip'?'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow':'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            renderTasks();
        };
 
        window.selectOperator = (el, operator) => { 
            document.querySelectorAll('#rechargeScreen .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedOperator = operator;
            document.getElementById('selectedOperator').value = operator;
        };
        
        window.selectWithdrawMethod = (el, method) => { 
            if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                showSmartToast(`${method} ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶¨‡¶®‡ßç‡¶ß`, 'error');
                return;
            }
            
            document.querySelectorAll('#withdrawSection .grid .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedMethod = method;
            document.getElementById('selectedWithdrawMethod').value = method;
        };

        // ‚úÖ SUBSCRIPTION FUNCTIONS
        window.switchSubscriptionTab = (tab) => {
            document.getElementById('tabStars').className = tab === 'stars' ? 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow' : 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            document.getElementById('tabTelegram').className = tab === 'telegram' ? 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow' : 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            
            document.getElementById('starsSection').classList.toggle('hidden', tab !== 'stars');
            document.getElementById('telegramSection').classList.toggle('hidden', tab !== 'telegram');
        };
        
        window.selectStarPackage = (stars) => {
            selectedStarPackage = stars;
            document.getElementById('selectedStars').textContent = stars;
            
            let price = 0;
            if(stars === 100) price = 290;
            else if(stars === 250) price = 652.5;
            else if(stars === 500) price = 1305;
            
            document.getElementById('totalStarPrice').textContent = price;
        };
        
        window.selectTelegramPlan = (plan) => {
            selectedTelegramPlan = plan;
            let planText = '';
            let price = 0;
            
            if(plan === '1month') {
                planText = '‡ßß ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú';
                price = 600;
            } else if(plan === '3month') {
                planText = '‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú';
                price = 1550;
            } else if(plan === '1year') {
                planText = '‡ßß ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú';
                price = 3900;
            }
            
            document.getElementById('selectedPlanText').textContent = planText;
            document.getElementById('selectedPlanPrice').textContent = price;
        };
        
        window.buyStars = () => {
            if(selectedStarPackage === 0) {
                showSmartToast('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const message = encodeURIComponent(`‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶Ü‡¶Æ‡¶ø ${currentUserData.name} (${currentUserData.phone})‡•§ ‡¶Ü‡¶Æ‡¶ø ${selectedStarPackage} ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ - ‡ß≥${document.getElementById('totalStarPrice').textContent} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§`);
            
            window.open(`https://t.me/TAKAR_WALA_ADMIN?text=${message}`, '_blank');
            
            showSmartToast('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
        };
        
        window.buyTelegramPremium = () => {
            if(!selectedTelegramPlan) {
                showSmartToast('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const planText = document.getElementById('selectedPlanText').textContent;
            const price = document.getElementById('selectedPlanPrice').textContent;
            
            const message = encodeURIComponent(`‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶Ü‡¶Æ‡¶ø ${currentUserData.name} (${currentUserData.phone})‡•§ ‡¶Ü‡¶Æ‡¶ø ${planText} - ‡ß≥${price} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§`);
            
            window.open(`https://t.me/TAKAR_WALA_ADMIN?text=${message}`, '_blank');
            
            showSmartToast('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
        };

        // ‚úÖ INITIALIZE EVENT LISTENERS
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemSettings();
            
            const depositAmount = document.getElementById('depositAmount');
            if(depositAmount) {
                depositAmount.addEventListener('input', window.calculateDepositVAT);
            }
            
            const withdrawAmount = document.getElementById('withdrawAmount');
            if(withdrawAmount) {
                withdrawAmount.addEventListener('input', window.calculateWithdrawVAT);
            }
            
            const rechAmount = document.getElementById('rechAmount');
            if(rechAmount) {
                rechAmount.addEventListener('input', window.calculateRechargeFee);
            }
            
            window.calculateDepositVAT();
            window.calculateWithdrawVAT();
            window.calculateRechargeFee();
        });
    </script>
</body>
</html>
