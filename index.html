<!DOCTYPE html>
<html lang="bn">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Takawala - Ultimate Final</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
              

    <style>
        
                /* ‚úÖ EMERGENCY FIX: FORCE HIDE */
        .hidden { 
            display: none !important; 
            visibility: hidden !important;
            pointer-events: none !important;
        }

        
                /* ‚úÖ iOS STYLE POPUP DESIGN */
        .ios-modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ï‡¶æ‡¶≤‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° */
            backdrop-filter: blur(5px); /* ‡¶¨‡ßç‡¶≤‡¶æ‡¶∞ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
            z-index: 9999999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ios-modal {
            background: rgba(255, 255, 255, 0.95);
            width: 85%;
            max-width: 320px;
            border-radius: 15px;
            text-align: center;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .ios-modal-content {
            padding: 20px 20px 15px;
        }

        .ios-icon-box {
            width: 50px; height: 50px;
            background: #eef2ff;
            color: #6366f1;
            font-size: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
        }
        
        .ios-title {
            font-size: 18px;
            font-weight: 700;
            color: #1c1c1e;
            margin-bottom: 5px;
        }
        
        .ios-message {
            font-size: 14px;
            color: #3a3a3c;
            line-height: 1.5;
        }
        
        /* ‡¶∞‡¶ô‡¶ø‡¶® ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ */
        .ios-message span { font-weight: bold; }
        .red-text { color: #ef4444; }
        .green-text { color: #10b981; }
        .blue-text { color: #3b82f6; }
        .gold-text { color: #d97706; }

        .ios-modal-actions {
            border-top: 1px solid #e5e5ea;
            display: flex;
        }
        
        .ios-btn {
            background: transparent;
            color: #007aff; /* ‡¶Ü‡¶á‡¶´‡ßã‡¶® ‡¶¨‡ßç‡¶≤‡ßÅ */
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            padding: 12px;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .ios-btn:active {
            background: #f2f2f7;
        }
        
        

        
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap');
        
        body { 
            font-family: 'Hind Siliguri', sans-serif; 
            background: #f8fafc;
            color: #1e293b;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* PREMIUM GRADIENT */
        .bg-premium { background: linear-gradient(135deg, #059669 0%, #047857 50%, #d97706 100%); }
        
        /* GLASS EFFECTS */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        /* SCROLL HIDE */
        ::-webkit-scrollbar { width: 0px; }
        
        /* ‚úÖ FIXED NOTIFICATION */
        #notificationMessage {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100000;
            min-width: 300px;
            max-width: 90%;
            width: auto;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            animation: slideDown 0.3s ease, fadeOut 0.3s ease 2.5s;
            animation-fill-mode: forwards;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
        }
        
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; visibility: visible; }
            to { opacity: 0; visibility: hidden; }
        }
        
        /* ‚úÖ iPHONE STYLE NOTIFICATION */
        .smart-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999999;
            min-width: 310px;
            max-width: 90%;
            padding: 10px 14px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDownFade 0.4s ease, fadeOutUp 0.4s ease 4.5s forwards;
        }
        
        .toast-icon {
            font-size: 22px;
            display: flex;
            align-items: center;
        }
        
        .toast-content p {
            color: #1e293b;
            font-family: 'Hind Siliguri', sans-serif;
            font-weight: 600;
            font-size: 13px;
            line-height: 1.3;
            margin: 0;
        }

        .toast-close {
            background: #f1f5f9;
            border: none;
            color: #94a3b8;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: auto;
        }
        
        .toast-close:active {
            background: #e2e8f0;
            color: #ef4444;
            transform: scale(0.9);
        }

        @keyframes slideDownFade {
            from { top: -100px; opacity: 0; transform: translateX(-50%) scale(0.9); }
            to { top: 20px; opacity: 1; transform: translateX(-50%) scale(1); }
        }
        
        @keyframes fadeOutUp {
            from { top: 20px; opacity: 1; transform: translateX(-50%) scale(1); }
            to { top: -100px; opacity: 0; transform: translateX(-50%) scale(0.9); visibility: hidden; }
        }

        /* LOADING ANIMATION */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loading-logo {
            width: 100px;
            animation: zoomInOut 2s ease-in-out infinite;
        }
        
        @keyframes zoomInOut {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* DISABLED STATE */
        .disabled-option {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }
        
        .disabled-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        /* ‚úÖ FIXED TEXT CONTAINERS */
        .text-container {
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            overflow-wrap: break-word;
            max-width: 100%;
        }
        
        .address-box {
            background: #f8fafc;
            border: 1px dashed #cbd5e1;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            word-break: break-all;
            overflow-wrap: break-word;
            white-space: normal;
            font-size: 13px;
            line-height: 1.4;
        }

        /* ‚úÖ HISTORY ITEM STYLES - FIXED LAYOUT */
        .history-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

                       /* ‚úÖ FIXED: WIDE & COMPACT RECEIPT STYLE */
        .receipt-box {
            background: #ffffff;
            width: 100% !important;   /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡ßØ‡ß´% ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶®‡¶ø‡¶¨‡ßá */
            max-width: 500px;        /* ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶ö‡¶ì‡ßú‡¶æ */
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            position: relative;
            margin: auto;            /* ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
        }

        .receipt-header {
            background: linear-gradient(135deg, #059669, #047857);
            padding: 15px;           /* ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶ø‡¶Ç ‡¶ï‡¶Æ‡¶ø‡ßü‡ßá‡¶õ‡¶ø ‡¶Ø‡¶æ‡¶§‡ßá ‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ ‡¶ï‡¶Æ ‡¶π‡ßü */
            text-align: center;
            color: white;
            position: relative;
        }
        
        /* ‡¶≤‡ßã‡¶ó‡ßã ‡¶∏‡¶æ‡¶á‡¶ú ‡¶†‡¶ø‡¶ï‡¶†‡¶æ‡¶ï ‡¶∞‡¶æ‡¶ñ‡¶æ */
        .receipt-header img {
            width: 28px;
            height: 28px;
        }
        
        .receipt-header h2 { font-size: 18px; margin-bottom: 2px; }
        .receipt-header p { font-size: 11px; opacity: 0.9; }

        /* ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶õ‡ßã‡¶ü ‡¶ï‡¶∞‡¶æ */
        .amount-box {
            margin-top: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 8px;
            backdrop-filter: blur(5px);
        }
        
        .amount-box h1 { font-size: 24px; margin: 0; }

        .receipt-body {
            padding: 15px;          /* ‡¶¨‡¶°‡¶ø‡¶∞ ‡¶∏‡ßç‡¶™‡ßá‡¶∏ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã */
            background-color: #fff;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;         /* ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá‡¶∞ ‡¶´‡¶æ‡¶Å‡¶ï‡¶æ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã */
            border-bottom: 1px dashed #e2e8f0;
            font-size: 13px;
        }

        .receipt-value {
            font-weight: 700;
            color: #1e293b;
            text-align: right;
            max-width: 65%;        /* ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã */
            word-break: break-all;
        }

        .receipt-footer {
            background: #f8fafc;
            padding: 10px;
            text-align: center;
            border-top: 2px dashed #cbd5e1;
        }
        
        .receipt-footer h3 { font-size: 10px; letter-spacing: 2px; }

        
        /* ‚úÖ FIXED REFERRAL LINK */
        .referral-box {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            word-break: break-all;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid #cbd5e1;
            text-align: center;
        }

        /* ‚úÖ PROOF SUBMISSION MODAL */
        .proof-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .proof-content {
            background: white;
            border-radius: 20px;
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }
        
        .task-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3b82f6;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        /* ‚úÖ GLOBAL CHAT ICON */
        #globalChatIcon {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 9999;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            cursor: pointer;
            border: 3px solid white;
            transition: all 0.3s ease;
        }
        
        #globalChatIcon:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.6);
        }
        
        #globalChatIcon i {
            font-size: 28px;
            color: white;
        }
        
        /* MAINTENANCE MODE */
        .maintenance-screen {
            position:fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            z-index: 999999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }
        
      /* =========================================
   ‚úÖ TWAI CHATBOT ICON (FIXED POSITION)
   ========================================= */
#twaiChatbotIcon {
    position: fixed;
    bottom: 170px; /* ‚¨ÖÔ∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶™‡¶ú‡¶ø‡¶∂‡¶® */
    right: 20px;
    z-index: 9999; /* Z-index ‡¶¨‡¶æ‡ßú‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ */
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
    cursor: pointer;
    border: 3px solid white;
    transition: all 0.3s ease;
}
#twaiChatbotIcon:hover { transform: scale(1.1); }
#twaiChatbotIcon i { font-size: 28px; color: white; }

/* =========================================
   ‚úÖ CHATBOT MODAL (FORCE DISPLAY FIX)
   ========================================= */
.chatbot-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 10010;
    
    /* ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶´‡ßç‡¶≤‡ßá‡¶ï‡ßç‡¶∏ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ */
    display: flex;
    align-items: flex-end;
    justify-content: center;
    backdrop-filter: blur(5px);
    
    /* ‡¶≤‡ßÅ‡¶ï‡¶ø‡ßü‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï */
    opacity: 0;
    visibility: hidden;
    pointer-events: none; /* ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá ‡¶®‡¶æ */
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

/* ‡¶Ø‡¶ñ‡¶® active ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶¨‡ßá */
.chatbot-modal.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto; /* ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶≤‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá */
}

/* ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ */
.chatbot-content {
    background: #ffffff;
    width: 100%;
    max-width: 500px;
    height: 90vh;
    border-radius: 25px 25px 0 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.3);
    
    /* ‡¶®‡¶ø‡¶ö ‡¶•‡ßá‡¶ï‡ßá ‡¶ì‡¶†‡¶æ‡¶∞ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

.chatbot-modal.active .chatbot-content {
    transform: translateY(0);
}

/* ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá (Header, Body, etc.) */
.chatbot-header {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    padding: 15px 20px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.close-chat-btn {
    background: rgba(255,255,255,0.2);
    width: 36px; height: 36px;
    border-radius: 50%; border: none; color: white;
    font-size: 20px; display: flex; align-items: center; justify-content: center;
    cursor: pointer;
}
.chatbot-body { flex: 1; background: #f8fafc; padding: 20px; overflow-y: auto; }
.chatbot-footer { background: white; border-top: 1px solid #e2e8f0; padding: 10px 15px 15px; display: flex; flex-direction: column; gap: 10px; }
.quick-questions-wrapper { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
.quick-btn { white-space: nowrap; background: #f1f5f9; color: #475569; border: 1px solid #cbd5e1; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; }
.chat-input-area { display: flex; align-items: center; background: #f1f5f9; border-radius: 30px; padding: 5px 5px 5px 20px; border: 1px solid #e2e8f0; }
.chat-input-area input { flex: 1; background: transparent; border: none; outline: none; font-size: 14px; }
.send-btn-new { width: 42px; height: 42px; background: linear-gradient(135deg, #8b5cf6, #6366f1); border-radius: 50%; color: white; border: none; display: flex; align-items: center; justify-content: center; font-size: 18px; }

        /* ‚úÖ HISTORY FILTER STYLES */
        .history-filter {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }
        
        .filter-btn {
            white-space: nowrap;
            padding: 8px 15px;
            border-radius: 20px;
            background: #f1f5f9;
            border: none;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #059669;
            color: white;
        }
        
        /* ‚úÖ SETTINGS TOGGLE STYLES */
        .toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #059669;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* ‚úÖ NEW LOGIN NOTICE MODAL STYLES */
        .login-notice-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 100000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .login-notice-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            backdrop-filter: blur(20px);
            border-radius: 25px;
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            transform: translateY(20px);
            animation: slideUpNotice 0.6s ease forwards;
        }
        
        @keyframes slideUpNotice {
            to { transform: translateY(0); opacity: 1; }
        }

        /* ‚úÖ INTERSTITIAL AD STYLES */
        .interstitial-ad {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

       

        /* üçé ULTRA PREMIUM iPHONE STYLE POPUP */
        div:where(.swal2-container) div:where(.swal2-popup) {
            border-radius: 30px !important;
            background: rgba(255, 255, 255, 0.85) !important;
            backdrop-filter: blur(25px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(25px) saturate(180%) !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2) !important;
            padding: 15px !important;
            width: 320px!important;
            border: 1px solid rgba(255, 255, 255, 0.5) !important;
        }

        div:where(.swal2-title) {
            font-family: 'Hind Siliguri', sans-serif !important;
            font-weight: 700 !important;
            color: #1e293b !important;
            font-size: 1.3rem !important;
            padding: 0 !important;
            margin-bottom: 2px !important;
        }

        div:where(.swal2-html-container) {
            font-family: 'Hind Siliguri', sans-serif !important;
            font-size: 0.95rem !important;
            color: #64748b !important;
            margin: 0 !important;
            line-height: 1.5 !important;
            font-weight: 500 !important;
        }

        div:where(.swal2-icon) {
            width: 60px !important;
            height: 60px !important;
            margin: 0 auto 5px auto !important;
            border-width: 3px !important;
        }
        
        .swal2-icon-content {
            font-size: 30px !important;
        }

        div:where(.swal2-actions) {
            margin-top: 10px !important;
            gap: 12px !important;
            width: 100% !important;
            display: flex !important;
            flex-direction: column !important;
        }

        div:where(.swal2-confirm), div:where(.swal2-cancel) {
            border-radius: 18px !important;
            font-weight: 700 !important;
            padding: 14px 0 !important;
            box-shadow: none !important;
            width: 100% !important;
            font-size: 15px !important;
            margin: 0 !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            transition: transform 0.2s ease !important;
        }

        div:where(.swal2-confirm) {
            background: #007AFF !important;
            color: white !important;
            background-image: linear-gradient(135deg, #007AFF, #005ecb) !important;
        }
        
        div:where(.swal2-cancel) {
            background: #F2F2F7 !important;
            color: #8E8E93 !important;
        }

        div:where(.swal2-confirm):active, div:where(.swal2-cancel):active {
            transform: scale(0.96) !important;
        }

        /* ‚úÖ MODERN iPHONE DOCK BOTTOM NAV */
        #bottomNav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.1);
        }
        
              /* ‚úÖ ULTRA PREMIUM 3D CHATBOT DESIGN */
        
       

        .chat-message {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px; /* ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá */
            opacity: 0;
            animation: messagePopUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; /* ‡¶¨‡¶æ‡¶â‡¶®‡ßç‡¶∏‡¶ø ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        }

        .user-message {
            align-items: flex-end;
        }

        .bot-message {
            align-items: flex-start;
        }

        .message-bubble {
            max-width: 78%;
            padding: 14px 18px;
            font-size: 13.5px;
            line-height: 1.6;
            font-weight: 500;
            position: relative;
            letter-spacing: 0.3px;
        }

        /* üë§ User Bubble (GORGEOUS PURPLE GRADIENT) */
        .user-bubble {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); /* ‡¶°‡¶ø‡¶™ ‡¶™‡¶æ‡¶∞‡ßç‡¶™‡¶≤ ‡¶ó‡ßç‡¶∞‡ßá‡¶°‡¶ø‡ßü‡ßá‡¶®‡ßç‡¶ü */
            color: white;
            border-radius: 18px 18px 2px 18px; /* ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶∂‡ßá‡¶™ */
            box-shadow: 0 10px 25px -5px rgba(124, 58, 237, 0.4), 
                        0 8px 10px -6px rgba(124, 58, 237, 0.2); /* ‡¶ó‡ßç‡¶≤‡ßã‡¶Ø‡¶º‡¶ø‡¶Ç ‡¶∂‡ßç‡¶Ø‡¶æ‡¶°‡ßã */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ü§ñ Bot Bubble (MODERN WHITE CARD) */
        .bot-bubble {
            background: #ffffff;
            color: #334155;
            border-radius: 18px 18px 18px 2px; /* ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶∂‡ßá‡¶™ */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 
                        0 8px 10px -6px rgba(0, 0, 0, 0.01);
            border: 1px solid #f1f5f9;
        }
        
        /* ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶¨‡¶æ‡¶¨‡¶≤‡ßá‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá ‡¶õ‡ßã‡¶ü‡ßç‡¶ü ‡¶Ü‡¶á‡¶ï‡¶® ‡¶¨‡¶æ ‡¶°‡¶ü (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤ ‡¶°‡ßá‡¶ï‡ßã‡¶∞‡ßá‡¶∂‡¶®) */
        .bot-bubble::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: -6px;
            width: 10px;
            height: 10px;
            background: #ffffff;
            border-bottom-right-radius: 20px;
            z-index: -1;
        }

        .message-time {
            font-size: 10px;
            color: #94a3b8;
            margin-top: 5px;
            font-weight: 700;
            padding: 0 4px;
            opacity: 0.8;
        }

        /* ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏‡ßá‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶á‡¶Æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
        .chatbot-input {
            padding: 15px;
            background: white;
            border-top: 1px solid #f1f5f9;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.02);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chatbot-input input {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            transition: all 0.3s;
            flex: 1;
        }

        .chatbot-input input:focus {
            background: white;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .chatbot-input button {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(109, 40, 217, 0.3);
            transition: transform 0.2s;
            margin: 0; /* ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü */
        }

        .chatbot-input button:active {
            transform: scale(0.95);
        }

        /* ‡¶¨‡¶æ‡¶â‡¶®‡ßç‡¶∏‡¶ø ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        @keyframes messagePopUp {
            0% { opacity: 0; transform: translateY(20px) scale(0.9); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

               /* ‚úÖ MARQUEE FIX */
        marquee {
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            display: block;
        }
        
                       
    </style>
    <!-- Monetag Ad Script -->
    <script src='//libtl.com/sdk.js' data-zone='10531082' data-sdk='show_10531082'></script>
</head>
<body class="bg-slate-50">

    <!-- MAINTENANCE SCREEN (HIDDEN BY DEFAULT) -->
    <div id="maintenanceScreen" class="maintenance-screen hidden">
        <div class="maintenance-content">
            <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" alt="Logo">
            <h1 class="text-4xl font-bold mb-4">üîß ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá</h1>
            <p class="text-xl mb-6">‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶æ‡¶á‡¶ü‡¶ü‡¶ø‡¶ï‡ßá ‡¶Ü‡¶∞‡ßã ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡¶ø</p>
            <p class="text-lg text-slate-300 mb-8">‡¶Ö‡¶≤‡ßç‡¶™ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßã‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ß‡ßà‡¶∞‡ßç‡¶Ø‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§</p>
            <div class="bg-white/10 p-6 rounded-2xl">
                <p class="text-sm">üìû ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó: support@takawala.com</p>
                <p class="text-sm mt-2">üì± ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ: @TAKA_WALA_ADMIN</p>
            </div>
        </div>
    </div>

    <!-- ‚úÖ GLOBAL CHAT ICON -->
    <div id="globalChatIcon" onclick="window.openSupport()">
        <i class="ri-customer-service-2-fill"></i>
    </div>
    
    <!-- ‚úÖ UPDATED TWAI CHATBOT ICON -->
    <div id="twaiChatbotIcon" onclick="window.openTWAI()">
        <i class="ri-robot-2-fill"></i>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="loading-logo">
    </div>

    <!-- ‚úÖ NEW SMART NOTIFICATION (TOAST) -->
    <div id="smartToast" class="smart-toast hidden">
        <div class="toast-icon"></div>
        <div class="toast-content">
            <p id="toastMessage"></p>
        </div>
        <button onclick="document.getElementById('smartToast').classList.add('hidden')" class="toast-close">
            <i class="ri-close-line"></i>
        </button>
    </div>

    <!-- ‚úÖ NEW LOGIN NOTICE MODAL -->
    <div id="loginNoticeModal" class="ios-modal-overlay hidden">
        <div class="ios-modal animate__animated animate__zoomIn">
            <div class="ios-modal-content">
                <div class="ios-icon-box" style="background: transparent; box-shadow: none; margin-bottom: 0;">
                    <img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-14 h-14 animate__animated animate__tada animate__infinite" style="filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2));">
                </div>
                
                <h3 id="noticeTitle" class="ios-title mt-2">‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h3>
                
                <div id="noticeMessage" class="ios-message mt-2">
                    ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                </div>
            </div>
            
            <div class="ios-modal-actions">
                <button onclick="closeLoginNoticeWithConfetti()" class="ios-btn text-blue-600 font-bold" style="font-size: 17px;">
                    ‡¶ì‡¶ï‡ßá, ‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø
                </button>
            </div>
        </div>
    </div>

    <!-- INTERSTITIAL AD (HIDDEN INITIALLY) -->
    <div id="monitagInterstitial" class="interstitial-ad hidden">
        <div id="interstitialContent" class="text-center bg-white p-5 md:p-8 rounded-2xl w-[95%] max-w-md relative overflow-hidden max-h-[85vh] overflow-y-auto mx-auto my-auto shadow-2xl border-4 border-white/50">
            <h3 class="font-bold text-xl mb-2 text-red-600">‚ö†Ô∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</h3>
            
            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 mb-6">
                <p class="text-sm font-bold text-slate-700 mb-2">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶π‡¶≤‡ßá:</p>
                <ul class="text-xs text-left text-slate-600 list-disc pl-4 space-y-1">
                    <li>‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ü‡¶ø ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡ßá ‡ß®‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</li>
                    <li>‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶∏‡ßá "‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®</li>
                </ul>
            </div>

            <button onclick="window.openAdLink()" class="w-full bg-blue-600 text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg hover:scale-105 transition animate-pulse">
                üëâ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
            </button>
            
            <div id="adTimer" class="mt-4 text-slate-400 font-bold text-sm">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®: ‡ßß‡ß¶</div>
            
            <button onclick="closeInterstitialAd()" class="mt-4 w-full bg-slate-200 text-slate-800 px-6 py-3 rounded-xl font-bold hidden">
                ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>

    <!-- ‚úÖ ULTRA PREMIUM CHATBOT HTML -->
<div id="twaiModal" class="chatbot-modal hidden">
    <!-- ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶¨‡ßá -->
    <div class="absolute inset-0" onclick="window.closeTWAI()"></div>
    
    <div class="chatbot-content">
        <!-- ‡ßß. ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="chatbot-header">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-md border border-white/30">
                    <i class="ri-robot-2-fill text-xl animate-pulse"></i>
                </div>
                <div>
                    <h3 class="font-bold text-lg leading-none">TWAI ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
                    <p class="text-[11px] opacity-90 mt-0.5">‡ß®‡ß™/‡ß≠ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‚Ä¢ ‡ß™‡ß¶‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞</p>
                </div>
            </div>
            <button onclick="window.closeTWAI()" class="close-chat-btn">
                <i class="ri-arrow-down-s-line"></i>
            </button>
        </div>
        
        <!-- ‡ß®. ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶°‡¶ø -->
        <div class="chatbot-body" id="chatbotMessages">
            <div class="chat-message bot-message">
                <div class="message-bubble bot-bubble">
                    ‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ! üëã<br>‡¶Ü‡¶Æ‡¶ø TWAI‡•§ ‡¶®‡¶ø‡¶ö‡ßá ‡ß™‡ß¶‡¶ü‡¶ø ‡¶ï‡¶Æ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ü‡¶õ‡ßá, ‡¶¨‡¶æ‡¶Æ‡ßá-‡¶°‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ü‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
                </div>
                <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
            </div>
        </div>
        
        <!-- ‡ß©. ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ (‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® + ‡¶á‡¶®‡¶™‡ßÅ‡¶ü) -->
        <div class="chatbot-footer">
            <!-- ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡ß™‡ß¶‡¶ü‡¶æ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
            <div class="quick-questions-wrapper" id="dynamicQuestionsContainer">
                <!-- Buttons will be injected here via JS -->
            </div>

            <div class="chat-input-area mt-2">
                <input type="text" id="chatbotInput" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                <button onclick="window.sendTWAI()" class="send-btn-new">
                    <i class="ri-send-plane-fill"></i>
                </button>
            </div>
        </div>
    </div>
</div>
            
    <!-- AUTH SCREEN -->
    <div id="authScreen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        <div class="glass-card w-full max-w-md p-8 rounded-[35px] text-center animate__animated animate__fadeInUp">
            <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="w-32 mx-auto mb-2 drop-shadow-xl animate__animated animate__pulse animate__infinite">
            <h1 class="text-3xl font-extrabold text-slate-800 mb-1">‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ</h1>
            <p class="text-slate-500 text-sm font-medium mb-8">‡¶™‡ßç‡¶∞‡¶´‡ßá‡¶∂‡¶®‡¶æ‡¶≤ ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ</p>

            <div class="flex bg-slate-100 p-1.5 rounded-full mb-6 border border-slate-200">
                <button onclick="window.toggleAuthTab('login')" id="btnTabLogin" class="flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg transition-all">‡¶≤‡¶ó‡¶á‡¶®</button>
                <button onclick="window.toggleAuthTab('register')" id="btnTabRegister" class="flex-1 py-3 rounded-full text-sm font-bold text-slate-500 transition-all">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
            </div>

                        <div id="loginForm" class="space-y-4 text-left">
                <input type="email" id="loginEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="password" id="loginPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                
                <div class="text-right">
                    <button onclick="window.resetPassword()" class="text-xs font-bold text-slate-500 hover:text-green-600 transition">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®?</button>
                </div>

                <button id="btnLoginAction" class="w-full bg-premium text-white font-bold py-4 rounded-2xl shadow-xl active:scale-95 transition mt-1">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <div id="registerForm" class="hidden space-y-3 text-left">
                <input type="text" id="regName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="text" id="regPhone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="email" id="regEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="password" id="regPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (‡ß¨+ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <input type="text" id="regReferralCode" placeholder="‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° (‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶¶‡¶ø‡¶®) *" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-green-500 font-bold">
                <button id="btnRegAction" class="w-full bg-premium text-white font-bold py-4 rounded-2xl shadow-xl active:scale-95 transition">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="hidden pb-24 max-w-md mx-auto min-h-screen relative bg-white">
        
        <!-- HOME SCREEN -->
        <div id="homeScreen" class="animate__animated animate__fadeIn relative">
            
            <div class="bg-premium pb-8 pt-8 px-5 rounded-b-[40px] text-white shadow-xl relative z-10">
                
                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                
                <div class="relative flex justify-between items-center mb-6">
                    <div class="flex items-center gap-3" onclick="window.showPage('profileScreen')">
                        <div class="relative">
                            <img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-12 h-12 rounded-full border-2 border-white/30 bg-white/10 backdrop-blur-sm">
                            <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 border-2 border-white rounded-full"></span>
                        </div>
                        <div>
                           <h3 class="font-bold text-lg leading-tight text-white drop-shadow-sm flex items-center gap-1" id="userNameDisplay">
    Guest
    <span id="verifiedBadge" class="hidden text-blue-400 text-sm">
        <i class="ri-checkbox-circle-fill"></i>
    </span>
</h3>

                            <div class="flex items-center gap-1 opacity-90">
                                <img src="https://i.postimg.cc/TwfTZM7Z/award.png" class="w-3">
                                <span class="text-[11px] font-bold text-yellow-300 tracking-wide" id="userPlanDisplay">Free Member</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="notificationIcon" class="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 relative cursor-pointer hover:bg-white/30 transition shadow-sm">
                        <img src="https://i.postimg.cc/c1nSnFz4/notofication.png" class="w-5 h-5 invert opacity-90">
                        <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
                        <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border border-white"></span>
                    </div>
                </div>

                <div class="bg-white/10 backdrop-blur-md rounded-full p-1.5 border border-white/20 shadow-lg relative mx-1 mb-2">
                    <div class="flex items-center justify-between">
                        
                        <div class="relative z-10 pl-1 cursor-pointer" onclick="toggleBalance()">
                            <div id="balancePill" class="balance-pill bg-white/95 rounded-full pl-1 pr-5 py-1 flex items-center gap-2 shadow-sm transition-all active:scale-95 h-10">
                                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center text-white shadow-md">
                                    <i class="ri-wallet-3-fill text-sm"></i>
                                </div>
                                <div class="flex flex-col justify-center min-w-[80px]">
                                    <span id="balanceText" class="text-[11px] font-bold text-slate-600 leading-none">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</span>
                                    <span id="balanceAmount" class="text-[13px] font-black text-rose-600 leading-none hidden">‡ß≥0.00</span>
                                </div>
                            </div>
                        </div>

                        <button onclick="window.showPage('walletScreen')" class="bg-white text-emerald-700 px-5 py-2 rounded-full text-[11px] font-bold shadow-md flex items-center gap-2 active:scale-95 transition-transform z-10 mr-1 hover:bg-emerald-50 h-9">
                            <img src="https://i.postimg.cc/7ZGpHH5q/save-money.png" class="w-4 h-4">
                            ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø
                        </button>
                    </div>
                </div>
            </div>

                        <div class="mx-5 -mt-6 bg-white p-3 rounded-2xl shadow-lg border border-slate-100 flex items-center gap-3 relative z-20 overflow-hidden">
                <div class="w-8 h-8 bg-orange-50 rounded-full flex items-center justify-center shrink-0">
                    <img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-5 h-5 animate-pulse">
                </div>
                <div class="w-full overflow-hidden">
                     <marquee behavior="scroll" direction="left" scrollamount="4" class="text-sm font-bold text-slate-600 leading-none pt-1" id="noticeText">
                        ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
                     </marquee>
                </div>
            </div>


                       <div class="px-5 grid grid-cols-3 gap-3 text-center mt-4 mb-20">
                
    <div onclick="window.showPage('taskScreen')" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/d1sXyCb6/clipboard.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span>
    </div>

    <div onclick="window.showPage('rechargeScreen')" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/jjdpNH5b/payment-method.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</span>
    </div>

    <div onclick="window.showPage('vipScreen')" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md relative">
        <div class="absolute -top-2 -right-2 bg-red-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full animate-pulse">HOT</div>
        <img src="https://i.postimg.cc/TwfTZM7Z/award.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</span>
    </div>

    <div onclick="window.loadHistory()" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/VNTvSLRX/transaction-history.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</span>
    </div>

    <div onclick="window.showDailyBonus()" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/qqLQKVHV/bonus.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶¨‡ßã‡¶®‡¶æ‡¶∏</span>
    </div>

    <div onclick="window.showPage('walletScreen')" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/wMdF5zV5/withdraw.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</span>
    </div>

    <div onclick="window.showDriveOffer()" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/qByrJYrn/sim-card.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞</span>
    </div>

    <div onclick="showAnnouncement()" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/9MW7x5nG/billboard.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶â‡¶®‡ßç‡¶∏‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span>
    </div>

    <div onclick="window.showPage('moreScreen')" class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition shadow-sm hover:shadow-md">
        <img src="https://i.postimg.cc/76SnZckK/more.png" class="w-11 mb-2 drop-shadow-md">
        <span class="text-[12px] font-bold text-slate-700">‡¶Ü‡¶∞‡¶ì</span>
    </div>
   </div>
</div>

       <!-- TASK SCREEN -->
<div id="taskScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
    <div class="flex justify-between items-center mb-6">
        <div class="flex items-center gap-3">
            <button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md">
                <i class="ri-arrow-left-line text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold text-slate-800">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h2>
        </div>
        <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')" class="w-8 cursor-pointer">
    </div>
    
    <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
        <button onclick="window.switchTaskTab('free')" id="tabFreeTask" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶´‡ßç‡¶∞‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
        <button onclick="window.switchTaskTab('vip')" id="tabVipTask" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
    </div>

    <!-- ‚úÖ ‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°‡ßá ‡¶õ‡¶ø‡¶≤ ‡¶®‡¶æ, ‡¶è‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® -->
    <div id="taskListContainer" class="pb-10">
        <!-- ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
    </div>
</div>
        <!-- WALLET SCREEN -->
        <div id="walletScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®')" class="w-8 cursor-pointer">
            </div>

            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-premium p-4 rounded-2xl text-white text-center shadow-lg"><p class="text-[10px] font-bold opacity-80">‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-xl font-extrabold mt-1">‡ß≥ <span id="walletMainDisplay">0.00</span></h2></div>
                <div class="bg-blue-600 p-4 rounded-2xl text-white text-center shadow-lg"><p class="text-[10px] font-bold opacity-80">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-xl font-extrabold mt-1">‡ß≥ <span id="walletRechargeDisplay">0.00</span></h2></div>
            </div>

            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.toggleWalletTab('deposit')" id="tabDeposit" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                <button onclick="window.toggleWalletTab('withdraw')" id="tabWithdraw" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                <button onclick="window.toggleWalletTab('transfer')" id="tabTransfer" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞</button>
            </div>

            <div id="depositSection">
                <div class="grid grid-cols-4 gap-3 mb-6">
                    <div onclick="window.selectPayment(this, 'bKash')" id="payment_bKash" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/C5vDR4nz/1656235223bkash-logo.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'Nagad')" id="payment_Nagad" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/k4phWWbK/1679248787Nagad-Logo.png" class="h-8 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'Rocket')" id="payment_Rocket" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectPayment(this, 'USDT')" id="payment_USDT" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain"></div>
                </div>
                <div class="glass-card p-5 rounded-[25px] space-y-4 text-center">
                    <div id="depositAddressContainer" class="address-box">
                        <p class="text-slate-500">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                    
                    <input type="text" id="depositTrxId" placeholder="TrxID" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <input type="number" id="depositAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <div class="text-xs text-red-500 font-bold" id="vatCalculation">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ßß‡ß¶%): ‡ß≥0.00 | ‡¶Æ‡ßã‡¶ü: ‡ß≥0.00</div>
                    <input type="hidden" id="selectedDepositMethod" value="">
                    <button onclick="window.submitDeposit()" class="w-full bg-green-600 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="withdrawSection" class="hidden">
                 <div class="grid grid-cols-4 gap-3 mb-6">
                    <div onclick="window.selectWithdrawMethod(this, 'bKash')" id="withdraw_bKash" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/C5vDR4nz/1656235223bkash-logo.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'Nagad')" id="withdraw_Nagad" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/k4phWWbK/1679248787Nagad-Logo.png" class="h-8 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'Rocket')" id="withdraw_Rocket" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png" class="h-10 object-contain"></div>
                    <div onclick="window.selectWithdrawMethod(this, 'USDT')" id="withdraw_USDT" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain"></div>
                </div>
                 <div class="glass-card p-5 rounded-[25px] space-y-4">
                    <input type="number" id="withdrawNumber" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <input type="number" id="withdrawAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none">
                    <div class="text-xs text-red-500 font-bold" id="withdrawVat">‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ßß‡ß¶%): ‡ß≥0.00 | ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§: ‡ß≥0.00</div>
                    <input type="hidden" id="selectedWithdrawMethod" value="">
                    <button onclick="window.submitWithdraw()" class="w-full bg-red-500 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="transferSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-4">
                    <div class="flex items-center justify-center gap-3 text-sm font-bold text-slate-600">
                        <span>‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span> <i class="ri-arrow-right-line"></i> <span>‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span>
                    </div>
                    <input type="number" id="transferAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 bg-slate-50 rounded-xl border font-bold outline-none text-center text-xl">
                    <button onclick="window.transferBalance()" class="w-full bg-slate-800 text-white font-bold py-3.5 rounded-xl shadow-lg">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <p class="text-xs text-red-500">* ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
                </div>
            </div>
        </div>

        <!-- RECHARGE SCREEN -->
        <div id="rechargeScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3"><button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</h2></div>
                <img src="https://i.postimg.cc/1zy2ppvd/insurance.png" onclick="window.showRules('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')" class="w-8 cursor-pointer">
            </div>
            
            <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 flex justify-between items-center mb-6">
                <div><p class="text-xs font-bold text-slate-500">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 class="text-2xl font-extrabold text-blue-600">‡ß≥ <span id="rechargePageBalance">0.00</span></h2></div>
                <img src="https://i.postimg.cc/jjdpNH5b/payment-method.png" class="w-10">
            </div>

            <div class="grid grid-cols-5 gap-3 mb-6">
                <div onclick="window.selectOperator(this, 'GP')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/65w1n62J/FB-IMG-1769495932877.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'BL')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/gJ8NL1Gx/FB-IMG-1769495999103.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Robi')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/RFHbQNLZ/FB-IMG-1769495977203.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Airtel')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/Wz0CjhdX/FB-IMG-1769496019329.jpg" class="h-full object-contain rounded-lg"></div>
                <div onclick="window.selectOperator(this, 'Teletalk')" class="bg-white p-2 rounded-2xl border cursor-pointer h-16 flex items-center justify-center"><img src="https://i.postimg.cc/TYCQbVvT/FB-IMG-1769496047333.jpg" class="h-full object-contain rounded-lg"></div>
            </div>

            <div class="glass-card p-6 rounded-[25px] space-y-4">
                 <input type="number" id="rechPhone" placeholder="‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full bg-slate-50 p-3 rounded-xl border font-bold outline-none">
                 <input type="number" id="rechAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full bg-slate-50 p-3 rounded-xl border font-bold outline-none">
                 <div class="text-xs text-red-500 font-bold" id="rechargeFee">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: ‡ß≥5 | ‡¶Æ‡ßã‡¶ü: ‡ß≥5</div>
                 <input type="hidden" id="selectedOperator" value="GP">
                 <button onclick="window.submitRecharge()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
        
        <!-- ‚úÖ DRIVE OFFER SCREEN -->
                        <div id="driveOfferScreen" class="hidden min-h-screen bg-slate-900 text-white animate__animated animate__fadeInRight pb-24">
            <div class="flex items-center gap-3 p-5 pt-8 bg-slate-800/50 backdrop-blur-md sticky top-0 z-50">
                <button onclick="window.showPage('homeScreen')" class="bg-white/10 p-2 rounded-full shadow-md backdrop-blur-md active:scale-95 transition">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-xl font-bold">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞</h2>
            </div>
            
            <div id="driveMaintenanceView" class="p-6 text-center mt-10 hidden">
                <div class="relative inline-block mb-6">
                    <div class="absolute inset-0 bg-blue-500 blur-2xl opacity-20 rounded-full"></div>
                    <img src="https://i.postimg.cc/qByrJYrn/sim-card.png" class="w-24 relative z-10 animate-bounce">
                </div>
                <h1 class="text-2xl font-bold mb-3 text-blue-400" id="driveMainTitle">‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá...</h1>
                <p class="text-slate-400 text-sm mb-6" id="driveMainMessage">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá‡•§</p>
                <div class="inline-block bg-slate-800 px-4 py-1.5 rounded-full border border-slate-700">
                    <p class="text-xs font-bold text-slate-300" id="driveLaunchDate">Coming Soon</p>
                </div>
            </div>

            <div id="driveActiveView" class="hidden">
                <div class="flex overflow-x-auto gap-3 p-4 scrollbar-hide sticky top-[72px] z-40 bg-slate-900/90 backdrop-blur-sm">
                    <button onclick="window.loadDriveOffers('gp')" id="tab_gp" class="flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full bg-slate-800 border border-slate-700 text-slate-300 font-bold text-xs transition-all hover:bg-slate-700">
                        <span class="w-2 h-2 rounded-full bg-blue-500"></span> GP
                    </button>
                    <button onclick="window.loadDriveOffers('robi')" id="tab_robi" class="flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full bg-slate-800 border border-slate-700 text-slate-300 font-bold text-xs transition-all hover:bg-slate-700">
                        <span class="w-2 h-2 rounded-full bg-red-500"></span> Robi
                    </button>
                    <button onclick="window.loadDriveOffers('bl')" id="tab_bl" class="flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full bg-slate-800 border border-slate-700 text-slate-300 font-bold text-xs transition-all hover:bg-slate-700">
                        <span class="w-2 h-2 rounded-full bg-orange-500"></span> BL
                    </button>
                    <button onclick="window.loadDriveOffers('airtel')" id="tab_airtel" class="flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full bg-slate-800 border border-slate-700 text-slate-300 font-bold text-xs transition-all hover:bg-slate-700">
                        <span class="w-2 h-2 rounded-full bg-red-600"></span> Airtel
                    </button>
                    <button onclick="window.loadDriveOffers('teletalk')" id="tab_teletalk" class="flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full bg-slate-800 border border-slate-700 text-slate-300 font-bold text-xs transition-all hover:bg-slate-700">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span> Teletalk
                    </button>
                </div>

                <div id="driveOffersContainer" class="px-4 pb-20 space-y-3">
                    </div>
            </div>
        </div>


        <!-- MORE SCREEN -->
                <div id="moreScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
             <div class="flex items-center gap-3 mb-6">
                 <button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md">
                     <i class="ri-arrow-left-line text-xl"></i>
                 </button>
                 <h2 class="text-2xl font-bold text-slate-800">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</h2>
             </div>
             
            <div class="grid grid-cols-3 gap-4 text-center">
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('profileScreen')">
                     <img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p>
                 </div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('referralScreen')">
                     <img src="https://i.postimg.cc/c4xbp54V/add-friend.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</p>
                 </div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('marketingScreen')">
                     <img src="https://i.postimg.cc/6p7RQSVx/megaphone.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç</p>
                 </div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('quizScreen')">
                     <img src="https://i.postimg.cc/mkNFY0L0/solution.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶ï‡ßÅ‡¶á‡¶ú</p>
                 </div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('summaryScreen')">
                     <img src="https://img.icons8.com/fluency/96/statistics.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</p>
                 </div>
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('settingsScreen')">
                     <img src="https://img.icons8.com/fluency/96/settings.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</p>
                 </div>
                 
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showSpinGame()">
                    <img src="https://i.postimg.cc/02p5C1GN/fortune-wheel.png" class="w-12 mx-auto mb-2">
                    <p class="text-xs font-bold">‡¶∏‡ßç‡¶™‡¶ø‡¶®</p>
                 </div>

                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.showPage('subscriptionScreen')">
                     <img src="https://i.postimg.cc/Z5JxMx1z/subscription-active.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</p>
                 </div>
                 
                 <div class="glass-card p-4 rounded-2xl cursor-pointer" onclick="window.openSupport()">
                     <img src="https://i.postimg.cc/GhmX78Xw/comment.png" class="w-12 mx-auto mb-2">
                     <p class="text-xs font-bold">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</p>
                 </div>
            </div>
             
             <!-- LUCKY DRAW BANNER BUTTON (Wide Style) -->
<div onclick="window.showLuckyDraw()" class="w-full mt-6 mb-3 bg-gradient-to-r from-purple-600 to-indigo-600 p-4 rounded-2xl shadow-lg shadow-purple-200 relative overflow-hidden group cursor-pointer flex items-center justify-between transform transition duration-300 active:scale-95">
    
    <!-- Decorative Background Effects -->
    <div class="absolute -right-6 -top-6 bg-white/10 w-24 h-24 rounded-full blur-xl group-hover:bg-white/20 transition"></div>
    <div class="absolute -left-6 -bottom-6 bg-white/10 w-20 h-20 rounded-full blur-xl"></div>

    <div class="flex items-center gap-4 relative z-10">
        <!-- Icon Box -->
        <div class="bg-white/20 p-2.5 rounded-full backdrop-blur-sm border border-white/10">
            <img src="https://i.postimg.cc/hj8zWcRb/tickets.png" class="w-9 h-9 drop-shadow-md animate-pulse">
        </div>
        
        <!-- Text -->
        <div class="text-left">
            <h3 class="text-lg font-bold text-white leading-none tracking-wide">‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ üéüÔ∏è</h3>
            <p class="text-[11px] text-purple-100 font-medium mt-1 opacity-90">‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®, ‡¶ú‡¶ø‡¶§‡ßÅ‡¶® ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ!</p>
        </div>
    </div>
    
    <!-- Arrow Icon -->
    <div class="bg-white/20 p-2 rounded-full backdrop-blur-md group-hover:bg-white/30 transition">
        <i class="ri-arrow-right-s-line text-white text-xl"></i>
    </div>
</div>
             
             <!-- ‚úÖ ‡ß¨‡ß™‡ßÆ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶Ü‡¶∂‡ßá‡¶™‡¶æ‡¶∂‡ßá ‡¶¨‡¶∏‡¶æ‡¶ì -->
<div onclick="window.showPage('promoClaimScreen')" class="w-full mt-4 mb-2 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 p-5 rounded-[30px] shadow-lg relative overflow-hidden group cursor-pointer active:scale-95 transition-all duration-300">
    <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full blur-2xl transition-all"></div>
    <div class="flex items-center justify-between relative z-10">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center border border-white/30">
                <i class="ri-magic-line text-white text-3xl animate-pulse"></i>
            </div>
            <div class="text-left">
                <h3 class="text-xl font-black text-white leading-none">‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‚ú®</h3>
                <p class="text-[11px] text-purple-100 font-bold mt-1 opacity-90 uppercase tracking-widest">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®!</p>
            </div>
        </div>
        <i class="ri-arrow-right-s-line text-white text-xl group-hover:translate-x-1 transition-transform"></i>
    </div>
</div>
             
             <button onclick="window.logout()" class="w-full mt-10 bg-red-100 text-red-600 py-3 rounded-xl font-bold">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
        </div>


        <!-- PROFILE SCREEN -->
        <div id="profileScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <div class="text-center mb-6">
                    <div class="relative inline-block">
                        <img id="currentAvatar" src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-24 h-24 mx-auto rounded-full border-4 border-slate-100">
                        <div class="absolute bottom-0 right-0 bg-green-500 text-white p-1 rounded-full cursor-pointer" onclick="window.showAvatarSelector()">
                            <i class="ri-edit-line text-sm"></i>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold mt-2" id="profNameDisplay">Guest</h3>
                </div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶®‡¶æ‡¶Æ</label><input type="text" id="profNameInput" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="profAddressInput" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶´‡ßã‡¶® (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)</label><input type="text" id="profPhoneInput" disabled class="w-full p-3 bg-slate-100 border rounded-xl font-bold text-slate-500"></div>
                <div><label class="text-xs font-bold text-slate-500 ml-2">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="profEmailInput" class="w-full p-3 bg-white border rounded-xl font-bold"></div>
                <button onclick="window.updateProfile()" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button onclick="window.showChangePassword()" class="w-full bg-slate-100 text-slate-800 py-3 rounded-xl font-bold shadow-lg">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
            </div>
        </div>

        <!-- AVATAR SELECTOR MODAL -->
        <div id="avatarModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-10000 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                <h3 class="text-xl font-bold mb-4 text-center">‡¶è‡¶≠‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="grid grid-cols-4 gap-3">
                    <div onclick="window.selectAvatar('https://img.icons8.com/fluency/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/fluency/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/color/96/user-male-circle--v1.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/color/96/user-male-circle--v1.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/office/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/office/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/plasticine/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/plasticine/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/dusk/96/user-male-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/dusk/96/user-male-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/fluency/96/user-female-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/fluency/96/user-female-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/color/96/user-female-circle--v1.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/color/96/user-female-circle--v1.png" class="w-16 h-16 mx-auto">
                    </div>
                    <div onclick="window.selectAvatar('https://img.icons8.com/office/96/user-female-circle.png')" class="p-2 border rounded-xl cursor-pointer hover:border-green-500">
                        <img src="https://img.icons8.com/office/96/user-female-circle.png" class="w-16 h-16 mx-auto">
                    </div>
                </div>
                <button onclick="window.closeAvatarModal()" class="w-full mt-4 bg-slate-100 text-slate-800 py-3 rounded-xl font-bold">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <!-- REFERRAL SCREEN (ULTIMATE PREMIUM) -->
        <div id="referralScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md active:scale-90 transition">
                    <i class="ri-arrow-left-line text-xl text-slate-700"></i>
                </button>
                <h2 class="text-2xl font-black text-slate-800 tracking-tight">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ì ‡¶Ü‡ßü</h2>
            </div>

            <!-- ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡¶æ‡¶∞‡ßç‡¶° -->
            <div class="glass-card p-6 rounded-[30px] text-center mb-6 relative overflow-hidden border-2 border-blue-500/20">
                <div class="absolute top-0 right-0 w-20 h-20 bg-blue-500/5 rounded-full -mr-10 -mt-10"></div>
                
                <img src="https://i.postimg.cc/c4xbp54V/add-friend.png" class="w-16 mx-auto mb-3 drop-shadow-lg">
                <h3 class="text-lg font-bold text-slate-800">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶á‡¶®‡¶≠‡¶æ‡¶á‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <p class="text-[11px] text-slate-500 mb-5 leading-relaxed">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶ï‡ßá‡¶â ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® <span class="text-blue-600 font-bold">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏!</span></p>
                
                <!-- ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ì ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ -->
                <div class="flex items-center gap-2 bg-slate-50 p-2 rounded-2xl border border-slate-200 mb-2">
                    <div class="flex-1 text-left pl-2 overflow-hidden">
                        <p class="text-[9px] text-slate-400 font-bold uppercase">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï</p>
                        <p id="referralLink" class="text-xs font-mono font-bold text-blue-600 truncate">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                    </div>
                    <button onclick="window.copyReferralLink()" class="w-10 h-10 bg-white rounded-xl shadow-sm border border-slate-100 flex items-center justify-center text-slate-600 active:scale-90 transition">
                        <i class="ri-file-copy-line"></i>
                    </button>
                    <button onclick="window.shareReferralLink()" class="w-10 h-10 bg-blue-600 rounded-xl shadow-md shadow-blue-200 flex items-center justify-center text-white active:scale-90 transition">
                        <i class="ri-share-forward-line"></i>
                    </button>
                </div>
            </div>

            <!-- ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ó‡ßç‡¶∞‡¶ø‡¶° -->
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-white p-5 rounded-[25px] border border-slate-100 shadow-sm text-center">
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</p>
                    <h3 class="text-2xl font-black text-slate-800" id="referralCount">0</h3>
                </div>
                <div class="bg-white p-5 rounded-[25px] border border-slate-100 shadow-sm text-center">
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ü‡ßü</p>
                    <h3 class="text-2xl font-black text-emerald-600">‡ß≥<span id="referralEarnings">0</span></h3>
                </div>
            </div>

            <!-- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
            <div class="flex items-center justify-between mb-4 px-1">
                <h4 class="font-bold text-slate-700 text-sm">‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤‡¶∏‡¶Æ‡ßÇ‡¶π</h4>
                <button onclick="loadReferralList()" class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center text-slate-600">
                    <i class="ri-refresh-line"></i>
                </button>
            </div>

            <div id="referralListContainer" class="space-y-3 pb-10">
                <div class="text-center py-10 opacity-50 italic text-xs text-slate-400">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            </div>
        </div>
        
        <!-- MARKETING SCREEN -->
        <div id="marketingScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç</h2></div>
            <div class="glass-card p-6 rounded-[25px] text-center">
                <img src="https://img.icons8.com/fluency/96/settings.png" class="w-20 mx-auto mb-4">
                <h3 class="text-xl font-bold text-slate-800 mb-2">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶§‡ßá‡¶õ‡ßá</h3>
                <p class="text-lg text-slate-600 mb-6">‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶è‡¶ü‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá</p>
                <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                    <p class="text-sm text-slate-700">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá‡•§ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞, ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡¶®‡¶æ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
                </div>
            </div>
        </div>

        <!-- QUIZ SCREEN -->
        <div id="quizScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶ï‡ßÅ‡¶á‡¶ú</h2></div>
            
            <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border">
                <button onclick="window.switchQuizTab('types')" id="tabQuizTypes" class="flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ü‡¶æ‡¶á‡¶™</button>
                <button onclick="window.switchQuizTab('questions')" id="tabQuizQuestions" class="flex-1 py-3 font-bold text-sm rounded-xl text-slate-500">‡¶ï‡ßÅ‡¶á‡¶ú ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</button>
            </div>

            <div id="quizTypesSection">
                <div class="glass-card p-6 rounded-[25px] space-y-4">
                    <h3 class="text-lg font-bold text-center mb-4">‡¶ï‡ßÅ‡¶á‡¶ú‡ßá‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div onclick="window.showQuizQuestions('general')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/mkNFY0L0/solution.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('math')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/Pqpp3Lfc/mathematics.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶• ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('science')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/V6XSw3CN/scince.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                        <div onclick="window.showQuizQuestions('islamic')" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-green-500 transition">
                            <img src="https://i.postimg.cc/QCbH91SW/rub-el-hizb.png" class="w-12 mx-auto mb-2">
                            <p class="text-xs font-bold">‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßÅ‡¶á‡¶ú</p>
                            <p class="text-[10px] text-slate-500">+‡ß≥0.25</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="quizQuestionsSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <button onclick="window.switchQuizTab('types')" class="bg-slate-100 text-slate-800 px-3 py-1 rounded-lg font-bold text-sm">
                            <i class="ri-arrow-left-line"></i> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
                        </button>
                        <h3 id="quizTypeTitle" class="text-lg font-bold">‡¶ï‡ßÅ‡¶á‡¶ú</h3>
                        <div class="quiz-timer" id="quizTimer">‡ß©‡ß¶</div>
                    </div>
                    
                    <div id="quizQuestionsContainer">
                        <!-- Questions will be loaded here -->
                    </div>
                    
                    <button onclick="window.submitQuiz()" id="submitQuizBtn" class="w-full bg-premium text-white py-3 rounded-xl font-bold shadow-lg hidden">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

        <!-- SUMMARY SCREEN -->
        <div id="summaryScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <h3 class="text-lg font-bold text-center mb-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-green-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-green-700">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</p>
                        <h3 class="text-xl font-bold text-green-800">‡ß≥ <span id="totalEarnings">0.00</span></h3>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-blue-700">‡¶Æ‡ßã‡¶ü ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</p>
                        <h3 class="text-xl font-bold text-blue-800">‡ß≥ <span id="totalDeposit">0.00</span></h3>
                    </div>
                    <div class="bg-red-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-red-700">‡¶Æ‡ßã‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</p>
                        <h3 class="text-xl font-bold text-red-800">‡ß≥ <span id="totalWithdraw">0.00</span></h3>
                    </div>
                    <div class="bg-purple-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-purple-700">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</p>
                        <h3 class="text-xl font-bold text-purple-800">‡ß≥ <span id="todayEarnings">0.00</span></h3>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-yellow-700">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p>
                        <h3 class="text-xl font-bold text-yellow-800"><span id="totalTasks">0</span></h3>
                    </div>
                    <div class="bg-pink-50 p-3 rounded-xl text-center">
                        <p class="text-xs font-bold text-pink-700">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</p>
                        <h3 class="text-xl font-bold text-pink-800"><span id="totalReferrals">0</span></h3>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶§‡¶•‡ßç‡¶Ø:</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span>‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</span><span id="joinDate">-</span></div>
                        <div class="flex justify-between"><span>‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú:</span><span id="summaryPlan">Free</span></div>
                        <div class="flex justify-between"><span>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï:</span><span id="activeTasks">0</span></div>
                        <div class="flex justify-between"><span>‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏:</span><span id="dailyBonusStatus">‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚úÖ UPDATED SETTINGS SCREEN -->
        <div id="settingsScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6"><button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md"><i class="ri-arrow-left-line text-xl"></i></button><h2 class="text-2xl font-bold text-slate-800">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h2></div>
            <div class="glass-card p-6 rounded-[25px] space-y-4">
                <h3 class="text-lg font-bold mb-4">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span>‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</span>
                        <label class="toggle">
                            <input type="checkbox" id="notificationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°</span>
                        <label class="toggle">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°</span>
                        <label class="toggle">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®</span>
                        <label class="toggle">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
                    <button onclick="window.showPage('profileScreen')" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button onclick="window.showChangePassword()" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
                </div>
             
                         <div class="glass-card p-5 mt-4 border-t-4 border-slate-800">
                <div class="flex items-center gap-2 mb-4">
                    <img src="https://img.icons8.com/fluency/48/password-check.png" class="w-6">
                    <h3 class="font-bold text-slate-800">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <input type="password" id="newPin" maxlength="4" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶ø‡¶® (‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)" class="w-full p-3 border rounded-xl text-center font-bold">
                    <input type="password" id="confirmPin" maxlength="4" placeholder="‡¶™‡¶ø‡¶® ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®" class="w-full p-3 border rounded-xl text-center font-bold">
                </div>
                <button onclick="window.setTransactionPin()" class="w-full mt-3 bg-slate-800 text-white py-3 rounded-xl font-bold active:scale-95 transition">‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <p class="text-[10px] text-slate-400 mt-2 text-center">*‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶è‡¶á ‡¶™‡¶ø‡¶®‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶® ‡¶π‡¶¨‡ßá‡•§</p>
            </div>

                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h4>
                    <button onclick="window.openSupport()" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm mb-2">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                                      
                    <button onclick="window.open('mailto:support@takawala.com')" class="w-full bg-slate-100 text-slate-800 py-2.5 rounded-lg font-bold text-sm">‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                </div>
            </div>
        </div>

        <!-- ‚úÖ ENHANCED HISTORY SCREEN WITH FILTER -->
        <div id="historyScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-slate-800">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h2>
            </div>
            
            <!-- ‚úÖ HISTORY FILTER -->
            <div class="history-filter mb-6">
                <button onclick="window.filterHistory('all')" id="filterAll" class="filter-btn active">‡¶∏‡¶¨</button>
                <button onclick="window.filterHistory('deposit')" id="filterDeposit" class="filter-btn">‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü</button>
                <button onclick="window.filterHistory('withdraw')" id="filterWithdraw" class="filter-btn">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</button>
                <button onclick="window.filterHistory('recharge')" id="filterRecharge" class="filter-btn">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</button>
                <button onclick="window.filterHistory('task')" id="filterTask" class="filter-btn">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
                <button onclick="window.filterHistory('bonus')" id="filterBonus" class="filter-btn">‡¶¨‡ßã‡¶®‡¶æ‡¶∏</button>
                <button onclick="window.filterHistory('quiz')" id="filterQuiz" class="filter-btn">‡¶ï‡ßÅ‡¶á‡¶ú</button>
            </div>
            
            <div id="historyListContainer" class="space-y-3">
                <!-- History will be loaded here -->
            </div>
        </div>
        
        <!-- VIP SCREEN -->
        <!-- VIP SCREEN ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞ ‡¶è‡¶ï‡¶¶‡¶Æ ‡¶â‡¶™‡¶∞‡ßá ‡¶è‡¶ü‡¶æ ‡¶¨‡¶∏‡¶æ‡¶ì -->
<div id="vipScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
     <div class="flex justify-between items-center mb-6">
         <div class="flex items-center gap-3">
             <button onclick="window.showPage('homeScreen')" class="bg-white p-2 rounded-full shadow-md">
                 <i class="ri-arrow-left-line text-xl"></i>
             </button>
             <h2 class="text-2xl font-bold text-slate-800">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</h2>
         </div>
     </div>

     <!-- ‚úÖ ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ -->
     <div id="activePackageTimer" class="hidden glass-card p-5 rounded-3xl border-2 border-green-500 mb-6 bg-gradient-to-br from-green-50 to-white shadow-lg animate__animated animate__pulse animate__infinite">
        <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                <i class="ri-vip-crown-fill text-xl"></i>
            </div>
            <div>
                <p class="text-[10px] font-bold text-slate-400 uppercase">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú</p>
                <h4 class="font-black text-slate-800" id="activePlanName">‡¶ó‡ßã‡¶≤‡ßç‡¶°</h4>
            </div>
        </div>
        
        <p class="text-xs font-bold text-slate-500 mb-2">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶§‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø:</p>
        <div class="grid grid-cols-4 gap-2 text-center">
            <div class="bg-white p-2 rounded-xl border border-slate-100 shadow-sm">
                <span id="exp_days" class="block font-black text-green-600 text-lg">00</span>
                <span class="text-[8px] font-bold text-slate-400">‡¶¶‡¶ø‡¶®</span>
            </div>
            <div class="bg-white p-2 rounded-xl border border-slate-100 shadow-sm">
                <span id="exp_hours" class="block font-black text-green-600 text-lg">00</span>
                <span class="text-[8px] font-bold text-slate-400">‡¶ò‡¶£‡ßç‡¶ü‡¶æ</span>
            </div>
            <div class="bg-white p-2 rounded-xl border border-slate-100 shadow-sm">
                <span id="exp_mins" class="block font-black text-green-600 text-lg">00</span>
                <span class="text-[8px] font-bold text-slate-400">‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü</span>
            </div>
            <div class="bg-white p-2 rounded-xl border border-slate-100 shadow-sm">
                <span id="exp_secs" class="block font-black text-red-500 text-lg animate-pulse">00</span>
                <span class="text-[8px] font-bold text-slate-400">‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°</span>
            </div>
        </div>
     </div>

     <!-- ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
     <div id="packageListContainer" class="space-y-4"></div>
</div>
                
       
        
        <!-- SPIN SCREEN -->
                <div id="spinScreen" class="hidden min-h-screen bg-slate-900 text-white animate__animated animate__fadeInRight pb-20">
            <div class="flex items-center gap-3 p-5 pt-8">
                <button onclick="window.showPage('moreScreen')" class="bg-white/10 p-2 rounded-full shadow-md backdrop-blur-md active:scale-95 transition">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold">‡¶≤‡¶æ‡¶ï‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶®</h2>
            </div>

            <div id="spinMaintenanceView" class="p-6 text-center mt-10">
                <div class="relative inline-block mb-8">
                    <div class="absolute inset-0 bg-purple-500 blur-2xl opacity-20 rounded-full"></div>
                    <img src="https://i.postimg.cc/02p5C1GN/fortune-wheel.png" class="w-32 relative z-10 animate-spin-slow">
                </div>
                
                <h1 class="text-3xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent" id="spinMainTitle">
                    ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá...
                </h1>
                
                <div class="bg-white/10 p-6 rounded-3xl backdrop-blur-md border border-white/10 shadow-2xl">
                    <p class="text-lg text-slate-200 mb-6 leading-relaxed" id="spinMainMessage">
                        ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡¶ü‡¶ø‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡ßü ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§
                    </p>
                    
                    <div class="mt-4 pt-4 border-t border-white/10">
                        <p class="text-sm text-slate-400 uppercase tracking-widest mb-2">‡¶≤‡¶û‡ßç‡¶ö ‡¶°‡ßá‡¶ü</p>
                        <div class="inline-block bg-purple-600/20 px-6 py-2 rounded-full border border-purple-500/30">
                            <p class="text-xl font-bold text-purple-300" id="spinLaunchDate">‡ßß‡¶≤‡¶æ ‡¶ú‡ßÅ‡¶® ‡ß®‡ß¶‡ß®‡ß¨</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="spinActiveView" class="hidden p-5 flex flex-col items-center">
                <div class="bg-purple-600/20 border border-purple-500/30 px-4 py-2 rounded-full mb-8">
                    <p class="text-sm font-bold text-purple-200">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡ßç‡¶™‡¶ø‡¶®: <span id="spinCount" class="text-white">0</span></p>
                </div>

                <div class="relative w-72 h-72 mb-10">
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 -mt-4 z-20">
                        <i class="ri-arrow-down-fill text-4xl text-yellow-400 drop-shadow-lg"></i>
                    </div>
                    <div id="wheel" class="w-full h-full rounded-full border-4 border-white/20 shadow-2xl relative overflow-hidden transition-transform duration-[4000ms] cubic-bezier(0.2, 0.8, 0.2, 1)">
                        <div class="w-full h-full" style="background: conic-gradient(
                            #ef4444 0deg 60deg, 
                            #3b82f6 60deg 120deg, 
                            #10b981 120deg 180deg, 
                            #f59e0b 180deg 240deg, 
                            #8b5cf6 240deg 300deg, 
                            #ec4899 300deg 360deg);">
                        </div>
                        <div class="absolute inset-0 m-auto w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg">
                            <img src="https://i.postimg.cc/GpZMXGKR/1769418328212-removebg-preview.png" class="w-10">
                        </div>
                    </div>
                </div>

                <button onclick="window.spinTheWheel()" id="spinBtn" class="w-full max-w-xs bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl font-bold text-xl shadow-lg hover:scale-105 transition active:scale-95">
                    ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® üîÑ
                </button>
            </div>
        </div>

<!-- LUCKY DRAW SCREEN -->
<div id="luckyDrawScreen" class="hidden min-h-screen bg-slate-50 animate__animated animate__fadeInRight pb-24">
    
    <!-- Header Area -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-5 pt-8 rounded-b-[30px] shadow-lg relative overflow-hidden">
        
        <!-- Back Button & Title -->
        <div class="flex items-center gap-3 relative z-10 mb-6">
            <button onclick="window.showPage('moreScreen')" class="bg-white/20 backdrop-blur-md p-2 rounded-full text-white shadow-md active:scale-95 transition">
                <i class="ri-arrow-left-line text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold text-white">‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ üéüÔ∏è</h2>
        </div>

        <!-- ‚úÖ TIMER SECTION (BIG & VISIBLE) -->
        <div class="relative z-10 text-center mb-6">
            <div class="inline-block bg-black/30 backdrop-blur-lg border border-white/20 px-8 py-4 rounded-2xl shadow-xl">
                <p class="text-[11px] text-purple-200 font-bold uppercase tracking-widest mb-1">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶°‡ßç‡¶∞ ‡¶π‡¶§‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø</p>
                
                <h1 id="drawCountdown" class="text-4xl font-mono font-black text-yellow-300 tracking-widest drop-shadow-lg">
                    00:00:00
                </h1>
                <!-- ‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡ßã‡¶∂‡¶®‡¶æ‡¶≤ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü (‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã) -->
<div class="mt-4 mx-2">
    <div class="bg-gradient-to-r from-white/10 to-transparent backdrop-blur-md border border-white/20 p-3 rounded-2xl shadow-inner">
        <p class="text-[13px] text-yellow-100 font-medium leading-relaxed text-center italic">
            ‚ú® ‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≠‡¶æ‡¶ó‡ßç‡¶Ø‡¶¨‡¶æ‡¶® ‡¶π‡¶®, ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ <span class="text-white font-bold underline">‡ßß‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span> ‡¶ñ‡¶∞‡¶ö ‡¶ï‡¶∞‡ßá ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶Æ‡¶≤‡¶ø <span class="text-white font-black text-base">‡ßß‡ß´ ‡¶•‡ßá‡¶ï‡ßá ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span> ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ú‡¶ø‡¶§‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®! üéüÔ∏è
        </p>
    </div>
</div>
                
            </div>
        </div>

        <!-- Stats Card -->
        <div class="bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-2xl flex justify-between items-center text-white relative z-10">
            <div>
                <p class="text-xs opacity-80 font-medium">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü</p>
                <h3 class="text-2xl font-black mt-1"><span id="luckyTicketCount">0</span><span class="text-sm font-normal opacity-70">/10</span></h3>
            </div>
            <div class="text-right">
                <p class="text-xs opacity-80 font-medium">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                <h3 class="text-xl font-bold mt-1">‡ß≥<span id="luckyDrawBalance">0.00</span></h3>
            </div>
        </div>
    </div>
    
    <!-- Body Content -->
    <div class="p-5 -mt-2">
        <!-- Buy Ticket Button -->
        <button onclick="window.buyLuckyTicket()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold text-lg shadow-xl shadow-slate-200 hover:scale-105 active:scale-95 transition-all mb-8 flex items-center justify-center gap-2 border border-slate-700">
            <i class="ri-ticket-2-line text-yellow-400"></i> ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡¶ø‡¶®‡ßÅ‡¶® (‡ß≥‡ßß‡ß¶)
        </button>

        <!-- Ticket List Section -->
        <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-slate-700 text-lg">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
            <button onclick="loadMyTickets()" class="text-purple-600 text-xs font-bold bg-purple-50 px-3 py-1 rounded-full">
                <i class="ri-refresh-line"></i> ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
            </button>
        </div>

        <!-- ‚úÖ MISSING ID FIXED HERE -->
        <div id="myTicketList" class="space-y-3 pb-20">
            <!-- Tickets will load here -->
            <div class="text-center py-8 opacity-50">
                <p class="text-xs font-bold text-slate-400">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
            </div>
        </div>
    </div>
</div>

<!-- ‚úÖ PROMO CLAIM SCREEN (‡¶è‡¶ü‡¶ø ‡¶¨‡¶∏‡¶¨‡ßá SUBSCRIPTION SCREEN ‡¶è‡¶∞ ‡¶â‡¶™‡¶∞‡ßá) -->
        <div id="promoClaimScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight min-h-screen bg-white">
            <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
            <div class="flex items-center gap-3 mb-8">
                <button onclick="window.showPage('moreScreen')" class="bg-white w-10 h-10 rounded-full shadow-md flex items-center justify-center active:scale-90 transition">
                    <i class="ri-arrow-left-line text-xl text-slate-700"></i>
                </button>
                <div>
                    <h2 class="text-2xl font-black text-slate-800 tracking-tight">‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‚ú®</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Enter Magic Code & Win</p>
                </div>
            </div>

            <!-- ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶æ‡¶∞‡ßç‡¶° -->
            <div class="glass-card p-8 rounded-[35px] text-center relative overflow-hidden border-2 border-purple-100 shadow-2xl shadow-purple-100/30">
                <!-- ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶°‡ßá‡¶ï‡ßã‡¶∞‡ßá‡¶∂‡¶® -->
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-purple-500/5 rounded-full"></div>
                
                <div class="relative z-10">
                    <div class="w-20 h-20 bg-gradient-to-tr from-purple-100 to-indigo-50 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-inner border border-white">
                        <i class="ri-gift-2-fill text-4xl text-purple-600 animate-bounce"></i>
                    </div>
                    
                    <h3 class="text-lg font-bold text-slate-800 mb-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶ï‡¶ø ‡¶ï‡ßã‡¶° ‡¶Ü‡¶õ‡ßá?</h3>
                    <p class="text-xs text-slate-500 mb-8 px-2 leading-relaxed">‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡ßü‡¶æ‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßã‡¶™‡¶® ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶®‡¶ø‡¶ö‡ßá ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

                    <!-- ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ -->
                    <div class="space-y-4">
                        <input type="text" id="userPromoInput" placeholder="TKW-XXXXXX" 
                            class="w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-2xl text-center font-mono font-black text-2xl text-purple-600 outline-none focus:border-purple-500 transition-all uppercase shadow-inner">

                        <button onclick="window.processMagicPromo()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-2xl font-black text-base shadow-xl shadow-purple-200 active:scale-95 transition-all flex items-center justify-center gap-2">
                            ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶® üöÄ
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‡¶π‡ßá‡¶≤‡ßç‡¶™ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú -->
            <p class="text-center mt-8 text-[10px] text-slate-400 font-bold px-10">
                * ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶° ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶≠‡ßÅ‡¶≤ ‡¶ï‡ßã‡¶° ‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
            </p>
        </div>

        <!-- SUBSCRIPTION SCREEN -->
                 <div id="subscriptionScreen" class="hidden p-5 pt-8 animate__animated animate__fadeInRight">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="window.showPage('moreScreen')" class="bg-white p-2 rounded-full shadow-md">
                    <i class="ri-arrow-left-line text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-slate-800">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</h2>
            </div>
            
            <div class="flex overflow-x-auto gap-2 mb-6 pb-2 scrollbar-hide" id="subTabsContainer">
                <button onclick="window.switchSubscriptionTab('stars')" id="tabStars" class="whitespace-nowrap px-6 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow transition-all">
                    ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®
                </button>
                
                </div>
            
            <div id="starsSection">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-6">
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <img src="https://i.postimg.cc/Z5JxMx1z/subscription-active.png" class="w-8">
                        <h3 class="text-xl font-bold text-yellow-700">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</h3>
                    </div>
                    
                    <p class="text-sm text-slate-600 mb-2">‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡ß≥<span id="starPrice">2.90</span></p>
                    
                    <div class="grid grid-cols-3 gap-3">
                        <div onclick="window.selectStarPackage(100)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500">
                            <div class="star-count mx-auto mb-2">100 ‚≠ê</div>
                            <p class="text-lg font-bold text-slate-800">‡ß≥<span id="price100">290</span></p>
                        </div>
                        <div onclick="window.selectStarPackage(250)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500 relative">
                            <div class="absolute -top-2 -right-2 bg-red-500 text-white text-[9px] px-2 py-0.5 rounded-full">‡ßß‡ß¶% ‡¶õ‡¶æ‡ßú</div>
                            <div class="star-count mx-auto mb-2">250 ‚≠ê</div>
                            <p class="text-lg font-bold text-green-600">‡ß≥<span id="price250">652.5</span></p>
                        </div>
                        <div onclick="window.selectStarPackage(500)" class="bg-white p-4 rounded-2xl border cursor-pointer text-center hover:border-yellow-500 relative">
                            <div class="absolute -top-2 -right-2 bg-red-500 text-white text-[9px] px-2 py-0.5 rounded-full">‡ßß‡ß¶% ‡¶õ‡¶æ‡ßú</div>
                            <div class="star-count mx-auto mb-2">500 ‚≠ê</div>
                            <p class="text-lg font-bold text-green-600">‡ß≥<span id="price500">1305</span></p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-xl mt-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-slate-700">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞:</span>
                            <span class="font-bold text-yellow-700"><span id="selectedStars">0</span> ‚≠ê</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-slate-700">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</span>
                            <span class="text-xl font-bold text-green-600">‡ß≥<span id="totalStarPrice">0</span></span>
                        </div>
                    </div>
                    
                    <button onclick="window.buyStars()" class="w-full bg-yellow-500 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-yellow-600 mt-4">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                </div>
            </div>
            
            <div id="dynamicServiceSection" class="hidden">
                <div class="glass-card p-6 rounded-[25px] text-center space-y-6">
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <img id="dynamicServiceIcon" src="" class="w-8 rounded-full">
                        <h3 id="dynamicServiceTitle" class="text-xl font-bold text-blue-700">Service Name</h3>
                    </div>
                    
                    <div id="dynamicPackagesList" class="space-y-4">
                        </div>
                    
                    <div class="bg-blue-50 p-4 rounded-xl mt-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold text-slate-700">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú:</span>
                            <span class="font-bold text-blue-700" id="selectedDynamicPlanName">‡¶ï‡ßã‡¶®‡ßã‡¶ü‡¶ø‡¶á ‡¶®‡¶æ</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-slate-700">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</span>
                            <span class="text-xl font-bold text-green-600">‡ß≥<span id="selectedDynamicPlanPrice">0</span></span>
                        </div>
                    </div>
                    
                    <button onclick="window.buyDynamicSubscription()" class="w-full bg-blue-600 text-white font-bold py-3.5 rounded-xl shadow-lg hover:scale-105 transition">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

    <!-- ‚úÖ MODERN iPHONE DOCK BOTTOM NAV -->
    <div id="bottomNav" class="hidden fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl shadow-[0_-5px_30px_rgba(0,0,0,0.1)] rounded-t-[30px] flex justify-around items-end pb-4 pt-2 z-50 border-t border-white/50">
        
        <div onclick="window.showPage('homeScreen')" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <div class="relative">
                <i class="ri-home-5-fill text-xl text-green-600 mb-0.5 block group-hover:-translate-y-1 transition-transform"></i>
                <span class="absolute -bottom-1.5 left-1/2 -translate-x-1/2 w-1 h-1 bg-green-600 rounded-full opacity-100"></span>
            </div>
            <p class="text-[9px] font-bold text-slate-600">‡¶π‡ßã‡¶Æ</p>
        </div>

        <div onclick="window.showPage('walletScreen')" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <i class="ri-wallet-3-line text-xl text-slate-400 mb-0.5 block group-hover:text-green-600 group-hover:-translate-y-1 transition-all"></i>
            <p class="text-[9px] font-bold text-slate-400 group-hover:text-green-600 transition-colors">‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</p>
        </div>

        <div onclick="window.showPage('taskScreen')" class="text-center cursor-pointer -mt-10 relative active:scale-95 transition-transform">
            <div class="bg-gradient-to-br from-green-500 to-emerald-700 p-3.5 rounded-full shadow-[0_8px_20px_rgba(34,197,94,0.4)] border-[5px] border-slate-50 relative z-10 overflow-hidden">
                <div class="absolute inset-0 bg-white/20 backdrop-blur-sm"></div>
                <img src="https://i.postimg.cc/d1sXyCb6/clipboard.png" class="w-6 h-6 invert brightness-0 relative z-20">
            </div>
            <p class="text-[9px] font-bold mt-1.5 text-slate-600">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p>
        </div>

        <div onclick="window.loadHistory()" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <i class="ri-history-line text-xl text-slate-400 mb-0.5 block group-hover:text-green-600 group-hover:-translate-y-1 transition-all"></i>
            <p class="text-[9px] font-bold text-slate-400 group-hover:text-green-600 transition-colors">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</p>
        </div>

        <div onclick="window.showPage('moreScreen')" class="group text-center cursor-pointer w-14 transition-transform active:scale-90">
            <i class="ri-menu-4-line text-xl text-slate-400 mb-0.5 block group-hover:text-green-600 group-hover:-translate-y-1 transition-all"></i>
            <p class="text-[9px] font-bold text-slate-400 group-hover:text-green-600 transition-colors">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p>
        </div>
    </div>

    <!-- ‚úÖ UPDATED PROOF SUBMISSION MODAL -->
    <div id="proofModal" class="proof-modal hidden">
        <div class="proof-content">
            <div class="bg-premium p-6 text-white text-center">
                <h2 class="text-xl font-bold">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</h2>
                <p class="text-sm opacity-90">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®</p>
                <div class="task-timer" id="proofTimer">‡ß®‡ß¶</div>
            </div>
            <div class="p-6">
                <div id="proofFormContainer">
                    <!-- Proof form will be loaded here dynamically -->
                </div>
                <div class="mt-4">
                    <button onclick="window.submitProof()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button onclick="window.closeProofModal()" class="w-full mt-2 bg-slate-200 text-slate-800 py-3 rounded-xl font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </div>
        </div>
    </div>

<!-- ‚úÖ USER HISTORY RECEIPT MODAL (FULL DETAILED VERSION) -->
<div id="userReceiptModal" class="fixed inset-0 z-[99999] hidden flex items-center justify-center px-4">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-md transition-opacity" onclick="window.closeUserReceiptModal()"></div>
    
    <!-- Modal Card -->
    <div class="bg-white w-full max-w-sm rounded-[30px] shadow-2xl overflow-hidden relative animate__animated animate__zoomIn z-10">
        
        <!-- Header Pattern -->
        <div class="absolute top-0 left-0 right-0 h-24 bg-slate-50 z-0 border-b border-slate-100"></div>

        <!-- Close Button -->
        <button onclick="window.closeUserReceiptModal()" class="absolute top-4 right-4 z-20 w-8 h-8 rounded-full bg-white text-slate-400 flex items-center justify-center hover:text-red-500 shadow-sm border border-slate-100 transition-all">
            <i class="ri-close-line text-xl"></i>
        </button>

        <div class="p-6 pt-6 text-center relative z-10">
            
            <!-- Dynamic Status Icon -->
            <div id="uReceiptIconBg" class="w-20 h-20 rounded-full mx-auto flex items-center justify-center mb-3 shadow-lg border-4 border-white transition-colors bg-white">
                <i id="uReceiptIcon" class="text-4xl"></i>
            </div>

            <!-- Status Text -->
            <h2 id="uReceiptStatus" class="text-2xl font-black text-slate-800 tracking-tight mb-1">Status</h2>
            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-4">‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡ßü‡¶æ‡¶≤ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü</p>

            <!-- Copyable TRX ID Box -->
            <div class="bg-white border-2 border-slate-100 rounded-xl p-2 mb-5 flex items-center justify-between relative overflow-hidden shadow-sm">
                <div class="text-left pl-2 overflow-hidden">
                    <p class="text-[9px] text-slate-400 font-bold uppercase">‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø</p>
                    <p id="uReceiptTrx" class="text-xs font-mono font-bold text-slate-700 truncate w-40">Loading...</p>
                </div>
                <button onclick="window.copyReceiptTrx()" class="bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1.5 rounded-lg text-xs font-bold transition-all active:scale-95 flex items-center gap-1">
                    <i class="ri-file-copy-line"></i> ‡¶ï‡¶™‡¶ø
                </button>
            </div>

            <!-- Full Details List -->
            <div class="bg-slate-50 rounded-2xl p-4 border border-slate-100 space-y-3">
                
                <!-- User Info -->
                <div class="flex justify-between items-center border-b border-dashed border-slate-200 pb-2">
                    <span class="text-slate-500 font-bold text-xs">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶Æ</span>
                    <span id="uReceiptName" class="font-bold text-slate-800 text-sm">...</span>
                </div>
                
                <div class="flex justify-between items-center border-b border-dashed border-slate-200 pb-2">
                    <span class="text-slate-500 font-bold text-xs">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</span>
                    <span id="uReceiptPhone" class="font-mono font-bold text-slate-800 text-sm">...</span>
                </div>

                <!-- Transaction Info -->
                <div class="flex justify-between items-center border-b border-dashed border-slate-200 pb-2">
                    <span class="text-slate-500 font-bold text-xs">‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£</span>
                    <span id="uReceiptType" class="font-bold text-blue-600 text-xs bg-blue-50 px-2 py-0.5 rounded">...</span>
                </div>

                <div class="flex justify-between items-center border-b border-dashed border-slate-200 pb-2">
                    <span class="text-slate-500 font-bold text-xs">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°</span>
                    <div class="flex items-center gap-1">
                        <img id="uReceiptMethodIcon" src="" class="w-4 h-4 object-contain hidden">
                        <span id="uReceiptMethod" class="font-bold text-slate-800 text-xs uppercase">...</span>
                    </div>
                </div>

                <div class="flex justify-between items-center border-b border-dashed border-slate-200 pb-2">
                    <span class="text-slate-500 font-bold text-xs">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</span>
                    <span id="uReceiptAmount" class="font-black text-slate-800 text-base">‡ß≥0.00</span>
                </div>

                <div class="flex justify-between items-center pt-1">
                    <span class="text-slate-500 font-bold text-xs">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶ì ‡¶∏‡¶Æ‡ßü</span>
                    <div class="text-right leading-tight">
                        <span id="uReceiptTime" class="block font-bold text-slate-700 text-[10px]">...</span>
                        <span id="uReceiptDate" class="block text-[10px] text-slate-400">...</span>
                    </div>
                </div>
            </div>

            <!-- Warning/Success Note Box -->
            <div id="uReceiptNoteBox" class="mt-4 p-3 rounded-xl text-left hidden border border-dashed">
                <div class="flex items-start gap-2">
                    <div id="uNoteIconBg" class="w-5 h-5 rounded-full flex items-center justify-center shrink-0 mt-0.5">
                        <i id="uNoteIcon" class="text-xs text-white"></i>
                    </div>
                    <div>
                        <p id="uNoteTitle" class="text-[10px] font-bold uppercase mb-0.5">Note</p>
                        <p id="uNoteText" class="text-xs font-medium leading-relaxed">...</p>
                    </div>
                </div>
            </div>

            <!-- Action Button -->
            <button onclick="window.closeUserReceiptModal()" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3.5 rounded-xl mt-5 transition-colors text-sm shadow-lg active:scale-95">
                ‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>
</div>
    <script>
        
                // üõ°Ô∏è SECRET PRO TIP: SECURITY SHIELD
        document.addEventListener('contextmenu', event => event.preventDefault()); // ‡¶∞‡¶æ‡¶á‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶¨‡¶®‡ßç‡¶ß
        document.onkeydown = function(e) {
            // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U ‡¶¨‡¶®‡ßç‡¶ß
            if(e.keyCode == 123) return false;
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false;
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false;
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
        }

        
        // ‚úÖ FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCXo_oRLBE9Gr7JZ_Fp4rl2OAjCz_AJEBo",
            authDomain: "takawala-e8522.firebaseapp.com",
            projectId: "takawala-e8522",
            storageBucket: "takawala-e8522.firebasestorage.app",
            messagingSenderId: "900133484973",
            appId: "1:900133484973:web:00f8d9de7c970f505f8924",
            measurementId: "G-ZNZ1D35QLB"
        };

        // ‚úÖ TELEGRAM BOT CONFIGURATION
        const TG_BOT_TOKEN = "8583588570:AAEKfRe3y_egMXA6n8WxiZA-z-sU4FEgE1M";
        const TG_ADMIN_CHAT_ID = "6454695072";

        async function sendTelegramNotification(message) {
            try {
                const url = `https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage`;
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: TG_ADMIN_CHAT_ID,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
            } catch (error) { console.error("TG Error:", error); }
        }

// ‚úÖ 40 QUESTIONS DATABASE (UPDATED)
const twaiResponses = {
    // ‡ßß-‡ßß‡ß¶ (‡¶¨‡ßá‡¶∏‡¶ø‡¶ï)
    '‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨?': '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶´‡ßç‡¶∞‡¶ø/‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡ßü ‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    '‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?': '‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü > ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡¶Ø‡¶æ‡¶®‡•§ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶π‡¶≤‡ßá ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶/‡¶∞‡¶ï‡ßá‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    '‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡¶§?': '‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡ß≥‡ß´ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ø‡¶ñ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá ‡¶§‡¶ñ‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§',
    '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶§‡ßá ‡¶ï‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶≤‡¶æ‡¶ó‡ßá?': '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡ß´-‡ß©‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡•§ ‡¶§‡¶¨‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ú‡ßç‡¶Ø‡¶æ‡¶Æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§',
    '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡¶ø?': '‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶á‡¶ú‡ßá "‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®?" ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®‡•§ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§',
    '‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡ßá‡¶® ‡¶π‡ßü?': '‡¶´‡ßá‡¶á‡¶ï ‡¶ï‡¶æ‡¶ú, ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞, ‡¶¨‡¶æ ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü‡¶≤‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§',
    '‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶§?': '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶/‡¶∞‡¶ï‡ßá‡¶ü‡ßá ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ‡•§',
    '‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶§?': '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá ‡ßß‡ß¶% ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶æ‡¶ü‡¶æ ‡¶π‡ßü‡•§ ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡¶≤‡ßá ‡ßØ‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§',
    '‡¶è‡¶ï ‡¶´‡ßã‡¶®‡ßá ‡¶ï‡ßü‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü?': '‡¶è‡¶ï ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ßß‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¨‡ßç‡¶≤‡¶ï ‡¶π‡¶¨‡ßá‡•§',
    '‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ?': '‡¶ï‡ßÅ‡¶á‡¶ú ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶Ø‡¶æ‡¶® > ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ü‡¶æ‡¶á‡¶™ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® > ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®‡•§',
    
    // ‡ßß‡ßß-‡ß®‡ß¶ (‡¶ü‡ßá‡¶ï‡¶®‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤)
    '‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨?': '‡¶®‡¶æ! ‡¶ñ‡¶¨‡¶∞‡¶¶‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§ ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶Ö‡¶® ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§',
    '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶ñ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü?': '‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßÆ‡¶ü‡¶æ, ‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞ ‡ß®‡¶ü‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶æ‡¶§ ‡ßÆ‡¶ü‡¶æ‡ßü ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ü‡¶∏‡ßá‡•§',
    '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶è‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ?': '‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞ ‡ß´-‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶≤‡ßá ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®‡•§',
    '‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßá?': '‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶¶‡¶æ‡ßü‡ßÄ ‡¶®‡¶á‡•§ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡ß© ‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶∞‡¶ø‡ßü‡ßá‡¶≤?': '‡¶ú‡¶ø, ‡ßß‡ß¶‡ß¶% ‡¶∞‡¶ø‡ßü‡ßá‡¶≤‡•§ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ó‡¶§ ‡ßß ‡¶¨‡¶õ‡¶∞ ‡¶ß‡¶∞‡ßá ‡¶®‡¶ø‡ßü‡¶Æ‡¶ø‡¶§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶õ‡¶ø‡•§',
    '‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶ì ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨?': '‡ßß‡ß¶‡ß¶‡ß¶ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü = ‡ßß ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶ï‡ßÅ‡¶á‡¶ú)‡•§ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡•§',
    '‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?': '‡¶Æ‡ßá‡¶®‡ßÅ > ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßÅ‡¶®‡•§',
    '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶§?': '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ, ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß´‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ (‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡ßá)‡•§',
    '‡¶®‡¶ó‡¶¶ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶§?': '‡¶®‡¶ó‡¶¶‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ, ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ß´‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ‡•§',
    '‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶ñ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡ßá?': '‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßß‡ß¶‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßß‡ß¶‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶•‡¶æ‡¶ï‡ßá‡¶®‡•§',

    // ‡ß®‡ßß-‡ß©‡ß¶ (‡¶´‡¶ø‡¶ö‡¶æ‡¶∞)
    '‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶¨?': '‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú‡ßá "‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏" ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡¶≤‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§',
    '‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶ï‡¶ø ‡¶≤‡¶æ‡¶≠?': '‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ü‡¶™‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï‡ßç‡¶∏‡¶ü‡ßç‡¶∞‡¶æ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§',
    '‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶™‡¶æ‡¶¨‡ßã?': '‡¶ú‡¶ø, ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶® ‡¶™‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡ßá‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§',
    '‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü ‡¶ï‡ßá‡¶®?': '‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶∞‡ßç‡¶•‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡ßü ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    '‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡ßã‡¶•‡¶æ‡ßü?': '‡¶Æ‡ßã‡¶∞ > ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶Ø‡¶æ‡¶®‡•§ ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§',
    '‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶≤‡ßá ‡¶ï‡¶ø ‡¶π‡¶¨‡ßá?': '‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶ü‡¶ï‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶¨‡ßá‡•§',
    '‡¶¨‡¶ø‡¶¶‡ßá‡¶∂‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá?': '‡¶Ø‡¶æ‡¶¨‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡¶ø ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç‡ßü‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§',
    '‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ?': '‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¢‡ßÅ‡¶ï‡ßÅ‡¶®‡•§',
    '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡ßá‡¶® ‡¶π‡ßü?': '‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶¨‡¶æ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶†‡¶ø‡¶ï‡¶Æ‡¶§‡ßã ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡ßü‡•§',
    '‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶¨‡ßá?': '‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®, ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ñ‡¶¨‡¶∞ ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§',

    // ‡ß©‡ßß-‡ß™‡ß¶ (‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®)
    '‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Ü‡¶∏‡ßá ‡¶®‡¶æ?': '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¶‡¶ø‡¶®‡•§',
    '‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá?': '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ > ‡¶è‡¶°‡¶ø‡¶ü ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§',
    '‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá?': '‡¶®‡¶æ, ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü ‡¶®‡¶æ‡•§',
    '‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶§‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü?': '‡¶´‡ßç‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶∞‡¶æ ‡¶¶‡¶ø‡¶®‡ßá ‡ßß ‡¶¨‡¶æ‡¶∞, ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶∞‡¶æ ‡¶¶‡¶ø‡¶®‡ßá ‡ß® ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§',
    '‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá?': '‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßß‡ß¶‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßÆ‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶•‡¶æ‡¶ï‡ßá‡•§',
    '‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ?': '‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡¶ü‡¶ø ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá‡•§ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    '‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ ‡¶ï‡¶ø?': '‡ßß‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶≤‡¶ü‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó ‡¶•‡¶æ‡¶ï‡ßá‡•§',
    '‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?': '‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶•‡ßá‡¶ï‡ßá "‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    '‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶¨ ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá?': '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ > ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶™‡¶ø‡¶® ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
    '‡¶Ü‡¶Æ‡¶ø ‡¶ï‡¶ø ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨?': '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶®‡¶ø‡ßü‡ßã‡¶ó ‡¶ö‡¶≤‡¶õ‡ßá ‡¶®‡¶æ‡•§ ‡¶≠‡¶æ‡¶≤‡ßã ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Æ‡¶°‡¶æ‡¶∞‡ßá‡¶ü‡¶∞ ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§',

    'default': '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶æ‡¶®‡¶ø ‡¶®‡¶æ‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'
};

// ‚úÖ RENDER BUTTONS AUTOMATICALLY (‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶≤‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßá)
function renderQuickQuestions() {
    const container = document.getElementById('dynamicQuestionsContainer');
    if(!container) return;
    
    // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßá ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã‡¶∞ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á
    if(container.children.length > 0) return;

    Object.keys(twaiResponses).forEach(question => {
        if(question !== 'default') {
            const btn = document.createElement('button');
            btn.className = 'quick-btn';
            btn.innerText = question;
            // ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá
            btn.onclick = () => window.askTWAI(question);
            container.appendChild(btn);
        }
    });
}

// ‚úÖ FORCE OPEN CHATBOT FUNCTION
window.openTWAI = () => {
    const modal = document.getElementById('twaiModal');
    
    if(!modal) {
        console.error("Chatbot Modal not found!");
        // ‡¶Ø‡¶¶‡¶ø ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶®‡¶æ ‡¶™‡¶æ‡ßü, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ‡¶¨‡ßá
        Swal.fire({ icon: 'error', title: 'Error', text: 'Chatbot modal ID missing!' });
        return;
    }

    // ‡ßß. ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá hidden ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶ø (Tailwind ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    modal.classList.remove('hidden');
    
    // ‡ß®. ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶´‡ßç‡¶≤‡ßá‡¶ï‡ßç‡¶∏ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶ø (‡¶Ø‡¶¶‡¶ø CSS ‡¶´‡ßá‡¶≤ ‡¶ï‡¶∞‡ßá)
    modal.style.display = 'flex';

    // ‡ß©. ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶ø
    if(typeof renderQuickQuestions === 'function') {
        renderQuickQuestions();
    }

    // ‡ß™. ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶∏‡¶Æ‡ßü ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶ø (‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    setTimeout(() => {
        modal.classList.add('active');
    }, 50); // ‡ßß‡ß¶ ‡¶è‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá ‡ß´‡ß¶ ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡ßü ‡¶™‡¶æ‡ßü
};

// ‚úÖ FORCE CLOSE CHATBOT FUNCTION
window.closeTWAI = () => {
    const modal = document.getElementById('twaiModal');
    if(!modal) return;

    // ‡ßß. ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∏‡¶∞‡¶æ‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡ßá‡¶Æ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
    modal.classList.remove('active');
    
    // ‡ß®. ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶™‡ßÅ‡¶∞‡ßã‡¶™‡ßÅ‡¶∞‡¶ø ‡¶π‡¶æ‡¶á‡¶° ‡¶π‡¶¨‡ßá
    setTimeout(() => {
        modal.classList.add('hidden');
        modal.style.display = 'none'; // ‡¶∏‡ßá‡¶´‡¶ü‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    }, 400); // CSS transition time (0.4s) ‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶®
};

// ‚úÖ ASK TWAI FUNCTION (Missing Fix)
window.askTWAI = (question) => {
    // ‡¶∏‡ßá‡¶´‡¶ü‡¶ø ‡¶ö‡ßá‡¶ï: ‡¶Ø‡¶¶‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
    if (typeof twaiResponses === 'undefined') {
        console.error("twaiResponses not found!");
        return;
    }

    const response = twaiResponses[question] || twaiResponses['default'];
    const chatContainer = document.getElementById('chatbotMessages');
    
    if (!chatContainer) return; // ‡¶∏‡ßá‡¶´‡¶ü‡¶ø ‡¶ö‡ßá‡¶ï

    // ‡ßß. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶æ
    const userMessage = document.createElement('div');
    userMessage.className = 'chat-message user-message';
    userMessage.innerHTML = `
        <div class="message-bubble user-bubble">${question}</div>
        <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
    `;
    chatContainer.appendChild(userMessage);
    
    // ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤
    chatContainer.scrollTop = chatContainer.scrollHeight;
    
    // ‡ß®. ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ (‡¶è‡¶ï‡¶ü‡ßÅ ‡¶¶‡ßá‡¶∞‡¶ø‡¶§‡ßá)
    setTimeout(() => {
        const botMessage = document.createElement('div');
        botMessage.className = 'chat-message bot-message';
        botMessage.innerHTML = `
            <div class="message-bubble bot-bubble">${response}</div>
            <div class="message-time">‡¶è‡¶ñ‡¶®‡¶á</div>
        `;
        chatContainer.appendChild(botMessage);
        
        // ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶Ü‡¶∏‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤
        chatContainer.scrollTo({
            top: chatContainer.scrollHeight,
            behavior: 'smooth'
        });
        
        // ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá
        if (typeof window.playSound === 'function') {
            window.playSound('snd_click');
        }
    }, 600);
};

// ‚úÖ SEND TWAI FUNCTION (Input Box Fix)
window.sendTWAI = () => {
    const input = document.getElementById('chatbotInput');
    if (!input) return;
    
    const question = input.value.trim();
    if (!question) return;
    
    window.askTWAI(question);
    input.value = ''; // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
};
              
        // ‚úÖ ADSTERRA ADS LINKS
        const adsterraLinks = [
            'https://www.effectivegatecpm.com/t24spqed1?key=7dead7af0eb6b2081051d790a9f95d1b',
            'https://www.effectivegatecpm.com/dt5xiqg93?key=69751766d294f4706935c6d1f690ea51',
            'https://www.effectivegatecpm.com/c6dvsywif5?key=91b430d7c920d751eaf19bfc7106e45d',
            'https://www.effectivegatecpm.com/q0cc46jma?key=8131e64ae71dd95e34995b8326d2ab81',
            'https://www.effectivegatecpm.com/skjxxk20uj?key=5c7946889852184605cd841244ecaf8d',
            'https://www.effectivegatecpm.com/qy6201wn?key=a1b1d956fe60158f669f837297a01895',
            'https://www.effectivegatecpm.com/f97068jz?key=afdd10b69fab899952ebc24c6c4a2898',
            'https://www.effectivegatecpm.com/cvcrrrps?key=5058530abbd00c92c632cc0ad8b71c58'
        ];

        // ‚úÖ WITHDRAW/RECHARGE SCHEDULE
        const withdrawalSchedule = {
            friday: { start: 8, end: 21.5 }, // 8:00 AM to 9:30 PM
            otherDays: { morning: { start: 9, end: 10 }, evening: { start: 15, end: 21.5 } } // 9-10 AM, 3-9:30 PM
        };

        function isWithinWithdrawalSchedule() {
            const now = new Date();
            const day = now.getDay(); // 0 = Sunday, 5 = Friday
            const hour = now.getHours() + (now.getMinutes() / 60);
            
            if (day === 5) { // Friday
                return hour >= withdrawalSchedule.friday.start && hour <= withdrawalSchedule.friday.end;
            } else {
                return (hour >= withdrawalSchedule.otherDays.morning.start && hour <= withdrawalSchedule.otherDays.morning.end) ||
                       (hour >= withdrawalSchedule.otherDays.evening.start && hour <= withdrawalSchedule.otherDays.evening.end);
            }
        }

        // ‚úÖ INITIALIZE FIREBASE
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ‚úÖ GLOBAL VARIABLES
        let currentUserData = null;
        
        // ‚úÖ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
function animateNumberUpdate(id, start, end, duration = 1000) {
    const obj = document.getElementById(id);
    if (!obj) return;
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const value = progress * (end - start) + start;
        if (id === 'balanceAmount' || id.includes('Display') || id.includes('Balance')) {
            obj.innerHTML =  value.toFixed(2);
        } else {
            obj.innerHTML = Math.floor(value);
        }
        if (progress < 1) window.requestAnimationFrame(step);
    };
    window.requestAnimationFrame(step);
}

let lastValues = { main: 0, recharge: 0, ref: 0 }; // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ ‡¶ú‡¶Æ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        
        let onAdCompleted = null; // ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶®: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶ï‡¶ø ‡¶π‡¶¨‡ßá ‡¶§‡¶æ ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        let currentUserId = null;
        let currentTaskType = 'free';
        let selectedMethod = 'bKash';
        let selectedOperator = 'GP';
        let selectedStarPackage = 0;
        let selectedTelegramPlan = null;
        let currentQuizType = null;
        let currentLoadedQuizzes = []; // üî• ‡¶è‡¶á ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßã
        let quizTimer = null;
        let taskTimer = null;
        let currentTaskInfo = null;
        let paymentNumbers = {};
        let systemSettings = {};
        let currentHistoryFilter = 'all';
        let todayEarnings = 0;
        let selectedAvatar = 'https://img.icons8.com/fluency/96/user-male-circle.png';
        let selectedAnswers = {};
        let maintenanceMode = false;
        let userWithdrawCount = 0;
        let userRechargeCount = 0;
        let proofTimer = null;

        // ‚úÖ SMART TOAST FUNCTION
        function showSmartToast(message, type = 'info') {
            let displayMessage = typeof message === 'object' && message !== null ? (message.message || JSON.stringify(message)) : String(message);
            
            const toast = document.getElementById('smartToast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('.toast-icon');
            
            if(window.toastTimeout) clearTimeout(window.toastTimeout);
            
            // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
            toast.style.animation = 'none';
            toast.offsetHeight; 
            toast.style.animation = 'slideDownFade 0.4s ease, fadeOutUp 0.4s ease 4.5s forwards';

            toast.classList.remove('hidden');
            
            // üî• ‡¶Æ‡¶°‡¶æ‡¶∞‡ßç‡¶® ‡¶Ü‡¶á‡¶ï‡¶® ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (Remix Icon)
            if(type === 'success') {
                toastIcon.innerHTML = '<i class="ri-checkbox-circle-fill text-green-500"></i>';
            } else if(type === 'error') {
                toastIcon.innerHTML = '<i class="ri-close-circle-fill text-red-500"></i>';
            } else {
                toastIcon.innerHTML = '<i class="ri-information-fill text-blue-500"></i>';
            }
            
            toastMessage.innerHTML = displayMessage;
            
            // ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
            window.toastTimeout = setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }

        

        // ‚úÖ LOADING ANIMATION
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // ‚úÖ UPDATED INTERSTITIAL AD SHOW FUNCTION
            function showInterstitialAd() {
            const interstitial = document.getElementById('monitagInterstitial');
            interstitial.classList.remove('hidden');
            
            let timeLeft = Math.floor(Math.random() * (25 - 20 + 1)) + 20; 
            const timerElement = document.getElementById('adTimer');
            const closeBtn = document.getElementById('adCloseBtn') || interstitial.querySelector('button.bg-slate-200');

            if(closeBtn) {
                if(!closeBtn.id) closeBtn.id = 'adCloseBtn';
                closeBtn.style.display = 'none'; // ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
                closeBtn.disabled = true;
            }

            if(window.adInterval) clearInterval(window.adInterval);

            window.adInterval = setInterval(() => {
                if (!document.hidden) {
                    timeLeft--;
                    if(timerElement) timerElement.innerHTML = `‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®: <span class="text-red-600 font-bold">${timeLeft}</span> ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°`;
                    
                    if(timeLeft <= 0) {
                        clearInterval(window.adInterval);
                        if(timerElement) timerElement.innerHTML = "‚úÖ ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶ü‡¶ø ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®";
                        if(closeBtn) {
                            // üî• ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Æ‡ßá‡¶á‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï: ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶≠‡ßá‡¶∏‡ßá ‡¶â‡¶†‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶¨‡ßá
                            closeBtn.innerHTML = "‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®"; 
                            closeBtn.style.display = "block";
                            closeBtn.classList.remove('hidden');
                            closeBtn.disabled = false;
                            closeBtn.style.opacity = "1";
                        }
                    }
                } else { 
                    if(timerElement) timerElement.innerHTML = `<span class="text-orange-500 animate-pulse">‚ö†Ô∏è ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶ú! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡ßÅ‡¶®</span>`;
                }
            }, 1000);
        }
        
 function closeInterstitialAd() {
    const interstitial = document.getElementById('monitagInterstitial');
    
    // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
    if(window.adInterval) clearInterval(window.adInterval);
    
    // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡¶æ
    interstitial.classList.add('hidden'); 
    
    // ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶ï‡¶≤ (‡¶∏‡ßç‡¶Æ‡ßÅ‡¶• ‡¶´‡¶ø‡¶ï‡ßç‡¶∏)
    if (onAdCompleted) {
        const callback = onAdCompleted;
        onAdCompleted = null; // ‡¶≤‡ßÅ‡¶™ ‡¶†‡ßá‡¶ï‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶ó‡ßá‡¶á ‡¶®‡¶æ‡¶≤ ‡¶ï‡¶∞‡ßã
        
        // üî• ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶∏‡¶Æ‡ßü ‡¶®‡¶ø‡ßü‡ßá ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá
        // ‡¶è‡¶§‡ßá ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶ù‡¶ø‡¶≤‡¶ø‡¶ï ‡¶¨‡¶æ ‡¶≤‡ßç‡¶Ø‡¶æ‡¶ó ‡¶Æ‡¶®‡ßá ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
        setTimeout(() => {
            try {
                callback(); 
            } catch (e) {
                console.error("Reward Error:", e);
                // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶∞‡¶∞ ‡¶π‡ßü, ‡¶§‡¶¨‡ßÅ‡¶ì ‡¶Ø‡ßá‡¶® ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü
                if(typeof hideLoading === 'function') hideLoading();
            }
        }, 200); // ‡ß®‡ß¶‡ß¶ ‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶°‡¶ø‡¶≤‡ßá (‡¶ö‡ßã‡¶ñ‡ßá‡¶∞ ‡¶Ü‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    }
}
        // ‚úÖ ‚úÖ FIXED: UPDATED AD LINK FUNCTION
        window.openAdLink = () => {
            const randomLink = adsterraLinks[Math.floor(Math.random() * adsterraLinks.length)];
            window.open(randomLink, '_blank');
            showSmartToast('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®', 'info');

            const closeBtn = document.getElementById('adCloseBtn');
            if(closeBtn) {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶¨‡¶≤‡¶¨‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶§‡ßá
                closeBtn.innerHTML = "‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®..."; 
                closeBtn.style.display = "block";
                closeBtn.disabled = true;
                closeBtn.style.opacity = "0.5";
            }
        };
        
        
        // ‚úÖ COPY TO CLIPBOARD
        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text).then(() => {
                showSmartToast('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            }).catch(() => {
                showSmartToast('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
            });
        };
        
        // ‚úÖ NEW MONETAG AD WRAPPER (For specific buttons)
        window.showMonetagAd = async (callback) => {
            showLoading(); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶Ü‡¶∏‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç
            try {
                // Monetag-‡¶è‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                if (typeof window['show_10531082'] === 'function') {
                    await window['show_10531082'](); 
                } else {
                    console.log("Adblocker detected or ad not ready.");
                }
            } catch (error) {
                console.error("Monetag Ad Error:", error);
            } finally {
                hideLoading();
                if(callback) callback(); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶®‡¶æ ‡¶Ü‡¶∏‡¶≤‡ßá‡¶ì ‡¶Ü‡¶∏‡¶≤ ‡¶ï‡¶æ‡¶ú‡¶ü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡ßá
            }
        };

        // ‚úÖ LOAD SYSTEM SETTINGS (‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ appConfig ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï)
async function loadSystemSettings() {
    try {
        const configDoc = await db.collection("settings").doc("appConfig").get();
        if(configDoc.exists) {
            systemSettings = configDoc.data();
            
            if(document.getElementById('refBonusText')) { document.getElementById('refBonusText').innerText = systemSettings.referralBonus || 5; }
            
            
            // ‡¶Æ‡ßá‡¶á‡¶®‡¶ü‡ßá‡¶®‡ßá‡¶®‡ßç‡¶∏ ‡¶Æ‡ßã‡¶° ‡¶ö‡ßá‡¶ï
            if(systemSettings.maintenanceMode === true) {
                maintenanceMode = true;
                showMaintenanceScreen();
                return;
            } else {
                maintenanceMode = false;
                document.getElementById('maintenanceScreen').classList.add('hidden');
            }
            
            // ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡¶ø‡¶Ç ‡¶ï‡¶∞‡¶æ (‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ü‡ßÅ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞)
            paymentNumbers = {
                bKash: systemSettings.bkashNumber || "",
                Nagad: systemSettings.nagadNumber || "",
                Rocket: systemSettings.rocketNumber || "",
                USDT_Polygon: systemSettings.polygonAddress || "",
                USDT_BEP20: systemSettings.bep20Address || ""
            };
            
            updatePaymentMethodStatus();
        }

        // ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡ßã‡¶° (‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶°‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡ßá)
        const settingsDoc = await db.collection("settings").doc("system").get();
        if(settingsDoc.exists) {
            document.getElementById('noticeText').innerText = settingsDoc.data().noticeText || "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!";
        }

        await loadUserTodayCounts();
        
    } catch (error) {
        console.error("Error loading system settings:", error);
    }
}
        // ‚úÖ LOAD USER TODAY'S COUNTS
        async function loadUserTodayCounts() {
            if(!currentUserId) return;
            
            try {
                const today = new Date();
                const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                
                // Withdraw count
                const withdrawQuery = await db.collection("history")
                    .where("userId", "==", currentUserId)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .where("type", "in", ["‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®", "Withdraw"])
                    .get();
                
                userWithdrawCount = withdrawQuery.size || 0;
                
                // Recharge count
                const rechargeQuery = await db.collection("history")
                    .where("userId", "==", currentUserId)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .where("type", "in", ["‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú", "Recharge"])
                    .get();
                
                userRechargeCount = rechargeQuery.size || 0;
                
            } catch (error) {
                console.error("Error loading user counts:", error);
            }
        }
        
        // ‚úÖ UPDATE PAYMENT METHOD STATUS
        function updatePaymentMethodStatus() {
            const methods = ['bKash', 'Nagad', 'Rocket', 'USDT'];
            methods.forEach(method => {
                const element = document.getElementById(`payment_${method}`);
                const withdrawElement = document.getElementById(`withdraw_${method}`);
                
                if(element) {
                    if(method === 'USDT') {
                        element.classList.remove('disabled-option');
                        element.onclick = () => window.selectPayment(element, method);
                        element.innerHTML = `<img src="https://i.postimg.cc/0QRCvZDV/usdt.png" class="h-10 object-contain">`;
                    } else if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                        element.classList.add('disabled-option');
                        element.onclick = null;
                        element.innerHTML = `
                            <img src="${element.querySelector('img').src}" class="h-10 object-contain opacity-50">
                            <div class="disabled-text">‡¶¨‡¶®‡ßç‡¶ß</div>
                        `;
                    } else {
                        element.classList.remove('disabled-option');
                        element.onclick = () => window.selectPayment(element, method);
                        element.innerHTML = `<img src="https://i.postimg.cc/${method === 'bKash' ? 'C5vDR4nz/1656235223bkash-logo.png' : method === 'Nagad' ? 'k4phWWbK/1679248787Nagad-Logo.png' : method === 'Rocket' ? 'xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png' : '0QRCvZDV/usdt.png'}" class="h-10 object-contain">`;
                    }
                }
                
                if(withdrawElement) {
                    if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                        withdrawElement.classList.add('disabled-option');
                        withdrawElement.onclick = null;
                        withdrawElement.innerHTML = `
                            <img src="${withdrawElement.querySelector('img').src}" class="h-10 object-contain opacity-50">
                            <div class="disabled-text">‡¶¨‡¶®‡ßç‡¶ß</div>
                        `;
                    } else {
                        withdrawElement.classList.remove('disabled-option');
                        withdrawElement.onclick = () => window.selectWithdrawMethod(withdrawElement, method);
                        withdrawElement.innerHTML = `<img src="https://i.postimg.cc/${method === 'bKash' ? 'C5vDR4nz/1656235223bkash-logo.png' : method === 'Nagad' ? 'k4phWWbK/1679248787Nagad-Logo.png' : method === 'Rocket' ? 'xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png' : '0QRCvZDV/usdt.png'}" class="h-10 object-contain">`;
                    }
                }
            });
        }
        
        // ‚úÖ SHOW MAINTENANCE SCREEN
        function showMaintenanceScreen() {
            document.getElementById('maintenanceScreen').classList.remove('hidden');
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('bottomNav').classList.add('hidden');
            document.getElementById('globalChatIcon').style.display = 'none';
            document.getElementById('twaiChatbotIcon').style.display = 'none';
        }

        // ‚úÖ SHOW NOTICE (CLEAN VERSION)
        async function showLoginNotice() {
            try {
                let title = "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ üëã";
                let msg = "‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!";
                
                try {
                    const doc = await db.collection("settings").doc("popup").get();
                    if(doc.exists) {
                        const data = doc.data();
                        if(data.title) title = data.title;
                        if(data.message) msg = data.message;
                    }
                } catch(e) { console.log("DB Error"); }

                document.getElementById('noticeTitle').innerText = title;
                document.getElementById('noticeMessage').innerHTML = msg;
                
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá (‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶¨‡¶æ‡¶ü‡¶®‡ßá)
                document.getElementById('loginNoticeModal').classList.remove('hidden');

            } catch (error) { console.error(error); }
        }

        function closeLoginNoticeWithConfetti() {
            document.getElementById('loginNoticeModal').classList.add('hidden');
            if(typeof confetti === 'function') {
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
            }
        
            // ‡ß®. ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶ó‡¶ú ‡¶´‡ßÅ‡¶ü‡¶æ‡¶®‡ßã (Birthday Style)
            if(typeof confetti === 'function') {
                // ‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { x: 0.1, y: 0.6 },
                    zIndex: 99999999
                });
                // ‡¶°‡¶æ‡¶® ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { x: 0.9, y: 0.6 },
                    zIndex: 99999999
                });
            }
        }

        // ‚úÖ NEW FUNCTION: CLOSE LOGIN NOTICE
        function closeLoginNotice() {
            document.getElementById('loginNoticeModal').classList.add('hidden');
        }

        // ‚úÖ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)
async function loadPackages() {
    try {
        const packagesSnapshot = await db.collection("vip_packages").get();
        
        const packageContainer = document.getElementById('packageListContainer');
        if(!packageContainer) return;
        
        packageContainer.innerHTML = '';
        
        if(packagesSnapshot.empty) {
            packageContainer.innerHTML = `<div class="text-center py-8 text-slate-500">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶®‡ßá‡¶á</div>`;
            hideLoading();
            return;
        }
        
        packagesSnapshot.forEach((doc) => {
            const packageData = doc.data();
            const packageId = doc.id;
            
            if(packageData.status === 'inactive') return;

            const pName = packageData.name || "VIP Package";
            const pPrice = packageData.price || 0;
            const pDays = packageData.days || 30;
            const pDesc = packageData.description || "‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ";
            
            // üî• ‡¶∏‡ßá‡¶´‡¶ü‡¶ø ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá (') ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶æ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶≤ ‡¶ï‡¶∞‡¶æ
            const safeName = pName.replace(/'/g, "\\'"); 
            
            // ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ
            const pDiscount = packageData.discountPrice || 0;
            let discountBadge = '';
            
            if(pDiscount > 0) {
                discountBadge = `
                <div class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-3 py-1 rounded-bl-2xl shadow-sm z-20 animate-pulse">
                    ‡ß≥${pDiscount} ‡¶õ‡¶æ‡ßú
                </div>`;
            }

            // ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
            let borderColor = 'border-purple-500';
            let bgColor = 'bg-purple-600';
            let textColor = 'text-purple-700';
            let badgeBg = 'bg-purple-100';
            
            if(pName.includes('‡¶∏‡¶ø‡¶≤‡¶≠‡¶æ‡¶∞') || pName.includes('Silver')) {
                borderColor = 'border-slate-400'; bgColor = 'bg-slate-500'; textColor = 'text-slate-700'; badgeBg = 'bg-slate-100';
            } else if(pName.includes('‡¶ó‡ßã‡¶≤‡ßç‡¶°') || pName.includes('Gold')) {
                borderColor = 'border-yellow-500'; bgColor = 'bg-yellow-500'; textColor = 'text-yellow-700'; badgeBg = 'bg-yellow-100';
            } else if(pName.includes('‡¶™‡ßç‡¶≤‡¶æ‡¶ü‡¶ø‡¶®‡¶æ‡¶Æ') || pName.includes('Platinum')) {
                borderColor = 'border-cyan-500'; bgColor = 'bg-cyan-600'; textColor = 'text-cyan-700'; badgeBg = 'bg-cyan-100';
            }

            const packageHTML = `
                <div class="glass-card p-5 rounded-3xl border-2 ${borderColor} mb-4 animate__animated animate__fadeInUp relative overflow-hidden">
                    ${discountBadge}
                    
                    <div class="flex justify-between items-center relative z-10">
                        <div>
                            <h3 class="font-bold text-xl ${textColor}">${pName}</h3>
                            <p class="text-xs text-slate-500 font-medium mt-1">${pDesc}</p>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="bg-white/60 px-2 py-0.5 rounded-lg text-[10px] font-bold text-slate-600 border border-slate-100">
                                    <i class="ri-calendar-check-line"></i> ${pDays} ‡¶¶‡¶ø‡¶®
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="${badgeBg} ${textColor} px-4 py-1 rounded-2xl font-black text-lg shadow-sm">
                                ‡ß≥${pPrice}
                            </div>
                            ${pDiscount > 0 ? `<p class="text-[10px] text-slate-400 line-through mt-0.5">‡ß≥${pPrice + pDiscount}</p>` : ''}
                        </div>
                    </div>
                    <!-- üî• ‡¶è‡¶ñ‡¶æ‡¶®‡ßá safeName ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                    <button onclick="window.buyPackage('${packageId}', ${pPrice}, '${safeName}', ${pDays})" 
                        class="w-full mt-4 ${bgColor} text-white py-3 rounded-2xl font-bold shadow-lg hover:opacity-90 active:scale-95 transition-all">
                        ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </div>
            `;
            
            packageContainer.innerHTML += packageHTML;
        });
        
    } catch (error) {
        console.error("Error loading packages:", error);
        document.getElementById('packageListContainer').innerHTML = `<p class="text-center text-red-500 font-bold">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</p>`;
    }
}
      // ‚úÖ ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶¨‡¶æ‡¶á ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡¶æ)
        window.buyPackage = async (packageId, price, name, days) => {
            if(!currentUserData) {
                showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }

            // üõë ‡ßß. ‡¶°‡¶æ‡¶¨‡¶≤ ‡¶™‡¶æ‡¶∞‡¶ö‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡ßá‡¶ï‡¶∂‡¶® (‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßá‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ)
            if (currentUserData.plan !== "Free Member" && currentUserData.packageExpiresAt) {
                try {
                    const expiryDate = currentUserData.packageExpiresAt.toDate();
                    const now = new Date();
                    
                    if (expiryDate > now) {
                        Swal.fire({
                            icon: 'warning',
                            title: '‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü!',
                            html: `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡ßá‡¶∞ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ <b>${expiryDate.toLocaleDateString('bn-BD')}</b> ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`,
                            confirmButtonText: '‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø',
                            confirmButtonColor: '#3b82f6',
                            customClass: { popup: 'rounded-[25px]' }
                        });
                        return;
                    }
                } catch (e) { console.error("Expiry Check Error", e); }
            }
            
            // ‡ß®. ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ö‡ßá‡¶ï
            if(currentUserData.mainBalance < price) {
                showSmartToast(`‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶õ‡ßá ‡ß≥${currentUserData.mainBalance.toFixed(2)}`, 'error');
                return;
            }
            
            // ‡ß©. ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∂‡¶® ‡¶™‡¶™-‡¶Ü‡¶™
            const result = await Swal.fire({
                title: `${name} ‡¶ï‡¶ø‡¶®‡¶¨‡ßá‡¶®?`,
                html: `‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: <b>‡ß≥${price}</b> | ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶: <b>${days} ‡¶¶‡¶ø‡¶®</b><br><br>‡¶ï‡¶ø‡¶®‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá: ‡ß≥${(currentUserData.mainBalance - price).toFixed(2)}`,
                showCancelButton: true,
                confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                confirmButtonColor: '#059669',
                icon: 'question',
                customClass: { popup: 'rounded-[25px]' }
            });
            
            if (result.isConfirmed) {
                showLoading();
                try {
                    const userRef = db.collection("users").doc(currentUserId);
                    
                    // ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶®
                    const expiryDate = new Date();
                    expiryDate.setDate(expiryDate.getDate() + parseInt(days));
                    
                    // ‡ßß. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                    await userRef.update({
                        mainBalance: firebase.firestore.FieldValue.increment(-price),
                        plan: name,
                        packageExpiresAt: expiryDate,
                        packageId: packageId,
                        totalSpent: firebase.firestore.FieldValue.increment(price) // ‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ñ‡¶∞‡¶ö ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç
                    });
                    
                    // ‡ß®. ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡¶ó (‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá)
                    await db.collection("history").add({
                        userId: currentUserId,
                        name: currentUserData.name, // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶π‡¶ú ‡¶π‡¶¨‡ßá
                        type: "‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡ßç‡¶∞‡ßü",
                        amount: -price,
                        status: "Success",
                        details: `${name} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡¶ü‡¶ø ${days} ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßá‡¶®‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`,
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // ‡ß©. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
                    const telegramMessage = `üõí *‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡ßç‡¶∞‡ßü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüì¶ *‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú:* ${name}\nüí∞ *‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:* ‡ß≥${price}\nüìÖ *‡¶Æ‡ßá‡ßü‡¶æ‡¶¶:* ${days} ‡¶¶‡¶ø‡¶®\n‚úÖ *‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ:* ‡¶∏‡¶´‡¶≤`;
                    await sendTelegramNotification(telegramMessage);
                    
                    showSmartToast(`${name} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`, 'success');
                    window.playSound('snd_success');
                    hideLoading();
                    
                    // ‡¶π‡ßã‡¶Æ‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ
                    setTimeout(() => { window.showPage('homeScreen'); }, 1500);
                    
                } catch (e) {
                    console.error("Purchase error:", e);
                    showSmartToast('‡¶ï‡ßç‡¶∞‡ßü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                    hideLoading();
                }
            }
        };
        // ‚úÖ UPDATED DEPOSIT ADDRESS FUNCTION
        window.selectPayment = (el, method) => { 
            if(method === 'USDT') {
                // USDT is always enabled in deposit
            } else if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                showSmartToast(`${method} ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶¨‡¶®‡ßç‡¶ß`, 'error');
                return;
            }
            
            document.querySelectorAll('#depositSection .grid .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedMethod = method;
            document.getElementById('selectedDepositMethod').value = method;
            
            updateDepositAddress(method);
        };
        
                                // ‚úÖ FIXED: DATABASE CONNECTED DEPOSIT FUNCTION (USDT + LOCAL)
        function updateDepositAddress(method) {
            const container = document.getElementById('depositAddressContainer');
            if(!container) return;

            // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ
            let address = "01XXXXXXXXX"; 
            let title = "‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞";
            let icon = "ri-smartphone-line";
            let color = "blue"; 
            let badge = "‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡ßü‡¶æ‡¶≤";
            let warning = "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶Æ‡¶ø‡¶≤‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡¶®";

            // 1. USDT LOGIC (DATABASE CONNECTED)
            if (method === 'USDT') {
                // üî• ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶∏‡¶¨‡ßá
                const polygonAddr = paymentNumbers.USDT_Polygon || "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á"; 
                const bscAddr = paymentNumbers.USDT_BEP20 || "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                
                container.innerHTML = `
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-2.5 relative mb-2 overflow-hidden hover:shadow-sm">
                        <div class="absolute top-0 right-0 bg-purple-100 px-2 py-0.5 rounded-bl-lg text-[9px] font-bold text-purple-600">
                            Polygon (Matic)
                        </div>
                        <p class="text-[10px] text-purple-600 font-bold mb-1 flex items-center gap-1">
                            <i class="ri-global-line"></i> Wallet Address:
                        </p>
                        <div class="flex items-center justify-between gap-2">
                            <h2 class="text-[11px] font-mono font-bold text-slate-700 truncate w-48 bg-white px-1 rounded border border-purple-100">
                                ${polygonAddr}
                            </h2>
                            <button onclick="window.copyToClipboard('${polygonAddr}')" 
                                class="bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded-md text-[10px] font-bold active:scale-95 transition h-6 flex items-center gap-1">
                                <i class="ri-file-copy-line"></i> ‡¶ï‡¶™‡¶ø
                            </button>
                        </div>
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-2.5 relative overflow-hidden hover:shadow-sm">
                        <div class="absolute top-0 right-0 bg-yellow-100 px-2 py-0.5 rounded-bl-lg text-[9px] font-bold text-yellow-700">
                            BSC (BEP20)
                        </div>
                        <p class="text-[10px] text-yellow-700 font-bold mb-1 flex items-center gap-1">
                            <i class="ri-bit-coin-line"></i> Wallet Address:
                        </p>
                        <div class="flex items-center justify-between gap-2">
                            <h2 class="text-[11px] font-mono font-bold text-slate-700 truncate w-48 bg-white px-1 rounded border border-yellow-100">
                                ${bscAddr}
                            </h2>
                            <button onclick="window.copyToClipboard('${bscAddr}')" 
                                class="bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded-md text-[10px] font-bold active:scale-95 transition h-6 flex items-center gap-1">
                                <i class="ri-file-copy-line"></i> ‡¶ï‡¶™‡¶ø
                            </button>
                        </div>
                    </div>
                    
                    <p class="text-[9px] text-red-400 mt-2 text-center font-bold">
                        ‚ö†Ô∏è ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ POLYGON ‡¶¨‡¶æ BEP20 ‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá‡¶®‡•§
                    </p>
                `;
                return; 
            }

            // 2. LOCAL METHOD LOGIC (BKASH/NAGAD)
            if (method === 'bKash') {
                address = paymentNumbers.bKash || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "pink";
            } else if (method === 'Nagad') {
                address = paymentNumbers.Nagad || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "orange";
            } else if (method === 'Rocket') {
                address = paymentNumbers.Rocket || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "purple";
            } else if (method === 'Upay') {
                address = paymentNumbers.Upay || "‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á";
                color = "blue";
            }

            // HTML GENERATION (LOCAL)
            container.innerHTML = `
                <div class="bg-${color}-50 border border-${color}-200 rounded-lg p-2.5 relative overflow-hidden transition-all hover:shadow-sm">
                    <div class="absolute top-0 right-0 bg-${color}-100 px-2 py-0.5 rounded-bl-lg text-[9px] font-bold text-${color}-600">
                        ${badge}
                    </div>
                    <p class="text-[10px] text-${color}-600 font-bold mb-1 flex items-center gap-1">
                        <i class="${icon}"></i> ${title}:
                    </p>
                    <div class="flex items-center justify-between gap-2">
                        <h2 class="text-lg font-black text-slate-700 tracking-wider font-mono leading-none">
                            ${address}
                        </h2>
                        <button onclick="window.copyToClipboard('${address}')" 
                            class="bg-${color}-500 hover:bg-${color}-600 text-white px-2.5 py-1 rounded-md text-[10px] font-bold shadow-sm active:scale-95 transition flex items-center gap-1 h-7">
                            <i class="ri-file-copy-line"></i> ‡¶ï‡¶™‡¶ø
                        </button>
                    </div>
                    <p class="text-[9px] text-slate-400 mt-1.5 flex items-center gap-1 leading-none opacity-80">
                        <i class="ri-shield-check-line text-${color}-400"></i> ${warning}
                    </p>
                </div>
            `;
        }

        // ‚úÖ AUTH FUNCTIONS
        document.getElementById('btnRegAction').addEventListener('click', async () => {
            const name = document.getElementById('regName').value, 
                  phone = document.getElementById('regPhone').value, 
                  email = document.getElementById('regEmail').value, 
                  pass = document.getElementById('regPass').value,
                  referralCode = document.getElementById('regReferralCode').value.trim();
            
            if(!name || !phone || !email || !pass || !referralCode) return showSmartToast('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶® (‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°‡¶∏‡¶π)', 'error');
            
            if(pass.length < 6) return showSmartToast('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
            
            try {
    showLoading();

   // ‚úÖ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≤‡¶ï ‡¶ö‡ßá‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ (‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)
            let deviceToken = localStorage.getItem('takawala_device_id');
            if (!deviceToken) {
                deviceToken = 'ID-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
                localStorage.setItem('takawala_device_id', deviceToken);
            }

            const checkDevice = await db.collection("users").where("deviceToken", "==", deviceToken).get();
            if (!checkDevice.empty) {
                hideLoading();
                // üî• ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç
                Swal.fire({
                    title: '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! üö´',
                    html: `
                        <div style="text-align: center;">
                            <p style="color: #334155; font-size: 14px; line-height: 1.6;">
                                ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ <b>‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ßß‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</b> ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ 
                                <br><br>
                                ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
                            </p>
                        </div>
                    `,
                    icon: 'warning',
                    confirmButtonText: '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá, ‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø',
                    confirmButtonColor: '#ef4444',
                    customClass: { popup: 'rounded-[25px]' }
                });
                return;
            }
            // ‚úÖ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≤‡¶ï ‡¶ö‡ßá‡¶ï ‡¶∂‡ßá‡¶∑

    showSmartToast('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                const uc = await auth.createUserWithEmailAndPassword(email, pass);
                
                const userReferralCode = 'REF' + Math.floor(100000 + Math.random() * 900000);
                
                const userData = { 
                    name, 
                    phone, 
                    email, 
                    mainBalance: 0, 
                    rechargeBalance: 0, 
                    plan: "Free Member", 
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(), 
                    totalEarnings: 0, 
                    totalDeposit: 0, 
                    totalWithdraw: 0, 
                    totalTasks: 0, 
                    totalReferrals: 0,
                    referralEarnings: 0,
                    stars: 0,
                    lastDailyBonus: null,
                    referralCode: userReferralCode,
                    referredBy: referralCode || null,
                    avatar: selectedAvatar,
                    
             deviceToken: deviceToken,       
                    address: '',
                    todayEarnings: 0,
                    lastQuizDate_general: null,
                    lastQuizDate_math: null,
                    lastQuizDate_science: null,
                    lastQuizDate_islamic: null
                };
                
                await db.collection("users").doc(uc.user.uid).set(userData);
                
                if(referralCode) {
    try {
        const referralQuery = await db.collection("users").where("referralCode", "==", referralCode).get();
        if(!referralQuery.empty) {
            const referrerDoc = referralQuery.docs[0];
            const referrerId = referrerDoc.id;
            
            // ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ
            let bAmt = parseFloat(systemSettings.referralBonus) || 5;
            
            // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶∞‡ßá‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
            await db.collection("users").doc(referrerId).update({
                mainBalance: firebase.firestore.FieldValue.increment(bAmt),
                totalEarnings: firebase.firestore.FieldValue.increment(bAmt),
                totalReferrals: firebase.firestore.FieldValue.increment(1),
                referralEarnings: firebase.firestore.FieldValue.increment(bAmt)
            });
            
            // ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
            await db.collection("history").add({
                userId: referrerId,
                type: "‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏",
                amount: bAmt,
                status: "Success",
                details: `${name} ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá`,
                date: new Date().toLocaleDateString('bn-BD'),
                time: new Date().toLocaleTimeString('bn-BD'),
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            await db.collection("users").doc(uc.user.uid).update({ referredBy: referralCode  });
        }
    } catch (e) { console.error("Referral Error:", e); }
}
                showSmartToast('‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶∏‡¶´‡¶≤! ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®', 'success');
                hideLoading();
           } catch (e) {
                hideLoading();
                console.error("Reg Error:", e);

                let banglaError = "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";

                // üî• ‡ßß. ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≤‡¶ï ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶è‡¶∞‡¶∞ (‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏)
                if (e.code === 'permission-denied' || e.message.includes("Missing or insufficient permissions")) {
                    
                    // ‚úÖ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶®‡¶æ ‡¶™‡ßá‡¶≤‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶¨‡ßá
                    // ‡¶Ø‡¶æ‡¶§‡ßá ‡¶∏‡ßç‡¶®‡ßç‡¶Ø‡¶æ‡¶™‡¶∂‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶è‡¶∞‡¶∞ ‡¶®‡¶æ ‡¶¶‡ßá‡ßü
                    if(auth.currentUser) { auth.signOut(); }

                    banglaError = "üö´ ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶è‡¶ï ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶®‡¶ø‡¶∑‡ßá‡¶ß‡•§";
                    
                    if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 100]); 
                }

                // ‡ß®. ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶•‡¶æ‡¶ï‡¶≤‡ßá
                else if (e.code === 'auth/email-already-in-use') {
                    banglaError = "‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                }

                // ‡ß©. ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶æ ‡¶π‡¶≤‡ßá
                else if (e.code === 'auth/invalid-email') {
                    banglaError = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§ ‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§";
                }

                // ‡ß™. ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßÅ‡¶∞‡ßç‡¶¨‡¶≤ ‡¶π‡¶≤‡ßá
                else if (e.code === 'auth/weak-password') {
                    banglaError = "‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ñ‡ßÅ‡¶¨ ‡¶¶‡ßÅ‡¶∞‡ßç‡¶¨‡¶≤‡•§ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ï‡¶†‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®‡•§";
                }

                // ‡ß´. ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá
                else if (e.code === 'auth/network-request-failed') {
                    banglaError = "‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶®‡ßá‡¶á‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                }

                // ‡ß¨. ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶¨‡ßç‡¶≤‡¶ï ‡¶π‡¶≤‡ßá
                else if (e.code === 'auth/too-many-requests') {
                    banglaError = "‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡¶®‡ßá‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶≠‡ßÅ‡¶≤ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                }

                // ‡ß≠. ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶°‡¶ø‡¶ú‡ßá‡¶¨‡¶≤ ‡¶π‡¶≤‡ßá
                else if (e.code === 'auth/user-disabled') {
                    banglaError = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§";
                }

                // ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶∞‡¶∞
                else {
                    banglaError = "‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + e.message;
                }

                showSmartToast(banglaError, 'error');
            }
        });

        document.getElementById('btnLoginAction').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            
            if(!email || !pass) return showSmartToast('‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®', 'error');
            
            try { 
                showLoading();
                showSmartToast('‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info'); 
                await auth.signInWithEmailAndPassword(email, pass); 
                showSmartToast('‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!', 'success'); 
                hideLoading();
            } catch (e) { 
                showSmartToast('‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°', 'error'); 
                hideLoading();
            }
        });

        // ‚úÖ AUTH STATE LISTENER WITH LOGIN NOTICE
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUserId = user.uid;
                showLoading();
                setTimeout(async () => {
                    await loadSystemSettings();
                    
                    if(maintenanceMode) {
                        hideLoading();
                        return;
                    }
                    
                    document.getElementById('authScreen').classList.add('hidden'); 
                    document.getElementById('mainApp').classList.remove('hidden'); 
                    document.getElementById('bottomNav').classList.remove('hidden');
    
        window.showPage('homeScreen');            
                    syncUserData(user.uid); 
                    renderTasks();
                    loadSummary(user.uid);
                    checkDailyBonus(user.uid);
                    loadTodayEarnings(user.uid);
                    loadSettingsFromLocalStorage(); // Load settings
                    
                    // Show icons
                    document.getElementById('globalChatIcon').style.display = 'flex';
                    document.getElementById('twaiChatbotIcon').style.display = 'flex';
                    
                    // ‚úÖ SHOW LOGIN NOTICE AFTER SUCCESSFUL LOGIN
                    setTimeout(async () => {
                        const noticeShown = await showLoginNotice();
                        if(noticeShown) {
                            console.log("Login notice shown successfully");
                        }
                    }, 1500);
                    
                    hideLoading();
                }, 2000);
            } else {
                document.getElementById('authScreen').classList.remove('hidden'); 
                document.getElementById('mainApp').classList.add('hidden'); 
                document.getElementById('bottomNav').classList.add('hidden');
                document.getElementById('globalChatIcon').style.display = 'none';
                document.getElementById('twaiChatbotIcon').style.display = 'none';
            }
        });

               // ‚úÖ SYNC USER DATA (FIXED SYNTAX, PLAN DISPLAY & VERIFIED BADGE)
        function syncUserData(uid) {
            // ‡ßß. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï
            db.collection("users").doc(uid).onSnapshot((d) => {
                if(d.exists) {
                    currentUserData = d.data();
                    const userData = currentUserData;
                    const safe = (id, txt) => { if(document.getElementById(id)) document.getElementById(id).innerText = txt; }

                    // üè∑Ô∏è ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶ø‡¶≤‡¶≠‡¶æ‡¶∞/‡¶ó‡ßã‡¶≤‡ßç‡¶°/‡¶°‡¶æ‡ßü‡¶Æ‡¶®‡ßç‡¶°)
                    const planEl = document.getElementById('userPlanDisplay');
                    if(planEl) planEl.innerText = userData.plan || "Free Member";

                    // üåÖ ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ó‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú (VIP ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
                    const displayH3 = document.getElementById('userNameDisplay');
                    if (displayH3) {
                        const hour = new Date().getHours();
                        let greeting = '';
                        if (hour >= 5 && hour < 12) greeting = '‡¶∂‡ßÅ‡¶≠ ‡¶∏‡¶ï‡¶æ‡¶≤ ‚òÄÔ∏è';
                        else if (hour >= 12 && hour < 17) greeting = '‡¶∂‡ßÅ‡¶≠ ‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞ üå§Ô∏è';
                        else if (hour >= 17 && hour < 20) greeting = '‡¶∂‡ßÅ‡¶≠ ‡¶¨‡¶ø‡¶ï‡ßá‡¶≤ üå•Ô∏è';
                        else greeting = '‡¶∂‡ßÅ‡¶≠ ‡¶∞‡¶æ‡¶§‡ßç‡¶∞‡¶ø üåô';

                        // ‡¶≤‡¶ú‡¶ø‡¶ï: ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® "Free Member" ‡¶®‡¶æ ‡¶π‡ßü, ‡¶§‡¶¨‡ßá‡¶á ‡¶®‡ßÄ‡¶≤ ‡¶ü‡¶ø‡¶ï ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                        const currentPlan = (userData.plan || "").toLowerCase();
                        const isPremium = currentPlan !== "" && currentPlan !== "free member" && !currentPlan.includes("free");

                        displayH3.innerHTML = `
                            ${greeting}, ${userData.name} 
                            ${isPremium ? '<span id="verifiedBadge" class="text-blue-400 text-sm ml-1"><i class="ri-checkbox-circle-fill"></i></span>' : ''}
                        `;
                    }

                    safe('profNameDisplay', userData.name);

                    // üí∞ ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
                    const newMain = userData.mainBalance || 0;
                    animateNumberUpdate('mainBalanceDisplay', lastValues.main, newMain);
                    animateNumberUpdate('walletMainDisplay', lastValues.main, newMain);
                    const balAmt = document.getElementById('balanceAmount');
                    if(balAmt) animateNumberUpdate('balanceAmount', lastValues.main, newMain);
                    lastValues.main = newMain;

                    // üîã ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
                    const newRech = userData.rechargeBalance || 0;
                    animateNumberUpdate('rechargePageBalance', lastValues.recharge, newRech);
                    animateNumberUpdate('walletRechargeDisplay', lastValues.recharge, newRech);
                    lastValues.recharge = newRech;

                    // üë• ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ü‡ßü ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
                    const newRef = userData.referralEarnings || 0;
                    animateNumberUpdate('referralEarnings', lastValues.ref, newRef);
                    lastValues.ref = newRef;
                    
                    // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                    if(document.getElementById('profNameInput')) document.getElementById('profNameInput').value = userData.name;
                    if(document.getElementById('profPhoneInput')) document.getElementById('profPhoneInput').value = userData.phone;
                    if(document.getElementById('profEmailInput')) document.getElementById('profEmailInput').value = userData.email;
                    if(document.getElementById('profAddressInput')) document.getElementById('profAddressInput').value = userData.address || '';
                    
                    // ‡¶è‡¶≠‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                    if(userData.avatar && document.getElementById('currentAvatar')) {
                        document.getElementById('currentAvatar').src = userData.avatar;
                    }

                    // ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶ö‡ßá‡¶ï
                    if(userData.packageExpiresAt) {
                        const expiryDate = userData.packageExpiresAt.toDate();
                        const now = new Date();
                        if(now > expiryDate) {
                            db.collection("users").doc(uid).update({
                                plan: "Free Member",
                                packageExpiresAt: firebase.firestore.FieldValue.delete()
                            });
                        }
                    }

                    // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                    if(document.getElementById('referralLink')) {
    const botUsername = "TAKA_WALA_TG_BOT"; // ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ
    const appName = "app"; // ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Ø‡¶º‡¶æ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶è‡¶∞ ‡¶∂‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶Æ (‡¶Ø‡¶æ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ)
    const tgRefLink = `https://t.me/${botUsername}/${appName}?startapp=${userData.referralCode}`;
    document.getElementById('referralLink').innerText = tgRefLink;
}
                                      if(userData.createdAt && document.getElementById('joinDate')) {
                        const date = userData.createdAt.toDate();
                        document.getElementById('joinDate').innerText = date.toLocaleDateString('bn-BD');
                    }
            
                   
                }
            }, (error) => { 
                // ‡ßß. ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶æ‡¶¶‡¶æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶´‡¶ø‡¶ï‡ßç‡¶∏)
                hideLoading();

                // ‡ß®. ‡¶Ø‡¶¶‡¶ø ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶è‡¶∞‡¶∞ ‡¶Ü‡¶∏‡ßá (‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®)
                if (error.code === 'permission-denied') {
                    console.warn("Security Alert: Permission Denied");
                    
                    // ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
                    auth.signOut(); 

                    // ‡¶π‡ßã‡¶Æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶≤‡ßÅ‡¶ï‡¶ø‡ßü‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                    document.getElementById('mainApp').classList.add('hidden');
                    document.getElementById('authScreen').classList.remove('hidden');

                    // ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
                    Swal.fire({
                        icon: 'error',
                        title: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶®‡ßá‡¶á! üö´',
                        html: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ü‡¶™‡¶®‡¶ø <b>‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</b> ‡¶ñ‡ßã‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§',
                        confirmButtonColor: '#ef4444',
                        confirmButtonText: '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá',
                        customClass: { popup: 'rounded-[25px]' }
                    });
                } else {
                    console.error("Sync Error:", error);
                }
            });
            
            // ‡ß®. ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï
            db.collection("settings").doc("appConfig").onSnapshot((d) => { 
                if(d.exists) {
                    systemSettings = d.data();
                    paymentNumbers = {
                        bKash: systemSettings.bkashNumber || "",
                        Nagad: systemSettings.nagadNumber || "",
                        Rocket: systemSettings.rocketNumber || "",
                        USDT_Polygon: systemSettings.polygonAddress || "",
                        USDT_BEP20: systemSettings.bep20Address || ""
                    };
                    updatePaymentMethodStatus();
                }
            });

            // ‡ß©. ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï
            db.collection("settings").doc("system").onSnapshot((d) => { 
                if(d.exists) {
                    const noticeElement = document.getElementById('noticeText');
                    if (noticeElement) noticeElement.innerHTML = d.data().noticeText || "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!";
                }
            });
        }
        // ‚úÖ FIXED: LOAD TODAY'S EARNINGS (SOLVED FIREBASE QUERY ERROR)
        async function loadTodayEarnings(uid) {
            try {
                const today = new Date();
                const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ timestamp ‡¶¶‡¶ø‡ßü‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶õ‡¶ø (amount ‡¶è‡¶∞ inequality ‡¶∏‡¶∞‡¶ø‡ßü‡ßá‡¶õ‡¶ø)
                const querySnapshot = await db.collection("history")
                    .where("userId", "==", uid)
                    .where("timestamp", ">=", todayStart)
                    .where("timestamp", "<", todayEnd)
                    .get();
                
                let todayTotal = 0;
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    // ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá amount ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø
                    const amount = parseFloat(data.amount) || 0;
                    if (amount > 0) {
                        todayTotal += amount;
                    }
                });
                
                todayEarnings = todayTotal;
                document.getElementById('todayEarnings').textContent = todayTotal.toFixed(2);
                
                // Update today's earnings in user document
                await db.collection("users").doc(uid).update({
                    todayEarnings: todayTotal
                });
                
            } catch (error) {
                console.error("Error loading today's earnings:", error);
            }
        }

         // ‚úÖ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (One Time & Daily Fix + Syntax Error Fix)
// ‚úÖ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏‡¶ø‡¶≠ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)
function renderTasks() {
    if (!currentUserId || !currentUserData) return;

    const list = document.getElementById('taskListContainer');
    if (!list) return;

    // ‡ßß. ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
    list.innerHTML = `
        <div class="flex flex-col items-center justify-center py-20 animate-pulse">
            <div class="w-10 h-10 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
            <p class="text-[11px] font-bold text-slate-400 mt-4 uppercase tracking-[2px]">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>`;

    const todayStr = new Date().toLocaleDateString('bn-BD');
    const uPlan = (currentUserData.plan || "free").toLowerCase();
    
    let uKey = "free";
    if (uPlan.includes("silver") || uPlan.includes("‡¶∏‡¶ø‡¶≤‡¶≠‡¶æ‡¶∞")) uKey = "silver";
    else if (uPlan.includes("gold") || uPlan.includes("‡¶ó‡ßã‡¶≤‡ßç‡¶°")) uKey = "gold";
    else if (uPlan.includes("vip") || uPlan.includes("‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø")) uKey = "vip";
    else if (uPlan.includes("platinum") || uPlan.includes("‡¶™‡ßç‡¶≤‡¶æ‡¶ü‡¶ø‡¶®‡¶æ‡¶Æ")) uKey = "platinum";

    // ‡ß®. ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶®‡¶æ
    db.collection("task_submissions")
        .where("userId", "==", currentUserId)
        .where("date", "==", todayStr)
        .get()
        .then((submissionSnap) => {
            const doneToday = new Set();
            submissionSnap.forEach(doc => doneToday.add(doc.data().taskId));

            // ‡ß©. ‡¶∏‡¶¨ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            return db.collection("tasks")
                .where("status", "==", "active")
                .orderBy("createdAt", "desc")
                .get()
                .then((snap) => {
                    list.innerHTML = '';
                    let hasTask = false;

                    snap.forEach(doc => {
                        const t = doc.data();
                        const taskId = doc.id;
                        
                        // ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶ö‡ßá‡¶ï‡¶ø‡¶Ç
                        const tPlans = (t.allowedPlans || []).map(p => p.toLowerCase());
                        const isAllowed = tPlans.includes('all') || tPlans.some(p => p.includes(uKey));
                        
                        // ‡¶ï‡ßã‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                        let shouldShow = false;
                        if (currentTaskType === 'free') {
                            if (tPlans.includes('all') || tPlans.some(p => p.includes('free'))) shouldShow = true;
                        } else {
                            if (isAllowed && uKey !== 'free') shouldShow = true;
                        }

                        if (shouldShow) {
                            // ‡¶≤‡¶ú‡¶ø‡¶ï: ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ü‡¶æ‡¶á‡¶™ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
                            let isCompleted = false;

                            if (t.taskType === 'one_time') {
                                // ‡¶ì‡ßü‡¶æ‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶π‡¶≤‡ßá ‡¶™‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶®‡ßá‡¶®‡ßç‡¶ü ‡¶ö‡ßá‡¶ï
                                if (t.completedBy && t.completedBy.includes(currentUserId)) {
                                    isCompleted = true;
                                }
                            } else {
                                // ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶π‡¶≤‡ßá ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ö‡ßá‡¶ï
                                if (doneToday.has(taskId)) {
                                    isCompleted = true;
                                }
                            }

                            // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶®‡¶æ ‡¶π‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá‡¶á ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßã
                            if (!isCompleted) {
                                hasTask = true;

                                let icon = 'ri-links-line', iconColor = 'from-slate-400 to-slate-600';
                                const link = (t.link || "").toLowerCase();
                                if (link.includes('youtube.com') || link.includes('youtu.be')) { icon = 'ri-youtube-fill'; iconColor = 'from-red-500 to-rose-600'; } 
                                else if (link.includes('facebook.com')) { icon = 'ri-facebook-circle-fill'; iconColor = 'from-blue-600 to-indigo-700'; } 
                                else if (link.includes('t.me')) { icon = 'ri-telegram-fill'; iconColor = 'from-sky-400 to-blue-500'; }
                                else if (link.includes('tiktok.com')) { icon = 'ri-tiktok-fill'; iconColor = 'from-slate-800 to-black'; }

                                const freqClass = t.taskType === 'daily' ? 'bg-blue-50 text-blue-600 border-blue-100' : 'bg-red-50 text-red-600 border-red-100';
                                const freqText = t.taskType === 'daily' ? '‡¶∞‡ßã‡¶ú ‡ßß‡¶¨‡¶æ‡¶∞' : '‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ßß‡¶¨‡¶æ‡¶∞';
                                
                                const safeTitle = (t.title || '').replace(/'/g, "\\'").replace(/"/g, "&quot;");
                                const safeDesc = (t.description || '').replace(/'/g, "\\'").replace(/"/g, "&quot;").replace(/\n/g, " ");
                                const safeLink = (t.link || '#').replace(/'/g, "\\'");

                                let planBadges = '';
                                t.allowedPlans.forEach(p => {
                                    let pName = p.toUpperCase();
                                    let pStyle = 'bg-slate-100 text-slate-600 border-slate-200';
                                    if(pName.includes('GOLD')) pStyle = 'bg-yellow-100 text-yellow-700 border-yellow-200';
                                    else if(pName.includes('VIP')) pStyle = 'bg-purple-100 text-purple-700 border-purple-200';
                                    else if(pName.includes('ALL')) { pName = '‡¶∏‡¶¨‡¶æ‡¶á'; pStyle = 'bg-emerald-50 text-emerald-600 border-emerald-100'; }
                                    // üî• Fix: mr-1 ‡¶∏‡¶∞‡¶ø‡ßü‡ßá gap-1 ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá HTML ‡¶è
                                    planBadges += `<span class="${pStyle} text-[8px] font-bold px-1.5 py-0.5 rounded border uppercase">${pName}</span>`;
                                });

                                list.innerHTML += `
                                <div class="bg-white rounded-2xl p-4 mb-4 border border-slate-100 shadow-sm animate__animated animate__fadeInUp">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="flex items-center gap-3 w-full"> <!-- w-full ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                                            <div class="w-10 h-10 bg-gradient-to-br ${iconColor} rounded-xl flex items-center justify-center text-xl text-white shadow-md shrink-0">
                                                <i class="${icon}"></i>
                                            </div>
                                            <div class="overflow-hidden flex-1"> <!-- flex-1 ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                                                <h4 class="font-bold text-slate-800 text-[14px] leading-tight truncate">${t.title}</h4>
                                                <div class="space-y-1.5 mt-1.5">
                                                    <div class="flex items-center gap-1">
                                                        <span class="text-[9px] text-slate-400 font-bold shrink-0">‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó:</span>
                                                        <span class="${freqClass} text-[8px] font-black px-1.5 py-0.5 rounded border uppercase">${freqText}</span>
                                                    </div>
                                                    
                                                    <!-- üî• ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°: flex-wrap ‡¶è‡¶¨‡¶Ç gap ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                                                    <div class="flex flex-wrap items-start gap-1">
                                                        <span class="text-[9px] text-slate-400 font-bold shrink-0 mt-0.5">‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ:</span>
                                                        <div class="flex flex-wrap gap-1">${planBadges}</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- ‡¶∞‡¶ø‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶°‡¶æ‡¶® ‡¶™‡¶æ‡¶∂‡ßá ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° -->
                                            <div class="bg-emerald-50 px-2 py-1 rounded-lg border border-emerald-100 text-center shrink-0 ml-1">
                                                <span class="text-[12px] font-black text-emerald-600">‡ß≥${t.reward}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button onclick="window.completeTask('${taskId}', ${t.reward}, 'general', '${safeTitle}', '${safeDesc}', '${safeLink}')" 
                                        class="w-full h-10 bg-slate-900 text-white rounded-xl text-[11px] font-bold active:scale-95 transition-all shadow-md">
                                        ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
                                    </button>
                                </div>`;
                            }
                        }
                    });

                    if (!hasTask) {
                        list.innerHTML = `
                            <div class="flex flex-col items-center justify-center py-24 text-center animate__animated animate__fadeIn">
                                <div class="relative mb-6">
                                    <img src="https://i.postimg.cc/d1sXyCb6/clipboard.png" 
                                         class="w-32 opacity-20 grayscale">
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <i class="ri-checkbox-circle-fill text-4xl text-emerald-500 shadow-sm"></i>
                                    </div>
                                </div>
                                <h3 class="text-xl font-black text-slate-800">‡¶∏‡¶¨ ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑!</h3>
                                <p class="text-xs text-slate-400 mt-2 px-10">‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§</p>
                                <button onclick="renderTasks()" class="mt-8 px-10 py-3 bg-emerald-600 text-white rounded-full text-xs font-black shadow-lg active:scale-95 transition-all">
                                    ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®
                                </button>
                            </div>`;
                    }
                });
        })
        .catch((error) => {
            console.error("Task Error: ", error);
            list.innerHTML = `<p class="text-center text-red-500 py-10 font-bold">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶¶‡¶ø‡¶®‡•§</p>`;
        });
}
                            
        // ‚úÖ ENHANCED HISTORY SYSTEM WITH FILTER - FIXED LAYOUT
        window.loadHistory = () => {
            window.showPage('historyScreen');
            document.getElementById('historyListContainer').innerHTML = `
                <div class="history-loading">
                    <div class="animate-pulse">
                        <div class="h-4 bg-slate-200 rounded w-3/4 mx-auto mb-4"></div>
                        <div class="h-20 bg-slate-100 rounded-lg mb-3"></div>
                        <div class="h-20 bg-slate-100 rounded-lg mb-3"></div>
                        <div class="h-20 bg-slate-100 rounded-lg"></div>
                    </div>
                </div>
            `;
            
            loadSimpleHistory('all');
        };
        
        window.filterHistory = (filterType) => {
            currentHistoryFilter = filterType;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}`).classList.add('active');
            
            loadSimpleHistory(filterType);
        };
        
      // ‚úÖ FINAL FIXED: HISTORY LOAD FUNCTION (CENTERED EMPTY + ANIMATED STATUS)
// ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤
let historyUnsubscribe = null;

async function loadSimpleHistory(filterType = 'all') {
    const list = document.getElementById('historyListContainer');
    if (!list) return;
    
    showLoading();
    
    // ‡ßß. ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
    if (historyUnsubscribe) {
        historyUnsubscribe();
    }

    try {
        // ‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶õ‡¶æ‡ßú‡¶æ‡¶á ‡¶∏‡¶¨ ‡¶Ü‡¶®‡¶¨‡ßã (‡¶Ø‡¶æ‡¶§‡ßá ‡¶°‡¶æ‡¶¨‡¶≤ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶≤‡ßá‡¶ì ‡¶ß‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá)
        let query = db.collection("history")
            .where("userId", "==", currentUserId)
            .orderBy("timestamp", "desc")
            .limit(50);

        // ‡ß®. ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ (.onSnapshot)
        historyUnsubscribe = query.onSnapshot((querySnapshot) => {
            list.innerHTML = ''; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶≤‡ßá ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá
            
            const seenTrx = new Set();
            const allDocs = [];

            // ‡¶°‡¶¨‡¶≤ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
            querySnapshot.forEach(doc => {
                const h = doc.data();
                const key = `${Math.abs(h.amount)}_${h.date}_${(h.type || "").substring(0,3).toLowerCase()}`;
                if (h.status !== "Pending") seenTrx.add(key);
                allDocs.push({id: doc.id, key: key, ...h});
            });

            let hasVisibleItems = false; // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø

            allDocs.forEach(h => {
                // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶∏‡ßç‡¶ï‡¶ø‡¶™
                if (h.status === "Pending" && seenTrx.has(h.key)) return;

                // ‡ß©. ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡¶ø‡¶Ç (‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ)
                let shouldShow = false;
                const t = (h.type || "").toLowerCase();

                if (filterType === 'all') {
                    shouldShow = true;
                } else if (filterType === 'deposit' && (t.includes('deposit') || t.includes('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü'))) {
                    shouldShow = true;
                } else if (filterType === 'withdraw' && (t.includes('withdraw') || t.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®'))) {
                    shouldShow = true;
                } else if (filterType === 'recharge' && (t.includes('recharge') || t.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú'))) {
                    shouldShow = true;
                } else if (filterType === 'task' && (t.includes('task') || t.includes('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï'))) {
                    shouldShow = true;
                } else if (filterType === 'bonus' && (t.includes('bonus') || t.includes('‡¶¨‡ßã‡¶®‡¶æ‡¶∏'))) {
                    shouldShow = true;
                } else if (filterType === 'quiz' && (t.includes('quiz') || t.includes('‡¶ï‡ßÅ‡¶á‡¶ú'))) {
                    shouldShow = true;
                }

                // ‡¶Ø‡¶¶‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶®‡¶æ ‡¶Æ‡¶ø‡¶≤‡ßá ‡¶§‡¶¨‡ßá ‡¶è‡¶á ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
                if (!shouldShow) return;

                hasVisibleItems = true; // ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá

                const date = h.date || '---';
                const time = h.time || '---';
                
                let icon = 'https://i.postimg.cc/VNTvSLRX/transaction-history.png';
                let bgColor = 'bg-slate-100';
                if(t.includes('recharge') || t.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')) { icon = 'https://i.postimg.cc/jjdpNH5b/payment-method.png'; bgColor = 'bg-blue-50'; } 
                else if(t.includes('withdraw') || t.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®')) { icon = 'https://i.postimg.cc/wMdF5zV5/withdraw.png'; bgColor = 'bg-red-50'; } 
                else if(t.includes('deposit') || t.includes('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü')) { icon = 'https://i.postimg.cc/7ZGpHH5q/save-money.png'; bgColor = 'bg-green-50'; } 

                const amount = parseFloat(h.amount) || 0;
                const amountColor = amount > 0 ? 'text-green-600' : 'text-red-500';
                const amountSign = amount > 0 ? '+' : '';

                let statusBadge = '';
                if(h.status === 'Pending') {
                    statusBadge = `<div class="flex items-center gap-1.5 bg-yellow-50 text-yellow-700 px-2.5 py-1 rounded-full border border-yellow-200"><i class="ri-loader-4-line animate-spin text-sm"></i><span class="text-[10px] font-bold">‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç</span></div>`;
                } else if(h.status === 'Success' || h.status === 'Approved' || h.status === '‡¶∏‡¶´‡¶≤') {
                    statusBadge = `<div class="flex items-center gap-1.5 bg-green-50 text-green-700 px-2.5 py-1 rounded-full border border-green-200"><i class="ri-checkbox-circle-fill text-sm"></i><span class="text-[10px] font-bold">‡¶∏‡¶´‡¶≤</span></div>`;
                } else {
                    statusBadge = `<div class="flex items-center gap-1.5 bg-red-50 text-red-700 px-2.5 py-1 rounded-full border border-red-200"><i class="ri-close-circle-fill text-sm"></i><span class="text-[10px] font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</span></div>`;
                }

                list.innerHTML += `
                <div class="history-item glass-card p-4 rounded-2xl mb-3 border border-slate-50 hover:shadow-md transition-all animate__animated animate__fadeIn">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 ${bgColor} rounded-full flex items-center justify-center"><img src="${icon}" class="w-5 h-5"></div>
                            <div><h4 class="font-bold text-slate-700 text-sm">${h.type}</h4><p class="text-[10px] text-slate-400 font-medium">${date} ‚Ä¢ ${time}</p></div>
                        </div>
                        <div class="text-right"><span class="block text-sm font-black ${amountColor}">${amountSign}‡ß≥${Math.abs(amount).toFixed(2)}</span></div>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-dashed border-slate-100">
                        ${statusBadge}
                        <button onclick="window.openHistoryReceipt('${h.id}')" class="flex items-center gap-1 text-slate-500 hover:text-blue-600 transition-colors"><span class="text-[10px] font-bold">‡¶∞‡¶ø‡¶∏‡¶ø‡¶ü</span><i class="ri-arrow-right-s-line"></i></button>
                    </div>
                </div>`;
            });

            // EMPTY STATE (‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶¨‡¶æ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ ‡¶Æ‡ßá‡¶≤‡ßá)
            if(!hasVisibleItems) { 
                list.innerHTML = `
                <div class="flex flex-col items-center justify-center w-full py-16 text-center animate__animated animate__fadeIn">
                    <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-4 shadow-sm border border-slate-100">
                        <img src="https://i.postimg.cc/VNTvSLRX/transaction-history.png" class="w-10 h-10 opacity-30 grayscale">
                    </div>
                    <h3 class="text-lg font-bold text-slate-500">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</h3>
                </div>`; 
            }

            hideLoading();
        }, (error) => {
            console.error("Snapshot error:", error);
            hideLoading();
        });

    } catch (error) {
        console.error("Error:", error);
        hideLoading();
    }
}

// ‚úÖ NEW DETAILED HISTORY RECEIPT FUNCTION (FULL INFO)
window.openHistoryReceipt = async (docId) => {
    showLoading();
    try {
        const doc = await db.collection("history").doc(docId).get();
        if (!doc.exists) { 
            showSmartToast("‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø", "error"); 
            hideLoading(); 
            return; 
        }
        
        const data = doc.data();
        
        // ‡ßß. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡¶∞‡¶Æ‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ‡¶•‡ßá‡¶ï‡ßá)
        // currentUserData ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶•‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶è‡¶≠‡ßá‡¶á‡¶≤‡ßá‡¶¨‡¶≤ ‡¶•‡¶æ‡¶ï‡ßá
        document.getElementById('uReceiptName').innerText = currentUserData?.name || "Unknown";
        document.getElementById('uReceiptPhone').innerText = currentUserData?.phone || "N/A";

        // ‡ß®. ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶™‡¶ø ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
        const shortTrx = docId.length > 20 ? docId.substring(0, 18) + "..." : docId;
        const fullTrx = data.trxId || docId; // ‡¶Ü‡¶∏‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        
        const trxEl = document.getElementById('uReceiptTrx');
        trxEl.innerText = fullTrx; 
        trxEl.dataset.fullTrx = fullTrx;

        // ‡ß©. ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶§‡¶•‡ßç‡¶Ø
        document.getElementById('uReceiptType').innerText = data.type || "‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®";
        document.getElementById('uReceiptAmount').innerText = `‡ß≥${Math.abs(parseFloat(data.amount || 0)).toFixed(2)}`;
        document.getElementById('uReceiptTime').innerText = data.time || "";
        document.getElementById('uReceiptDate').innerText = data.date || "";

        // ‡ß™. ‡¶Æ‡ßá‡¶•‡¶° ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶á‡¶ï‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
        const method = (data.method || data.paymentMethod || data.operator || "System").toUpperCase();
        document.getElementById('uReceiptMethod').innerText = method;
        
        const methodIconEl = document.getElementById('uReceiptMethodIcon');
        let methodIcon = "";
        
        if(method.includes('BKASH')) methodIcon = "https://i.postimg.cc/C5vDR4nz/1656235223bkash-logo.png";
        else if(method.includes('NAGAD')) methodIcon = "https://i.postimg.cc/k4phWWbK/1679248787Nagad-Logo.png";
        else if(method.includes('ROCKET')) methodIcon = "https://i.postimg.cc/xTbBypgf/vecteezy-rocket-color-logo-mobile-banking-icon-68706013.png";
        else if(method.includes('GP')) methodIcon = "https://i.postimg.cc/65w1n62J/FB-IMG-1769495932877.jpg";
        else if(method.includes('ROBI')) methodIcon = "https://i.postimg.cc/RFHbQNLZ/FB-IMG-1769495977203.jpg";
        else if(method.includes('AIRTEL')) methodIcon = "https://i.postimg.cc/Wz0CjhdX/FB-IMG-1769496019329.jpg";
        else if(method.includes('BL') || method.includes('BANGLALINK')) methodIcon = "https://i.postimg.cc/gJ8NL1Gx/FB-IMG-1769495999103.jpg";
        else if(method.includes('TELETALK')) methodIcon = "https://i.postimg.cc/TYCQbVvT/FB-IMG-1769496047333.jpg";

        if(methodIcon) {
            methodIconEl.src = methodIcon;
            methodIconEl.classList.remove('hidden');
        } else {
            methodIconEl.classList.add('hidden');
        }

        // ‡ß´. ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶á‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ß‡¶∞‡¶æ
        const statusEl = document.getElementById('uReceiptStatus');
        const iconBg = document.getElementById('uReceiptIconBg');
        const icon = document.getElementById('uReceiptIcon');
        const amountEl = document.getElementById('uReceiptAmount');
        
        const noteBox = document.getElementById('uReceiptNoteBox');
        const noteTitle = document.getElementById('uNoteTitle');
        const noteText = document.getElementById('uNoteText');
        const noteIcon = document.getElementById('uNoteIcon');
        const noteIconBg = document.getElementById('uNoteIconBg');

        const status = data.status || 'Pending';
        statusEl.innerText = status;
        
        // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶®‡ßã‡¶ü ‡¶π‡¶æ‡¶á‡¶°
        noteBox.classList.add('hidden');

        // ‡ß¨. ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶û‡ßç‡¶ú (‡¶≤‡¶æ‡¶≤/‡¶∏‡¶¨‡ßÅ‡¶ú/‡¶π‡¶≤‡ßÅ‡¶¶)
        if (status === 'Rejected' || status === 'Failed' || status === '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤') {
            // üî¥ ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
            statusEl.className = "text-2xl font-black text-red-500 tracking-tight mb-1";
            iconBg.className = "w-20 h-20 rounded-full mx-auto flex items-center justify-center mb-3 shadow-lg border-4 border-white transition-colors bg-red-50";
            icon.className = "ri-close-line text-4xl text-red-500";
            amountEl.className = "font-black text-red-500 text-base";

            // ‡¶®‡ßã‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏
            noteBox.className = "mt-4 p-3 rounded-xl text-left bg-red-50 border border-red-100 border-dashed block";
            noteIconBg.className = "w-5 h-5 rounded-full flex items-center justify-center shrink-0 mt-0.5 bg-red-500";
            noteIcon.className = "ri-close-line text-xs text-white";
            noteTitle.className = "text-[10px] font-bold uppercase mb-0.5 text-red-600";
            noteTitle.innerText = "‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£:";
            
            let reason = data.rejectionReason || data.details || "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶ï ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§";
            reason = reason.replace("Rejected: ", "").replace("‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°: ", "");
            noteText.className = "text-xs font-medium leading-relaxed text-red-600";
            noteText.innerText = reason;

        } else if (status === 'Success' || status === 'Approved' || status === '‡¶∏‡¶´‡¶≤') {
            // üü¢ ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
            statusEl.className = "text-2xl font-black text-green-600 tracking-tight mb-1";
            iconBg.className = "w-20 h-20 rounded-full mx-auto flex items-center justify-center mb-3 shadow-lg border-4 border-white transition-colors bg-green-50";
            icon.className = "ri-check-line text-4xl text-green-500";
            amountEl.className = "font-black text-green-600 text-base";

            // ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶®‡ßã‡¶ü (‡¶Ø‡¶¶‡¶ø ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶•‡¶æ‡¶ï‡ßá)
            if(data.details && !data.details.includes(docId)) {
                noteBox.className = "mt-4 p-3 rounded-xl text-left bg-green-50 border border-green-100 border-dashed block";
                noteIconBg.className = "w-5 h-5 rounded-full flex items-center justify-center shrink-0 mt-0.5 bg-green-500";
                noteIcon.className = "ri-check-line text-xs text-white";
                noteTitle.className = "text-[10px] font-bold uppercase mb-0.5 text-green-600";
                noteTitle.innerText = "‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§:";
                noteText.className = "text-xs font-medium leading-relaxed text-green-600";
                noteText.innerText = data.details;
            }

        } else {
            // üü° ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
            statusEl.className = "text-2xl font-black text-yellow-600 tracking-tight mb-1";
            iconBg.className = "w-20 h-20 rounded-full mx-auto flex items-center justify-center mb-3 shadow-lg border-4 border-white transition-colors bg-yellow-50";
            icon.className = "ri-time-line text-4xl text-yellow-500";
            amountEl.className = "font-black text-slate-800 text-base";
        }

        // ‡ß≠. ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
        document.getElementById('userReceiptModal').classList.remove('hidden');
        
    } catch (error) {
        console.error(error);
        showSmartToast("‡¶è‡¶∞‡¶∞ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "error");
    }
    hideLoading();
};

// ‚úÖ COPY TRX ID FUNCTION
window.copyReceiptTrx = () => {
    const trxId = document.getElementById('uReceiptTrx').dataset.fullTrx;
    if(trxId) {
        window.copyToClipboard(trxId);
    } else {
        showSmartToast("‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶Ü‡¶á‡¶°‡¶ø ‡¶®‡ßá‡¶á", "error");
    }
};

// ‚úÖ CLOSE MODAL FUNCTION
window.closeUserReceiptModal = () => {
    document.getElementById('userReceiptModal').classList.add('hidden');
};

       // ‚úÖ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ
        window.showQuizQuestions = async (type) => {
            // ‡ßß. ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ö‡ßá‡¶ï
            if(currentUserData) {
                const today = new Date().toDateString();
                const lastQuizDateField = `lastQuizDate_${type}`;
                const lastQuizDate = currentUserData[lastQuizDateField] ? 
                    new Date(currentUserData[lastQuizDateField].toDate()).toDateString() : null;
                
                if(lastQuizDate === today) {
                    showSmartToast(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ‡¶è‡¶á ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶∞ ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ñ‡ßá‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶∏‡ßÅ‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            currentQuizType = type;
            selectedAnswers = {};
            currentLoadedQuizzes = []; 
            
            const quizTitles = {
                general: '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ú‡ßç‡¶û‡¶æ‡¶®', math: '‡¶ó‡¶£‡¶ø‡¶§', science: '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®', islamic: '‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï'
            };
            document.getElementById('quizTypeTitle').textContent = quizTitles[type] || '‡¶ï‡ßÅ‡¶á‡¶ú';
            
            const container = document.getElementById('quizQuestionsContainer');
            container.innerHTML = `
                <div class="text-center py-10">
                    <div class="w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
                    <p class="mt-2 text-slate-400 text-xs font-bold">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>`;
            document.getElementById('submitQuizBtn').classList.add('hidden');
            
            window.switchQuizTab('questions');

            try {
                // ‡ß®. ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶≤‡ßã‡¶°
                const snapshot = await db.collection("quizzes")
                    .where("category", "==", type)
                    .where("status", "==", "active")
                    .limit(5) 
                    .get();

                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="text-center py-16 opacity-60">
                            <i class="ri-file-list-3-line text-5xl text-slate-300"></i>
                            <p class="text-slate-500 mt-2 font-bold">‡¶è‡¶á ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶§‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶®‡ßá‡¶á‡•§</p>
                            <button onclick="window.switchQuizTab('types')" class="mt-4 bg-slate-100 text-slate-700 px-6 py-2 rounded-full font-bold text-xs">‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
                        </div>`;
                    return;
                }

                snapshot.forEach(doc => {
                    currentLoadedQuizzes.push({ id: doc.id, ...doc.data() });
                });

                // ‡ß©. ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
                let questionsHtml = '';
                currentLoadedQuizzes.forEach((q, qIndex) => {
                    let optionsHtml = '';
                    q.options.forEach((option, oIndex) => {
                        optionsHtml += `
                            <div class="flex items-center p-4 bg-white rounded-2xl border border-slate-100 cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition-all mb-3 shadow-sm group" onclick="window.selectQuizAnswer(${qIndex}, ${oIndex})">
                                <div class="w-6 h-6 rounded-full border-2 border-slate-200 flex items-center justify-center mr-3 group-hover:border-purple-500 transition-all">
                                    <input type="radio" name="quizQuestion${qIndex}" id="q${qIndex}o${oIndex}" class="accent-purple-600 hidden">
                                    <div class="radio-dot w-2 h-2 rounded-full bg-purple-600 opacity-0 transition-all" id="dot${qIndex}o${oIndex}"></div>
                                </div>
                                <label for="q${qIndex}o${oIndex}" class="flex-1 cursor-pointer font-bold text-slate-600 text-sm">${option}</label>
                            </div>
                        `;
                    });
                    
                    questionsHtml += `
                        <div class="mb-8 p-5 bg-white rounded-3xl border border-slate-50 shadow-sm animate__animated animate__fadeInUp">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="bg-purple-100 text-purple-600 w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs">Q${qIndex + 1}</span>
                                <h4 class="font-bold text-slate-800 text-sm">${q.question}</h4>
                            </div>
                            <div class="space-y-1">${optionsHtml}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = questionsHtml;
                document.getElementById('submitQuizBtn').classList.remove('hidden');
                
                startQuizTimer();

            } catch (error) {
                console.error(error);
                container.innerHTML = '<p class="text-center text-red-500 py-10 font-bold">‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
            }
        };

        // ‚úÖ ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®
        window.submitQuiz = async () => {
            const answeredCount = Object.keys(selectedAnswers).length;
            if(answeredCount < currentLoadedQuizzes.length) { 
                showSmartToast('‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®', 'error'); 
                return; 
            }
            
            if(quizTimer) clearInterval(quizTimer);
            
            let totalReward = 0;
            let correctCount = 0;

            currentLoadedQuizzes.forEach((q, index) => {
                // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ correctAnswer ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶ö‡ßá‡¶ï
                if(selectedAnswers[index] === q.correctAnswer) {
                    correctCount++;
                    // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡¶¶‡¶ø ‡ßß‡ß¶ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡ßß ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶π‡¶¨‡ßá (points / 10)
                    const points = q.points || 2.5; 
                    totalReward += (points / 10);
                }
            });
            
            // ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá)
            const result = await Swal.fire({
                title: '‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! üéâ',
                html: `‡¶Ü‡¶™‡¶®‡¶ø <b>${correctCount}‡¶ü‡¶ø</b> ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§<br>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: <b>‡ß≥${totalReward.toFixed(2)}</b>`,
                icon: 'success',
                showCancelButton: true,
                confirmButtonText: '‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶®‡¶ø‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                confirmButtonColor: '#8b5cf6'
            });

            if (result.isConfirmed) {
                onAdCompleted = async () => {
                    showLoading();
                    try {
                        const userRef = db.collection("users").doc(currentUserId);
                        await userRef.update({
                            mainBalance: firebase.firestore.FieldValue.increment(totalReward),
                            totalEarnings: firebase.firestore.FieldValue.increment(totalReward),
                            todayEarnings: firebase.firestore.FieldValue.increment(totalReward),
                            [`lastQuizDate_${currentQuizType}`]: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        await db.collection("history").add({
                            userId: currentUserId, 
                            type: "‡¶ï‡ßÅ‡¶á‡¶ú ‡¶¨‡ßã‡¶®‡¶æ‡¶∏", 
                            amount: totalReward, 
                            status: "Success",
                            details: `${currentQuizType} ‡¶ï‡ßÅ‡¶á‡¶ú‡ßá ${correctCount}‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡•§`, 
                            date: new Date().toLocaleDateString('bn-BD'),
                            time: new Date().toLocaleTimeString('bn-BD'), 
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        // ‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                        
                        showSmartToast(`‡ß≥${totalReward.toFixed(2)} ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!`, 'success');
                        window.playSound('snd_success');
                        hideLoading();
                        window.switchQuizTab('types');
                        
                    } catch (error) { 
                        showSmartToast('‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'error'); 
                        hideLoading(); 
                    }
                };
                showInterstitialAd();
            } else {
                window.switchQuizTab('types');
            }
        };

        // ‚úÖ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
        window.switchQuizTab = (tab) => {
            const typesSection = document.getElementById('quizTypesSection');
            const questionsSection = document.getElementById('quizQuestionsSection');
            const btnTypes = document.getElementById('tabQuizTypes');
            const btnQuestions = document.getElementById('tabQuizQuestions');

            if (tab === 'types') {
                typesSection.classList.remove('hidden');
                questionsSection.classList.add('hidden');
                btnTypes.className = 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow';
                btnQuestions.className = 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            } else {
                typesSection.classList.add('hidden');
                questionsSection.classList.remove('hidden');
                btnQuestions.className = 'flex-1 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow';
                btnTypes.className = 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500';
            }
        };

        // ‚úÖ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
        window.startQuizTimer = () => {
            if(quizTimer) clearInterval(quizTimer);
            let timeLeft = 60; 
            const timerElement = document.getElementById('quizTimer');
            
            quizTimer = setInterval(() => {
                timeLeft--;
                timerElement.innerText = timeLeft;
                if(timeLeft <= 10) timerElement.classList.replace('bg-blue-500', 'bg-red-500');
                if(timeLeft <= 0) {
                    clearInterval(quizTimer);
                    showSmartToast('‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑!', 'warning');
                    window.submitQuiz();
                }
            }, 1000);
        };

        // ‚úÖ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï
        window.selectQuizAnswer = (qIndex, oIndex) => {
            // ‡¶∞‡ßá‡¶°‡¶ø‡¶ì ‡¶°‡¶ü ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
            document.querySelectorAll(`[name="quizQuestion${qIndex}"]`).forEach((el, idx) => {
                const dot = document.getElementById(`dot${qIndex}o${idx}`);
                if(idx === oIndex) {
                    dot.style.opacity = "1";
                    dot.style.transform = "scale(1.2)";
                } else {
                    dot.style.opacity = "0";
                    dot.style.transform = "scale(0.8)";
                }
            });
            
            selectedAnswers[qIndex] = oIndex;
            window.playSound('snd_click');
        };
        // ‚úÖ PROFILE FUNCTIONS
        window.showAvatarSelector = () => {
            document.getElementById('avatarModal').classList.remove('hidden');
        };
        
        window.closeAvatarModal = () => {
            document.getElementById('avatarModal').classList.add('hidden');
        };
        
        window.selectAvatar = (avatarUrl) => {
            selectedAvatar = avatarUrl;
            document.getElementById('currentAvatar').src = avatarUrl;
            window.closeAvatarModal();
            showSmartToast('‡¶è‡¶≠‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
        };
        
        window.updateProfile = async () => { 
            try {
                showLoading();
                await db.collection("users").doc(currentUserId).update({ 
                    name: document.getElementById('profNameInput').value, 
                    email: document.getElementById('profEmailInput').value,
                    address: document.getElementById('profAddressInput').value,
                    avatar: selectedAvatar
                }); 
                
                document.getElementById('currentAvatar').src = selectedAvatar;
                
                showSmartToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success'); 
                hideLoading();
            } catch (e) {
                showSmartToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        window.showChangePassword = async () => {
            const { value: newPassword } = await Swal.fire({
                title: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®',
                input: 'password',
                inputLabel: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (‡ß¨+ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)',
                inputPlaceholder: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®',
                showCancelButton: true,
                confirmButtonText: '‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                inputValidator: (value) => {
                    if (!value || value.length < 6) {
                        return '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá';
                    }
                }
            });
            
            if (newPassword) {
                try {
                    showLoading();
                    const user = auth.currentUser;
                    await user.updatePassword(newPassword);
                    showSmartToast('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶´‡¶≤', 'success');
                    hideLoading();
                } catch (error) {
                    showSmartToast('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                    hideLoading();
                }
            }
        };

        // ‚úÖ NEW UPDATED TASK COMPLETION - 20 SECONDS STRICT TIMER
        window.completeTask = async (taskId, reward, taskType, title, description, link) => {
            if(!currentUserData) return;
            
            currentTaskInfo = { taskId, reward, taskType, title, description, link };
            
            // ‡ßß. ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶∏‡ßç‡¶ü‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
            showInterstitialAd();
            
            // ‡ß®. ‡ß¶.‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶¨‡ßá
            setTimeout(() => {
                window.open(link, '_blank');
            }, 500);
            
            // ‡ß©. ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ
            startTaskTimer();
            
            showSmartToast('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡ß®‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßá ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§', 'info');
        };
        
       function startTaskTimer() {
            if(taskTimer) clearInterval(taskTimer);
            
            // ‡ßß. ‡ß®‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ß®‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶Æ ‡¶∏‡¶Æ‡ßü ‡¶®‡¶ø‡¶¨‡ßá
            let timeLeft = Math.floor(Math.random() * (25 - 20 + 1)) + 20; 
            let cheatCount = 0; // ‡ß®. ‡¶ö‡¶ø‡¶ü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ (‡ß¶ ‡¶•‡ßá‡¶ï‡ßá)
            
            taskTimer = setInterval(() => {
                // ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡ßá (‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶•‡¶æ‡¶ï‡ßá)
                if (!document.hidden) {
                    timeLeft--;
                    
                    if(timeLeft <= 0) {
                        clearInterval(taskTimer);
                        showProofSubmissionForm(); // ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ ‡¶Ü‡¶∏‡¶¨‡ßá
                        showSmartToast('‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶è‡¶ñ‡¶® ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®‡•§', 'success');
                    }
                } else {
                    // ‡ß©. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá
                    cheatCount++; 
                    
                    if(cheatCount >= 3) {
                        // ‡¶Ø‡¶¶‡¶ø ‡ß© ‡¶¨‡¶æ‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶õ‡ßá‡ßú‡ßá ‡¶Ø‡¶æ‡ßü, ‡¶§‡¶¨‡ßá ‡¶∏‡¶¨ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶π‡ßã‡¶Æ‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶¨‡ßá
                        clearInterval(taskTimer);
                        window.showPage('homeScreen'); 
                        
                        Swal.fire({
                            title: '‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤! ‚ùå',
                            text: '‡¶Ü‡¶™‡¶®‡¶ø ‡ß© ‡¶¨‡¶æ‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶õ‡ßá‡ßú‡ßá‡¶õ‡ßá‡¶®, ‡¶§‡¶æ‡¶á ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ü‡¶ø ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑ ‡¶®‡¶æ ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶õ‡¶æ‡ßú‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§',
                            icon: 'error',
                            confirmButtonText: '‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®',
                            confirmButtonColor: '#ef4444',
                            customClass: { popup: 'rounded-[25px]' }
                        });
                    } else {
                        // ‡ß© ‡¶¨‡¶æ‡¶∞ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶ó ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶¶‡¶ø‡¶¨‡ßá
                        showSmartToast(`‚ö†Ô∏è ‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®! ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶õ‡¶æ‡ßú‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§ (‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç: ${cheatCount}/3)`, 'error');
                        if (navigator.vibrate) navigator.vibrate(100); 
                    }
                }
            }, 1000);
        }
       
       
                       // ‚úÖ GORGEOUS PROOF SUBMISSION FORM (SMART CATEGORY LOGIC)
        function showProofSubmissionForm() {
            const container = document.getElementById('proofFormContainer');
            if(!container) return;

            // 1. ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ)
            let proof1Label = "‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡ßß (Username/Email)";
            let proof1Placeholder = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®";
            let icon = "ri-user-line";

            // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶¨‡ßá
            if(currentTaskInfo) {
                if(currentTaskInfo.taskType === 'youtube' || currentTaskInfo.link.includes('youtube')) {
                    proof1Label = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤";
                    proof1Placeholder = "‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶®: My Channel Name";
                    icon = "ri-youtube-fill";
                } else if(currentTaskInfo.taskType === 'telegram' || currentTaskInfo.link.includes('t.me')) {
                    proof1Label = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ";
                    proof1Placeholder = "‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶®: @username";
                    icon = "ri-telegram-fill";
                } else if(currentTaskInfo.taskType === 'facebook' || currentTaskInfo.link.includes('facebook')) {
                    proof1Label = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ/‡¶≤‡¶ø‡¶Ç‡¶ï";
                    proof1Placeholder = "‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶®: Facebook Profile Link";
                    icon = "ri-facebook-circle-fill";
                }
            }

            // 2. ‡¶ó‡¶∞‡ßç‡¶ú‡¶ø‡¶Ø‡¶º‡¶æ‡¶∏ HTML ‡¶´‡¶∞‡ßç‡¶Æ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®
            container.innerHTML = `
                <div class="space-y-5 animate__animated animate__fadeInUp">
                    
                    <div class="relative group">
                        <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1 flex items-center gap-1">
                            <i class="${icon} text-blue-500"></i> ${proof1Label} <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="ri-id-card-line text-slate-400"></i>
                            </div>
                            <input type="text" id="proof1" placeholder="${proof1Placeholder}" 
                                class="w-full pl-10 p-3.5 bg-slate-50 rounded-xl border border-slate-200 font-bold text-sm focus:border-blue-500 focus:bg-white outline-none transition-all shadow-sm">
                        </div>
                    </div>

                    <div class="relative group">
                        <label class="block text-xs font-bold text-slate-500 mb-1.5 ml-1 flex items-center gap-1">
                            <i class="ri-image-line text-purple-500"></i> ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï (Screenshot Link) <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="ri-link-m text-slate-400"></i>
                            </div>
                            <input type="text" id="proof2" placeholder="https://prnt.sc/..." 
                                class="w-full pl-10 p-3.5 bg-slate-50 rounded-xl border border-slate-200 font-bold text-sm focus:border-purple-500 focus:bg-white outline-none transition-all shadow-sm">
                        </div>
                        <p class="text-[10px] font-bold text-red-500 mt-1.5 flex items-start gap-1 ml-1 animate-pulse">
                            <i class="ri-information-fill mt-0.5"></i>
                            <span>‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü <b>imgbb.com</b> ‡¶¨‡¶æ <b>prnt.sc</b> ‡¶§‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®‡•§</span>
                        </p>
                    </div>

                    <div class="bg-orange-50 p-3 rounded-xl border border-orange-200 flex items-start gap-2.5">
                        <div class="bg-orange-100 p-1.5 rounded-full text-orange-600">
                            <i class="ri-shield-check-line text-sm"></i>
                        </div>
                        <div>
                            <h4 class="text-[11px] font-bold text-orange-800 mb-0.5">‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ</h4>
                            <p class="text-[10px] font-medium text-orange-700 leading-tight opacity-90">
                                ‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¨‡¶æ ‡¶≠‡ßÅ‡ßü‡¶æ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®‡•§
                            </p>
                        </div>
                    </div>
                </div>
            `;

            // ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
            document.getElementById('proofModal').classList.remove('hidden');
        }

        // ‚úÖ MISSING FUNCTION: CLOSE MODAL
        window.closeProofModal = () => {
            document.getElementById('proofModal').classList.add('hidden');
        }

// ‚úÖ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü (‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶°)
        window.submitProof = async () => {
    if(!currentTaskInfo) return;
    const proof1 = document.getElementById('proof1')?.value.trim();
    const proof2 = document.getElementById('proof2')?.value.trim();
    
    if(!proof1 || !proof2) {
        showSmartToast('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
        return;
    }
    
    showLoading();
    try {
        const submissionData = {
            userId: currentUserId,
            taskId: currentTaskInfo.taskId,
            taskTitle: currentTaskInfo.title,
            reward: currentTaskInfo.reward,
            userName: currentUserData.name,
            userPhone: currentUserData.phone,
            proofText: proof1, 
            screenshotUrl: proof2, 
            status: "Pending",
            date: new Date().toLocaleDateString('bn-BD'),
            time: new Date().toLocaleTimeString('bn-BD'),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        // ‡ßß. ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶æ
        await db.collection("task_submissions").add(submissionData);
        
        // ‡ß®. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶æ
        await db.collection("history").add({
            userId: currentUserId,
            type: "‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü",
            amount: currentTaskInfo.reward,
            status: "Pending",
            details: currentTaskInfo.title,
            date: new Date().toLocaleDateString('bn-BD'),
            time: new Date().toLocaleTimeString('bn-BD'),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ‚úÖ ‡ß©. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® (‡¶Ø‡¶æ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶õ‡¶ø‡¶≤ ‡¶®‡¶æ)
        const telegramMessage = `üìù *‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüìã *‡¶ü‡¶æ‡¶∏‡ßç‡¶ï:* ${currentTaskInfo.title}\nüí∞ *‡¶∞‡¶ø‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°:* ‡ß≥${currentTaskInfo.reward}\nüîó *‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶≤‡¶ø‡¶Ç‡¶ï:* ${proof2}\nüí¨ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßã‡¶ü:* ${proof1}`;
        await sendTelegramNotification(telegramMessage);
        
        showSmartToast('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
        window.playSound('snd_success');
        hideLoading();
        window.closeProofModal();
        renderTasks(); // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶á ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü
    } catch (e) {
        showSmartToast('‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'error');
        hideLoading();
    }
};
        // ‚úÖ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ì ‡¶´‡¶ø ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶® (‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶°)
        window.calculateDepositVAT = () => {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            const vatPercentage = systemSettings.vatFee || 0; 
            const vat = amount * (vatPercentage / 100);
            const total = amount + vat;
            document.getElementById('vatCalculation').innerHTML = `‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (${vatPercentage}%): ‡ß≥${vat.toFixed(2)} | ‡¶Æ‡ßã‡¶ü: ‡ß≥${total.toFixed(2)}`;
        };
        
        window.calculateWithdrawVAT = () => {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            const vatPercentage = systemSettings.withdrawFee || 0; 
            const vat = amount * (vatPercentage / 100);
            const received = amount - vat;
            document.getElementById('withdrawVat').innerHTML = `‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (${vatPercentage}%): ‡ß≥${vat.toFixed(2)} | ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§: ‡ß≥${received.toFixed(2)}`;
        };
        
        window.calculateRechargeFee = () => {
            const amount = parseFloat(document.getElementById('rechAmount').value) || 0;
            const fee = systemSettings.rechargeFee || 0; 
            const total = amount + fee;
            document.getElementById('rechargeFee').innerHTML = `‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: ‡ß≥${fee.toFixed(2)} | ‡¶Æ‡ßã‡¶ü: ‡ß≥${total.toFixed(2)}`;
        };
        // ‚úÖ UPDATED DEPOSIT FUNCTION
        window.submitDeposit = async () => {
            const trxId = document.getElementById('depositTrxId').value.trim();
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const method = document.getElementById('selectedDepositMethod').value;
            
            if(!trxId || !amount || amount <= 0) {
                showSmartToast('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            if(!method) {
                showSmartToast('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const minDeposit = systemSettings.minDeposit || 50;
            if(amount < minDeposit) {
                showSmartToast(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minDeposit}`, 'error');
                return;
            }
            
            showLoading();
            showSmartToast('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                const vatPercentage = systemSettings.vatPercentage || 10;
                const vat = amount * (vatPercentage / 100);
                const totalAmount = amount + vat;
                
                // Save to pending_requests
                await db.collection("pending_requests").add({ 
                    userId: currentUserId, 
                    type: "Deposit",
                    amount: amount, 
                    vat: vat,
                    totalAmount: totalAmount,
                    trxId: trxId,
                    method: method,
                    userName: currentUserData.name,
                    userPhone: currentUserData.phone,
                    status: "Pending",
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // ‚úÖ ADDED: Save to history as well
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü",
                    amount: amount,
                    status: "Pending",
                    details: `${method} - TrxID: ${trxId}`,
                    trxId: trxId,
                    method: method,
                    date: new Date().toLocaleDateString('bn-BD'),
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Send Telegram notification
                const telegramMessage = `üí∞ *‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüí≥ *‡¶Æ‡ßá‡¶•‡¶°:* ${method}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüßæ *TrxID:* ${trxId}\nüìä *‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü:* ‡ß≥${vat.toFixed(2)}\nüí∞ *‡¶Æ‡ßã‡¶ü:* ‡ß≥${totalAmount.toFixed(2)}`;
                await sendTelegramNotification(telegramMessage);
                
                showSmartToast('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®', 'success');
                hideLoading();
                
                document.getElementById('depositTrxId').value = '';
                document.getElementById('depositAmount').value = '';
                window.calculateDepositVAT();
                
            } catch (e) {
                showSmartToast('‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                hideLoading();
            }
        };
        
        // ‚úÖ UPDATED WITHDRAW FUNCTION WITH SCHEDULE
        window.submitWithdraw = async () => {
            const number = document.getElementById('withdrawNumber').value.trim();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const method = document.getElementById('selectedWithdrawMethod').value;
            
            if(!number || !amount || amount <= 0) {
                showSmartToast('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            if(!method) {
                showSmartToast('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const minWithdraw = systemSettings.minWithdraw || 50;
            const maxWithdraw = systemSettings.maxWithdraw || 5000;
            
            if(amount < minWithdraw) {
                showSmartToast(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minWithdraw}`, 'error');
                return;
            }
            
            if(amount > maxWithdraw) {
                showSmartToast(`‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${maxWithdraw}`, 'error');
                return;
            }
            
                        // üîê ‡¶™‡¶ø‡¶® ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® (‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞)
            if (!currentUserData.transactionPin) {
                return Swal.fire({
                    title: '‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á!',
                    text: '‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶ó‡ßá ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
                    icon: 'info',
                    confirmButtonText: '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏‡ßá ‡¶Ø‡¶æ‡¶®'
                }).then(() => window.showPage('settingsScreen'));
            }

            const { value: userPin } = await Swal.fire({
                title: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡¶®',
                input: 'password',
                inputPlaceholder: '‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶™‡¶ø‡¶®',
                inputAttributes: { maxlength: 4, textAlign: 'center' },
                showCancelButton: true,
                confirmButtonText: '‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤'
            });

            if (!userPin) return; // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡ßá‡¶≤ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶•‡ßá‡¶Æ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá

            if (userPin !== currentUserData.transactionPin) {
                return showSmartToast('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®!', 'error');
            }

            
            if(!currentUserData) {
                showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.mainBalance < amount) {
                showSmartToast('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + currentUserData.mainBalance.toFixed(2), 'error');
                return;
            }
            
            const isFreeUser = currentUserData.plan === "Free Member" || currentUserData.plan.includes("Free");
            if(isFreeUser) {
                const referralCount = currentUserData.totalReferrals || 0;
                if(referralCount < 3) {
                    showSmartToast(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ${referralCount}‡•§ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß©‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`, 'error');
                    return;
                }
            }
            
            let dailyLimit = 1;
            if(!isFreeUser) {
                dailyLimit = 2;
            }
            
            if(userWithdrawCount >= dailyLimit) {
                showSmartToast(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú ${userWithdrawCount} ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ${dailyLimit} ‡¶¨‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`, 'error');
                return;
            }
            
            const vatPercentage = systemSettings.vatPercentage || 10;
            const vat = amount * (vatPercentage / 100);
            const received = amount - vat;
            
            
            // ‚úÖ CHECK WITHDRAWAL SCHEDULE
            const withinSchedule = isWithinWithdrawalSchedule();
            
            // üí∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ü‡¶ó‡ßá Monetag ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶Ü‡¶∏‡¶¨‡ßá
            window.showMonetagAd(async () => {
                showLoading();
                showSmartToast('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                try {
                    const userRef = db.collection("users").doc(currentUserId);
                    await userRef.update({
                        mainBalance: firebase.firestore.FieldValue.increment(-amount),
                        totalWithdraw: firebase.firestore.FieldValue.increment(amount)
                    });
                    
                    await db.collection("pending_requests").add({ 
                        userId: currentUserId, 
                        type: "Withdraw", 
                        amount: amount, 
                        vat: vat,
                        receivedAmount: received,
                        number: number,
                        method: method,
                        userName: currentUserData.name,
                        userPhone: currentUserData.phone,
                        status: "Pending",
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    await db.collection("history").add({
                        userId: currentUserId,
                        type: "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®",
                        amount: -amount,
                        status: "Pending",
                        details: `${method} - ${number}`,
                        vat: vat,
                        receivedAmount: received,
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    userWithdrawCount++;
                    
                    // Send Telegram notification
                    const telegramMessage = `üí∏ *‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüí≥ *‡¶Æ‡ßá‡¶•‡¶°:* ${method}\nüìû *‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü:* ${number}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüìä *‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü:* ‡ß≥${vat.toFixed(2)}\nüí∞ *‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§:* ‡ß≥${received.toFixed(2)}\n‚è∞ *‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÇ‡¶ö‡ßÄ:* ${withinSchedule ? '‡¶≠‡¶ø‡¶§‡¶∞‡ßá' : '‡¶¨‡¶æ‡¶á‡¶∞‡ßá'}`;
                    await sendTelegramNotification(telegramMessage);
                    
                    let successMessage = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®';
                    if(!withinSchedule) {
                        successMessage += '\n\n‡¶®‡ßã‡¶ü‡¶ø‡¶∂: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶¶‡¶ø‡¶¨‡¶∏‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§';
                    }
                    
                    showSmartToast(successMessage, 'success');
                  
                    window.playSound('snd_success');                
                    hideLoading();
                    
                    document.getElementById('withdrawNumber').value = '';
                    document.getElementById('withdrawAmount').value = '';
                    window.calculateWithdrawVAT();
                    
                } catch (e) {
                    showSmartToast('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                    hideLoading();
                }
            }); // <-- Monetag ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∂‡ßá‡¶∑
        };
            
        
       // ‚úÖ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Corrected)
        window.submitRecharge = async () => { 
            const phone = document.getElementById('rechPhone').value.trim();
            const amount = parseFloat(document.getElementById('rechAmount').value);
            const operator = document.getElementById('selectedOperator').value;
            
            if(!phone || !amount || amount <= 0) {
                showSmartToast('‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            const minRecharge = systemSettings.minRecharge || 20;
            if(amount < minRecharge) {
                showSmartToast(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß≥${minRecharge}`, 'error');
                return;
            }
                     
            const fee = systemSettings.rechargeFee || 5;
            const totalAmount = amount + fee;
            
            if(!currentUserData) {
                showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'error');
                return;
            }
            
            if(currentUserData.rechargeBalance < totalAmount) {
                showSmartToast('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!', 'error');
                return;
            }
            
            // ‡¶™‡¶ø‡¶® ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
            if (!currentUserData.transactionPin) {
                return Swal.fire({
                    title: '‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á!',
                    text: '‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶ó‡ßá ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
                    icon: 'info',
                    confirmButtonText: '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏‡ßá ‡¶Ø‡¶æ‡¶®'
                }).then(() => window.showPage('settingsScreen'));
            }

            const { value: userPin } = await Swal.fire({
                title: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡¶®',
                input: 'password',
                inputPlaceholder: '‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶™‡¶ø‡¶®',
                inputAttributes: { maxlength: 4, textAlign: 'center' },
                showCancelButton: true,
                confirmButtonText: '‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®',
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤'
            });

            if (!userPin) return; 

            if (userPin !== currentUserData.transactionPin) {
                return showSmartToast('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®!', 'error');
            }
            
            const withinSchedule = isWithinWithdrawalSchedule();
            
            // üí∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ü‡¶ó‡ßá Monetag ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶Ü‡¶∏‡¶¨‡ßá
            window.showMonetagAd(async () => {
                showLoading();
                
                // üî• ‡¶è‡¶á 'try' ‡¶¨‡ßç‡¶≤‡¶ï‡¶ü‡¶ø ‡¶Æ‡¶ø‡¶∏‡¶ø‡¶Ç ‡¶õ‡¶ø‡¶≤ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°‡ßá
                try {
                    // ‡ßß. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡¶æ
                    await db.collection("users").doc(currentUserId).update({
                        rechargeBalance: firebase.firestore.FieldValue.increment(-totalAmount)
                    });
                    
                    // ‡ß®. ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø pending_requests ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
                    await db.collection("pending_requests").add({
                        userId: currentUserId, 
                        type: "Recharge",
                        number: phone, 
                        amount: amount, 
                        fee: fee,
                        totalAmount: totalAmount,
                        operator: operator,
                        userName: currentUserData.name,
                        userPhone: currentUserData.phone,
                        status: 'Pending', 
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    }); 
                    
                    // ‡ß©. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶ø‡¶ú‡¶∏‡ßç‡¶¨ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶§‡ßá ‡¶∏‡ßá‡¶≠
                    await db.collection("history").add({
                        userId: currentUserId,
                        type: "Recharge",
                        amount: -totalAmount,
                        status: "Pending",
                        details: `${operator} - ${phone}`,
                        date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    userRechargeCount++;
                    
                    // ‡ß™. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®
                    const telegramMessage = `üì± *‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüìû *‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞:* ${phone}\nüè¢ *‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞:* ${operator}\nüíµ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${amount}\nüí∞ *‡¶Æ‡ßã‡¶ü:* ‡ß≥${totalAmount}`;
                    await sendTelegramNotification(telegramMessage);
                    
                    let successMessage = '‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                    if(!withinSchedule) {
                        successMessage += '\n\n‡¶®‡ßã‡¶ü‡¶ø‡¶∂: ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶¶‡¶ø‡¶¨‡¶∏‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§';
                    }
                    
                    showSmartToast(successMessage, 'success'); 
                    window.playSound('snd_success');
                    hideLoading();
                    
                    document.getElementById('rechPhone').value = '';
                    document.getElementById('rechAmount').value = '';
                    window.calculateRechargeFee();
                    
                } catch (e) {
                    console.error("Recharge Error:", e);
                    showSmartToast('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
                    hideLoading();
                }
            });
        };
        
        window.transferBalance = async () => {
    const am = parseFloat(document.getElementById('transferAmount').value);
    
    // ‡ßß. ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
    if(!am || am <= 0) {
        showSmartToast('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£! ‡¶∏‡¶†‡¶ø‡¶ï ‡¶Ö‡¶Ç‡¶ï ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®', 'error');
        return;
    }
    
    if(!currentUserData) {
        showSmartToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...', 'error');
        return;
    }
    
    if(currentUserData.mainBalance < am) {
        showSmartToast('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á! ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥' + currentUserData.mainBalance.toFixed(2), 'error');
        return;
    }
    
    showLoading();
    
    try {
        const userRef = db.collection("users").doc(currentUserId);
        
        // ‡ß®. ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶Æ‡ßá‡¶á‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡¶æ‡¶á‡¶®‡¶æ‡¶∏, ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú‡ßá ‡¶™‡ßç‡¶≤‡¶æ‡¶∏)
        await userRef.update({
            mainBalance: firebase.firestore.FieldValue.increment(-am),
            rechargeBalance: firebase.firestore.FieldValue.increment(am)
        });
        
        // ‡ß©. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶§‡ßá ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
        await db.collection("history").add({
            userId: currentUserId,
            type: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞",
            amount: am,
            status: "Success",
            details: "‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏",
            date: new Date().toLocaleDateString('bn-BD'),
            time: new Date().toLocaleTimeString('bn-BD'),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ‚úÖ ‡ß™. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® (‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
        const tgMsg = `üîÑ *‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüí∞ *‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:* ‡ß≥${am}\n‚ÑπÔ∏è ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`;
        await sendTelegramNotification(tgMsg);
        
        // ‡ß´. ‡¶∏‡¶´‡¶≤‡¶§‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ì ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
        showSmartToast(`‡ß≥${am} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'success');
        if(typeof window.playSound === 'function') window.playSound('snd_success');
        
        hideLoading();
        
        // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
        document.getElementById('transferAmount').value = '';
        
    } catch (e) {
        console.error("Transfer Error:", e);
        showSmartToast('‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
        hideLoading();
    }
};
        
        
        // ‚úÖ SUMMARY FUNCTIONS
        async function loadSummary(uid) {
            try {
                showLoading();
                const userDoc = await db.collection("users").doc(uid).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    document.getElementById('totalEarnings').innerText = (data.totalEarnings || 0).toFixed(2);
                    document.getElementById('totalDeposit').innerText = (data.totalDeposit || 0).toFixed(2);
                    document.getElementById('totalWithdraw').innerText = (data.totalWithdraw || 0).toFixed(2);
                    document.getElementById('totalTasks').innerText = data.totalTasks || '0';
                    document.getElementById('summaryPlan').innerText = data.plan || 'Free';
                    document.getElementById('totalReferrals').innerText = data.totalReferrals || '0';
                    document.getElementById('referralCount').innerText = data.totalReferrals || '0';
                    document.getElementById('referralEarnings').innerText = data.referralEarnings || 0;
                    document.getElementById('todayEarnings').innerText = (data.todayEarnings || 0).toFixed(2);
                    todayEarnings = data.todayEarnings || 0;
                    
                    const tasksSnap = await db.collection("tasks").get();
                    document.getElementById('activeTasks').innerText = tasksSnap.size || '0';
                    
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    document.getElementById('dailyBonusStatus').innerText = lastBonus === today ? '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
                }
                hideLoading();
            } catch (e) {
                console.error("Error loading summary:", e);
                hideLoading();
            }
        }

        async function checkDailyBonus(uid) {
            try {
                const userDoc = await db.collection("users").doc(uid).get();
                if(userDoc.exists) {
                    const data = userDoc.data();
                    const today = new Date().toDateString();
                    const lastBonus = data.lastDailyBonus ? new Date(data.lastDailyBonus.toDate()).toDateString() : null;
                    
                    if(lastBonus === today) {
                        document.getElementById('dailyBonusStatus').innerText = '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                    } else {
                        document.getElementById('dailyBonusStatus').innerText = '‡¶Ü‡¶ú ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
                    }
                }
            } catch (e) {
                console.error("Error checking daily bonus:", e);
            }
        }

                                     // ‚úÖ PROFESSIONAL DAILY BONUS (FIXED SIZE & VISIBILITY)
        window.showDailyBonus = async () => {
            if(!currentUserId) return;

            // ‡ßß. ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const banglaDays = {
                'Saturday': '‡¶∂‡¶®‡¶ø', 'Sunday': '‡¶∞‡¶¨‡¶ø', 'Monday': '‡¶∏‡ßã‡¶Æ', 
                'Tuesday': '‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤', 'Wednesday': '‡¶¨‡ßÅ‡¶ß', 'Thursday': '‡¶¨‡ßÉ‡¶π‡¶É', 'Friday': '‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞'
            };
            const today = new Date();
            const todayName = days[today.getDay()];
            const todayDateStr = today.toDateString();

            // ‡ß®. ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü
            let bonusAmounts = {
                'Saturday': 2, 'Sunday': 2, 'Monday': 3, 
                'Tuesday': 3, 'Wednesday': 4, 'Thursday': 4, 
                'Friday': 0 
            };

            try {
                const settingsDoc = await db.collection("settings").doc("daily_bonus").get();
                if(settingsDoc.exists) {
                    bonusAmounts = { ...bonusAmounts, ...settingsDoc.data() };
                }
            } catch(e) { console.log("Default bonus used"); }

            // ‡ß©. ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ö‡ßá‡¶ï
            let hasClaimedToday = false;
            if(currentUserData && currentUserData.lastDailyBonus) {
                const lastBonusDate = new Date(currentUserData.lastDailyBonus.toDate()).toDateString();
                if(lastBonusDate === todayDateStr) hasClaimedToday = true;
            }

            // ‡ß™. HTML ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü
            let boxesHtml = '';
            const weekOrder = ['Saturday', 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            
            const giftIconUrl = "https://i.postimg.cc/dtj5JQqK/gift-box.png"; 

            weekOrder.forEach(dayName => {
                const isToday = (dayName === todayName);
                const isFriday = (dayName === 'Friday');
                const amount = bonusAmounts[dayName];
                
                // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤
                let boxClass = "bg-slate-50 border-slate-200 opacity-80"; 
                // ‡¶á‡¶Æ‡ßá‡¶ú ‡¶∏‡¶æ‡¶á‡¶ú ‡¶™‡¶æ‡¶∞‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
                let content = `<img src="${giftIconUrl}" class="w-8 h-8 mb-1 grayscale opacity-60">`; 
                let textClass = "text-slate-500";
                let text = `‡ß≥${amount}`;
                
                if (isToday) {
                    if (hasClaimedToday) {
                        boxClass = "bg-green-50 border-green-200";
                        content = `<i class="ri-checkbox-circle-fill text-3xl mb-1 text-green-500"></i>`;
                        textClass = "text-green-600";
                        text = "‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®";
                    } else {
                        // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶π‡¶æ‡¶á‡¶≤‡¶æ‡¶á‡¶ü ‡¶ï‡¶∞‡¶æ
                        boxClass = "bg-white border-blue-500 shadow-md ring-2 ring-blue-100 cursor-pointer transform hover:scale-105 transition-all";
                        content = `<img src="${giftIconUrl}" class="w-10 h-10 mb-1 animate-bounce drop-shadow-md">`; 
                        textClass = "text-blue-600";
                        
                        if(isFriday) {
                             boxClass = "bg-gradient-to-br from-purple-600 to-indigo-600 border-none shadow-xl ring-4 ring-purple-200 cursor-pointer transform hover:scale-105";
                             content = `<img src="${giftIconUrl}" class="w-12 h-12 mb-1 animate-tada drop-shadow-lg filter brightness-125">`;
                             textClass = "text-yellow-300";
                             text = "‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø";
                        }
                    }
                } else if (isFriday) {
                    boxClass = "bg-purple-50 border-purple-200";
                    content = `<img src="${giftIconUrl}" class="w-9 h-9 mb-1">`;
                    textClass = "text-purple-600";
                    text = "‡¶¨‡¶ø‡¶ó ‡¶Ö‡¶´‡¶æ‡¶∞";
                } else {
                    content = `<img src="${giftIconUrl}" class="w-8 h-8 mb-1">`;
                    textClass = "text-slate-600";
                }

                // üî• ‡¶π‡¶æ‡¶á‡¶ü ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø (h-24) ‡¶Ø‡¶æ‡¶§‡ßá ‡¶∏‡¶¨ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶ß‡¶∞‡ßá
                boxesHtml += `
                    <div class="flex flex-col items-center justify-center h-24 p-1 rounded-2xl border ${boxClass} relative overflow-hidden transition-all" 
                        ${(isToday && !hasClaimedToday) ? `onclick="claimBonus('${dayName}', ${amount})"` : ''}>
                        
                        ${isToday && !hasClaimedToday ? '<span class="absolute top-0 right-0 bg-red-500 w-2.5 h-2.5 rounded-full m-1.5 animate-ping"></span>' : ''}
                        
                        ${content}
                        <span class="text-[11px] font-bold ${isFriday && isToday ? 'text-white' : 'text-slate-500'} mb-0.5">${banglaDays[dayName]}</span>
                        <span class="text-xs font-black ${textClass}">${text}</span>
                    </div>
                `;
            });

            Swal.fire({
                title: 'üéÅ ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏',
                html: `
                    <p class="text-sm text-slate-500 mb-5">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶¢‡ßÅ‡¶ï‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßÅ‡¶®!</p>
                    <div class="grid grid-cols-4 gap-3 mb-2 px-1">
                        ${boxesHtml}
                    </div>
                `,
                showConfirmButton: false,
                showCloseButton: true,
                background: '#f8fafc',
                customClass: {
                    popup: 'rounded-[30px] w-full max-w-md border border-slate-200',
                    title: 'text-slate-800 font-bold text-xl'
                }
            });
        };

        // ‡ß¨. ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Birthday Confetti üéâ)
        window.claimBonus = async (dayName, baseAmount) => {
            Swal.close(); 

            let finalAmount = baseAmount;
            let message = `‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡ß≥${baseAmount}`;

            // ‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï
            if (dayName === 'Friday') {
                finalAmount = Math.floor(Math.random() * (15 - 5 + 1)) + 5; 
                message = `üéâ ‡¶ú‡ßÅ‡¶Æ‡ßç‡¶Æ‡¶æ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï! ‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶® ‡ß≥${finalAmount}`;
            }

            const result = await Swal.fire({
                title: 'üéÅ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®',
                html: `<div class="text-center">
                        <img src="https://i.postimg.cc/dtj5JQqK/gift-box.png" class="w-20 mx-auto mb-3 animate-bounce">
                        <p class="text-slate-600 font-bold">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
                       </div>`,
                showCancelButton: true,
                confirmButtonText: '‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®',
                cancelButtonText: '‡¶®‡¶æ, ‡¶•‡¶æ‡¶ï',
                confirmButtonColor: '#8b5cf6'
            });

            if (result.isConfirmed) {
                onAdCompleted = async () => {
                    showLoading();
                    try {
                        const userRef = db.collection("users").doc(currentUserId);
                        
                        await userRef.update({
                            mainBalance: firebase.firestore.FieldValue.increment(finalAmount),
                            totalEarnings: firebase.firestore.FieldValue.increment(finalAmount),
                            todayEarnings: firebase.firestore.FieldValue.increment(finalAmount),
                            lastDailyBonus: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        await db.collection("history").add({
                            userId: currentUserId,
                            type: "‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏",
                            amount: finalAmount,
                            status: "Success",
                            details: `${dayName} - ‡¶ö‡ßá‡¶ï ‡¶á‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏`,
                            date: new Date().toLocaleDateString('bn-BD'),
                            time: new Date().toLocaleTimeString('bn-BD'),
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        if(typeof todayEarnings !== 'undefined') {
                            todayEarnings += finalAmount;
                            document.getElementById('todayEarnings').textContent = todayEarnings.toFixed(2);
                        }

                        // üî• ‡¶¶‡ßÅ‡¶á ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶æ‡¶∞‡ßç‡¶•‡¶°‡ßá ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø
                        if(typeof confetti === 'function') {
                            var duration = 3000;
                            var end = Date.now() + duration;

                            (function frame() {
                                confetti({
                                    particleCount: 5, angle: 60, spread: 55, origin: { x: 0 },
                                    colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#purple']
                                });
                                confetti({
                                    particleCount: 5, angle: 120, spread: 55, origin: { x: 1 },
                                    colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#purple']
                                });

                                if (Date.now() < end) {
                                    requestAnimationFrame(frame);
                                }
                            }());
                        }

                        showSmartToast(message, 'success');
        
// ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶≤‡ßá ‡¶¨‡ßú ‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø
confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                
          window.playSound('snd_success');
     
                        hideLoading();
                        
                    } catch (e) {
                        console.error(e);
                        showSmartToast("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "error");
                        hideLoading();
                    }
                };
                showInterstitialAd();
            }
        };



        // ‚úÖ OTHER FUNCTIONS
        window.copyReferralLink = () => {
            const link = document.getElementById('referralLink').innerText;
            navigator.clipboard.writeText(link);
            showSmartToast('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
        };
        
        
            window.openSupport = () => { 
    window.open('https://t.me/TAKA_WALA_ADMIN', '_blank'); 
};
        
                       // ‚úÖ DYNAMIC DRIVE OFFER FUNCTION (UPDATED WITH AD)
        window.showDriveOffer = async () => {
            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∂‡ßã ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶¶‡¶ø‡ßü‡ßá ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            window.showMonetagAd(async () => {
                window.showPage('driveOfferScreen');
                showLoading();

                try {
                    const doc = await db.collection("settings").doc("drive_offer").get();
                    let isActive = false;
                    
                    if(doc.exists) {
                        const data = doc.data();
                        if(data.isActive === true) isActive = true;
                        
                        document.getElementById('driveMainTitle').innerText = data.title || "‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá...";
                        document.getElementById('driveMainMessage').innerText = data.message || "‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá...";
                        document.getElementById('driveLaunchDate').innerText = data.launchDate || "COMING SOON";
                    }

                    if(isActive) {
                        document.getElementById('driveMaintenanceView').classList.add('hidden');
                        document.getElementById('driveActiveView').classList.remove('hidden');
                        window.loadDriveOffers('gp'); // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá GP ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
                    } else {
                        document.getElementById('driveMaintenanceView').classList.remove('hidden');
                        document.getElementById('driveActiveView').classList.add('hidden');
                        hideLoading();
                    }
                } catch(e) {
                    console.log("Drive settings error:", e);
                    hideLoading();
                }
            }); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∂‡ßá‡¶∑
        };

        // üîÑ LOAD OFFERS BY OPERATOR
        window.loadDriveOffers = async (operator) => {
            // ‡ßß. ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            ['gp', 'robi', 'bl', 'airtel', 'teletalk'].forEach(op => {
                const btn = document.getElementById(`tab_${op}`);
                if(op === operator) {
                    btn.className = 'flex-shrink-0 flex items-center gap-2 px-5 py-2 rounded-full bg-blue-600 text-white font-bold text-xs shadow-lg transition-all scale-105';
                } else {
                    btn.className = 'flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full bg-slate-800 border border-slate-700 text-slate-300 font-bold text-xs transition-all hover:bg-slate-700';
                }
            });

            const container = document.getElementById('driveOffersContainer');
            container.innerHTML = '<div class="text-center py-10"><div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"></div></div>';

            try {
                // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶≤‡ßã‡¶°
                const snapshot = await db.collection("drive_offers")
                    .where("operator", "==", operator)
                    .orderBy("price", "asc") // ‡¶¶‡¶æ‡¶Æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
                    .get();

                container.innerHTML = '';
                
                if(snapshot.empty) {
                    container.innerHTML = `
                        <div class="text-center py-10 opacity-50">
                            <img src="https://i.postimg.cc/qByrJYrn/sim-card.png" class="w-16 mx-auto mb-3 grayscale opacity-50">
                            <p class="text-sm">‡¶è‡¶á ‡¶∏‡¶ø‡¶Æ‡ßá ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</p>
                        </div>`;
                    hideLoading();
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    // ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
                    let colorClass = 'border-l-4 border-blue-500'; // GP default
                    if(operator === 'robi') colorClass = 'border-l-4 border-red-500';
                    else if(operator === 'bl') colorClass = 'border-l-4 border-orange-500';
                    else if(operator === 'airtel') colorClass = 'border-l-4 border-red-600';
                    else if(operator === 'teletalk') colorClass = 'border-l-4 border-green-500';

                    const card = `
                        <div class="bg-slate-800 p-4 rounded-xl shadow-lg border border-slate-700 relative overflow-hidden ${colorClass}">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="font-bold text-white text-lg">${data.title}</h3>
                                    <p class="text-xs text-slate-400 mt-1">${data.description || '‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶: ‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®'}</p>
                                </div>
                                <div class="text-right">
                                    <span class="block text-xl font-black text-green-400">‡ß≥${data.price}</span>
                                    ${data.regularPrice ? `<span class="text-[10px] text-slate-500 line-through">‡ß≥${data.regularPrice}</span>` : ''}
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between mt-4 pt-3 border-t border-slate-700">
                                <div class="bg-slate-700/50 px-2 py-1 rounded text-[10px] text-slate-300 font-mono">
                                    ${data.area || '‡¶∏‡¶æ‡¶∞‡¶æ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂'}
                                </div>
                                <button onclick="window.buyDriveOffer('${data.title}', '${data.price}', '${operator}')" class="bg-white text-slate-900 px-6 py-2 rounded-lg font-bold text-xs hover:bg-blue-50 transition active:scale-95">
                                    ‡¶ï‡¶ø‡¶®‡ßÅ‡¶® <i class="ri-shopping-cart-2-line ml-1"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });

            } catch(e) {
                console.error("Error loading offers:", e);
                container.innerHTML = '<p class="text-center text-red-400 text-xs">‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>';
            }
            hideLoading();
        };

        // üõçÔ∏è BUY FUNCTION (TELEGRAM REDIRECT)
        window.buyDriveOffer = (offerName, price, operator) => {
            const opName = operator.toUpperCase();
            const message = encodeURIComponent(`‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶Ü‡¶Æ‡¶ø ${currentUserData.name} (${currentUserData.phone})‡•§\n\n‡¶Ö‡¶´‡¶æ‡¶∞: ${offerName}\n‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞: ${opName}\n‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${price}\n\n‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶Ö‡¶´‡¶æ‡¶∞‡¶ü‡¶ø ‡¶®‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§`);
            
            window.open(`https://t.me/TAKA_WALA_ADMIN?text=${message}`, '_blank');
            showSmartToast('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
        };


               // ‚úÖ DYNAMIC SPIN FUNCTION (UPDATED WITH AD)
        window.showSpinGame = async () => {
            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∂‡ßã ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶¶‡¶ø‡ßü‡ßá ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            window.showMonetagAd(async () => {
                window.showPage('spinScreen');
                showLoading();

                let title = "‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá...";
                let message = "‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡¶ü‡¶ø‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡ßü ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§";
                let date = "‡ßß‡¶≤‡¶æ ‡¶ú‡ßÅ‡¶® ‡ß®‡ß¶‡ß®‡ß¨";
                let isActive = false;

                try {
                    const doc = await db.collection("settings").doc("spin_game").get();
                    if(doc.exists) {
                        const data = doc.data();
                        if(data.title) title = data.title;
                        if(data.message) message = data.message;
                        if(data.launchDate) date = data.launchDate;
                        if(data.isActive === true) isActive = true;
                    }
                } catch(e) { console.log("Spin settings error", e); }

                document.getElementById('spinMainTitle').innerText = title;
                document.getElementById('spinMainMessage').innerText = message;
                document.getElementById('spinLaunchDate').innerText = date;

                if(isActive) {
                    document.getElementById('spinMaintenanceView').classList.add('hidden');
                    document.getElementById('spinActiveView').classList.remove('hidden');
                    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡¶∏
                    document.getElementById('spinCount').innerText = currentUserData.dailySpins || 5; 
                } else {
                    document.getElementById('spinMaintenanceView').classList.remove('hidden');
                    document.getElementById('spinActiveView').classList.add('hidden');
                }
                
                hideLoading();
            }); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∂‡ßá‡¶∑
        };

        // üé∞ SPIN LOGIC (Visual Demo)
        window.spinTheWheel = () => {
            const wheel = document.getElementById('wheel');
            const btn = document.getElementById('spinBtn');
            
            // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡¶ø‡¶ú‡ßá‡¶¨‡¶≤ ‡¶ï‡¶∞‡¶æ
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            
            // ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶∞‡ßã‡¶ü‡ßá‡¶∂‡¶® (‡ß©‡ß¶‡ß¶‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ß´‡ß¶‡ß¶‡ß¶ ‡¶°‡¶ø‡¶ó‡ßç‡¶∞‡¶ø)
            const deg = Math.floor(3000 + Math.random() * 2000); 
            
            wheel.style.transform = `rotate(${deg}deg)`;
            
            // ‡ß™ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü
            setTimeout(() => {
                Swal.fire({
                    title: '‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! üéâ',
                    text: '‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶® (‡¶°‡ßá‡¶Æ‡ßã)',
                    icon: 'success',
                    confirmButtonText: '‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡¶ø‡¶®',
                    confirmButtonColor: '#8b5cf6'
                });
                
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                // ‡¶ö‡¶æ‡¶ï‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü (Visual only logic for now)
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${deg % 360}deg)`;
                setTimeout(() => wheel.style.transition = 'transform 4s cubic-bezier(0.2, 0.8, 0.2, 1)', 50);
                
            }, 4000);
        };

        
        
        window.logout = () => {
            auth.signOut();
            showSmartToast('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤', 'success');
            document.getElementById('globalChatIcon').style.display = 'none';
            document.getElementById('twaiChatbotIcon').style.display = 'none';
        };
        
                // ‚úÖ PASSWORD RESET FUNCTION
        window.resetPassword = async () => {
            const { value: email } = await Swal.fire({
                title: '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü',
                input: 'email',
                inputLabel: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®',
                inputPlaceholder: 'example@mail.com',
                confirmButtonText: '‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶†‡¶æ‡¶®',
                confirmButtonColor: '#059669',
                showCancelButton: true,
                cancelButtonText: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤',
                customClass: {
                    popup: 'rounded-[25px]'
                }
            });

            if (email) {
                showLoading();
                try {
                    await auth.sendPasswordResetEmail(email);
                    showSmartToast('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶∏‡ßç‡¶™‡ßç‡¶Ø‡¶æ‡¶Æ ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'success');
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá',
                        text: '‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
                        confirmButtonText: '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá',
                        confirmButtonColor: '#059669',
                        customClass: { popup: 'rounded-[25px]' }
                    });
                    
                } catch (error) {
                    console.error(error);
                    if(error.code === 'auth/user-not-found') {
                        showSmartToast('‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á', 'error');
                    } else {
                        showSmartToast('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶ï‡¶ø‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®', 'error');
                    }
                }
                hideLoading();
            }
        };

        
     // ‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ rulesConfig ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞‡¶´‡ßÅ‡¶≤ ‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ ‡¶≤‡ßã‡¶°
        window.showRules = async (title) => {
            window.playSound('snd_click');
            showLoading();
            
            try {
                // ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø rulesConfig ‡¶°‡¶ï‡ßÅ‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                const doc = await db.collection("settings").doc("rulesConfig").get();
                let ruleContent = "<p class='text-slate-400'>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶ø‡ßü‡¶Æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á‡•§</p>";
                
                if (doc.exists) {
                    const data = doc.data();
                    
                    // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶Æ‡¶ø‡¶≤‡¶æ‡¶®‡ßã
                    if (title.includes('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï')) {
                        ruleContent = data.generalRules || ruleContent;
                    } else if (title.includes('‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú')) {
                        ruleContent = data.depositRules || ruleContent;
                    } else if (title.includes('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®') || title.includes('‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®') || title.includes('‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü')) {
                        ruleContent = data.withdrawRules || ruleContent;
                    } else if (title.includes('‡¶∞‡ßá‡¶´‡¶æ‡¶∞')) {
                        ruleContent = data.referralRules || ruleContent;
                    } else {
                        ruleContent = data.generalRules || ruleContent;
                    }
                }

                hideLoading();

                // ‡¶∏‡ßÅ‡¶á‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø HTML ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶∂‡ßã ‡¶ï‡¶∞‡ßá
                Swal.fire({
                    title: `<span style="color:#1e293b; font-weight:800;">${title} ‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ</span>`,
                    html: `
                        <div style="text-align:left; font-size:14px; color:#475569; line-height:1.6; max-height:300px; overflow-y:auto; padding:5px;">
                            ${ruleContent}
                        </div>
                    `,
                    confirmButtonText: '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá, ‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø',
                    confirmButtonColor: '#059669',
                    customClass: {
                        popup: 'rounded-[25px]',
                        container: 'my-swal'
                    }
                });
            } catch (e) {
                console.error("Rules Load Error:", e);
                hideLoading();
                showSmartToast("‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "error");
            }
        };
      

        // ‚úÖ SETTINGS FUNCTIONS
        function loadSettingsFromLocalStorage() {
            const notificationToggle = document.getElementById('notificationToggle');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const soundToggle = document.getElementById('soundToggle');
            const vibrationToggle = document.getElementById('vibrationToggle');
            
            if(localStorage.getItem('notificationEnabled') !== null) {
                notificationToggle.checked = localStorage.getItem('notificationEnabled') === 'true';
            }
            
            if(localStorage.getItem('darkModeEnabled') !== null) {
                darkModeToggle.checked = localStorage.getItem('darkModeEnabled') === 'true';
                if(darkModeToggle.checked) {
                    document.body.classList.add('bg-slate-900', 'text-white');
                }
            }
            
            if(localStorage.getItem('soundEnabled') !== null) {
                soundToggle.checked = localStorage.getItem('soundEnabled') === 'true';
            }
            
            if(localStorage.getItem('vibrationEnabled') !== null) {
                vibrationToggle.checked = localStorage.getItem('vibrationEnabled') === 'true';
            }
            
            // Add event listeners
            notificationToggle.addEventListener('change', function() {
                localStorage.setItem('notificationEnabled', this.checked);
                showSmartToast(`‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
            
            darkModeToggle.addEventListener('change', function() {
                localStorage.setItem('darkModeEnabled', this.checked);
                if(this.checked) {
                    document.body.classList.add('bg-slate-900', 'text-white');
                } else {
                    document.body.classList.remove('bg-slate-900', 'text-white');
                }
                showSmartToast(`‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶° ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
            
            soundToggle.addEventListener('change', function() {
                localStorage.setItem('soundEnabled', this.checked);
                showSmartToast(`‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
            
            vibrationToggle.addEventListener('change', function() {
                localStorage.setItem('vibrationEnabled', this.checked);
                showSmartToast(`‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶® ${this.checked ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
            });
        }

        // ‚úÖ TOGGLE BALANCE FUNCTION (MISSING FUNCTION)
        window.toggleBalance = () => {
            const balanceText = document.getElementById('balanceText');
            const balanceAmount = document.getElementById('balanceAmount');
            
            if(balanceAmount.classList.contains('hidden')) {
                balanceText.classList.add('hidden');
                balanceAmount.classList.remove('hidden');
                if(currentUserData) {
                    balanceAmount.textContent = `‡ß≥${currentUserData.mainBalance.toFixed(2)}`;
                }
            } else {
                balanceText.classList.remove('hidden');
                balanceAmount.classList.add('hidden');
            }
        };

        // ‚úÖ GLOBAL WINDOW FUNCTIONS
        window.toggleAuthTab = (t) => {
            document.getElementById('loginForm').classList.toggle('hidden', t!=='login');
            document.getElementById('registerForm').classList.toggle('hidden', t!=='register');
            document.getElementById('btnTabLogin').className = t==='login'?'flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg':'flex-1 py-3 rounded-full text-sm font-bold text-slate-500';
            document.getElementById('btnTabRegister').className = t==='register'?'flex-1 py-3 rounded-full text-sm font-bold bg-premium text-white shadow-lg':'flex-1 py-3 rounded-full text-sm font-bold text-slate-500';
        };
        
        // ‡ßß. ‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞ ‡¶´‡¶æ‡¶∏‡ßç‡¶ü ‡¶™‡ßá‡¶ú ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® (‡¶ù‡¶ø‡¶≤‡¶ø‡¶ï ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§ - ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶®)
window.showPage = (id) => { 
    // ‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá)
    if (typeof luckyDrawInterval !== 'undefined' && luckyDrawInterval) {
        clearInterval(luckyDrawInterval);
    }

    // ‚ùå ‡¶Ü‡¶ó‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá showLoading() ‡¶õ‡¶ø‡¶≤, ‡¶∏‡ßá‡¶ü‡¶æ ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø‡•§ ‡¶è‡¶ü‡¶æ‡¶á ‡¶ù‡¶ø‡¶≤‡¶ø‡¶ï ‡¶Æ‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶ï‡¶æ‡¶∞‡¶£‡•§

    // ‡¶∏‡¶¨ ‡¶™‡ßá‡¶ú ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡¶æ
    const allPages = document.querySelectorAll('#mainApp > div');
    allPages.forEach(div => { 
        if(div.id !== 'bottomNav') {
            div.classList.add('hidden');
            // ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶õ‡¶ø ‡¶Ø‡¶æ‡¶§‡ßá ‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶π‡ßü
            div.classList.remove('animate__animated', 'animate__fadeIn'); 
        }
    }); 

    // ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶™‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
    const targetPage = document.getElementById(id);
    if(targetPage) {
        targetPage.classList.remove('hidden');
        // ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶´‡ßá‡¶° ‡¶á‡¶® ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶≤‡ßã
        targetPage.classList.add('animate__animated', 'animate__fadeIn'); 
    }

    // ‚úÖ ‡¶™‡ßá‡¶ú ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶â‡¶™‡¶∞‡ßá ‡¶â‡¶†‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
    window.scrollTo(0, 0);

    // ‡¶™‡ßá‡¶ú ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
    if(id === 'taskScreen') {
        renderTasks(); 
    } 
    else if(id === 'vipScreen') {
        loadPackages();
        startPackageCountdown(); 
    } 
    else if(id === 'referralScreen') {
        loadReferralList();
    } 
    else if(id === 'walletScreen') {
        updateDepositAddress(selectedMethod || 'bKash');
        window.toggleWalletTab('deposit'); 
    }
    else if(id === 'quizScreen') {
        window.switchQuizTab('types');
    }
    else if(id === 'settingsScreen') {
        loadSettingsFromLocalStorage();
    }
    else if(id === 'summaryScreen') {
        if(typeof currentUserId !== 'undefined' && currentUserId) {
            loadSummary(currentUserId);
        }
    }
    else if(id === 'subscriptionScreen') {
        window.switchSubscriptionTab('stars');
        loadSubscriptions();
    }

    // ‚ùå hideLoading() ‡¶ì ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø, ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶á ‡¶ï‡¶∞‡¶ø‡¶®‡¶ø‡•§
};

// ‡ß®. ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶∏‡ßÅ‡¶á‡¶ö‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)
window.toggleWalletTab = (t) => {
    // ‡¶∏‡¶¨ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡¶æ
    ['deposit','withdraw','transfer'].forEach(id => {
        const sec = document.getElementById(id+'Section');
        if(sec) sec.classList.add('hidden');
    });

    // ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßã ‡¶ï‡¶∞‡¶æ
    const targetSection = document.getElementById(t+'Section');
    if(targetSection) targetSection.classList.remove('hidden');

    // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    ['tabDeposit','tabWithdraw','tabTransfer'].forEach(id => {
        const btn = document.getElementById(id);
        if(btn) btn.className = 'flex-1 py-3 font-bold text-sm rounded-xl text-slate-500 transition-all';
    });

    const activeTabId = 'tab' + t.charAt(0).toUpperCase() + t.slice(1);
    const activeBtn = document.getElementById(activeTabId);
    if(activeBtn) {
        // ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶û‡ßç‡¶ú
        activeBtn.className = 'flex-1 py-3 font-bold text-sm rounded-xl bg-slate-800 text-white shadow transition-all';
    }
    
    // ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶® ‡¶ï‡¶≤
    if(t === 'deposit') {
        const depAmtInput = document.getElementById('depositAmount');
        if(depAmtInput) {
            // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ (‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶è‡ßú‡¶æ‡¶§‡ßá)
            depAmtInput.removeEventListener('input', window.calculateDepositVAT);
            depAmtInput.addEventListener('input', window.calculateDepositVAT);
            // ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü
            if(window.calculateDepositVAT) window.calculateDepositVAT();
        }
    } 
    else if(t === 'withdraw') {
        const withAmtInput = document.getElementById('withdrawAmount');
        if(withAmtInput) {
            withAmtInput.removeEventListener('input', window.calculateWithdrawVAT);
            withAmtInput.addEventListener('input', window.calculateWithdrawVAT);
            if(window.calculateWithdrawVAT) window.calculateWithdrawVAT();
        }
    }
};
        
        // ‚úÖ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶∏‡ßÅ‡¶á‡¶ö ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶≤‡¶ï‡¶ø‡¶Ç ‡¶ì ‡¶Ö‡¶ü‡ßã-‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶∏‡¶π)
window.switchTaskTab = (type) => {
    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø ‡¶∏‡ßá‡¶ü‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
    const userPlan = (currentUserData.plan || "").toLowerCase();
    
    // ‡¶Ø‡¶¶‡¶ø ‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶´‡ßç‡¶∞‡¶ø ‡¶π‡ßü
    if (type === 'vip') {
        if (!userPlan || userPlan.includes('free')) {
            Swal.fire({
                title: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶≤‡¶ï! üîê',
                text: '‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶®?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®',
                cancelButtonText: '‡¶®‡¶æ, ‡¶•‡¶æ‡¶ï',
                confirmButtonColor: '#059669',
                customClass: { popup: 'rounded-[25px]' }
            }).then((res) => {
                if (res.isConfirmed) window.showPage('vipScreen');
            });
            return; // ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶á ‡¶•‡¶æ‡¶Æ‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶¨‡ßá
        }
    }

    // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    currentTaskType = type;
    
    // ‡ßß. ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ì ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    const btnFree = document.getElementById('tabFreeTask');
    const btnVip = document.getElementById('tabVipTask');
    
    if (type === 'free') {
        btnFree.classList.add('bg-green-500', 'text-white', 'shadow');
        btnFree.classList.remove('text-slate-500');
        btnVip.classList.remove('bg-green-500', 'text-white', 'shadow');
        btnVip.classList.add('text-slate-500');
    } else {
        btnVip.classList.add('bg-green-500', 'text-white', 'shadow');
        btnVip.classList.remove('text-slate-500');
        btnFree.classList.remove('bg-green-500', 'text-white', 'shadow');
        btnFree.classList.add('text-slate-500');
    }
    
    // ‡ß®. ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
    renderTasks();
};
 
        window.selectOperator = (el, operator) => { 
            document.querySelectorAll('#rechargeScreen .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedOperator = operator;
            document.getElementById('selectedOperator').value = operator;
        };
        
        window.selectWithdrawMethod = (el, method) => { 
            if(!paymentNumbers[method] || paymentNumbers[method] === "OFF" || paymentNumbers[method] === "") {
                showSmartToast(`${method} ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶¨‡¶®‡ßç‡¶ß`, 'error');
                return;
            }
            
            document.querySelectorAll('#withdrawSection .grid .bg-white').forEach(d=>d.classList.remove('border-green-500','bg-green-50')); 
            el.classList.add('border-green-500','bg-green-50'); 
            selectedMethod = method;
            document.getElementById('selectedWithdrawMethod').value = method;
        };

        // ‚úÖ SUBSCRIPTION FUNCTIONS        
     
        window.selectStarPackage = (stars) => {
            selectedStarPackage = stars;
            document.getElementById('selectedStars').textContent = stars;
            
            let price = 0;
            if(stars === 100) price = 290;
            else if(stars === 250) price = 652.5;
            else if(stars === 500) price = 1305;
            
            document.getElementById('totalStarPrice').textContent = price;
        };
                
        
        window.buyStars = () => {
            if(selectedStarPackage === 0) {
                showSmartToast('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            const message = encodeURIComponent(`‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶Ü‡¶Æ‡¶ø ${currentUserData.name} (${currentUserData.phone})‡•§ ‡¶Ü‡¶Æ‡¶ø ${selectedStarPackage} ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ - ‡ß≥${document.getElementById('totalStarPrice').textContent} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§`);
            window.open(`https://t.me/TAKA_WALA_ADMIN?text=${message}`, '_blank'); 
            showSmartToast('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
        };
        
        
                // ‚úÖ GLOBAL VARS FOR SUBSCRIPTION
        let subscriptionData = [];
        let selectedService = null;
        let selectedPlan = null;

        // 1Ô∏è‚É£ LOAD SUBSCRIPTIONS FROM FIREBASE
        async function loadSubscriptions() {
            try {
                const snapshot = await db.collection("subscriptions").orderBy("order", "asc").get();
                subscriptionData = [];
                
                // Tabs Container Clear (Keep Stars)
                const tabsContainer = document.getElementById('subTabsContainer');
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶ü‡¶æ (Stars) ‡¶∞‡ßá‡¶ñ‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∏‡¶¨ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
                while (tabsContainer.children.length > 1) {
                    tabsContainer.removeChild(tabsContainer.lastChild);
                }

                if(!snapshot.empty) {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        subscriptionData.push({ id: doc.id, ...data });
                        
                        // Create Tab Button
                        const btn = document.createElement('button');
                        btn.className = 'whitespace-nowrap px-6 py-3 font-bold text-sm rounded-xl text-slate-500 bg-white shadow-sm border border-slate-100 transition-all';
                        btn.innerText = data.name; // e.g., Telegram, YouTube
                        btn.id = `tab_${doc.id}`;
                        btn.onclick = () => window.switchSubscriptionTab(doc.id);
                        tabsContainer.appendChild(btn);
                    });
                }
            } catch (e) {
                console.error("Error loading subs:", e);
            }
        }

        // 2Ô∏è‚É£ SWITCH TABS FUNCTION
        window.switchSubscriptionTab = (tabId) => {
            // Reset UI Colors
            document.querySelectorAll('#subTabsContainer button').forEach(btn => {
                btn.className = 'whitespace-nowrap px-6 py-3 font-bold text-sm rounded-xl text-slate-500 bg-white shadow-sm border border-slate-100 transition-all';
            });

            // Active Tab Style
            const activeBtn = document.getElementById(tabId === 'stars' ? 'tabStars' : `tab_${tabId}`);
            if(activeBtn) {
                activeBtn.className = 'whitespace-nowrap px-6 py-3 font-bold text-sm rounded-xl bg-green-500 text-white shadow-lg transition-all transform scale-105';
            }

            // Show/Hide Sections
            if (tabId === 'stars') {
                document.getElementById('starsSection').classList.remove('hidden');
                document.getElementById('dynamicServiceSection').classList.add('hidden');
            } else {
                document.getElementById('starsSection').classList.add('hidden');
                document.getElementById('dynamicServiceSection').classList.remove('hidden');
                
                // Render Service Data
                renderServiceData(tabId);
            }
        };

        // 3Ô∏è‚É£ RENDER PACKAGES DYNAMICALLY
        function renderServiceData(serviceId) {
            const service = subscriptionData.find(s => s.id === serviceId);
            if(!service) return;

            selectedService = service;
            selectedPlan = null; // Reset selection
            document.getElementById('selectedDynamicPlanName').innerText = "‡¶ï‡ßã‡¶®‡ßã‡¶ü‡¶ø‡¶á ‡¶®‡¶æ";
            document.getElementById('selectedDynamicPlanPrice').innerText = "0";

            // Update Header
            document.getElementById('dynamicServiceTitle').innerText = service.title; // e.g. "Telegram Premium"
            document.getElementById('dynamicServiceIcon').src = service.icon || "https://i.postimg.cc/TwfTZM7Z/award.png";

            // Render Packages
            const list = document.getElementById('dynamicPackagesList');
            list.innerHTML = '';

            if(service.plans && service.plans.length > 0) {
                service.plans.forEach((plan, index) => {
                    // Badge Logic
                    let badgeHtml = '';
                    if(plan.tag) {
                        badgeHtml = `<div class="absolute -top-2 -right-2 bg-${plan.tagColor || 'purple'}-500 text-white text-[10px] px-2 py-0.5 rounded-full">${plan.tag}</div>`;
                    }

                    list.innerHTML += `
                        <div onclick="window.selectDynamicPlan(${index})" id="plan_${index}" class="bg-white p-4 rounded-2xl border cursor-pointer text-left hover:border-blue-500 relative transition-all shadow-sm">
                            ${badgeHtml}
                            <div class="flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-slate-800">${plan.name}</h4>
                                    <p class="text-[11px] text-slate-500">${plan.desc || 'Best Value'}</p>
                                </div>
                                <span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-lg font-bold">‡ß≥${plan.price}</span>
                            </div>
                        </div>
                    `;
                });
            } else {
                list.innerHTML = `<p class="text-slate-400">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶®‡ßá‡¶á</p>`;
            }
        }

        // 4Ô∏è‚É£ SELECT PLAN FUNCTION
        window.selectDynamicPlan = (index) => {
            if(!selectedService || !selectedService.plans[index]) return;

            // Remove active class from all
            document.querySelectorAll('#dynamicPackagesList > div').forEach(div => {
                div.classList.remove('border-blue-600', 'bg-blue-50', 'ring-2', 'ring-blue-200');
                div.classList.add('bg-white', 'border-slate-200');
            });

            // Add active class
            const activeDiv = document.getElementById(`plan_${index}`);
            activeDiv.classList.remove('bg-white', 'border-slate-200');
            activeDiv.classList.add('border-blue-600', 'bg-blue-50', 'ring-2', 'ring-blue-200');

            selectedPlan = selectedService.plans[index];
            
            document.getElementById('selectedDynamicPlanName').innerText = selectedPlan.name;
            document.getElementById('selectedDynamicPlanPrice').innerText = selectedPlan.price;
        };

        // 5Ô∏è‚É£ BUY FUNCTION (REDIRECT TO TELEGRAM)
        window.buyDynamicSubscription = () => {
            if(!selectedPlan || !selectedService) {
                showSmartToast('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }

            const message = encodeURIComponent(`‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ‡¶Ü‡¶Æ‡¶ø ${currentUserData.name} (${currentUserData.phone})‡•§\n\n‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏: ${selectedService.title}\n‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú: ${selectedPlan.name}\n‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${selectedPlan.price}\n\n‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ü‡¶ø ‡¶ï‡¶ø‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡•§`);
            
            window.open(`https://t.me/TAKA_WALA_ADMIN?text=${message}`, '_blank');
            showSmartToast('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
        };

        // Call loadSubscriptions when page loads (inside showPage or onload)
        // ‡¶§‡ßã‡¶∞ existing showPage('subscriptionScreen') ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá `loadSubscriptions()` ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶¨‡¶ø‡•§

        // ‚úÖ SET TRANSACTION PIN FUNCTION
        window.setTransactionPin = async () => {
            const pin = document.getElementById('newPin').value;
            const confirm = document.getElementById('confirmPin').value;

            if(pin.length !== 4 || isNaN(pin)) {
                return showSmartToast('‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡¶®', 'error');
            }
            if(pin !== confirm) {
                return showSmartToast('‡¶™‡¶ø‡¶® ‡¶Æ‡¶ø‡¶≤‡ßá‡¶®‡¶ø!', 'error');
            }

            showLoading();
            try {
                await db.collection("users").doc(auth.currentUser.uid).update({
                    transactionPin: pin
                });
                showSmartToast('‡¶™‡¶ø‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚úÖ', 'success');
                               window.playSound('snd_success');
                document.getElementById('newPin').value = "";
                document.getElementById('confirmPin').value = "";
            } catch(e) {
                showSmartToast('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'error');
            }
            hideLoading();
        };



             // ‚úÖ INITIALIZE EVENT LISTENERS
        document.addEventListener('DOMContentLoaded', function() {
            // ‡ßß. ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡¶∞
            let refCode = "";
            if (window.Telegram && window.Telegram.WebApp) {
                const tgData = window.Telegram.WebApp.initDataUnsafe;
                if (tgData && tgData.start_param) refCode = tgData.start_param.replace(/^R/, ''); 
            }
            if (!refCode) {
                const urlParams = new URLSearchParams(window.location.search);
                refCode = (urlParams.get('ref') || urlParams.get('startapp') || "").replace(/^R/, '');
            }

            if (refCode) {
                const regRefField = document.getElementById('regReferralCode');
                if (regRefField) {
                    regRefField.value = refCode;
                    setTimeout(() => {
                        showSmartToast('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
                        window.toggleAuthTab('register'); 
                    }, 1000);
                }
            }
            
            
            
            // ‡ß®. ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞‡¶∏
            const depAmt = document.getElementById('depositAmount');
            if(depAmt) depAmt.addEventListener('input', window.calculateDepositVAT);
            
            const withAmt = document.getElementById('withdrawAmount');
            if(withAmt) withAmt.addEventListener('input', window.calculateWithdrawVAT);
            
            const rechAmt = document.getElementById('rechAmount');
            if(rechAmt) rechAmt.addEventListener('input', window.calculateRechargeFee);
            
            // ‡ß©. ‡¶π‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø‡¶ï ‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ì ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶ø‡¶Ç
            document.querySelectorAll('button, .glass-card, .cursor-pointer').forEach(element => {
                element.addEventListener('click', () => {
                    window.playSound('snd_click');
                    if (navigator.vibrate) navigator.vibrate(40);
                });
            });

            setTimeout(attachAppSounds, 1000);
        }); 

        // ‡ß™. ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
        window.addEventListener('offline', () => {
            Swal.fire({ title: '‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®!', text: '‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá! ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', icon: 'warning', showConfirmButton: false, allowOutsideClick: false });
        });

        window.addEventListener('online', () => { Swal.close(); showSmartToast('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶∏‡ßá‡¶õ‡ßá! ', 'success'); });
        // ‚úÖ ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶è‡¶∞‡¶∞-‡¶´‡ßç‡¶∞‡¶ø ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶ï‡¶®‡¶∏‡ßã‡¶≤ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá)
window.playSound = (id) => {
    const audio = document.getElementById(id);
    if (audio) {
        audio.currentTime = 0; 
        const playPromise = audio.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶∞‡¶∞ ‡¶¨‡¶æ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
                // ‡¶ö‡ßÅ‡¶™‡¶ö‡¶æ‡¶™ ‡¶á‡¶ó‡¶®‡ßã‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá
            });
        }
    }
};

        // üîä ‡¶Ö‡¶°‡¶ø‡¶ì ‡¶Ü‡¶®‡¶≤‡¶ï‡¶æ‡¶∞: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßã‡¶•‡¶æ‡¶ì ‡¶ü‡¶æ‡¶ö ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá
        const unlockAudio = () => {
            ['snd_click', 'snd_success', 'snd_bonus'].forEach(id => {
                const audio = document.getElementById(id);
                if(audio) {
                    audio.play().then(() => {
                        audio.pause();
                        audio.currentTime = 0;
                    }).catch(() => {});
                }
            });
            document.removeEventListener('click', unlockAudio);
            document.removeEventListener('touchstart', unlockAudio);
        };
        document.addEventListener('click', unlockAudio);
        document.addEventListener('touchstart', unlockAudio);
        // üîä ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° + ‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶π‡¶¨‡ßá
        const attachAppSounds = () => {
            document.querySelectorAll('button, .glass-card, .cursor-pointer, [onclick]').forEach(element => {
                element.addEventListener('click', () => {
                    window.playSound('snd_click'); // ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
                    if (navigator.vibrate) navigator.vibrate(30); // ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®
                });
            });
        };

      
        // ‚úÖ REAL-TIME LIVE PAYMENT PROOF
        const startLivePayoutNotifications = () => {
            // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá
            db.collection("history")
                .where("status", "==", "Success")
                .orderBy("date", "desc")
                .limit(1)
                .onSnapshot(snapshot => {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === "added") {
                            const data = change.doc.data();
                            // ‡¶Ø‡¶¶‡¶ø ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶®‡¶ü‡¶ø ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá‡¶á ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                            showLiveToast(data.name || "‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞", data.amount, data.type);
                        }
                    });
                });
        };

        const showLiveToast = (name, amount, type) => {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-24 left-4 right-4 z-[1000] animate__animated animate__fadeInUp';
            toast.innerHTML = `
                <div class="bg-slate-900/90 backdrop-blur-md border border-white/10 p-3 rounded-2xl flex items-center gap-3 shadow-2xl">
                    <div class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white shrink-0">
                        <i class="ri-check-double-line text-xl"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏‡¶´‡ßÅ‡¶≤! üéâ</p>
                        <p class="text-xs text-white"><b>${name}</b> ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ <b>‡ß≥${amount}</b> ${type === 'Withdraw' ? '‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞' : '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü'} ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§</p>
                    </div>
                </div>
            `;
            document.body.appendChild(toast);
            
            // ‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
            setTimeout(() => {
                toast.classList.replace('animate__fadeInUp', 'animate__fadeOutDown');
                setTimeout(() => toast.remove(), 1000);
            }, 4000);
        };

        // ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ
        setTimeout(startLivePayoutNotifications, 5000); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ñ‡ßã‡¶≤‡¶æ‡¶∞ ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá       
   
   // üõ°Ô∏è ANTI-SPAM SYSTEM (‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶†‡ßá‡¶ï‡¶æ‡¶®‡ßã)
let clickTracker = 0;
let clickTimer = null;
document.addEventListener('click', () => {
    clickTracker++;
    if (clickTracker > 15) { 
        showSmartToast('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ñ‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§', 'error');
        clickTracker = 0;
    }
    if (!clickTimer) {
        clickTimer = setTimeout(() => { 
            clickTracker = 0; 
            clickTimer = null;
        }, 5000);
    }
});

// üì¢ DYNAMIC ANNOUNCEMENT POPUP (CONNECTED TO ADMIN)
async function showAnnouncement() {
    window.playSound('snd_click');
    
    // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶ø (‡¶Ø‡¶¶‡¶ø ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá)
    let channelLink = "https://t.me/TAKAR_GACHH"; 
    let groupLink = "https://t.me/TAKAR_GACH_V27";
    
    // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßá‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ü‡¶®‡¶æ
    try {
        const doc = await db.collection("settings").doc("supportConfig").get();
        if (doc.exists) {
            const data = doc.data();
            if(data.telegramChannel) channelLink = data.telegramChannel;
            if(data.telegramGroup) groupLink = data.telegramGroup;
        }
    } catch(e) {
        console.log("Fetching links failed, using default.");
    }
    
    // ‡¶™‡¶™-‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
    Swal.fire({
        title: '<span class="text-blue-600 font-bold">‡¶Ö‡¶´‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</span>',
        html: `
            <div class="space-y-4 p-2 text-center">
                <p class="text-sm text-slate-600">‡¶∏‡¶¨ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶™‡ßá‡¶§‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶®‡•§</p>
                
                <a href="${channelLink}" target="_blank" style="text-decoration: none;">
                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-xl border border-blue-100 mb-2 hover:bg-blue-100 transition">
                        <i class="ri-telegram-fill text-3xl text-blue-500"></i>
                        <div class="text-left">
                            <p class="font-bold text-slate-800">‡¶Ö‡¶´‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</p>
                            <p class="text-xs text-blue-600">‡¶∏‡¶¨ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®</p>
                        </div>
                    </div>
                </a>

                <a href="${groupLink}" target="_blank" style="text-decoration: none;">
                    <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-xl border border-purple-100 hover:bg-purple-100 transition">
                        <i class="ri-group-fill text-3xl text-purple-500"></i>
                        <div class="text-left">
                            <p class="font-bold text-slate-800">‡¶Ö‡¶´‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</p>
                            <p class="text-xs text-purple-600">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶≤‡ßã‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        </div>
                    </div>
                </a>
            </div>
        `,
        showConfirmButton: true,
        confirmButtonText: '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá',
        confirmButtonColor: '#3b82f6',
        borderRadius: '20px'
    });
}
   
   
   // ‚úÖ MISSING FUNCTIONS ADDED HERE (‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°‡ßá ‡¶®‡ßá‡¶á, ‡¶§‡¶æ‡¶á ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®)

// ‡ßß. ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
async function loadMyTickets() {
    if(!currentUserId) return;
    
    const list = document.getElementById('myTicketList');
    list.innerHTML = '<div class="text-center py-4"><div class="w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto"></div></div>';

    try {
        // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
        const today = new Date().toLocaleDateString('bn-BD');
        
        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ï‡ßá‡¶®‡¶æ ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶Ü‡¶®‡¶æ
        const snapshot = await db.collection("lucky_tickets")
            .where("userId", "==", currentUserId)
            .where("date", "==", today)
            .orderBy("timestamp", "desc")
            .get();

        // ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        const count = snapshot.size;
        document.getElementById('luckyTicketCount').innerText = count;
        
        list.innerHTML = ''; // ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶´‡ßá‡¶≤‡¶æ

        if (snapshot.empty) {
            list.innerHTML = `
                <div class="text-center py-8 opacity-50">
                    <i class="ri-coupon-3-line text-4xl text-slate-300"></i>
                    <p class="text-xs font-bold text-slate-400 mt-2">‡¶Ü‡¶ú ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡ßá‡¶®‡¶æ ‡¶π‡ßü‡¶®‡¶ø</p>
                </div>`;
            return;
        }

        snapshot.forEach(doc => {
            const t = doc.data();
            list.innerHTML += `
                <div class="bg-white p-3 rounded-xl border border-purple-100 flex justify-between items-center shadow-sm animate__animated animate__fadeInUp">
                    <div class="flex items-center gap-3">
                        <div class="bg-purple-100 p-2 rounded-lg text-purple-600">
                            <i class="ri-ticket-2-fill text-xl"></i>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold">‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</p>
                            <h4 class="text-sm font-black text-slate-700 tracking-widest font-mono">#${t.ticketNumber}</h4>
                        </div>
                    </div>
                    <span class="bg-green-100 text-green-700 text-[10px] px-2 py-1 rounded font-bold">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠</span>
                </div>
            `;
        });

    } catch (e) {
        console.error("Ticket Load Error:", e);
        list.innerHTML = '<p class="text-center text-red-400 text-xs">‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>';
    }
}

// ‡ß®. ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡ßá‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶è‡¶ü‡¶ø‡¶ì ‡¶Æ‡¶ø‡¶∏‡¶ø‡¶Ç ‡¶õ‡¶ø‡¶≤)
window.buyLuckyTicket = async () => {
    if(!currentUserData) return;
    
    // ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡ßß‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ
    const ticketPrice = 10; 
    
    // ‡ßß. ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ö‡ßá‡¶ï
    if (currentUserData.mainBalance < ticketPrice) {
        showSmartToast('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!', 'error');
        return;
    }

    // ‡ß®. ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶ö‡ßá‡¶ï (‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡ßß‡ß¶‡¶ü‡¶ø)
    const currentCount = parseInt(document.getElementById('luckyTicketCount').innerText || '0');
    if (currentCount >= 10) {
        showSmartToast('‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ (‡ßß‡ß¶/‡ßß‡ß¶)! ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
        return;
    }

    // ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∂‡¶®
    const result = await Swal.fire({
        title: '‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡¶ø‡¶®‡¶¨‡ßá‡¶®?',
        text: `‡¶¶‡¶æ‡¶Æ: ‡ß≥${ticketPrice} ‡¶ü‡¶æ‡¶ï‡¶æ`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶ï‡¶ø‡¶®‡¶¨',
        cancelButtonText: '‡¶®‡¶æ',
        confirmButtonColor: '#7c3aed'
    });

    if (result.isConfirmed) {
        // üí∞ ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡ßá‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá Monetag ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶Ü‡¶∏‡¶¨‡ßá
        window.showMonetagAd(async () => {
            showLoading();
            try {
                const today = new Date().toLocaleDateString('bn-BD');
                const ticketNum = Math.floor(100000 + Math.random() * 900000); // ‡ß¨ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü

                // ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡¶æ
                await db.collection("users").doc(currentUserId).update({
                    mainBalance: firebase.firestore.FieldValue.increment(-ticketPrice)
                });

                // ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶∞‡¶æ‡¶ñ‡¶æ
                await db.collection("lucky_tickets").add({
                    userId: currentUserId,
                    userName: currentUserData.name,
                    ticketNumber: ticketNum,
                    price: ticketPrice,
                    date: today,
                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                // ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                await db.collection("history").add({
                    userId: currentUserId,
                    type: "‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü",
                    amount: -ticketPrice,
                    status: "Success",
                    details: `Ticket #${ticketNum}`,
                    date: today,
                    time: new Date().toLocaleTimeString('bn-BD'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                showSmartToast('‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ï‡ßá‡¶®‡¶æ ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá! üéâ', 'success');
                window.playSound('snd_success');
                
                // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                loadMyTickets(); 
                document.getElementById('luckyDrawBalance').innerText = (currentUserData.mainBalance - ticketPrice).toFixed(2);

            } catch (e) {
                console.error(e);
                showSmartToast('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
            }
            hideLoading();
        });
    }
};
   
   // ‚úÖ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶Æ ‡¶â‡¶á‡¶®‡¶æ‡¶∞ + ‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø + ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® (‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü)
async function runAutoLuckyDraw() {
    try {
        const todayStr = new Date().toLocaleDateString('bn-BD'); // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ
        const metaRef = db.collection("settings").doc("luckyDrawMeta");
        const metaDoc = await metaRef.get();

        // ‡ßß. ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá ‡¶Ü‡¶ú ‡¶°‡ßç‡¶∞ ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ
        if (metaDoc.exists && metaDoc.data().lastDrawDate === todayStr) {
            console.log("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶°‡ßç‡¶∞ ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            return;
        }

        // ‡ß®. ‡¶ó‡¶§‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
        const snapshot = await db.collection("lucky_tickets")
            .where("status", "==", "pending")
            .get();

        if (snapshot.empty) {
            console.log("‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶®‡ßá‡¶á‡•§");
            return;
        }

        // ‡ß©. ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶Æ‡¶≤‡¶ø ‡¶è‡¶ï‡¶ú‡¶®‡¶ï‡ßá ‡¶¨‡¶ø‡¶ú‡ßü‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡¶æ
        const allDocs = snapshot.docs;
        const randomIndex = Math.floor(Math.random() * allDocs.length);
        const winnerDoc = allDocs[randomIndex];
        const winnerData = winnerDoc.data();

        // ‡ß™. ‡ßß‡ßß ‡¶•‡ßá‡¶ï‡ßá ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶Æ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ (‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï ü§´)
        const randomPrize = Math.floor(Math.random() * (30 - 11 + 1)) + 11;

        // ‡ß´. ‡¶¨‡¶ø‡¶ú‡ßü‡ßÄ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ (‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
        let winnerPhone = "N/A";
        try {
            const uDoc = await db.collection("users").doc(winnerData.userId).get();
            if(uDoc.exists) winnerPhone = uDoc.data().phone;
        } catch(e) { console.log("Phone fetch error"); }

        // ‡ß¨. ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (Batch Update for consistency)
        const batch = db.batch();
        
        // ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶â‡¶á‡¶®‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
        batch.update(db.collection("lucky_tickets").doc(winnerDoc.id), { status: 'winner', prizeAmount: randomPrize });

        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã
        batch.update(db.collection("users").doc(winnerData.userId), {
            mainBalance: firebase.firestore.FieldValue.increment(randomPrize),
            totalEarnings: firebase.firestore.FieldValue.increment(randomPrize)
        });

        // ‡¶°‡ßç‡¶∞ ‡¶Æ‡ßá‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        batch.set(metaRef, { lastDrawDate: todayStr, lastWinner: winnerData.userName, prize: randomPrize });

        await batch.commit();

        // ‡ß≠. ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶§‡ßá ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
        await db.collection("history").add({
            userId: winnerData.userId,
            type: "‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ ‡¶ú‡ßü‡ßÄ üèÜ",
            amount: randomPrize,
            status: "Success",
            details: `‡¶ü‡¶ø‡¶ï‡ßá‡¶ü #${winnerData.ticketNumber} ‡¶¨‡¶ø‡¶ú‡ßü‡ßÄ! ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: ‡ß≥${randomPrize}`,
            date: todayStr,
            time: new Date().toLocaleTimeString('bn-BD'),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        // üöÄ ‡ßÆ. ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã (‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá)
        const tgMsg = `üé∞ *‡¶≤‡¶æ‡¶ï‡¶ø ‡¶°‡ßç‡¶∞ ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü* üé∞\n\nüë§ ‡¶¨‡¶ø‡¶ú‡ßü‡ßÄ: *${winnerData.userName}*\nüì± ‡¶´‡ßã‡¶®: \`${winnerPhone}\`\nüéü ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü: \`#${winnerData.ticketNumber}\`\nüí∞ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: *‡ß≥${randomPrize}*\nüìÖ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${todayStr}\n\n‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‚úÖ`;
        await sendTelegramNotification(tgMsg);

        // üéâ ‡ßØ. ‡¶ß‡ßÅ‡¶Æ‡¶ß‡¶æ‡¶Æ ‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® (‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶ß‡¶∞‡ßá ‡¶ö‡¶≤‡¶¨‡ßá)
        if(typeof confetti === 'function') {
            var duration = 3000;
            var end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5, angle: 60, spread: 55, origin: { x: 0 },
                    colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#purple']
                });
                confetti({
                    particleCount: 5, angle: 120, spread: 55, origin: { x: 1 },
                    colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#purple']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }
        
        // ‡ßß‡ß¶. ‡¶ü‡ßã‡¶∏‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
        showSmartToast(`üéâ ‡¶ó‡¶§ ‡¶°‡ßç‡¶∞ ‡¶è‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßü‡ßÄ: ${winnerData.userName} (‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: ‡ß≥${randomPrize})`, 'success');
        window.playSound('snd_bonus'); // ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°

    } catch (e) {
        console.error("Auto Draw Error:", e);
    }
}
   
// ‚úÖ GLOBAL TIMER VARIABLE
let luckyDrawInterval = null;

// ‚úÖ SHOW LUCKY DRAW PAGE WITH TIMER
window.showLuckyDraw = async () => {
    window.showPage('luckyDrawScreen');

runAutoLuckyDraw(); 

    // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    if(currentUserData) {
        // ‡¶∏‡ßá‡¶´‡¶ü‡¶ø ‡¶ö‡ßá‡¶ï: ‡¶á‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ
        const balanceEl = document.getElementById('luckyDrawBalance');
        if(balanceEl) balanceEl.innerText = currentUserData.mainBalance.toFixed(2);
    }
    
    // ‡¶ü‡¶ø‡¶ï‡ßá‡¶ü ‡¶≤‡ßã‡¶°
    if(typeof loadMyTickets === 'function') {
        loadMyTickets();
    }

    // üî• TIMER LOGIC START üî•
    const timerDisplay = document.getElementById('drawCountdown');
    
    // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
    if (luckyDrawInterval) clearInterval(luckyDrawInterval);

    // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶®‡¶æ ‡¶™‡ßá‡¶≤‡ßá ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶•‡¶æ‡¶Æ‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶® (‡¶è‡¶∞‡¶∞ ‡¶è‡ßú‡¶æ‡¶§‡ßá)
    if(!timerDisplay) return;

    const updateTimer = () => {
        const now = new Date();
        const midnight = new Date();
        
        // ‡¶∞‡¶æ‡¶§ ‡ßß‡ß® ‡¶ü‡¶æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ)
        midnight.setHours(24, 0, 0, 0);

        const diff = midnight - now;

        // ‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá
        if (diff <= 0) {
            timerDisplay.innerText = "00:00:00";
            return;
        }

        // ‡¶∏‡¶Æ‡ßü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶®
        const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
        const m = Math.floor((diff / (1000 * 60)) % 60);
        const s = Math.floor((diff / 1000) % 60);

        // ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶¶‡ßÅ‡¶á ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü)
        timerDisplay.innerText = 
            `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    };

    // ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ
    updateTimer();
    
    // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    luckyDrawInterval = setInterval(updateTimer, 1000);
};

// ‚úÖ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü
document.addEventListener('click', (e) => {
    // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶ú‡¶ø‡¶®‡¶ø‡¶∏‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶π‡ßü
    if (e.target.closest('button') || e.target.closest('.glass-card') || e.target.closest('.cursor-pointer')) {
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;

        confetti({
            particleCount: 15,
            spread: 40,
            origin: { x, y },
            colors: ['#059669', '#3b82f6', '#8b5cf6', '#f59e0b'],
            ticks: 50,
            gravity: 1.2,
            scalar: 0.7,
            shapes: ['circle']
        });
    }
});
   
   // ü§´ ‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡ßß: ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï (‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶§‡¶æ‡¶ï‡ßá ‡¶°‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ü‡ßç‡¶∞‡¶ø‡¶ï)
let originalTitle = document.title;
window.addEventListener('blur', () => {
    document.title = "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶ø ‡¶®‡¶ø‡¶¨‡ßá‡¶® ‡¶®‡¶æ? ‡ß≥"; // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
});
window.addEventListener('focus', () => {
    document.title = originalTitle; // ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶≤‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
});

// ü§´ ‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡ß®: ‡¶è‡¶®‡ßç‡¶ü‡¶ø-‡¶ö‡¶ø‡¶ü ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® (‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Å‡¶ï‡¶ø ‡¶¶‡¶ø‡¶≤‡ßá ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç)
document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        // ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶¨‡¶æ ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶ö‡¶≤‡¶æ‡¶ï‡¶æ‡¶≤‡ßÄ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡ßá
        if (window.taskTimer || window.quizTimer) {
            showSmartToast('‚ö†Ô∏è ‡¶™‡ßá‡¶ú ‡¶õ‡ßá‡ßú‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ! ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶ú ‡¶π‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§', 'error');
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]); // ‡¶¨‡¶ø‡¶™‡¶¶ ‡¶∏‡¶Ç‡¶ï‡ßá‡¶§ ‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®
        }
    }
});
   
   let packageCountdownInterval = null;

function startPackageCountdown() {
    // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶≠‡¶æ‡¶≤ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
    if (packageCountdownInterval) clearInterval(packageCountdownInterval);

    packageCountdownInterval = setInterval(() => {
        const timerBox = document.getElementById('activePackageTimer');
        
        // ‡ßß. ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶®‡¶æ
        if (!currentUserData || !currentUserData.packageExpiresAt || currentUserData.plan === "Free Member") {
            if(timerBox) timerBox.classList.add('hidden');
            return;
        }

        const expiryDate = currentUserData.packageExpiresAt.toDate(); // Firebase Timestamp to JS Date
        const now = new Date();
        const diff = expiryDate - now;

        // ‡ß®. ‡¶Ø‡¶¶‡¶ø ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü
        if (diff <= 0) {
            clearInterval(packageCountdownInterval);
            if(timerBox) timerBox.classList.add('hidden');
            // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶´‡ßç‡¶∞‡¶ø ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ (‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶á‡¶° ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶•‡ßá‡¶ï‡ßá‡¶ì ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü)
            return;
        }

        // ‡ß©. ‡¶∏‡¶Æ‡ßü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶®
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((diff / (1000 * 60)) % 60);
        const seconds = Math.floor((diff / 1000) % 60);

        // ‡ß™. UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        if(timerBox) {
            timerBox.classList.remove('hidden');
            document.getElementById('activePlanName').innerText = currentUserData.plan;
            document.getElementById('exp_days').innerText = days.toString().padStart(2, '0');
            document.getElementById('exp_hours').innerText = hours.toString().padStart(2, '0');
            document.getElementById('exp_mins').innerText = minutes.toString().padStart(2, '0');
            document.getElementById('exp_secs').innerText = seconds.toString().padStart(2, '0');
        }
    }, 1000);
}
   
   // ‡ßß. ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡ßü‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Smart Message ‡¶∏‡¶π)
window.shareReferralLink = async () => {
    const link = document.getElementById('referralLink').innerText;
    if(link === "‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...") return;

    const shareData = {
        title: '‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ - ‡¶ò‡¶∞‡ßá ‡¶¨‡¶∏‡ßá ‡¶Ü‡ßü',
        text: `‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ! üëã\n\n‡¶ò‡¶∞‡ßá ‡¶¨‡¶∏‡ßá ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ß´‡ß¶‡ß¶-‡ßß‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡ßü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶Ü‡¶ú‡¶á ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® "‡¶ü‡¶æ‡¶ï‡¶æ‡¶ì‡ßü‡¶æ‡¶≤‡¶æ" ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡•§\n\n‚úÖ ‡ßß‡ß¶‡ß¶% ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶∏‡ßç‡¶§\n‚úÖ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü\n‚úÖ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏\n\n‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶è‡¶ñ‡¶®‡¶á ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:\n`,
        url: link
    };

    try {
        if (navigator.share) {
            await navigator.share(shareData);
        } else {
            // ‡¶Ø‡¶¶‡¶ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶§‡¶¨‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ï‡¶™‡¶ø ‡¶π‡¶¨‡ßá
            window.copyReferralLink();
            showSmartToast('‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶è‡¶ñ‡¶® ‡¶Ø‡ßá ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§', 'success');
        }
    } catch (err) { console.log(err); }
};

// ‡ß®. ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
async function loadReferralList() {
    if(!currentUserData || !currentUserData.referralCode) return;
    const container = document.getElementById('referralListContainer');
    const myCode = currentUserData.referralCode.trim();

    container.innerHTML = '<div class="text-center py-10"><div class="w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"></div></div>';

    try {
        const snapshot = await db.collection("users").where("referredBy", "==", myCode).get();

        if (snapshot.empty) {
            container.innerHTML = `
                <div class="bg-slate-50 p-8 rounded-[30px] border border-dashed border-slate-200 text-center">
                    <p class="text-[11px] font-bold text-slate-400">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßá‡¶â ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡¶ø‡•§ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶á‡¶®‡¶≠‡¶æ‡¶á‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®!</p>
                </div>`;
            return;
        }

        container.innerHTML = '';
        snapshot.forEach(doc => {
            const data = doc.data();
            let date = data.createdAt ? new Date(data.createdAt.toDate()).toLocaleDateString('bn-BD') : '---';
            
            container.innerHTML += `
                <div class="bg-white p-4 rounded-2xl border border-slate-100 flex justify-between items-center shadow-sm animate__animated animate__fadeInUp">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center font-black text-slate-500 border border-white shadow-sm">
                            ${data.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="text-left">
                            <p class="text-sm font-bold text-slate-800">${data.name}</p>
                            <p class="text-[10px] text-slate-400">‡¶ú‡ßü‡ßá‡¶®‡¶ø‡¶Ç: ${date}</p>
                        </div>
                    </div>
                    <span class="text-[9px] font-bold text-emerald-600 bg-emerald-50 px-2.5 py-1 rounded-lg border border-emerald-100">‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span>
                </div>`;
        });
    } catch (e) { console.log(e); }
    
}

// ‚úÖ ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (With Monetag Ad)
window.processMagicPromo = async () => {
    const inputField = document.getElementById('userPromoInput');
    const promoCode = inputField.value.trim().toUpperCase();
    if (!promoCode) { showSmartToast('‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error'); return; }

    // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶¨‡ßá
    window.showMonetagAd(async () => {
        showLoading();
        try {
            const promoRef = db.collection("promo_codes").doc(promoCode);
            const doc = await promoRef.get();

            if (!doc.exists) {
                showSmartToast('‡¶≠‡ßÅ‡¶≤ ‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶°! ‚ùå', 'error');
            } else {
                const data = doc.data();
                const now = new Date();
                const expiry = data.expiryAt.toDate();
                const usedByCount = data.usedBy ? data.usedBy.length : 0;
                const promoLimit = data.limit || 0;

                if (now > expiry) { showSmartToast('‡¶ï‡ßã‡¶°‡¶ü‡¶ø‡¶∞ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑! ‚è∞', 'error'); } 
                else if (promoLimit > 0 && usedByCount >= promoLimit) { showSmartToast('‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑! üö´', 'error'); }
                else if (data.usedBy && data.usedBy.includes(currentUserId)) { showSmartToast('‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®! ‚úã', 'warning'); } 
                else {
                    const bonusAmount = data.amount || 0;
                    await db.collection("users").doc(currentUserId).update({
                        mainBalance: firebase.firestore.FieldValue.increment(bonusAmount),
                        totalEarnings: firebase.firestore.FieldValue.increment(bonusAmount)
                    });
                    await promoRef.update({ usedBy: firebase.firestore.FieldValue.arrayUnion(currentUserId) });
                    
                    await db.collection("history").add({
                        userId: currentUserId, type: "‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ üéÅ", amount: bonusAmount, status: "Success",
                        details: `Code: ${promoCode}`, date: new Date().toLocaleDateString('bn-BD'),
                        time: new Date().toLocaleTimeString('bn-BD'), timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    const tgMsg = `üéÅ *‡¶™‡ßç‡¶∞‡ßã‡¶Æ‡ßã ‡¶ï‡ßã‡¶° ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ*\n\nüë§ *‡¶á‡¶â‡¶ú‡¶æ‡¶∞:* ${currentUserData.name}\nüì± *‡¶´‡ßã‡¶®:* ${currentUserData.phone}\nüé´ *‡¶ï‡ßã‡¶°:* ${promoCode}\nüí∞ *‡¶¨‡ßã‡¶®‡¶æ‡¶∏:* ‡ß≥${bonusAmount}`;
                    await sendTelegramNotification(tgMsg);

                    if(typeof confetti === 'function') confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
                    window.playSound('snd_success');
                    inputField.value = '';
                    showSmartToast(`‡ß≥${bonusAmount} ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`, 'success');
                    window.showPage('homeScreen');
                }
            }
        } catch (e) { showSmartToast('‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!', 'error'); }
        hideLoading();
    });
};
                   
    </script>
    
        <audio id="snd_click" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>
<audio id="snd_success" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3" preload="auto"></audio>
<audio id="snd_bonus" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    
</body>
</html>
